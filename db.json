{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/freemind/source/css/comment.css","path":"css/comment.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/google-fonts.css","path":"css/google-fonts.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/font-awesome.css","path":"css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/highlight-default.min.css","path":"css/highlight-default.min.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/highlight.css","path":"css/highlight.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/responsive.css","path":"css/responsive.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/style.css","path":"css/style.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.eot","path":"fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.woff","path":"fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/img/github-sprite.png","path":"img/github-sprite.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/img/glyphicons-halflings-white.png","path":"img/glyphicons-halflings-white.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/img/glyphicons-halflings.png","path":"img/glyphicons-halflings.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/img/grid-18px-masked.png","path":"img/grid-18px-masked.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/img/grid-baseline-20px.png","path":"img/grid-baseline-20px.png","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/comment.js","path":"js/comment.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/gallery.js","path":"js/gallery.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/highlight.min.js","path":"js/highlight.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/jquery.imagesloaded.min.js","path":"js/jquery.imagesloaded.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/marked.js","path":"js/marked.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/spin.min.js","path":"js/spin.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/common.css","path":"css/themes/common.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/FontAwesome.otf","path":"fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.ttf","path":"fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/jquery-2.0.3.min.js","path":"js/jquery-2.0.3.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/js/timeago.min.js","path":"js/timeago.min.js","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/default.css","path":"css/themes/default.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/0AKsP294HTD-nvJgucYTaIbN6UDyHWBl620a-IRfuBk.woff","path":"fonts/google-fonts/0AKsP294HTD-nvJgucYTaIbN6UDyHWBl620a-IRfuBk.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/0XxGQsSc1g4rdRdjJKZrNBsxEYwM7FgeyaSgU71cLG0.woff","path":"fonts/google-fonts/0XxGQsSc1g4rdRdjJKZrNBsxEYwM7FgeyaSgU71cLG0.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/PIPMHY90P7jtyjpXuZ2cLD8E0i7KZn-EPnyo3HZu7kw.woff","path":"fonts/google-fonts/PIPMHY90P7jtyjpXuZ2cLD8E0i7KZn-EPnyo3HZu7kw.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/LKf8nhXsWg5ybwEGXk8UBQ.woff","path":"fonts/google-fonts/LKf8nhXsWg5ybwEGXk8UBQ.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/2UX7WLTfW3W8TclTUvlFyQ.woff","path":"fonts/google-fonts/2UX7WLTfW3W8TclTUvlFyQ.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/UyYrYy3ltEffJV9QueSi4RdbPw3QSf9R-kE0EsQUn2A.woff","path":"fonts/google-fonts/UyYrYy3ltEffJV9QueSi4RdbPw3QSf9R-kE0EsQUn2A.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/cj2hUnSRBhwmSPr9kS5899kZXW4sYc4BjuAIFc1SXII.woff","path":"fonts/google-fonts/cj2hUnSRBhwmSPr9kS5899kZXW4sYc4BjuAIFc1SXII.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/google-fonts/lILlYDvubYemzYzN7GbLkHhCUOGz7vYGh680lGh-uXM.woff","path":"fonts/google-fonts/lILlYDvubYemzYzN7GbLkHhCUOGz7vYGh680lGh-uXM.woff","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/bootstrap.css","path":"css/themes/bootstrap.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/cerulean.css","path":"css/themes/cerulean.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/cyborg.css","path":"css/themes/cyborg.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/darkly.css","path":"css/themes/darkly.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/lumen.css","path":"css/themes/lumen.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/readable.css","path":"css/themes/readable.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/sandstone.css","path":"css/themes/sandstone.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/simplex.css","path":"css/themes/simplex.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/slate.css","path":"css/themes/slate.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/spacelab.css","path":"css/themes/spacelab.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/superhero.css","path":"css/themes/superhero.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/united.css","path":"css/themes/united.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/cosmo.css","path":"css/themes/cosmo.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/flatly.css","path":"css/themes/flatly.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/journal.css","path":"css/themes/journal.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/paper.css","path":"css/themes/paper.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/css/themes/yeti.css","path":"css/themes/yeti.css","modified":1,"renderable":1},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.svg","path":"fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"source/images/20180407/CommemorateMyGrandpa.jpg","path":"images/20180407/CommemorateMyGrandpa.jpg","modified":1,"renderable":0}],"Cache":[{"_id":"themes/freemind/LICENSE","hash":"a708d11fd1944ab4b94b39a8c83c75f362a170d7","modified":1548827866000},{"_id":"themes/freemind/_config.yml.bak","hash":"d6d952c74956a7c0530a1519873dcdd8a30d7299","modified":1549958216000},{"_id":"themes/freemind/README.md","hash":"f74fa874b75eb9b77f38bbb260d67f21b67ad03d","modified":1548827866000},{"_id":"themes/freemind/_config.yml","hash":"28ce190c58d46977fff94d3b01485d3c750fbfa6","modified":1551864636000},{"_id":"source/_posts/Another Way to Generate a PrimeTable.md","hash":"bf094950d0ff6ead07be2710310e076ac3135c3a","modified":1548674898000},{"_id":"source/_posts/CommemorateMyGrandpa.md","hash":"c87c59fa2886e8976e4dd4fb022544c0bee1a9e7","modified":1551861858000},{"_id":"source/_posts/DeployBlogWithHexo.md","hash":"c46e07d7ac79a426e8c0f6c6fadf4c3b893b47f6","modified":1548674898000},{"_id":"themes/freemind/package.json","hash":"00357ef6f24eb049074da81809e98f973f528cca","modified":1548827868000},{"_id":"source/_posts/The Origins of the English Language.md","hash":"c4ba6557eb89e107d5629823d49deece9d3f7578","modified":1549960474000},{"_id":"source/_posts/TCG.md","hash":"49c51cc117422baed93161fcb4f3f3958a01189f","modified":1551864290000},{"_id":"source/_posts/HighPerformanceServer.md","hash":"502d78c04a98faf1bfc153067340837a014494b3","modified":1551864198000},{"_id":"source/_posts/cpp-conversion-operator.md.bak","hash":"e9b5f95a53f92858a8213527a419b693dd9def2f","modified":1553825934000},{"_id":"source/_posts/CppRvalueReference.md","hash":"b892c32fe3915a7eb7e8832c658f201cd2f54168","modified":1557210274000},{"_id":"source/_posts/IllustrateOfProtoBuf.md","hash":"c7f34249cde5830a61066e8f2b9657b33a0aebbb","modified":1551863236000},{"_id":"source/_posts/How-to-specify-a-newer-version-gcc-for-cmake.md","hash":"e9619ea007e5936ce7a5a0ed742f0d73d0431078","modified":1557210860000},{"_id":"source/_posts/The Lifetime of Food - Design is Refactoring.md","hash":"9851a9e82e807e6d798eb2be33a9d55498378454","modified":1551864418000},{"_id":"source/_posts/What I have learnt from the Dissertation of Danqi.md","hash":"93d8980fb7fc3ecdcbfe4de91a995e4b631591d3","modified":1551856928000},{"_id":"source/_posts/unsigned-intergers-in-cpp.md","hash":"c9fc20d05ac76fe6958b121b2291261e31f16e45","modified":1557210224000},{"_id":"source/about/index.md","hash":"72d513e1e1df1fe5941e0bfeb38d7922f594fe83","modified":1551863010000},{"_id":"source/categories/index.md","hash":"6fabd9f75d99959b1f23f6122eb0468e0b190ef2","modified":1548674898000},{"_id":"source/tags/index.md","hash":"954f9c93cacf3157e5ea5a913d96f8804a5c330b","modified":1548674900000},{"_id":"themes/freemind/languages/default.yml","hash":"6ea300b240139d3f363c66e105feed4113629c86","modified":1548827866000},{"_id":"themes/freemind/languages/pt-BR.yml","hash":"5909ce04246e958746c2d75a0dfd47076f8d0132","modified":1548827866000},{"_id":"themes/freemind/languages/zh-CN.yml","hash":"9a5392c125c20d1b64f7fdc8c22e1d30b4a8fbe4","modified":1548827866000},{"_id":"themes/freemind/languages/zh-TW.yml","hash":"44f8887b925454e7144c8c1bb9c8ca194cec969c","modified":1548827866000},{"_id":"themes/freemind/layout/archive.ejs","hash":"c97be36b33bb44957778587f00c978f2d28016f8","modified":1548827868000},{"_id":"themes/freemind/layout/categories.ejs","hash":"4702d93c9f437436138fb348ece828fe93f5b292","modified":1548827868000},{"_id":"themes/freemind/layout/index.ejs","hash":"2beec802d9dadb9369ffc7511304b1cc1feb96b0","modified":1548827868000},{"_id":"themes/freemind/layout/layout.ejs","hash":"288577e8d379364126679ae8466bee90b62bbda8","modified":1548827868000},{"_id":"themes/freemind/layout/page.ejs","hash":"21612a42b29cb20f106bc2716c598e69db142750","modified":1548827868000},{"_id":"themes/freemind/layout/post.ejs","hash":"dd2ad444d8a916a4f3fbcfb6e1b5f19890429ec4","modified":1548827868000},{"_id":"themes/freemind/layout/tags.ejs","hash":"67f650c3fac6c80548607f0369bfebacf56aba08","modified":1548827868000},{"_id":"themes/freemind/layout/_partial/after_footer.ejs","hash":"464732987cb5d1e47e52559b7a278880083b3819","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/archive.ejs","hash":"26c59710677bd6e0bfb194e98cdd27a41c97ce0d","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/article.ejs","hash":"21463a6393a1468778dbb49d0eb61c556bf4e869","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/footer.ejs","hash":"b4b55c57c4172931af355565ba404dc7dd367c21","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/head.ejs","hash":"8ee2e74f906710d52dadcc330d9db5bde7524d96","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/index.ejs","hash":"7f4b8d82522cc6034b8584230462cdc70d0b0567","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/index_pagination.ejs","hash":"bf4552d1eccce17865cacc717592bbd2bed7c573","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/navigation.ejs","hash":"f1fa4aefb27ef8f90b47b36a8d1d9aede8fdcaf1","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/search.ejs","hash":"a7c526c07a8af040ba285dc63f267004ce211dce","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/sidebar.ejs","hash":"862ff700568ec5a00f222131b353475d0a3f2a9c","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/category.ejs","hash":"9582012806de184f419a2230aa52ca20915a4115","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/links.ejs","hash":"c0452a56e4513efe03867734f5fbcb6715f9a852","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/recent_comments.ejs","hash":"b7f35a28bfafc858921f9065965ebbfb034ba781","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/recent_posts.ejs","hash":"8d1018d6b4b9c83a58efc11a2ceef86a2bbbeb17","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/search.ejs","hash":"620dd8a93a9f0fca63f6f0b520cf192ce7b5a645","modified":1548827868000},{"_id":"themes/freemind/layout/_widget/tagcloud.ejs","hash":"2bb6f4c3b2c10bc107f2d216bda34339ca045338","modified":1548827868000},{"_id":"themes/freemind/source/css/comment.css","hash":"acbef2bb5327b74fb68036ae238bc03514e4b4d8","modified":1548827868000},{"_id":"themes/freemind/source/css/google-fonts.css","hash":"91e629d0a0a531e920252788ed8863c26608c2b2","modified":1548827868000},{"_id":"themes/freemind/source/css/font-awesome.css","hash":"6df51eee1e75e450cb9cd71e925e6aa9ac2d6a9d","modified":1548827868000},{"_id":"themes/freemind/source/css/highlight-default.min.css","hash":"6ad10fd07f492660d5c8c8eaec6e74a94d277b4a","modified":1548827868000},{"_id":"themes/freemind/source/css/highlight.css","hash":"98a031dd0991929ec23098db9dfde15ae662f031","modified":1548827868000},{"_id":"themes/freemind/source/css/responsive.css","hash":"25136a75af5957a669d5c4782da8b8fa95f8fc55","modified":1548827868000},{"_id":"themes/freemind/source/css/style.css","hash":"0bff700f4fb1ea229c7cba92e57313149f6b9585","modified":1548827868000},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.eot","hash":"0183979056f0b87616cd99d5c54a48f3b771eee6","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1548827870000},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.woff","hash":"7d65e0227d0d7cdc1718119cd2a7dce0638f151c","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1548827870000},{"_id":"themes/freemind/source/fancybox/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1548827870000},{"_id":"themes/freemind/source/img/github-sprite.png","hash":"4d7ee33beaaebf002ba57a172d159e46194ae481","modified":1548827870000},{"_id":"themes/freemind/source/img/glyphicons-halflings-white.png","hash":"a25c4705320fd63c33790e666872910e702b9bf6","modified":1548827870000},{"_id":"themes/freemind/source/img/glyphicons-halflings.png","hash":"84f613631b07d4fe22acbab50e551c0fe04bd78b","modified":1548827870000},{"_id":"themes/freemind/source/img/grid-18px-masked.png","hash":"1379b689836f9fcccd88aa729c4034d6b36e1f3c","modified":1548827870000},{"_id":"themes/freemind/source/img/grid-baseline-20px.png","hash":"43b8d0c9b39f5ce07ecfde036fd13f835c129238","modified":1548827870000},{"_id":"themes/freemind/source/js/bootstrap.min.js","hash":"6c264e0e0026ab5ece49350c6a8812398e696cbb","modified":1548827870000},{"_id":"themes/freemind/source/js/comment.js","hash":"5cdafe054baa2ef66670ed46e6f862718e77bfcb","modified":1548827870000},{"_id":"themes/freemind/source/js/gallery.js","hash":"d19f1b1cc5b75e21ca1d643b6dae9490ead28b55","modified":1548827870000},{"_id":"themes/freemind/source/js/highlight.min.js","hash":"02bb4cdaf43c85b7ee4ef6ccf1f3fe8e82fd3ceb","modified":1548827870000},{"_id":"themes/freemind/source/js/jquery.imagesloaded.min.js","hash":"3eb6381d2ed4b706020e4be5aff024aab4bcabc5","modified":1548827870000},{"_id":"themes/freemind/source/js/main.js","hash":"d78290344d95646172e488e0af2dade9740288f8","modified":1548827870000},{"_id":"themes/freemind/source/js/marked.js","hash":"b1d4ef560ea01a5fe3a391a5933be5e7016f1d6a","modified":1548827870000},{"_id":"themes/freemind/source/js/search.js","hash":"6197e425941f107761d3cbfb0f06ad4a3f5f7427","modified":1548827870000},{"_id":"themes/freemind/source/js/spin.min.js","hash":"f91e2b661f4feb976b5e260bdc2366763ad13562","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/common.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1548827868000},{"_id":"themes/freemind/source/fonts/FontAwesome.otf","hash":"6270a4a561a69fef5f5cc18cdf9efc256ec2ccbe","modified":1548827870000},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.ttf","hash":"6225ccc4ec94d060f19efab97ca42d842845b949","modified":1548827870000},{"_id":"themes/freemind/source/js/jquery-2.0.3.min.js","hash":"28daf1b2a995cc4de81154a9a9ebdbb98f7c9997","modified":1548827870000},{"_id":"themes/freemind/source/js/timeago.min.js","hash":"d220fcc47be00effec6b5181b97cc0929d10031e","modified":1548827870000},{"_id":"themes/freemind/layout/_partial/post/bdshare.ejs","hash":"24c91ac17714ea39120a18633c3611b15464e5ab","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/analytics.ejs","hash":"31a0a3e5bc616b847c1ed82293fb3a3fc97054be","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/category.ejs","hash":"54c22e9df09949f59298b21bb2fd55b01fa68845","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/comment.ejs","hash":"6215f957e22e1041ed7990f996cf6806a34a5c29","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/comment_footer.ejs","hash":"fefc355eb4d61d08ffca7f6439fecb146696265e","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/entry.ejs","hash":"af003040bc93a1f0f710ab6a81db22a512f03646","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/jiathis.ejs","hash":"6fbf47f67e6f18fe4fea7fff6b564d29512469b5","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/meta.ejs","hash":"70b3b1dc3b039db3ef6f5e88709d0d4d5a8034a5","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/pagination.ejs","hash":"3336c168120c33e63cbfefc2c4f24c2562282d38","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/recommended_posts.ejs","hash":"68c27c333534a23d1037a2bfd136bef1468389cb","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/share.ejs","hash":"24c04b319f1b19e887c42db961b90a7e0ab26fdc","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/slogan.ejs","hash":"f82820a4af877570074895927f3bddc3b4b6a4fa","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/tag.ejs","hash":"ca231a24b4d17206991da3468842dd8610d94080","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/title.ejs","hash":"edfa78ed7a845d15bb43eca6268115704ec8072e","modified":1548827866000},{"_id":"themes/freemind/layout/_partial/post/title_top.ejs","hash":"de37bbb4b36fcb9d66a3d6efdd40a668087d75c2","modified":1548827866000},{"_id":"themes/freemind/source/css/themes/default.css","hash":"32f758d295c7037f247d300f2481b5d7d4f3b100","modified":1548827868000},{"_id":"themes/freemind/source/fonts/google-fonts/0AKsP294HTD-nvJgucYTaIbN6UDyHWBl620a-IRfuBk.woff","hash":"1d9bb14c006d39d7eb0812a85567c7431f899b8d","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/0XxGQsSc1g4rdRdjJKZrNBsxEYwM7FgeyaSgU71cLG0.woff","hash":"33225e85c33279e7b4f0c5c65ff93bec740dd59c","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/PIPMHY90P7jtyjpXuZ2cLD8E0i7KZn-EPnyo3HZu7kw.woff","hash":"18dc51e642b4df958098d3bbc6d3ba0237ef6150","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/LKf8nhXsWg5ybwEGXk8UBQ.woff","hash":"f401d51152681048c06187c5d3919b1407b899c5","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/2UX7WLTfW3W8TclTUvlFyQ.woff","hash":"87deb174af2e2beebb9f09d618a5159ca299a3d0","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/UyYrYy3ltEffJV9QueSi4RdbPw3QSf9R-kE0EsQUn2A.woff","hash":"d9f913d09bb3c25749daf8e7ab829c850a842929","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/cj2hUnSRBhwmSPr9kS5899kZXW4sYc4BjuAIFc1SXII.woff","hash":"17a484b92c0dacc8e8b4f0d38ccc1db400819d1d","modified":1548827870000},{"_id":"themes/freemind/source/fonts/google-fonts/lILlYDvubYemzYzN7GbLkHhCUOGz7vYGh680lGh-uXM.woff","hash":"e6c9f1e5a6a966a8f7250201356f351890a48921","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/bootstrap.css","hash":"11197c2fc2925b34cc98a3f4ec67ffdd9f36a760","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/cerulean.css","hash":"7fee0903cce12483ae3f37d330ef693826a5a61f","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/cyborg.css","hash":"4320dbfd9543f6ef1cc703d83d85c6652f9272d0","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/darkly.css","hash":"581ff4339a616fe26b4dc1b6c1d1ad7946b83de6","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/lumen.css","hash":"5c23c4a98aec86b8483040e0ca602d3a4574f32c","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/readable.css","hash":"af59c50f83bba69a4fef7d0ac32e309c903b4511","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/sandstone.css","hash":"5878440ffa7e1656214bafd8b7f39d736219807a","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/simplex.css","hash":"b8165c48cf72e54c1f8ae1a550a04a64e6ce1929","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/slate.css","hash":"3859265e9fcdb579f40a2ef7a5bd8dbead2d13ca","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/spacelab.css","hash":"fa4efbf50ca392c25e9b6395d6221696ec6573b6","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/superhero.css","hash":"cc4ce979e1def77b7c9b250d97d0baf3e0a3f845","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/united.css","hash":"857151fa534842d0f8e862b2067f22905a1b3382","modified":1548827870000},{"_id":"themes/freemind/source/css/themes/cosmo.css","hash":"bcb36ab2b547571fa4125e05e1074abba6bd5670","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/flatly.css","hash":"a95865761e69d0daf75660e24d9f5f316482ea55","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/journal.css","hash":"b77cda6baedc3852c64f5664206356b3057b4781","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/paper.css","hash":"1ae57ddb500a85b8ca8e7d2897e55cb2ba4cf1bc","modified":1548827868000},{"_id":"themes/freemind/source/css/themes/yeti.css","hash":"7cb64c45bed521321e0a4a57e05e3d1c87721f16","modified":1548827870000},{"_id":"themes/freemind/source/fonts/fontawesome-webfont.svg","hash":"cd980eab6db5fa57db670cb2e4278e67e1a4d6c9","modified":1548827870000},{"_id":"source/images/20180407/CommemorateMyGrandpa.jpg","hash":"8ad01453e54b3f9b546faa8bccc3dfa53250e2a6","modified":1548674898000},{"_id":"public/search.xml","hash":"59200bae248bbca159e316cdb275878b931a95ed","modified":1557210956723},{"_id":"public/about/index.html","hash":"e0685b84360e38271694f7f1ee88b0f9937d1ffa","modified":1557210956983},{"_id":"public/categories/index.html","hash":"4ad02fd3913f83061bcc10c3ebd7c717d189d760","modified":1557210956983},{"_id":"public/2019/01/18/DeployBlogWithHexo/index.html","hash":"3f0d50b08bf00f02c8cd02d0ad73dfd04eabd9cc","modified":1557210956994},{"_id":"public/2018/04/07/CommemorateMyGrandpa/index.html","hash":"928716928691ad764cde24fbc37cb9a670016538","modified":1557210956994},{"_id":"public/2016/12/23/Another Way to Generate a PrimeTable/index.html","hash":"554d7c5c3966ae0fce378fa5eb7c4967462b37e2","modified":1557210956994},{"_id":"public/2014/12/03/The Origins of the English Language/index.html","hash":"ee8d92d007ab2948eaaca6f40b007ddefcc2346c","modified":1557210956994},{"_id":"public/categories/Algorithm/index.html","hash":"c6804c6f533e17e32f154178920c0ba0c1d3d1ca","modified":1557210956994},{"_id":"public/categories/rumination/index.html","hash":"cf1b79215e9f71ac8f4cb019f47742e8d97f177c","modified":1557210956995},{"_id":"public/categories/history/index.html","hash":"aaabfaa220d6c68add0761858d368bf3afffd779","modified":1557210956995},{"_id":"public/categories/translation/index.html","hash":"a8b325d9ebbd2ebaf16b297df49ba3ca6331aa49","modified":1557210956995},{"_id":"public/categories/cpp/index.html","hash":"2daf29e3b94ebe55543a377956f43c27b9b1d666","modified":1557210956995},{"_id":"public/categories/opensource/index.html","hash":"ececbdefeaeac0e1676d9f7122725d72eec26494","modified":1557210956995},{"_id":"public/archives/index.html","hash":"9804e7d6202d7bb347fc6a9da396f516aa1204d1","modified":1557210956995},{"_id":"public/archives/page/2/index.html","hash":"65d8f917cd75ff63595764e7543e265bb4a5ce82","modified":1557210956995},{"_id":"public/archives/2014/index.html","hash":"d54b8caad615bd6fe8f04dcaea7344ffe3d114c6","modified":1557210956995},{"_id":"public/archives/2016/index.html","hash":"165ce82163474d5b1c3bcc3413b8c71060bd47c5","modified":1557210956995},{"_id":"public/archives/2014/12/index.html","hash":"bb2b24da4e27d54d8bc180937a3674b91b5ebc4a","modified":1557210956995},{"_id":"public/archives/2016/03/index.html","hash":"74b00ea63c5eb49cb72134255ae8efbcebb58da9","modified":1557210956995},{"_id":"public/archives/2016/12/index.html","hash":"4cec7060d199104a972cc95504906ce9e4c13a02","modified":1557210956995},{"_id":"public/archives/2018/index.html","hash":"0e5b4f1443f70e72c66c2f409c1a3ad45cb4af5b","modified":1557210956995},{"_id":"public/archives/2018/04/index.html","hash":"8985402c19ac5dec0d8c2c1a625fcc5b94cb4eb3","modified":1557210956995},{"_id":"public/archives/2019/index.html","hash":"98e40b9b71179f96b14d30486bd3854d798f3556","modified":1557210956995},{"_id":"public/archives/2019/01/index.html","hash":"296e140ed176658fb51763959c094949fe1419d1","modified":1557210956996},{"_id":"public/archives/2019/02/index.html","hash":"83f7949a1cca29fef7675c0086aba5e1f7a4761e","modified":1557210956996},{"_id":"public/archives/2019/03/index.html","hash":"48f783b86bae459cf65f7c28132d42441f0c00c3","modified":1557210956996},{"_id":"public/archives/2019/04/index.html","hash":"0acd7643c3eaa974dbf0f6fcc0d47b31cd33a1d7","modified":1557210956996},{"_id":"public/tags/grandpa/index.html","hash":"ed5dbd6465ed5b05acc944957a53fb2ea12f2a56","modified":1557210956996},{"_id":"public/tags/blog/index.html","hash":"524d6e07b2e83a0c0df022db2acde881d2292e47","modified":1557210956996},{"_id":"public/tags/hexo/index.html","hash":"83db0a0cb0c6f7f1aefd85badae6962a4da78d7f","modified":1557210956996},{"_id":"public/tags/dissertation/index.html","hash":"18cc135600790ffd9c56e5993a1002b1b4139334","modified":1557210956996},{"_id":"public/tags/c-2-0/index.html","hash":"357a5c7e4a5e941ba3a04c092ac005bd8be29a53","modified":1557210956996},{"_id":"public/tags/TCG/index.html","hash":"53c727f9041f1ef40c77474a3922472bf8f7de41","modified":1557210956996},{"_id":"public/tags/protobuf/index.html","hash":"6d221af67c0a36721742f5e298109da6c2ba338b","modified":1557210956996},{"_id":"public/tags/rust/index.html","hash":"7096f58dd39e99be761f409182a2951a0a1000f7","modified":1557210956997},{"_id":"public/tags/Linux/index.html","hash":"b90ec3c063d76b27473c001bc60fe0f27f38fcf8","modified":1557210956997},{"_id":"public/tags/High-Performance/index.html","hash":"9d862797b89b2e50a9074277476496b97fc6819b","modified":1557210956997},{"_id":"public/page/2/index.html","hash":"7e3e384c54a521827e96168ff4ce1c16b41e9479","modified":1557210956997},{"_id":"public/tags/index.html","hash":"019e6b951b88acf6a5438711146efb3fe347a645","modified":1557210956997},{"_id":"public/2019/04/10/How-to-specify-a-newer-version-gcc-for-cmake/index.html","hash":"07bf2db9bb7130eb699eb6f99c8fd78c37eb64ff","modified":1557210956997},{"_id":"public/2019/03/06/The Lifetime of Food - Design is Refactoring/index.html","hash":"de2159be5c5de29df760208ffda7ebd680b45ed7","modified":1557210956997},{"_id":"public/2019/03/03/What I have learnt from the Dissertation of Danqi/index.html","hash":"5fc1573b8011e8ccfbed520466e5805fccf09c89","modified":1557210956997},{"_id":"public/2019/02/14/CppRvalueReference/index.html","hash":"f14558c27f7153df57975ac3193770782d89c3e9","modified":1557210956997},{"_id":"public/2019/01/30/TCG/index.html","hash":"d95bf63de3e102d44c5d3b489e02b709cfef4775","modified":1557210956997},{"_id":"public/2019/01/28/HighPerformanceServer/index.html","hash":"4c575ab99ff9beda1db829fccabf40c082ddd1f1","modified":1557210956997},{"_id":"public/2016/03/16/IllustrateOfProtoBuf/index.html","hash":"fbc1156ada6a6014268161ae478db71eb92c7384","modified":1557210956997},{"_id":"public/index.html","hash":"ea6c1a78c6f21b6844c8b826e65cb0d6b2e23876","modified":1557210956998},{"_id":"public/archives/2019/05/index.html","hash":"e395a3aa906e2d335ddd689fa3ccc4649cdbf58d","modified":1557210957003},{"_id":"public/tags/cpp/index.html","hash":"4dbaf541f7ba9c37b8224b8a40129ede1a9e850b","modified":1557210957003},{"_id":"public/2019/05/07/unsigned-intergers-in-cpp/index.html","hash":"4f9be9152c5308edc1fc7eae0485d2554cd997d7","modified":1557210957003},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1557210957003},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1557210957003},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1557210957003},{"_id":"public/fonts/fontawesome-webfont.woff","hash":"7d65e0227d0d7cdc1718119cd2a7dce0638f151c","modified":1557210957003},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1557210957003},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1557210957003},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1557210957003},{"_id":"public/img/github-sprite.png","hash":"4d7ee33beaaebf002ba57a172d159e46194ae481","modified":1557210957003},{"_id":"public/img/glyphicons-halflings-white.png","hash":"a25c4705320fd63c33790e666872910e702b9bf6","modified":1557210957008},{"_id":"public/img/glyphicons-halflings.png","hash":"84f613631b07d4fe22acbab50e551c0fe04bd78b","modified":1557210957008},{"_id":"public/img/grid-18px-masked.png","hash":"1379b689836f9fcccd88aa729c4034d6b36e1f3c","modified":1557210957008},{"_id":"public/img/grid-baseline-20px.png","hash":"43b8d0c9b39f5ce07ecfde036fd13f835c129238","modified":1557210957008},{"_id":"public/fonts/google-fonts/0AKsP294HTD-nvJgucYTaIbN6UDyHWBl620a-IRfuBk.woff","hash":"1d9bb14c006d39d7eb0812a85567c7431f899b8d","modified":1557210957008},{"_id":"public/fonts/google-fonts/0XxGQsSc1g4rdRdjJKZrNBsxEYwM7FgeyaSgU71cLG0.woff","hash":"33225e85c33279e7b4f0c5c65ff93bec740dd59c","modified":1557210957008},{"_id":"public/fonts/google-fonts/LKf8nhXsWg5ybwEGXk8UBQ.woff","hash":"f401d51152681048c06187c5d3919b1407b899c5","modified":1557210957008},{"_id":"public/fonts/google-fonts/PIPMHY90P7jtyjpXuZ2cLD8E0i7KZn-EPnyo3HZu7kw.woff","hash":"18dc51e642b4df958098d3bbc6d3ba0237ef6150","modified":1557210957008},{"_id":"public/fonts/google-fonts/2UX7WLTfW3W8TclTUvlFyQ.woff","hash":"87deb174af2e2beebb9f09d618a5159ca299a3d0","modified":1557210957008},{"_id":"public/fonts/google-fonts/cj2hUnSRBhwmSPr9kS5899kZXW4sYc4BjuAIFc1SXII.woff","hash":"17a484b92c0dacc8e8b4f0d38ccc1db400819d1d","modified":1557210957008},{"_id":"public/fonts/google-fonts/UyYrYy3ltEffJV9QueSi4RdbPw3QSf9R-kE0EsQUn2A.woff","hash":"d9f913d09bb3c25749daf8e7ab829c850a842929","modified":1557210957008},{"_id":"public/fonts/google-fonts/lILlYDvubYemzYzN7GbLkHhCUOGz7vYGh680lGh-uXM.woff","hash":"e6c9f1e5a6a966a8f7250201356f351890a48921","modified":1557210957008},{"_id":"public/fonts/fontawesome-webfont.eot","hash":"0183979056f0b87616cd99d5c54a48f3b771eee6","modified":1557210957009},{"_id":"public/css/comment.css","hash":"acbef2bb5327b74fb68036ae238bc03514e4b4d8","modified":1557210957009},{"_id":"public/css/google-fonts.css","hash":"91e629d0a0a531e920252788ed8863c26608c2b2","modified":1557210957009},{"_id":"public/css/highlight-default.min.css","hash":"6ad10fd07f492660d5c8c8eaec6e74a94d277b4a","modified":1557210957009},{"_id":"public/css/highlight.css","hash":"98a031dd0991929ec23098db9dfde15ae662f031","modified":1557210957009},{"_id":"public/css/responsive.css","hash":"25136a75af5957a669d5c4782da8b8fa95f8fc55","modified":1557210957009},{"_id":"public/fancybox/jquery.fancybox.css","hash":"5f163444617b6cf267342f06ac166a237bb62df9","modified":1557210957009},{"_id":"public/fonts/FontAwesome.otf","hash":"6270a4a561a69fef5f5cc18cdf9efc256ec2ccbe","modified":1557210957318},{"_id":"public/fonts/fontawesome-webfont.ttf","hash":"6225ccc4ec94d060f19efab97ca42d842845b949","modified":1557210957319},{"_id":"public/js/gallery.js","hash":"d19f1b1cc5b75e21ca1d643b6dae9490ead28b55","modified":1557210957321},{"_id":"public/js/jquery.imagesloaded.min.js","hash":"3eb6381d2ed4b706020e4be5aff024aab4bcabc5","modified":1557210957321},{"_id":"public/js/main.js","hash":"d78290344d95646172e488e0af2dade9740288f8","modified":1557210957321},{"_id":"public/css/themes/common.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1557210957321},{"_id":"public/js/spin.min.js","hash":"f91e2b661f4feb976b5e260bdc2366763ad13562","modified":1557210957321},{"_id":"public/js/search.js","hash":"6197e425941f107761d3cbfb0f06ad4a3f5f7427","modified":1557210957322},{"_id":"public/js/timeago.min.js","hash":"d220fcc47be00effec6b5181b97cc0929d10031e","modified":1557210957322},{"_id":"public/css/themes/default.css","hash":"32f758d295c7037f247d300f2481b5d7d4f3b100","modified":1557210957322},{"_id":"public/css/style.css","hash":"0bff700f4fb1ea229c7cba92e57313149f6b9585","modified":1557210957322},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"53360764b429c212f424399384417ccc233bb3be","modified":1557210958742},{"_id":"public/js/comment.js","hash":"5cdafe054baa2ef66670ed46e6f862718e77bfcb","modified":1557210959006},{"_id":"public/css/font-awesome.css","hash":"6df51eee1e75e450cb9cd71e925e6aa9ac2d6a9d","modified":1557210959006},{"_id":"public/js/marked.js","hash":"b1d4ef560ea01a5fe3a391a5933be5e7016f1d6a","modified":1557210959206},{"_id":"public/js/bootstrap.min.js","hash":"6c264e0e0026ab5ece49350c6a8812398e696cbb","modified":1557210959302},{"_id":"public/js/highlight.min.js","hash":"02bb4cdaf43c85b7ee4ef6ccf1f3fe8e82fd3ceb","modified":1557210959336},{"_id":"public/fonts/fontawesome-webfont.svg","hash":"cd980eab6db5fa57db670cb2e4278e67e1a4d6c9","modified":1557210959357},{"_id":"public/images/20180407/CommemorateMyGrandpa.jpg","hash":"8ad01453e54b3f9b546faa8bccc3dfa53250e2a6","modified":1557210959527},{"_id":"public/js/jquery-2.0.3.min.js","hash":"28daf1b2a995cc4de81154a9a9ebdbb98f7c9997","modified":1557210959535},{"_id":"public/css/themes/bootstrap.css","hash":"11197c2fc2925b34cc98a3f4ec67ffdd9f36a760","modified":1557210959536},{"_id":"public/css/themes/united.css","hash":"857151fa534842d0f8e862b2067f22905a1b3382","modified":1557210959543},{"_id":"public/css/themes/cyborg.css","hash":"4320dbfd9543f6ef1cc703d83d85c6652f9272d0","modified":1557210959543},{"_id":"public/css/themes/cerulean.css","hash":"7fee0903cce12483ae3f37d330ef693826a5a61f","modified":1557210959544},{"_id":"public/css/themes/readable.css","hash":"af59c50f83bba69a4fef7d0ac32e309c903b4511","modified":1557210959544},{"_id":"public/css/themes/sandstone.css","hash":"5878440ffa7e1656214bafd8b7f39d736219807a","modified":1557210959544},{"_id":"public/css/themes/simplex.css","hash":"b8165c48cf72e54c1f8ae1a550a04a64e6ce1929","modified":1557210959544},{"_id":"public/css/themes/superhero.css","hash":"cc4ce979e1def77b7c9b250d97d0baf3e0a3f845","modified":1557210959544},{"_id":"public/css/themes/spacelab.css","hash":"fa4efbf50ca392c25e9b6395d6221696ec6573b6","modified":1557210959544},{"_id":"public/css/themes/cosmo.css","hash":"bcb36ab2b547571fa4125e05e1074abba6bd5670","modified":1557210959544},{"_id":"public/css/themes/flatly.css","hash":"a95865761e69d0daf75660e24d9f5f316482ea55","modified":1557210959545},{"_id":"public/css/themes/journal.css","hash":"b77cda6baedc3852c64f5664206356b3057b4781","modified":1557210959545},{"_id":"public/css/themes/yeti.css","hash":"7cb64c45bed521321e0a4a57e05e3d1c87721f16","modified":1557210959545},{"_id":"public/css/themes/darkly.css","hash":"581ff4339a616fe26b4dc1b6c1d1ad7946b83de6","modified":1557210959545},{"_id":"public/css/themes/lumen.css","hash":"5c23c4a98aec86b8483040e0ca602d3a4574f32c","modified":1557210959545},{"_id":"public/css/themes/paper.css","hash":"1ae57ddb500a85b8ca8e7d2897e55cb2ba4cf1bc","modified":1557210959554},{"_id":"public/css/themes/slate.css","hash":"3859265e9fcdb579f40a2ef7a5bd8dbead2d13ca","modified":1557210959554}],"Category":[{"name":"Algorithm","_id":"cjvdf735c0004t0t85z0mjr0u"},{"name":"rumination","_id":"cjvdf735j000at0t8z3q48xc2"},{"name":"history","_id":"cjvdf735o000ft0t8gujyfivd"},{"name":"translation","_id":"cjvdf735q000it0t815p2u6lx"},{"name":"cpp","_id":"cjvdf735t000qt0t8bsvw8wo8"},{"name":"opensource","_id":"cjvdf736r000zt0t82cwv7sdl"}],"Data":[],"Page":[{"title":"about me","date":"2019-01-18T17:33:34.000Z","keywords":["CV","skills"],"_content":"\nHong ZHANG\n\n### Objective ###\n`C++` developer \n\n### Personal skills ###\n* Familiar with the basic **data structures and algorithms**, familiar with **STL**.\n* Familiar with `C/C++/Qt` development in *Linux/windows*, familiar with **vim/gcc/gdb/vs/eclipse**.\n* Familiar with **Object-Oriented** and **Object-Based** programming, familiar with common **design pattern**.\n* Familiar UML, be able to write **design, implementation and test docs**.\n* Familiar with **multiple-thread** and **network programming**, know *libevent* and *muduo* network kit.\n* Familiar with `shell`, know `Perl/Python`.\n\n### Self-assessment ###\nLove life, love techs; prefer independent thinking and be willing to share.\n\n","source":"about/index.md","raw":"---\ntitle: about me\ndate: 2019-01-19 01:33:34\nkeywords: [CV, skills]\n---\n\nHong ZHANG\n\n### Objective ###\n`C++` developer \n\n### Personal skills ###\n* Familiar with the basic **data structures and algorithms**, familiar with **STL**.\n* Familiar with `C/C++/Qt` development in *Linux/windows*, familiar with **vim/gcc/gdb/vs/eclipse**.\n* Familiar with **Object-Oriented** and **Object-Based** programming, familiar with common **design pattern**.\n* Familiar UML, be able to write **design, implementation and test docs**.\n* Familiar with **multiple-thread** and **network programming**, know *libevent* and *muduo* network kit.\n* Familiar with `shell`, know `Perl/Python`.\n\n### Self-assessment ###\nLove life, love techs; prefer independent thinking and be willing to share.\n\n","updated":"2019-03-06T09:03:30.000Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjvdf73580001t0t8j4dqwaz0","content":"<p>Hong ZHANG</p>\n<h3 id=\"Objective\"><a href=\"#Objective\" class=\"headerlink\" title=\"Objective\"></a>Objective</h3><p><code>C++</code> developer </p>\n<h3 id=\"Personal-skills\"><a href=\"#Personal-skills\" class=\"headerlink\" title=\"Personal skills\"></a>Personal skills</h3><ul>\n<li>Familiar with the basic <strong>data structures and algorithms</strong>, familiar with <strong>STL</strong>.</li>\n<li>Familiar with <code>C/C++/Qt</code> development in <em>Linux/windows</em>, familiar with <strong>vim/gcc/gdb/vs/eclipse</strong>.</li>\n<li>Familiar with <strong>Object-Oriented</strong> and <strong>Object-Based</strong> programming, familiar with common <strong>design pattern</strong>.</li>\n<li>Familiar UML, be able to write <strong>design, implementation and test docs</strong>.</li>\n<li>Familiar with <strong>multiple-thread</strong> and <strong>network programming</strong>, know <em>libevent</em> and <em>muduo</em> network kit.</li>\n<li>Familiar with <code>shell</code>, know <code>Perl/Python</code>.</li>\n</ul>\n<h3 id=\"Self-assessment\"><a href=\"#Self-assessment\" class=\"headerlink\" title=\"Self-assessment\"></a>Self-assessment</h3><p>Love life, love techs; prefer independent thinking and be willing to share.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Hong ZHANG</p>\n<h3 id=\"Objective\"><a href=\"#Objective\" class=\"headerlink\" title=\"Objective\"></a>Objective</h3><p><code>C++</code> developer </p>\n<h3 id=\"Personal-skills\"><a href=\"#Personal-skills\" class=\"headerlink\" title=\"Personal skills\"></a>Personal skills</h3><ul>\n<li>Familiar with the basic <strong>data structures and algorithms</strong>, familiar with <strong>STL</strong>.</li>\n<li>Familiar with <code>C/C++/Qt</code> development in <em>Linux/windows</em>, familiar with <strong>vim/gcc/gdb/vs/eclipse</strong>.</li>\n<li>Familiar with <strong>Object-Oriented</strong> and <strong>Object-Based</strong> programming, familiar with common <strong>design pattern</strong>.</li>\n<li>Familiar UML, be able to write <strong>design, implementation and test docs</strong>.</li>\n<li>Familiar with <strong>multiple-thread</strong> and <strong>network programming</strong>, know <em>libevent</em> and <em>muduo</em> network kit.</li>\n<li>Familiar with <code>shell</code>, know <code>Perl/Python</code>.</li>\n</ul>\n<h3 id=\"Self-assessment\"><a href=\"#Self-assessment\" class=\"headerlink\" title=\"Self-assessment\"></a>Self-assessment</h3><p>Love life, love techs; prefer independent thinking and be willing to share.</p>\n"},{"title":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\nlayout: \"categories\"\n---\n","date":"2076-11-29T08:54:34.955Z","updated":"2019-01-28T11:28:18.000Z","path":"categories/index.html","comments":1,"_id":"cjvdf735b0003t0t8ud2wetiz","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\nlayout: \"tags\"\n---\n","date":"2076-11-29T08:54:34.955Z","updated":"2019-01-28T11:28:20.000Z","path":"tags/index.html","comments":1,"_id":"cjvdf735e0006t0t8cxptmt6r","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Another Way To Generate A Prime Table","date":"2016-12-22T19:29:22.000Z","_content":"\n```c++\n void CalculatePrimesUpTo(int max) {\n    ::std::fill(is_prime_, is_prime_ + is_prime_size_, true);\n    is_prime_[0] = is_prime_[1] = false;\n\n    for (int i = 2; i <= max; i++) {\n      if (!is_prime_[i]) continue;\n\n      // Marks all multiples of i (except i itself) as non-prime.\n      for (int j = 2*i; j <= max; j += i) {\n        is_prime_[j] = false;\n      }\n    }\n  }\n```","source":"_posts/Another Way to Generate a PrimeTable.md","raw":"---\ntitle: Another Way To Generate A Prime Table\ndate: 2016-12-23 03:29:22\ntags:\ncategories: Algorithm\n---\n\n```c++\n void CalculatePrimesUpTo(int max) {\n    ::std::fill(is_prime_, is_prime_ + is_prime_size_, true);\n    is_prime_[0] = is_prime_[1] = false;\n\n    for (int i = 2; i <= max; i++) {\n      if (!is_prime_[i]) continue;\n\n      // Marks all multiples of i (except i itself) as non-prime.\n      for (int j = 2*i; j <= max; j += i) {\n        is_prime_[j] = false;\n      }\n    }\n  }\n```","slug":"Another Way to Generate a PrimeTable","published":1,"updated":"2019-01-28T11:28:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf73530000t0t895rrtlf8","content":"<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CalculatePrimesUpTo</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span> </span>&#123;</span><br><span class=\"line\">   ::<span class=\"built_in\">std</span>::fill(is_prime_, is_prime_ + is_prime_size_, <span class=\"literal\">true</span>);</span><br><span class=\"line\">   is_prime_[<span class=\"number\">0</span>] = is_prime_[<span class=\"number\">1</span>] = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &lt;= max; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!is_prime_[i]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// Marks all multiples of i (except i itself) as non-prime.</span></span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">2</span>*i; j &lt;= max; j += i) &#123;</span><br><span class=\"line\">       is_prime_[j] = <span class=\"literal\">false</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">CalculatePrimesUpTo</span><span class=\"params\">(<span class=\"keyword\">int</span> max)</span> </span>&#123;</span><br><span class=\"line\">   ::<span class=\"built_in\">std</span>::fill(is_prime_, is_prime_ + is_prime_size_, <span class=\"literal\">true</span>);</span><br><span class=\"line\">   is_prime_[<span class=\"number\">0</span>] = is_prime_[<span class=\"number\">1</span>] = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &lt;= max; i++) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (!is_prime_[i]) <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">// Marks all multiples of i (except i itself) as non-prime.</span></span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">2</span>*i; j &lt;= max; j += i) &#123;</span><br><span class=\"line\">       is_prime_[j] = <span class=\"literal\">false</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>"},{"title":"Commemorate My Grandpa","date":"2018-04-06T17:02:44.000Z","description":"It is a huge change to my family.","keywords":["grandpa","commemorate"],"feature":null,"toc":true,"_content":"### commemorate my grandpa\nRecently, a lot of changes happened to me.\n\n<!--more-->\n\n![CommemorateMyGrandpa](/images/20180407/CommemorateMyGrandpa.jpg)\n","source":"_posts/CommemorateMyGrandpa.md","raw":"---\ntitle: Commemorate My Grandpa\ndate: 2018-04-07 01:02:44\ntags: [grandpa]\ncategories: rumination\ndescription: It is a huge change to my family.\nkeywords: [grandpa, commemorate]\nfeature: \ntoc: true\n---\n### commemorate my grandpa\nRecently, a lot of changes happened to me.\n\n<!--more-->\n\n![CommemorateMyGrandpa](/images/20180407/CommemorateMyGrandpa.jpg)\n","slug":"CommemorateMyGrandpa","published":1,"updated":"2019-03-06T08:44:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf73590002t0t8z123js4m","content":"<h3 id=\"commemorate-my-grandpa\"><a href=\"#commemorate-my-grandpa\" class=\"headerlink\" title=\"commemorate my grandpa\"></a>commemorate my grandpa</h3><p>Recently, a lot of changes happened to me.</p>\n<a id=\"more\"></a>\n<p><img src=\"/images/20180407/CommemorateMyGrandpa.jpg\" alt=\"CommemorateMyGrandpa\"></p>\n","site":{"data":{}},"excerpt":"<h3 id=\"commemorate-my-grandpa\"><a href=\"#commemorate-my-grandpa\" class=\"headerlink\" title=\"commemorate my grandpa\"></a>commemorate my grandpa</h3><p>Recently, a lot of changes happened to me.</p>","more":"<p><img src=\"/images/20180407/CommemorateMyGrandpa.jpg\" alt=\"CommemorateMyGrandpa\"></p>"},{"title":"Deploy a blog with hexo","date":"2019-01-18T15:31:59.000Z","description":null,"key words":null,"toc":true,"_content":"\n## History\n\n|    Date    | Version |      Comments       |\n| :--------: | :-----: | :-----------------: |\n| 2019-01-18 | v 0.0.1 | Create the document |\n\n\n\n## Abstract\n\nThe purpose of this document is to share some ideas that I have learn from the others about how to deploy a blog. More accurately, I will be writing about the history that how could I deploy this from zero to one. Here, I will not only try to illustrate the codes , but also show you all my configuration files and the references. I hope you could get involved well and do better than me.\n\n","source":"_posts/DeployBlogWithHexo.md","raw":"---\ntitle: Deploy a blog with hexo\ndate: 2019-01-18 23:31:59\ntags: [blog, hexo]\ncategories: history\ndescription:\nkey words: \ntoc: true\n---\n\n## History\n\n|    Date    | Version |      Comments       |\n| :--------: | :-----: | :-----------------: |\n| 2019-01-18 | v 0.0.1 | Create the document |\n\n\n\n## Abstract\n\nThe purpose of this document is to share some ideas that I have learn from the others about how to deploy a blog. More accurately, I will be writing about the history that how could I deploy this from zero to one. Here, I will not only try to illustrate the codes , but also show you all my configuration files and the references. I hope you could get involved well and do better than me.\n\n","slug":"DeployBlogWithHexo","published":1,"updated":"2019-01-28T11:28:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf735e0005t0t8odzc0p7f","content":"<h2 id=\"History\"><a href=\"#History\" class=\"headerlink\" title=\"History\"></a>History</h2><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Date</th>\n<th style=\"text-align:center\">Version</th>\n<th style=\"text-align:center\">Comments</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">2019-01-18</td>\n<td style=\"text-align:center\">v 0.0.1</td>\n<td style=\"text-align:center\">Create the document</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Abstract\"><a href=\"#Abstract\" class=\"headerlink\" title=\"Abstract\"></a>Abstract</h2><p>The purpose of this document is to share some ideas that I have learn from the others about how to deploy a blog. More accurately, I will be writing about the history that how could I deploy this from zero to one. Here, I will not only try to illustrate the codes , but also show you all my configuration files and the references. I hope you could get involved well and do better than me.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"History\"><a href=\"#History\" class=\"headerlink\" title=\"History\"></a>History</h2><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Date</th>\n<th style=\"text-align:center\">Version</th>\n<th style=\"text-align:center\">Comments</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">2019-01-18</td>\n<td style=\"text-align:center\">v 0.0.1</td>\n<td style=\"text-align:center\">Create the document</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Abstract\"><a href=\"#Abstract\" class=\"headerlink\" title=\"Abstract\"></a>Abstract</h2><p>The purpose of this document is to share some ideas that I have learn from the others about how to deploy a blog. More accurately, I will be writing about the history that how could I deploy this from zero to one. Here, I will not only try to illustrate the codes , but also show you all my configuration files and the references. I hope you could get involved well and do better than me.</p>\n"},{"title":"The origins of English language","date":"2014-12-03T15:31:59.000Z","description":null,"key words":["Enghlish","Etymology"],"toc":true,"_content":"\n## The origins of the English language\n\nThe life stories of individual words, often mazy and conjectural, need a fixed backdrop if they are to make sense.<!--more--> So first, a little history. English is a member of the Indo-European family of languages. The precise origins of this are still a matter of some controversy, but the consensus view is that it came on the scene around 8,000 years ago in the general area to the north of the Black Sea. Since then it has split up into a large number of subgroups, which today provide nearly all the languages of Europe and have also spread over large areas of the Middle East and northern India. Among them are the Indo-Iranian languages, including Hindi and ancient Sanskrit; the Slavic languages  Russian, Polish, Czech, Serbo-Croat, and so on; the Baltic languages, Latvian and Lithuanian (which of all these modern languages most closely resembles its Indo-European ancestor); the Celtic languages, such as Welsh, Gaelic, and Breton; and Greek.But in the history of English, there are two particular groups that are of central importance. The first is the Romance languages: classical Latin, the literary language of ancient Rome; and French, Italian, Spanish, Portuguese, and Romanian, which evolved from Vulgar Latin, the language of the common people that spread through the Western Roman Empire. The role of Latin and French, in particular, in the growth of English vocabulary has been immense. We acquired a sizeable portion of our words from one or other of these sources.\n\nThe second important group, of course, is the Germanic languages: for that is the group to which English itself belongs. The existence of the Germanic peoples as a separate speech community dates back at least 3,000 years. Their first northern European home has been traced to an area around the river Elbe. At this time they all spoke the same language, which is generally known as Common Germanic.\nAround the 2nd century BC this began to split up into three distinct dialects. One was East Germanic. The only East Germanic language of which any written evidence survives is Gothic. Now extinct, it was spoken by Germanic peoples who migrated back eastwards to the area of modern Bulgaria and the Crimea. It provides us with our closest glimpse of what prehistoric C common Germanic must have been like. The second was North Germanic, which has evolved into modern Swedish,Danish, Norwegian, and Icelandic. And lastly there was West Germanic, the ancestor of modern German, Dutch, Flemish, Frisian, and English.\nThe forerunners of English crossed the Channel in the 5th and 6th centuries AD.\n\nThey were brought by peoples from the northeastern corner of the European mainland, around Jutland and southern Denmark  the Angles, Saxons, and Jutes.They spoke a mutually intelligible set of Germanic dialects (whose closest modern continental relative is Frisian), which formed the basis of what is now known as Old English (the alternative term Anglo-Saxon is no longer much used). This was a more or less homogeneous language, but with marked geographical differences reflecting the areas into which the various Germanic peoples had moved: the Angles into the Midlands (where Mercian was spoken)and the North (whose form of Old English is now called Northumbrian); the Jutes into Kent; and the Saxons into the rest of southern and western England (their speech is known as West Saxon).\n\n\n\n\n","source":"_posts/The Origins of the English Language.md","raw":"---\ntitle: The origins of English language\ndate: 2014-12-03 23:31:59\ntags: \ncategories: translation\ndescription: \nkey words: [Enghlish, Etymology]\ntoc: true\n---\n\n## The origins of the English language\n\nThe life stories of individual words, often mazy and conjectural, need a fixed backdrop if they are to make sense.<!--more--> So first, a little history. English is a member of the Indo-European family of languages. The precise origins of this are still a matter of some controversy, but the consensus view is that it came on the scene around 8,000 years ago in the general area to the north of the Black Sea. Since then it has split up into a large number of subgroups, which today provide nearly all the languages of Europe and have also spread over large areas of the Middle East and northern India. Among them are the Indo-Iranian languages, including Hindi and ancient Sanskrit; the Slavic languages  Russian, Polish, Czech, Serbo-Croat, and so on; the Baltic languages, Latvian and Lithuanian (which of all these modern languages most closely resembles its Indo-European ancestor); the Celtic languages, such as Welsh, Gaelic, and Breton; and Greek.But in the history of English, there are two particular groups that are of central importance. The first is the Romance languages: classical Latin, the literary language of ancient Rome; and French, Italian, Spanish, Portuguese, and Romanian, which evolved from Vulgar Latin, the language of the common people that spread through the Western Roman Empire. The role of Latin and French, in particular, in the growth of English vocabulary has been immense. We acquired a sizeable portion of our words from one or other of these sources.\n\nThe second important group, of course, is the Germanic languages: for that is the group to which English itself belongs. The existence of the Germanic peoples as a separate speech community dates back at least 3,000 years. Their first northern European home has been traced to an area around the river Elbe. At this time they all spoke the same language, which is generally known as Common Germanic.\nAround the 2nd century BC this began to split up into three distinct dialects. One was East Germanic. The only East Germanic language of which any written evidence survives is Gothic. Now extinct, it was spoken by Germanic peoples who migrated back eastwards to the area of modern Bulgaria and the Crimea. It provides us with our closest glimpse of what prehistoric C common Germanic must have been like. The second was North Germanic, which has evolved into modern Swedish,Danish, Norwegian, and Icelandic. And lastly there was West Germanic, the ancestor of modern German, Dutch, Flemish, Frisian, and English.\nThe forerunners of English crossed the Channel in the 5th and 6th centuries AD.\n\nThey were brought by peoples from the northeastern corner of the European mainland, around Jutland and southern Denmark  the Angles, Saxons, and Jutes.They spoke a mutually intelligible set of Germanic dialects (whose closest modern continental relative is Frisian), which formed the basis of what is now known as Old English (the alternative term Anglo-Saxon is no longer much used). This was a more or less homogeneous language, but with marked geographical differences reflecting the areas into which the various Germanic peoples had moved: the Angles into the Midlands (where Mercian was spoken)and the North (whose form of Old English is now called Northumbrian); the Jutes into Kent; and the Saxons into the rest of southern and western England (their speech is known as West Saxon).\n\n\n\n\n","slug":"The Origins of the English Language","published":1,"updated":"2019-02-12T08:34:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf735g0008t0t8i1gb3gw3","content":"<h2 id=\"The-origins-of-the-English-language\"><a href=\"#The-origins-of-the-English-language\" class=\"headerlink\" title=\"The origins of the English language\"></a>The origins of the English language</h2><p>The life stories of individual words, often mazy and conjectural, need a fixed backdrop if they are to make sense.<a id=\"more\"></a> So first, a little history. English is a member of the Indo-European family of languages. The precise origins of this are still a matter of some controversy, but the consensus view is that it came on the scene around 8,000 years ago in the general area to the north of the Black Sea. Since then it has split up into a large number of subgroups, which today provide nearly all the languages of Europe and have also spread over large areas of the Middle East and northern India. Among them are the Indo-Iranian languages, including Hindi and ancient Sanskrit; the Slavic languages  Russian, Polish, Czech, Serbo-Croat, and so on; the Baltic languages, Latvian and Lithuanian (which of all these modern languages most closely resembles its Indo-European ancestor); the Celtic languages, such as Welsh, Gaelic, and Breton; and Greek.But in the history of English, there are two particular groups that are of central importance. The first is the Romance languages: classical Latin, the literary language of ancient Rome; and French, Italian, Spanish, Portuguese, and Romanian, which evolved from Vulgar Latin, the language of the common people that spread through the Western Roman Empire. The role of Latin and French, in particular, in the growth of English vocabulary has been immense. We acquired a sizeable portion of our words from one or other of these sources.</p>\n<p>The second important group, of course, is the Germanic languages: for that is the group to which English itself belongs. The existence of the Germanic peoples as a separate speech community dates back at least 3,000 years. Their first northern European home has been traced to an area around the river Elbe. At this time they all spoke the same language, which is generally known as Common Germanic.<br>Around the 2nd century BC this began to split up into three distinct dialects. One was East Germanic. The only East Germanic language of which any written evidence survives is Gothic. Now extinct, it was spoken by Germanic peoples who migrated back eastwards to the area of modern Bulgaria and the Crimea. It provides us with our closest glimpse of what prehistoric C common Germanic must have been like. The second was North Germanic, which has evolved into modern Swedish,Danish, Norwegian, and Icelandic. And lastly there was West Germanic, the ancestor of modern German, Dutch, Flemish, Frisian, and English.<br>The forerunners of English crossed the Channel in the 5th and 6th centuries AD.</p>\n<p>They were brought by peoples from the northeastern corner of the European mainland, around Jutland and southern Denmark  the Angles, Saxons, and Jutes.They spoke a mutually intelligible set of Germanic dialects (whose closest modern continental relative is Frisian), which formed the basis of what is now known as Old English (the alternative term Anglo-Saxon is no longer much used). This was a more or less homogeneous language, but with marked geographical differences reflecting the areas into which the various Germanic peoples had moved: the Angles into the Midlands (where Mercian was spoken)and the North (whose form of Old English is now called Northumbrian); the Jutes into Kent; and the Saxons into the rest of southern and western England (their speech is known as West Saxon).</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"The-origins-of-the-English-language\"><a href=\"#The-origins-of-the-English-language\" class=\"headerlink\" title=\"The origins of the English language\"></a>The origins of the English language</h2><p>The life stories of individual words, often mazy and conjectural, need a fixed backdrop if they are to make sense.","more":"So first, a little history. English is a member of the Indo-European family of languages. The precise origins of this are still a matter of some controversy, but the consensus view is that it came on the scene around 8,000 years ago in the general area to the north of the Black Sea. Since then it has split up into a large number of subgroups, which today provide nearly all the languages of Europe and have also spread over large areas of the Middle East and northern India. Among them are the Indo-Iranian languages, including Hindi and ancient Sanskrit; the Slavic languages  Russian, Polish, Czech, Serbo-Croat, and so on; the Baltic languages, Latvian and Lithuanian (which of all these modern languages most closely resembles its Indo-European ancestor); the Celtic languages, such as Welsh, Gaelic, and Breton; and Greek.But in the history of English, there are two particular groups that are of central importance. The first is the Romance languages: classical Latin, the literary language of ancient Rome; and French, Italian, Spanish, Portuguese, and Romanian, which evolved from Vulgar Latin, the language of the common people that spread through the Western Roman Empire. The role of Latin and French, in particular, in the growth of English vocabulary has been immense. We acquired a sizeable portion of our words from one or other of these sources.</p>\n<p>The second important group, of course, is the Germanic languages: for that is the group to which English itself belongs. The existence of the Germanic peoples as a separate speech community dates back at least 3,000 years. Their first northern European home has been traced to an area around the river Elbe. At this time they all spoke the same language, which is generally known as Common Germanic.<br>Around the 2nd century BC this began to split up into three distinct dialects. One was East Germanic. The only East Germanic language of which any written evidence survives is Gothic. Now extinct, it was spoken by Germanic peoples who migrated back eastwards to the area of modern Bulgaria and the Crimea. It provides us with our closest glimpse of what prehistoric C common Germanic must have been like. The second was North Germanic, which has evolved into modern Swedish,Danish, Norwegian, and Icelandic. And lastly there was West Germanic, the ancestor of modern German, Dutch, Flemish, Frisian, and English.<br>The forerunners of English crossed the Channel in the 5th and 6th centuries AD.</p>\n<p>They were brought by peoples from the northeastern corner of the European mainland, around Jutland and southern Denmark  the Angles, Saxons, and Jutes.They spoke a mutually intelligible set of Germanic dialects (whose closest modern continental relative is Frisian), which formed the basis of what is now known as Old English (the alternative term Anglo-Saxon is no longer much used). This was a more or less homogeneous language, but with marked geographical differences reflecting the areas into which the various Germanic peoples had moved: the Angles into the Midlands (where Mercian was spoken)and the North (whose form of Old English is now called Northumbrian); the Jutes into Kent; and the Saxons into the rest of southern and western England (their speech is known as West Saxon).</p>"},{"title":"What I Have Learnt From the Dissertation of Danqi","date":"2019-03-03T08:53:28.000Z","keyword":["Reading comprehension","NLP","Dissertation for doctor degree"],"description":"It is some ideas about what I have recently been reading and thinking.","toc":true,"_content":"\n## What I have learnt from the dissertation of Danqi\nNot many doctors' dissertations could be big bang, but [Danqi Chen](https://github.com/danqi)'s did. Recently, the doctor from Stanford NLP Group has attracted a lot of attention, including my friends and me.\n\nThe library of Stanford said her doctor dissertation named [Neural Reading Comprehension and Beyond](https://stacks.stanford.edu/file/druid:gd576xb1833/thesis-augmented.pdf) that reaches 156 pages had been read over 1,000 times in four days, since it was uploaded, which has becoming the most popular dissertation for doctor degree in recent decade.\n\nAnd here I am writing what I have learnt from it.\n\n<!--more-->\n\n### Why this paper\n\nI decided to write something about my daily learning and thinking down when I realized that did not keep doing it in the notebook or on my blog.\n\nActual, I have completed the course [**how to write a good research paper**](http://www.xuetangx.com/courses/course-v1:Tsinghua+20150001+sp/about) and got a **excellent** grade, which was encouraged from [Li ZHU](https://github.com/zhuli19901106)Siraj , etc. And then I am looking for some papers to learn something fresh and hope to try a new era. I downloaded some about cyber security but no one about artificial intelligence until I met Danqi's, which could be a perfect example on how to write a good research paper in my mind.\n\n### What it is about\n\nThe paper is trying to build computer systems to read a passage of text and answer comprehension questions by focusing on neural reading comprehension. It consists of two parts: the first one is called foundations to tell readers an overview of reading comprehension and her group's effort of their models which understands what they have actually learned, more of that, they summarized recent advances and discussed future directions and open questions in that field; the second one is called applications to tell readers two new directions they pioneered: 1)how they can combine information retrieval techs with neural reading comprehension to tackle large-scale open-domain question answering; and 2)how they can build conversational question answering systems form current single-turn, span-based reading comprehension models, what's more, they implemented those ideas in the DrQA and CoQA projects and they demonstrate the effectiveness of those approaches.\n\n### Who is Danqi Chen\n\n[She](https://cs.stanford.edu/~danqi/) graduated from Yao class of Tsinghua university in 2012. During the time, she won the silver medal in the world final of ACM/ICPC. \n\nBefore going to Tsinghua, she studied in [Yali](https://en.wikipedia.org/wiki/Yali_High_School) Changsha, in which she presented [plug-like dynamic programming](https://cs.stanford.edu/~danqi/misc/dynamic-programming.pdf) and [CDQ's divide-and-conquer](https://cs.stanford.edu/~danqi/misc/divide-and-conquer.pdf) .\n\nAfter studying in Tsinghua, she went to Stanford. Now she currently visiting Facebook AI Research (Seattle) and University of Washington. And she will be joining the Computer Science Department at Princeton University as an \nassistant professor in Fall 2019.\n\n### What I have learnt\n\nSpecifically, what impressed me most, firstly, is understanding Reading Comprehension from a fool computer view, \n\n>\n> Alyssa got to the beach after a long trip, She's from Charlotte. She traveled from Atlanta. She's now in Miami. She went to Miami to visit some friends. But she wanted some time to herself at the beach, so she went there first. After going swimming and laying out, she went to her friend Ellen's house. Ellen greeted Alyssa and they both had some lemonade to drink. Alyssa called her friends Kristen and Rachel to meet at Ellen's house. The girls traded stories and caught up on their lives. It was a happy time for everyone. The girls went to a restaurant for dinner. The restaurant had a special on catfish. Alyssa enjoyed the restaurant's special. Ellen ordered a salad. Kristen had soup.Rachel had a steak. After eating, the ladies went back to Ellen's house to have fun. The had lots of fun. They stayed the night because they were tired. Alyssa was happy to spend time with her friend again.\n>\n>\n> - Question: What city is Alyssa in?\n> - Answer: Miami\n> - Quesion: what did Alyssa eat at the restaurant?\n> - Answer: catfish\n> - Question: How may friends does Alyssa have in this story?\n> - Answer: 3\n>\n\nso how many steps should a machine process before answer the above questions?\n\n> - part-of-speech tagging. It requires our machines to understand that, for example, in the first sentence *Alyssa got to the beach after a long trip.*, *Alyssa* is a proper noun, *beach* and *trip* are common nouns. *got* is a verb in its past tense, *long* is an adjective, *after* is a preposition.\n> - named entity recognition. Our machines also should understand that *Alyssa*, *Ellen*, *Kristen* are the names of people in the story while *Charlotte*, *Atlanta* and *Miami* are the names of locations.\n> - syntactic parsing. To understand the meaning of each single sentence, our machines also need to understand the relationship between words, or the syntactical (grammatical) structure. Taking the first sentence *Alyssa got to the beach after a long trip.* as an example again, the machines should understand that *Alyssa* is the subject, and *beach* is object of the verb *got*, while *after a long trip* as a whole is a prepositional phrase which describes a temporal relationship with the verb.\n> - coreference resolution. Furthermore, our machines even need to understand the interplay between sentences. For example, the mention *She* in the sentence *She's now in Miami* refers to *Alyssa* mentioned in the first sentence, while the mention *The girls* refers to *Alyssa, Ellen, Kristen and Rachel* in the previous sentences.\n\nI did a lot of reading comprehensions during the school time, both English and Chinese class, but I have never thought them from the view like this even when I prepared the examinations in high school. Actually, it works effectively when learning a new language, and I would like to try it when I learn my third language. Still now, I have to read a lot of papers and blogs from the Internet, I got suck sometime when they were not tiny or simple. \n\nSo secondly, what I learnt from it is that to try to write things down in simple way, which is what I am doing, this paper is just a kind of timely rain in my almost dry land.\n\nAnd thirdly, I knew that a doctor dissertation is not easy and also not difficult for me, and I know what it should cover from the outline and something else even though I am trying to be a doctor. If I have a chance, I will not afraid of it.\n\nLast but not least, I hope I could have opportunity to implement/prove/check out her ideas one day.","source":"_posts/What I have learnt from the Dissertation of Danqi.md","raw":"---\ntitle: What I Have Learnt From the Dissertation of Danqi\ndate: 2019-03-03 16:53:28\ntags: dissertation\nkeyword: [Reading comprehension, NLP, Dissertation for doctor degree]\ncategories: rumination\ndescription: It is some ideas about what I have recently been reading and thinking.\ntoc: true\n---\n\n## What I have learnt from the dissertation of Danqi\nNot many doctors' dissertations could be big bang, but [Danqi Chen](https://github.com/danqi)'s did. Recently, the doctor from Stanford NLP Group has attracted a lot of attention, including my friends and me.\n\nThe library of Stanford said her doctor dissertation named [Neural Reading Comprehension and Beyond](https://stacks.stanford.edu/file/druid:gd576xb1833/thesis-augmented.pdf) that reaches 156 pages had been read over 1,000 times in four days, since it was uploaded, which has becoming the most popular dissertation for doctor degree in recent decade.\n\nAnd here I am writing what I have learnt from it.\n\n<!--more-->\n\n### Why this paper\n\nI decided to write something about my daily learning and thinking down when I realized that did not keep doing it in the notebook or on my blog.\n\nActual, I have completed the course [**how to write a good research paper**](http://www.xuetangx.com/courses/course-v1:Tsinghua+20150001+sp/about) and got a **excellent** grade, which was encouraged from [Li ZHU](https://github.com/zhuli19901106)Siraj , etc. And then I am looking for some papers to learn something fresh and hope to try a new era. I downloaded some about cyber security but no one about artificial intelligence until I met Danqi's, which could be a perfect example on how to write a good research paper in my mind.\n\n### What it is about\n\nThe paper is trying to build computer systems to read a passage of text and answer comprehension questions by focusing on neural reading comprehension. It consists of two parts: the first one is called foundations to tell readers an overview of reading comprehension and her group's effort of their models which understands what they have actually learned, more of that, they summarized recent advances and discussed future directions and open questions in that field; the second one is called applications to tell readers two new directions they pioneered: 1)how they can combine information retrieval techs with neural reading comprehension to tackle large-scale open-domain question answering; and 2)how they can build conversational question answering systems form current single-turn, span-based reading comprehension models, what's more, they implemented those ideas in the DrQA and CoQA projects and they demonstrate the effectiveness of those approaches.\n\n### Who is Danqi Chen\n\n[She](https://cs.stanford.edu/~danqi/) graduated from Yao class of Tsinghua university in 2012. During the time, she won the silver medal in the world final of ACM/ICPC. \n\nBefore going to Tsinghua, she studied in [Yali](https://en.wikipedia.org/wiki/Yali_High_School) Changsha, in which she presented [plug-like dynamic programming](https://cs.stanford.edu/~danqi/misc/dynamic-programming.pdf) and [CDQ's divide-and-conquer](https://cs.stanford.edu/~danqi/misc/divide-and-conquer.pdf) .\n\nAfter studying in Tsinghua, she went to Stanford. Now she currently visiting Facebook AI Research (Seattle) and University of Washington. And she will be joining the Computer Science Department at Princeton University as an \nassistant professor in Fall 2019.\n\n### What I have learnt\n\nSpecifically, what impressed me most, firstly, is understanding Reading Comprehension from a fool computer view, \n\n>\n> Alyssa got to the beach after a long trip, She's from Charlotte. She traveled from Atlanta. She's now in Miami. She went to Miami to visit some friends. But she wanted some time to herself at the beach, so she went there first. After going swimming and laying out, she went to her friend Ellen's house. Ellen greeted Alyssa and they both had some lemonade to drink. Alyssa called her friends Kristen and Rachel to meet at Ellen's house. The girls traded stories and caught up on their lives. It was a happy time for everyone. The girls went to a restaurant for dinner. The restaurant had a special on catfish. Alyssa enjoyed the restaurant's special. Ellen ordered a salad. Kristen had soup.Rachel had a steak. After eating, the ladies went back to Ellen's house to have fun. The had lots of fun. They stayed the night because they were tired. Alyssa was happy to spend time with her friend again.\n>\n>\n> - Question: What city is Alyssa in?\n> - Answer: Miami\n> - Quesion: what did Alyssa eat at the restaurant?\n> - Answer: catfish\n> - Question: How may friends does Alyssa have in this story?\n> - Answer: 3\n>\n\nso how many steps should a machine process before answer the above questions?\n\n> - part-of-speech tagging. It requires our machines to understand that, for example, in the first sentence *Alyssa got to the beach after a long trip.*, *Alyssa* is a proper noun, *beach* and *trip* are common nouns. *got* is a verb in its past tense, *long* is an adjective, *after* is a preposition.\n> - named entity recognition. Our machines also should understand that *Alyssa*, *Ellen*, *Kristen* are the names of people in the story while *Charlotte*, *Atlanta* and *Miami* are the names of locations.\n> - syntactic parsing. To understand the meaning of each single sentence, our machines also need to understand the relationship between words, or the syntactical (grammatical) structure. Taking the first sentence *Alyssa got to the beach after a long trip.* as an example again, the machines should understand that *Alyssa* is the subject, and *beach* is object of the verb *got*, while *after a long trip* as a whole is a prepositional phrase which describes a temporal relationship with the verb.\n> - coreference resolution. Furthermore, our machines even need to understand the interplay between sentences. For example, the mention *She* in the sentence *She's now in Miami* refers to *Alyssa* mentioned in the first sentence, while the mention *The girls* refers to *Alyssa, Ellen, Kristen and Rachel* in the previous sentences.\n\nI did a lot of reading comprehensions during the school time, both English and Chinese class, but I have never thought them from the view like this even when I prepared the examinations in high school. Actually, it works effectively when learning a new language, and I would like to try it when I learn my third language. Still now, I have to read a lot of papers and blogs from the Internet, I got suck sometime when they were not tiny or simple. \n\nSo secondly, what I learnt from it is that to try to write things down in simple way, which is what I am doing, this paper is just a kind of timely rain in my almost dry land.\n\nAnd thirdly, I knew that a doctor dissertation is not easy and also not difficult for me, and I know what it should cover from the outline and something else even though I am trying to be a doctor. If I have a chance, I will not afraid of it.\n\nLast but not least, I hope I could have opportunity to implement/prove/check out her ideas one day.","slug":"What I have learnt from the Dissertation of Danqi","published":1,"updated":"2019-03-06T07:22:08.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf735i0009t0t80fi9aouz","content":"<h2 id=\"What-I-have-learnt-from-the-dissertation-of-Danqi\"><a href=\"#What-I-have-learnt-from-the-dissertation-of-Danqi\" class=\"headerlink\" title=\"What I have learnt from the dissertation of Danqi\"></a>What I have learnt from the dissertation of Danqi</h2><p>Not many doctors dissertations could be big bang, but <a href=\"https://github.com/danqi\" target=\"_blank\" rel=\"noopener\">Danqi Chen</a>s did. Recently, the doctor from Stanford NLP Group has attracted a lot of attention, including my friends and me.</p>\n<p>The library of Stanford said her doctor dissertation named <a href=\"https://stacks.stanford.edu/file/druid:gd576xb1833/thesis-augmented.pdf\" target=\"_blank\" rel=\"noopener\">Neural Reading Comprehension and Beyond</a> that reaches 156 pages had been read over 1,000 times in four days, since it was uploaded, which has becoming the most popular dissertation for doctor degree in recent decade.</p>\n<p>And here I am writing what I have learnt from it.</p>\n<a id=\"more\"></a>\n<h3 id=\"Why-this-paper\"><a href=\"#Why-this-paper\" class=\"headerlink\" title=\"Why this paper\"></a>Why this paper</h3><p>I decided to write something about my daily learning and thinking down when I realized that did not keep doing it in the notebook or on my blog.</p>\n<p>Actual, I have completed the course <a href=\"http://www.xuetangx.com/courses/course-v1:Tsinghua+20150001+sp/about\" target=\"_blank\" rel=\"noopener\"><strong>how to write a good research paper</strong></a> and got a <strong>excellent</strong> grade, which was encouraged from <a href=\"https://github.com/zhuli19901106\" target=\"_blank\" rel=\"noopener\">Li ZHU</a>Siraj , etc. And then I am looking for some papers to learn something fresh and hope to try a new era. I downloaded some about cyber security but no one about artificial intelligence until I met Danqis, which could be a perfect example on how to write a good research paper in my mind.</p>\n<h3 id=\"What-it-is-about\"><a href=\"#What-it-is-about\" class=\"headerlink\" title=\"What it is about\"></a>What it is about</h3><p>The paper is trying to build computer systems to read a passage of text and answer comprehension questions by focusing on neural reading comprehension. It consists of two parts: the first one is called foundations to tell readers an overview of reading comprehension and her groups effort of their models which understands what they have actually learned, more of that, they summarized recent advances and discussed future directions and open questions in that field; the second one is called applications to tell readers two new directions they pioneered: 1)how they can combine information retrieval techs with neural reading comprehension to tackle large-scale open-domain question answering; and 2)how they can build conversational question answering systems form current single-turn, span-based reading comprehension models, whats more, they implemented those ideas in the DrQA and CoQA projects and they demonstrate the effectiveness of those approaches.</p>\n<h3 id=\"Who-is-Danqi-Chen\"><a href=\"#Who-is-Danqi-Chen\" class=\"headerlink\" title=\"Who is Danqi Chen\"></a>Who is Danqi Chen</h3><p><a href=\"https://cs.stanford.edu/~danqi/\" target=\"_blank\" rel=\"noopener\">She</a> graduated from Yao class of Tsinghua university in 2012. During the time, she won the silver medal in the world final of ACM/ICPC. </p>\n<p>Before going to Tsinghua, she studied in <a href=\"https://en.wikipedia.org/wiki/Yali_High_School\" target=\"_blank\" rel=\"noopener\">Yali</a> Changsha, in which she presented <a href=\"https://cs.stanford.edu/~danqi/misc/dynamic-programming.pdf\" target=\"_blank\" rel=\"noopener\">plug-like dynamic programming</a> and <a href=\"https://cs.stanford.edu/~danqi/misc/divide-and-conquer.pdf\" target=\"_blank\" rel=\"noopener\">CDQs divide-and-conquer</a> .</p>\n<p>After studying in Tsinghua, she went to Stanford. Now she currently visiting Facebook AI Research (Seattle) and University of Washington. And she will be joining the Computer Science Department at Princeton University as an<br>assistant professor in Fall 2019.</p>\n<h3 id=\"What-I-have-learnt\"><a href=\"#What-I-have-learnt\" class=\"headerlink\" title=\"What I have learnt\"></a>What I have learnt</h3><p>Specifically, what impressed me most, firstly, is understanding Reading Comprehension from a fool computer view, </p>\n<blockquote>\n<p>Alyssa got to the beach after a long trip, Shes from Charlotte. She traveled from Atlanta. Shes now in Miami. She went to Miami to visit some friends. But she wanted some time to herself at the beach, so she went there first. After going swimming and laying out, she went to her friend Ellens house. Ellen greeted Alyssa and they both had some lemonade to drink. Alyssa called her friends Kristen and Rachel to meet at Ellens house. The girls traded stories and caught up on their lives. It was a happy time for everyone. The girls went to a restaurant for dinner. The restaurant had a special on catfish. Alyssa enjoyed the restaurants special. Ellen ordered a salad. Kristen had soup.Rachel had a steak. After eating, the ladies went back to Ellens house to have fun. The had lots of fun. They stayed the night because they were tired. Alyssa was happy to spend time with her friend again.</p>\n<ul>\n<li>Question: What city is Alyssa in?</li>\n<li>Answer: Miami</li>\n<li>Quesion: what did Alyssa eat at the restaurant?</li>\n<li>Answer: catfish</li>\n<li>Question: How may friends does Alyssa have in this story?</li>\n<li>Answer: 3</li>\n</ul>\n</blockquote>\n<p>so how many steps should a machine process before answer the above questions?</p>\n<blockquote>\n<ul>\n<li>part-of-speech tagging. It requires our machines to understand that, for example, in the first sentence <em>Alyssa got to the beach after a long trip.</em>, <em>Alyssa</em> is a proper noun, <em>beach</em> and <em>trip</em> are common nouns. <em>got</em> is a verb in its past tense, <em>long</em> is an adjective, <em>after</em> is a preposition.</li>\n<li>named entity recognition. Our machines also should understand that <em>Alyssa</em>, <em>Ellen</em>, <em>Kristen</em> are the names of people in the story while <em>Charlotte</em>, <em>Atlanta</em> and <em>Miami</em> are the names of locations.</li>\n<li>syntactic parsing. To understand the meaning of each single sentence, our machines also need to understand the relationship between words, or the syntactical (grammatical) structure. Taking the first sentence <em>Alyssa got to the beach after a long trip.</em> as an example again, the machines should understand that <em>Alyssa</em> is the subject, and <em>beach</em> is object of the verb <em>got</em>, while <em>after a long trip</em> as a whole is a prepositional phrase which describes a temporal relationship with the verb.</li>\n<li>coreference resolution. Furthermore, our machines even need to understand the interplay between sentences. For example, the mention <em>She</em> in the sentence <em>Shes now in Miami</em> refers to <em>Alyssa</em> mentioned in the first sentence, while the mention <em>The girls</em> refers to <em>Alyssa, Ellen, Kristen and Rachel</em> in the previous sentences.</li>\n</ul>\n</blockquote>\n<p>I did a lot of reading comprehensions during the school time, both English and Chinese class, but I have never thought them from the view like this even when I prepared the examinations in high school. Actually, it works effectively when learning a new language, and I would like to try it when I learn my third language. Still now, I have to read a lot of papers and blogs from the Internet, I got suck sometime when they were not tiny or simple. </p>\n<p>So secondly, what I learnt from it is that to try to write things down in simple way, which is what I am doing, this paper is just a kind of timely rain in my almost dry land.</p>\n<p>And thirdly, I knew that a doctor dissertation is not easy and also not difficult for me, and I know what it should cover from the outline and something else even though I am trying to be a doctor. If I have a chance, I will not afraid of it.</p>\n<p>Last but not least, I hope I could have opportunity to implement/prove/check out her ideas one day.</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"What-I-have-learnt-from-the-dissertation-of-Danqi\"><a href=\"#What-I-have-learnt-from-the-dissertation-of-Danqi\" class=\"headerlink\" title=\"What I have learnt from the dissertation of Danqi\"></a>What I have learnt from the dissertation of Danqi</h2><p>Not many doctors dissertations could be big bang, but <a href=\"https://github.com/danqi\" target=\"_blank\" rel=\"noopener\">Danqi Chen</a>s did. Recently, the doctor from Stanford NLP Group has attracted a lot of attention, including my friends and me.</p>\n<p>The library of Stanford said her doctor dissertation named <a href=\"https://stacks.stanford.edu/file/druid:gd576xb1833/thesis-augmented.pdf\" target=\"_blank\" rel=\"noopener\">Neural Reading Comprehension and Beyond</a> that reaches 156 pages had been read over 1,000 times in four days, since it was uploaded, which has becoming the most popular dissertation for doctor degree in recent decade.</p>\n<p>And here I am writing what I have learnt from it.</p>","more":"<h3 id=\"Why-this-paper\"><a href=\"#Why-this-paper\" class=\"headerlink\" title=\"Why this paper\"></a>Why this paper</h3><p>I decided to write something about my daily learning and thinking down when I realized that did not keep doing it in the notebook or on my blog.</p>\n<p>Actual, I have completed the course <a href=\"http://www.xuetangx.com/courses/course-v1:Tsinghua+20150001+sp/about\" target=\"_blank\" rel=\"noopener\"><strong>how to write a good research paper</strong></a> and got a <strong>excellent</strong> grade, which was encouraged from <a href=\"https://github.com/zhuli19901106\" target=\"_blank\" rel=\"noopener\">Li ZHU</a>Siraj , etc. And then I am looking for some papers to learn something fresh and hope to try a new era. I downloaded some about cyber security but no one about artificial intelligence until I met Danqis, which could be a perfect example on how to write a good research paper in my mind.</p>\n<h3 id=\"What-it-is-about\"><a href=\"#What-it-is-about\" class=\"headerlink\" title=\"What it is about\"></a>What it is about</h3><p>The paper is trying to build computer systems to read a passage of text and answer comprehension questions by focusing on neural reading comprehension. It consists of two parts: the first one is called foundations to tell readers an overview of reading comprehension and her groups effort of their models which understands what they have actually learned, more of that, they summarized recent advances and discussed future directions and open questions in that field; the second one is called applications to tell readers two new directions they pioneered: 1)how they can combine information retrieval techs with neural reading comprehension to tackle large-scale open-domain question answering; and 2)how they can build conversational question answering systems form current single-turn, span-based reading comprehension models, whats more, they implemented those ideas in the DrQA and CoQA projects and they demonstrate the effectiveness of those approaches.</p>\n<h3 id=\"Who-is-Danqi-Chen\"><a href=\"#Who-is-Danqi-Chen\" class=\"headerlink\" title=\"Who is Danqi Chen\"></a>Who is Danqi Chen</h3><p><a href=\"https://cs.stanford.edu/~danqi/\" target=\"_blank\" rel=\"noopener\">She</a> graduated from Yao class of Tsinghua university in 2012. During the time, she won the silver medal in the world final of ACM/ICPC. </p>\n<p>Before going to Tsinghua, she studied in <a href=\"https://en.wikipedia.org/wiki/Yali_High_School\" target=\"_blank\" rel=\"noopener\">Yali</a> Changsha, in which she presented <a href=\"https://cs.stanford.edu/~danqi/misc/dynamic-programming.pdf\" target=\"_blank\" rel=\"noopener\">plug-like dynamic programming</a> and <a href=\"https://cs.stanford.edu/~danqi/misc/divide-and-conquer.pdf\" target=\"_blank\" rel=\"noopener\">CDQs divide-and-conquer</a> .</p>\n<p>After studying in Tsinghua, she went to Stanford. Now she currently visiting Facebook AI Research (Seattle) and University of Washington. And she will be joining the Computer Science Department at Princeton University as an<br>assistant professor in Fall 2019.</p>\n<h3 id=\"What-I-have-learnt\"><a href=\"#What-I-have-learnt\" class=\"headerlink\" title=\"What I have learnt\"></a>What I have learnt</h3><p>Specifically, what impressed me most, firstly, is understanding Reading Comprehension from a fool computer view, </p>\n<blockquote>\n<p>Alyssa got to the beach after a long trip, Shes from Charlotte. She traveled from Atlanta. Shes now in Miami. She went to Miami to visit some friends. But she wanted some time to herself at the beach, so she went there first. After going swimming and laying out, she went to her friend Ellens house. Ellen greeted Alyssa and they both had some lemonade to drink. Alyssa called her friends Kristen and Rachel to meet at Ellens house. The girls traded stories and caught up on their lives. It was a happy time for everyone. The girls went to a restaurant for dinner. The restaurant had a special on catfish. Alyssa enjoyed the restaurants special. Ellen ordered a salad. Kristen had soup.Rachel had a steak. After eating, the ladies went back to Ellens house to have fun. The had lots of fun. They stayed the night because they were tired. Alyssa was happy to spend time with her friend again.</p>\n<ul>\n<li>Question: What city is Alyssa in?</li>\n<li>Answer: Miami</li>\n<li>Quesion: what did Alyssa eat at the restaurant?</li>\n<li>Answer: catfish</li>\n<li>Question: How may friends does Alyssa have in this story?</li>\n<li>Answer: 3</li>\n</ul>\n</blockquote>\n<p>so how many steps should a machine process before answer the above questions?</p>\n<blockquote>\n<ul>\n<li>part-of-speech tagging. It requires our machines to understand that, for example, in the first sentence <em>Alyssa got to the beach after a long trip.</em>, <em>Alyssa</em> is a proper noun, <em>beach</em> and <em>trip</em> are common nouns. <em>got</em> is a verb in its past tense, <em>long</em> is an adjective, <em>after</em> is a preposition.</li>\n<li>named entity recognition. Our machines also should understand that <em>Alyssa</em>, <em>Ellen</em>, <em>Kristen</em> are the names of people in the story while <em>Charlotte</em>, <em>Atlanta</em> and <em>Miami</em> are the names of locations.</li>\n<li>syntactic parsing. To understand the meaning of each single sentence, our machines also need to understand the relationship between words, or the syntactical (grammatical) structure. Taking the first sentence <em>Alyssa got to the beach after a long trip.</em> as an example again, the machines should understand that <em>Alyssa</em> is the subject, and <em>beach</em> is object of the verb <em>got</em>, while <em>after a long trip</em> as a whole is a prepositional phrase which describes a temporal relationship with the verb.</li>\n<li>coreference resolution. Furthermore, our machines even need to understand the interplay between sentences. For example, the mention <em>She</em> in the sentence <em>Shes now in Miami</em> refers to <em>Alyssa</em> mentioned in the first sentence, while the mention <em>The girls</em> refers to <em>Alyssa, Ellen, Kristen and Rachel</em> in the previous sentences.</li>\n</ul>\n</blockquote>\n<p>I did a lot of reading comprehensions during the school time, both English and Chinese class, but I have never thought them from the view like this even when I prepared the examinations in high school. Actually, it works effectively when learning a new language, and I would like to try it when I learn my third language. Still now, I have to read a lot of papers and blogs from the Internet, I got suck sometime when they were not tiny or simple. </p>\n<p>So secondly, what I learnt from it is that to try to write things down in simple way, which is what I am doing, this paper is just a kind of timely rain in my almost dry land.</p>\n<p>And thirdly, I knew that a doctor dissertation is not easy and also not difficult for me, and I know what it should cover from the outline and something else even though I am trying to be a doctor. If I have a chance, I will not afraid of it.</p>\n<p>Last but not least, I hope I could have opportunity to implement/prove/check out her ideas one day.</p>"},{"title":"C++ rvalue reference","date":"2019-02-14T10:46:35.000Z","keyword":["rvalue reference","move sematics","perfect forwarding"],"description":"A brief illustration of c++ rvalue reference","toc":true,"_content":"## c++ rvalue reference\n\n### why we need rvalue references?\n\nrvalue references are a new reference type introduced in c++0x that help solve the problem of **unnecessary copying** and enable **perfect forwarding**. When the right-hand side of an assignment is an rvalue, the the left-hand side object can steal resources from the right-hand side object rather than performing a separate allocation, thus enabling **move semantics**.\n<!--more-->\n\n### what is rvalue and lvalue?\n\n- lvalue: those could be appeared in the left of the `operator =`\n- rvalue: those could only be appeared in the right of the `operator =`\n\n**note:** `C++` with its user-defined types has introduced some subtleties regarding modifiability and assignability that cause this definition to be incorrect. Let us see the following samples:\n\n```c++\n/// sample 1\nint a = 9;\nint b = 4;\n\na = b;\t//OK\nb = a;\t//OK\na = a+b; //OK\n\na + b = 12; // Error, lvalue required as left operand of assignment\n\n/// sample 2\nstring s1(\"hello\");\nstring s2(\"world\");\n\ns1 + s2 = s2; // It is OK, how surprising!!!\ncout << \"s1 = \" << s1 << endl; //s1 = hello\ncout << \"s2 = \" << s2 << endl; //s2 = world\n\nstring() = \"Hello World\"; // It could be assigned to a temp object!!!\n\n/// sample 3\ncomple<int> c1(3, 8), c2(1, 0);\n\nc1 + c2 = comple<int>(4, 9);  //OK, c1 + c2 could be as lvalue!!!\ncout << \"c1 = \" << c1 << endl; //c1 = (3,8)\ncout << \"c2 = \" << c2 << endl; //c2 = (1,0)\n\ncomple<int>() = complex<int>(4, 9); //It could be assigned to a temp object!!!\n```\n\n### the forms of rvalue\n\n- those could only appeared in the right of the `operator =`\n- temp object\n- return value(special form of temp object)\n\n**note:** It would lose some import information of object(especial for rvalue) in call hierarchy. The following is a sample.\n\n```c++\nvoid process(int & i);\nvoid process(int && i);\n\nvoid forward(int && i)\n{\n    process(i);// unperfect forwarding\n}\n```\n\n### What is perfect forwarding?\n\nPerfect forwarding allows you to write a single function template that takes n arbitrary arguments and forwards them transparently to another arbitrary function. The nature of argument(modifiable, const, lvalue, or rvalue) is preserved in this forwarding process. \n\n```c++\ntemplate <typename T1, typename T2>\nvoid functionA(T1 && t1, T2 && t2)\n{\n    functionB(std::forward<T1>(t1), \n              std::forward<T2>(t2));\n}\n```\n\n### Implementation of moveable aware class\n\nA  class with awareness have to implement the big 5, which support **move semantics**. And the **move constructor** and the **destructor** should be guaranteed  without throw, while **copy constructor** behaves as deep copy.\n\n```c++\nclass Mystring\n{\npublic:\n    ~Mystring()  \n    { \n        if (m_data) delete m_data; \n    }\n    \n    Mystring() \n    : m_data(nullptr)\n    , m_len(0)\n    {}\n    \n    Mystring(const Mystring & rhs)\n    {\n        m_len = rhs.m_len;\n        m_data = new char[m_len + 1];\n        memcpy(m_data, rhs.m_data, rhs.m_len);\n        m_data[m_len] = '\\0';\n    }\n    \n    Mystring(const Mystring && rhs) noexcept // noexcept\n    {\n        m_data = rhs.m_data;\n        m_len = rhs.m_len;\n        \n        rhs.m_len = 0;\n        rhs.m_data = nullptr;// when rvalue is a temp object, the dctor will be called while it leaves the efficetive domain(eg: as a function parameter)\n    }\n    \n    Mystring & operator=(const Mystring & rhs)\n    {\n        if (this != rhs) \n        {\n            m_len = rhs.m_len;\n            if (m_data) delete m_data;            \n            m_data = new char[m_len + 1];\n            memcpy(m_data, rhs.m_data, rhs.m_len);\n            m_data[m_len] = '\\0';\n        }\n        return *this;\n    }\n    \n    Mystring & operator=(const Mystring && rhs)\n    {\n        if (this != rhs)\n        {\n            m_len = rhs.m_len;\n            if (m_data) delete m_data;\n          \tm_data = rhs.m_data;\n         \n            rhs.m_len = 0;\n            rhs.m_data = nullptr;\n        }\n        return *this;\n    }\n \nprivate:\n\tchar * m_data; \n\tsize_t m_len;\n};\n```\n\n### Testify it in the STL containers\n\n","source":"_posts/CppRvalueReference.md","raw":"---\ntitle: C++ rvalue reference\ndate: 2019-02-14 18:46:35\ntags: c++2.0\nkeyword: [rvalue reference, move sematics, perfect forwarding]\ncategories: cpp\ndescription: A brief illustration of c++ rvalue reference\ntoc: true\n---\n## c++ rvalue reference\n\n### why we need rvalue references?\n\nrvalue references are a new reference type introduced in c++0x that help solve the problem of **unnecessary copying** and enable **perfect forwarding**. When the right-hand side of an assignment is an rvalue, the the left-hand side object can steal resources from the right-hand side object rather than performing a separate allocation, thus enabling **move semantics**.\n<!--more-->\n\n### what is rvalue and lvalue?\n\n- lvalue: those could be appeared in the left of the `operator =`\n- rvalue: those could only be appeared in the right of the `operator =`\n\n**note:** `C++` with its user-defined types has introduced some subtleties regarding modifiability and assignability that cause this definition to be incorrect. Let us see the following samples:\n\n```c++\n/// sample 1\nint a = 9;\nint b = 4;\n\na = b;\t//OK\nb = a;\t//OK\na = a+b; //OK\n\na + b = 12; // Error, lvalue required as left operand of assignment\n\n/// sample 2\nstring s1(\"hello\");\nstring s2(\"world\");\n\ns1 + s2 = s2; // It is OK, how surprising!!!\ncout << \"s1 = \" << s1 << endl; //s1 = hello\ncout << \"s2 = \" << s2 << endl; //s2 = world\n\nstring() = \"Hello World\"; // It could be assigned to a temp object!!!\n\n/// sample 3\ncomple<int> c1(3, 8), c2(1, 0);\n\nc1 + c2 = comple<int>(4, 9);  //OK, c1 + c2 could be as lvalue!!!\ncout << \"c1 = \" << c1 << endl; //c1 = (3,8)\ncout << \"c2 = \" << c2 << endl; //c2 = (1,0)\n\ncomple<int>() = complex<int>(4, 9); //It could be assigned to a temp object!!!\n```\n\n### the forms of rvalue\n\n- those could only appeared in the right of the `operator =`\n- temp object\n- return value(special form of temp object)\n\n**note:** It would lose some import information of object(especial for rvalue) in call hierarchy. The following is a sample.\n\n```c++\nvoid process(int & i);\nvoid process(int && i);\n\nvoid forward(int && i)\n{\n    process(i);// unperfect forwarding\n}\n```\n\n### What is perfect forwarding?\n\nPerfect forwarding allows you to write a single function template that takes n arbitrary arguments and forwards them transparently to another arbitrary function. The nature of argument(modifiable, const, lvalue, or rvalue) is preserved in this forwarding process. \n\n```c++\ntemplate <typename T1, typename T2>\nvoid functionA(T1 && t1, T2 && t2)\n{\n    functionB(std::forward<T1>(t1), \n              std::forward<T2>(t2));\n}\n```\n\n### Implementation of moveable aware class\n\nA  class with awareness have to implement the big 5, which support **move semantics**. And the **move constructor** and the **destructor** should be guaranteed  without throw, while **copy constructor** behaves as deep copy.\n\n```c++\nclass Mystring\n{\npublic:\n    ~Mystring()  \n    { \n        if (m_data) delete m_data; \n    }\n    \n    Mystring() \n    : m_data(nullptr)\n    , m_len(0)\n    {}\n    \n    Mystring(const Mystring & rhs)\n    {\n        m_len = rhs.m_len;\n        m_data = new char[m_len + 1];\n        memcpy(m_data, rhs.m_data, rhs.m_len);\n        m_data[m_len] = '\\0';\n    }\n    \n    Mystring(const Mystring && rhs) noexcept // noexcept\n    {\n        m_data = rhs.m_data;\n        m_len = rhs.m_len;\n        \n        rhs.m_len = 0;\n        rhs.m_data = nullptr;// when rvalue is a temp object, the dctor will be called while it leaves the efficetive domain(eg: as a function parameter)\n    }\n    \n    Mystring & operator=(const Mystring & rhs)\n    {\n        if (this != rhs) \n        {\n            m_len = rhs.m_len;\n            if (m_data) delete m_data;            \n            m_data = new char[m_len + 1];\n            memcpy(m_data, rhs.m_data, rhs.m_len);\n            m_data[m_len] = '\\0';\n        }\n        return *this;\n    }\n    \n    Mystring & operator=(const Mystring && rhs)\n    {\n        if (this != rhs)\n        {\n            m_len = rhs.m_len;\n            if (m_data) delete m_data;\n          \tm_data = rhs.m_data;\n         \n            rhs.m_len = 0;\n            rhs.m_data = nullptr;\n        }\n        return *this;\n    }\n \nprivate:\n\tchar * m_data; \n\tsize_t m_len;\n};\n```\n\n### Testify it in the STL containers\n\n","slug":"CppRvalueReference","published":1,"updated":"2019-05-07T06:24:34.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf735k000bt0t8p96q7v91","content":"<h2 id=\"c-rvalue-reference\"><a href=\"#c-rvalue-reference\" class=\"headerlink\" title=\"c++ rvalue reference\"></a>c++ rvalue reference</h2><h3 id=\"why-we-need-rvalue-references\"><a href=\"#why-we-need-rvalue-references\" class=\"headerlink\" title=\"why we need rvalue references?\"></a>why we need rvalue references?</h3><p>rvalue references are a new reference type introduced in c++0x that help solve the problem of <strong>unnecessary copying</strong> and enable <strong>perfect forwarding</strong>. When the right-hand side of an assignment is an rvalue, the the left-hand side object can steal resources from the right-hand side object rather than performing a separate allocation, thus enabling <strong>move semantics</strong>.<br><a id=\"more\"></a></p>\n<h3 id=\"what-is-rvalue-and-lvalue\"><a href=\"#what-is-rvalue-and-lvalue\" class=\"headerlink\" title=\"what is rvalue and lvalue?\"></a>what is rvalue and lvalue?</h3><ul>\n<li>lvalue: those could be appeared in the left of the <code>operator =</code></li>\n<li>rvalue: those could only be appeared in the right of the <code>operator =</code></li>\n</ul>\n<p><strong>note:</strong> <code>C++</code> with its user-defined types has introduced some subtleties regarding modifiability and assignability that cause this definition to be incorrect. Let us see the following samples:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// sample 1</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> a = <span class=\"number\">9</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> b = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">a = b;\t<span class=\"comment\">//OK</span></span><br><span class=\"line\">b = a;\t<span class=\"comment\">//OK</span></span><br><span class=\"line\">a = a+b; <span class=\"comment\">//OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">a + b = <span class=\"number\">12</span>; <span class=\"comment\">// Error, lvalue required as left operand of assignment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// sample 2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">s1</span><span class=\"params\">(<span class=\"string\">\"hello\"</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">s2</span><span class=\"params\">(<span class=\"string\">\"world\"</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">s1 + s2 = s2; <span class=\"comment\">// It is OK, how surprising!!!</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"s1 = \"</span> &lt;&lt; s1 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//s1 = hello</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"s2 = \"</span> &lt;&lt; s2 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//s2 = world</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">string</span>() = <span class=\"string\">\"Hello World\"</span>; <span class=\"comment\">// It could be assigned to a temp object!!!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// sample 3</span></span><br><span class=\"line\">comple&lt;<span class=\"keyword\">int</span>&gt; c1(<span class=\"number\">3</span>, <span class=\"number\">8</span>), c2(<span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">c1 + c2 = comple&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">4</span>, <span class=\"number\">9</span>);  <span class=\"comment\">//OK, c1 + c2 could be as lvalue!!!</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"c1 = \"</span> &lt;&lt; c1 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//c1 = (3,8)</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"c2 = \"</span> &lt;&lt; c2 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//c2 = (1,0)</span></span><br><span class=\"line\"></span><br><span class=\"line\">comple&lt;<span class=\"keyword\">int</span>&gt;() = <span class=\"keyword\">complex</span>&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">4</span>, <span class=\"number\">9</span>); <span class=\"comment\">//It could be assigned to a temp object!!!</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"the-forms-of-rvalue\"><a href=\"#the-forms-of-rvalue\" class=\"headerlink\" title=\"the forms of rvalue\"></a>the forms of rvalue</h3><ul>\n<li>those could only appeared in the right of the <code>operator =</code></li>\n<li>temp object</li>\n<li>return value(special form of temp object)</li>\n</ul>\n<p><strong>note:</strong> It would lose some import information of object(especial for rvalue) in call hierarchy. The following is a sample.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp; i)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp;&amp; i)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">forward</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp;&amp; i)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    process(i);<span class=\"comment\">// unperfect forwarding</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"What-is-perfect-forwarding\"><a href=\"#What-is-perfect-forwarding\" class=\"headerlink\" title=\"What is perfect forwarding?\"></a>What is perfect forwarding?</h3><p>Perfect forwarding allows you to write a single function template that takes n arbitrary arguments and forwards them transparently to another arbitrary function. The nature of argument(modifiable, const, lvalue, or rvalue) is preserved in this forwarding process. </p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T1, <span class=\"keyword\">typename</span> T2&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">functionA</span><span class=\"params\">(T1 &amp;&amp; t1, T2 &amp;&amp; t2)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    functionB(<span class=\"built_in\">std</span>::forward&lt;T1&gt;(t1), </span><br><span class=\"line\">              <span class=\"built_in\">std</span>::forward&lt;T2&gt;(t2));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Implementation-of-moveable-aware-class\"><a href=\"#Implementation-of-moveable-aware-class\" class=\"headerlink\" title=\"Implementation of moveable aware class\"></a>Implementation of moveable aware class</h3><p>A  class with awareness have to implement the big 5, which support <strong>move semantics</strong>. And the <strong>move constructor</strong> and the <strong>destructor</strong> should be guaranteed  without throw, while <strong>copy constructor</strong> behaves as deep copy.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mystring</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ~Mystring()  </span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring() </span><br><span class=\"line\">    : m_data(<span class=\"literal\">nullptr</span>)</span><br><span class=\"line\">    , m_len(<span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring(<span class=\"keyword\">const</span> Mystring &amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        m_len = rhs.m_len;</span><br><span class=\"line\">        m_data = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[m_len + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(m_data, rhs.m_data, rhs.m_len);</span><br><span class=\"line\">        m_data[m_len] = <span class=\"string\">'\\0'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring(<span class=\"keyword\">const</span> Mystring &amp;&amp; rhs) <span class=\"keyword\">noexcept</span> <span class=\"comment\">// noexcept</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        m_data = rhs.m_data;</span><br><span class=\"line\">        m_len = rhs.m_len;</span><br><span class=\"line\">        </span><br><span class=\"line\">        rhs.m_len = <span class=\"number\">0</span>;</span><br><span class=\"line\">        rhs.m_data = <span class=\"literal\">nullptr</span>;<span class=\"comment\">// when rvalue is a temp object, the dctor will be called while it leaves the efficetive domain(eg: as a function parameter)</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring &amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Mystring &amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> != rhs) </span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_len = rhs.m_len;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data;            </span><br><span class=\"line\">            m_data = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[m_len + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"built_in\">memcpy</span>(m_data, rhs.m_data, rhs.m_len);</span><br><span class=\"line\">            m_data[m_len] = <span class=\"string\">'\\0'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring &amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Mystring &amp;&amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> != rhs)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_len = rhs.m_len;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data;</span><br><span class=\"line\">          \tm_data = rhs.m_data;</span><br><span class=\"line\">         </span><br><span class=\"line\">            rhs.m_len = <span class=\"number\">0</span>;</span><br><span class=\"line\">            rhs.m_data = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> * m_data; </span><br><span class=\"line\">\t<span class=\"keyword\">size_t</span> m_len;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Testify-it-in-the-STL-containers\"><a href=\"#Testify-it-in-the-STL-containers\" class=\"headerlink\" title=\"Testify it in the STL containers\"></a>Testify it in the STL containers</h3>","site":{"data":{}},"excerpt":"<h2 id=\"c-rvalue-reference\"><a href=\"#c-rvalue-reference\" class=\"headerlink\" title=\"c++ rvalue reference\"></a>c++ rvalue reference</h2><h3 id=\"why-we-need-rvalue-references\"><a href=\"#why-we-need-rvalue-references\" class=\"headerlink\" title=\"why we need rvalue references?\"></a>why we need rvalue references?</h3><p>rvalue references are a new reference type introduced in c++0x that help solve the problem of <strong>unnecessary copying</strong> and enable <strong>perfect forwarding</strong>. When the right-hand side of an assignment is an rvalue, the the left-hand side object can steal resources from the right-hand side object rather than performing a separate allocation, thus enabling <strong>move semantics</strong>.<br>","more":"</p>\n<h3 id=\"what-is-rvalue-and-lvalue\"><a href=\"#what-is-rvalue-and-lvalue\" class=\"headerlink\" title=\"what is rvalue and lvalue?\"></a>what is rvalue and lvalue?</h3><ul>\n<li>lvalue: those could be appeared in the left of the <code>operator =</code></li>\n<li>rvalue: those could only be appeared in the right of the <code>operator =</code></li>\n</ul>\n<p><strong>note:</strong> <code>C++</code> with its user-defined types has introduced some subtleties regarding modifiability and assignability that cause this definition to be incorrect. Let us see the following samples:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// sample 1</span></span><br><span class=\"line\"><span class=\"keyword\">int</span> a = <span class=\"number\">9</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> b = <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">a = b;\t<span class=\"comment\">//OK</span></span><br><span class=\"line\">b = a;\t<span class=\"comment\">//OK</span></span><br><span class=\"line\">a = a+b; <span class=\"comment\">//OK</span></span><br><span class=\"line\"></span><br><span class=\"line\">a + b = <span class=\"number\">12</span>; <span class=\"comment\">// Error, lvalue required as left operand of assignment</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// sample 2</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">s1</span><span class=\"params\">(<span class=\"string\">\"hello\"</span>)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"built_in\">string</span> <span class=\"title\">s2</span><span class=\"params\">(<span class=\"string\">\"world\"</span>)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">s1 + s2 = s2; <span class=\"comment\">// It is OK, how surprising!!!</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"s1 = \"</span> &lt;&lt; s1 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//s1 = hello</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"s2 = \"</span> &lt;&lt; s2 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//s2 = world</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">string</span>() = <span class=\"string\">\"Hello World\"</span>; <span class=\"comment\">// It could be assigned to a temp object!!!</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// sample 3</span></span><br><span class=\"line\">comple&lt;<span class=\"keyword\">int</span>&gt; c1(<span class=\"number\">3</span>, <span class=\"number\">8</span>), c2(<span class=\"number\">1</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">c1 + c2 = comple&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">4</span>, <span class=\"number\">9</span>);  <span class=\"comment\">//OK, c1 + c2 could be as lvalue!!!</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"c1 = \"</span> &lt;&lt; c1 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//c1 = (3,8)</span></span><br><span class=\"line\"><span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"c2 = \"</span> &lt;&lt; c2 &lt;&lt; <span class=\"built_in\">endl</span>; <span class=\"comment\">//c2 = (1,0)</span></span><br><span class=\"line\"></span><br><span class=\"line\">comple&lt;<span class=\"keyword\">int</span>&gt;() = <span class=\"keyword\">complex</span>&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">4</span>, <span class=\"number\">9</span>); <span class=\"comment\">//It could be assigned to a temp object!!!</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"the-forms-of-rvalue\"><a href=\"#the-forms-of-rvalue\" class=\"headerlink\" title=\"the forms of rvalue\"></a>the forms of rvalue</h3><ul>\n<li>those could only appeared in the right of the <code>operator =</code></li>\n<li>temp object</li>\n<li>return value(special form of temp object)</li>\n</ul>\n<p><strong>note:</strong> It would lose some import information of object(especial for rvalue) in call hierarchy. The following is a sample.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp; i)</span></span>;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">process</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp;&amp; i)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">forward</span><span class=\"params\">(<span class=\"keyword\">int</span> &amp;&amp; i)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    process(i);<span class=\"comment\">// unperfect forwarding</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"What-is-perfect-forwarding\"><a href=\"#What-is-perfect-forwarding\" class=\"headerlink\" title=\"What is perfect forwarding?\"></a>What is perfect forwarding?</h3><p>Perfect forwarding allows you to write a single function template that takes n arbitrary arguments and forwards them transparently to another arbitrary function. The nature of argument(modifiable, const, lvalue, or rvalue) is preserved in this forwarding process. </p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> T1, <span class=\"keyword\">typename</span> T2&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">functionA</span><span class=\"params\">(T1 &amp;&amp; t1, T2 &amp;&amp; t2)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    functionB(<span class=\"built_in\">std</span>::forward&lt;T1&gt;(t1), </span><br><span class=\"line\">              <span class=\"built_in\">std</span>::forward&lt;T2&gt;(t2));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Implementation-of-moveable-aware-class\"><a href=\"#Implementation-of-moveable-aware-class\" class=\"headerlink\" title=\"Implementation of moveable aware class\"></a>Implementation of moveable aware class</h3><p>A  class with awareness have to implement the big 5, which support <strong>move semantics</strong>. And the <strong>move constructor</strong> and the <strong>destructor</strong> should be guaranteed  without throw, while <strong>copy constructor</strong> behaves as deep copy.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mystring</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">    ~Mystring()  </span><br><span class=\"line\">    &#123; </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data; </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring() </span><br><span class=\"line\">    : m_data(<span class=\"literal\">nullptr</span>)</span><br><span class=\"line\">    , m_len(<span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring(<span class=\"keyword\">const</span> Mystring &amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        m_len = rhs.m_len;</span><br><span class=\"line\">        m_data = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[m_len + <span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"built_in\">memcpy</span>(m_data, rhs.m_data, rhs.m_len);</span><br><span class=\"line\">        m_data[m_len] = <span class=\"string\">'\\0'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring(<span class=\"keyword\">const</span> Mystring &amp;&amp; rhs) <span class=\"keyword\">noexcept</span> <span class=\"comment\">// noexcept</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        m_data = rhs.m_data;</span><br><span class=\"line\">        m_len = rhs.m_len;</span><br><span class=\"line\">        </span><br><span class=\"line\">        rhs.m_len = <span class=\"number\">0</span>;</span><br><span class=\"line\">        rhs.m_data = <span class=\"literal\">nullptr</span>;<span class=\"comment\">// when rvalue is a temp object, the dctor will be called while it leaves the efficetive domain(eg: as a function parameter)</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring &amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Mystring &amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> != rhs) </span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_len = rhs.m_len;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data;            </span><br><span class=\"line\">            m_data = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[m_len + <span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"built_in\">memcpy</span>(m_data, rhs.m_data, rhs.m_len);</span><br><span class=\"line\">            m_data[m_len] = <span class=\"string\">'\\0'</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Mystring &amp; <span class=\"keyword\">operator</span>=(<span class=\"keyword\">const</span> Mystring &amp;&amp; rhs)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span> != rhs)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            m_len = rhs.m_len;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (m_data) <span class=\"keyword\">delete</span> m_data;</span><br><span class=\"line\">          \tm_data = rhs.m_data;</span><br><span class=\"line\">         </span><br><span class=\"line\">            rhs.m_len = <span class=\"number\">0</span>;</span><br><span class=\"line\">            rhs.m_data = <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> *<span class=\"keyword\">this</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">char</span> * m_data; </span><br><span class=\"line\">\t<span class=\"keyword\">size_t</span> m_len;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"Testify-it-in-the-STL-containers\"><a href=\"#Testify-it-in-the-STL-containers\" class=\"headerlink\" title=\"Testify it in the STL containers\"></a>Testify it in the STL containers</h3>"},{"title":"[Translation] Trusted Computing Group At |(TCG)| Organisation","date":"2019-01-30T12:20:20.000Z","description":"A translation try of TCG.","toc":true,"_content":"\n## Trusted Computing Group At | (TCG) | Organisation\n\nTrusted Computing based on hardware root of trust has been developed  by industry to protect computing infrastructure and billions of end  points.\n\n> \n>\n\n<!--more-->\n\n\n\nTCG created the Trusted Platform Module cryptographic capability,  which enforces specific behaviors and protects the system against  unauthorized changes and attacks such as malware and root kits. As  computing has expanded to different devices and infrastructure has  evolved, so too has TCG extended the concept of trusted systems well  beyond the computer-with-a-TPM to other devices, ranging from hard disk  drives and mobile phones.\n\n> TCG(TPM)TCGTPM\n>\n\nStandards-based Trusted Computing technologies developed by TCG  members now are deployed in enterprise systems, storage systems,  networks, embedded systems, and mobile devices and can secure cloud  computing and virtualized systems. Thousands of vendors offer a variety  of Trusted Computing-based products, including hardware, applications,  and services.\n\n> TCG()()\n>\n\nThe result is that systems, networks, and applications are safer,  less prone to viruses and malware and thus not only more reliable but  also simpler to deploy and easier to manage.\n\n> \n>\n\n## Benefits\n\n### Systems based on Trusted Computing:\n\n- Protect critical data and systems agains a variety of attacks\n- Enable secure authentication and strong protection of unlimited certificates, keys, and passwords that otherwise are accessible\n- Establish strong machine identity and integrity\n- Help satisfy regulatory compliance with hardware-based security\n- Cost less to manage, removing need for expensive tokens and peripherals\n\n> \n>\n> - \n> - \n> - ()\n> - \n> - \n>\n\n### Trusted Computing Technologies:\n\n- Provide more secure remote access through a combination of machine and user authentication\n- Protect against data leakage by confirmation of platform integrity prior to decryption\n- Provide hardware-based protection for encryption and authentication  keys used by stored data files and communications (email, network  access, etc)\n- Protect in hardware Personally Identifiable Information, such as user IDs and passwords\n- Protect passwords and credentials stored on drives\n\n> \n>\n> - \n> - \n> - \n> - ID\n> - \n>\n\n\n\n## Standards Development\n\nSecurity is built into an increasing number of general purpose ICT  products, and security standards are fundamental to the integrity and  sustainability of the global ICT infrastructure. The Trusted Computing  Group (TCG) believes that open, interoperable, and internationally  vetted standards are critical for the success of trusted computing, and  that the multilateral approach to creating such standards is most  effective.\n\n> ICTICTTCGTCG\n>\n\n\n\nTCG works within the international standards community, and has  liaison and working group relationships with the Internet Engineering  Task Force (IETF) and the JTC1 joint committee of the International  Organization for Standardization (ISO) and the International  Electrotechnical Commission (IEC). The Trusted Platform Module is  defined by an [ISO/IEC international standard](http://standards.iso.org/ittf/PubliclyAvailableStandards/index.html)*. The  TCG Certification Program leverages established and recognized security  evaluation standards. This program relies on certification by  laboratories operating under the supervision of National Schemes of [Common Criteria](https://www.commoncriteriaportal.org/) members.\n\n> TCGIETFISOJTC1IECTPMISO/IECTCG\n>\n\n\n\nIn support of open security standards, TCG encourages all nations to  adopt global best practices around standards development and adoption.  An open process fully supports worldwide participation from industry,  academia, and government with fair and transparent development and  decision processes. Specifications must be fully transparent and  available to all participants, both during development and for  implementation. TCG supports the use of published, peer reviewed  standards and cryptographic algorithms.\n\n> TCGTCG\n>\n\n\n\nTCG only supports open standards that are developed through a  transparent development process, have undergone rigorous open review,  and are compatible with existing global standards. Closed standards  hamper both existing and emerging markets, and are detrimental to the  security of global ICT infrastructure, representing an obstacle to  technology innovation and industry growth.\n\n> TCGICT\n>\n\n\n\nTCG recognizes international standards in the field of IT security as  the most appropriate method to ensure efficacy, interoperability,  adoption and user acceptance. TCG takes into consideration international  market requirements through international membership and welcomes  participation from industry, academia, and governments in a unified,  worldwide Trusted Computing standards development process.\n\n> TCGITTCG\n>\n\n\n\n**The Trusted Computing Group Trusted Platform Module specification version 1.2 is published as ISO/IEC 11889 Parts 1-4.*\n\n> TCGTPM1.2ISO/IEC 118891-4\n>","source":"_posts/TCG.md","raw":"---\ntitle: '[Translation] Trusted Computing Group At |(TCG)| Organisation'\ndate: 2019-01-30 20:20:20\ntags: [TCG]\ncategories: translation\ndescription: A translation try of TCG.\ntoc: true\n---\n\n## Trusted Computing Group At | (TCG) | Organisation\n\nTrusted Computing based on hardware root of trust has been developed  by industry to protect computing infrastructure and billions of end  points.\n\n> \n>\n\n<!--more-->\n\n\n\nTCG created the Trusted Platform Module cryptographic capability,  which enforces specific behaviors and protects the system against  unauthorized changes and attacks such as malware and root kits. As  computing has expanded to different devices and infrastructure has  evolved, so too has TCG extended the concept of trusted systems well  beyond the computer-with-a-TPM to other devices, ranging from hard disk  drives and mobile phones.\n\n> TCG(TPM)TCGTPM\n>\n\nStandards-based Trusted Computing technologies developed by TCG  members now are deployed in enterprise systems, storage systems,  networks, embedded systems, and mobile devices and can secure cloud  computing and virtualized systems. Thousands of vendors offer a variety  of Trusted Computing-based products, including hardware, applications,  and services.\n\n> TCG()()\n>\n\nThe result is that systems, networks, and applications are safer,  less prone to viruses and malware and thus not only more reliable but  also simpler to deploy and easier to manage.\n\n> \n>\n\n## Benefits\n\n### Systems based on Trusted Computing:\n\n- Protect critical data and systems agains a variety of attacks\n- Enable secure authentication and strong protection of unlimited certificates, keys, and passwords that otherwise are accessible\n- Establish strong machine identity and integrity\n- Help satisfy regulatory compliance with hardware-based security\n- Cost less to manage, removing need for expensive tokens and peripherals\n\n> \n>\n> - \n> - \n> - ()\n> - \n> - \n>\n\n### Trusted Computing Technologies:\n\n- Provide more secure remote access through a combination of machine and user authentication\n- Protect against data leakage by confirmation of platform integrity prior to decryption\n- Provide hardware-based protection for encryption and authentication  keys used by stored data files and communications (email, network  access, etc)\n- Protect in hardware Personally Identifiable Information, such as user IDs and passwords\n- Protect passwords and credentials stored on drives\n\n> \n>\n> - \n> - \n> - \n> - ID\n> - \n>\n\n\n\n## Standards Development\n\nSecurity is built into an increasing number of general purpose ICT  products, and security standards are fundamental to the integrity and  sustainability of the global ICT infrastructure. The Trusted Computing  Group (TCG) believes that open, interoperable, and internationally  vetted standards are critical for the success of trusted computing, and  that the multilateral approach to creating such standards is most  effective.\n\n> ICTICTTCGTCG\n>\n\n\n\nTCG works within the international standards community, and has  liaison and working group relationships with the Internet Engineering  Task Force (IETF) and the JTC1 joint committee of the International  Organization for Standardization (ISO) and the International  Electrotechnical Commission (IEC). The Trusted Platform Module is  defined by an [ISO/IEC international standard](http://standards.iso.org/ittf/PubliclyAvailableStandards/index.html)*. The  TCG Certification Program leverages established and recognized security  evaluation standards. This program relies on certification by  laboratories operating under the supervision of National Schemes of [Common Criteria](https://www.commoncriteriaportal.org/) members.\n\n> TCGIETFISOJTC1IECTPMISO/IECTCG\n>\n\n\n\nIn support of open security standards, TCG encourages all nations to  adopt global best practices around standards development and adoption.  An open process fully supports worldwide participation from industry,  academia, and government with fair and transparent development and  decision processes. Specifications must be fully transparent and  available to all participants, both during development and for  implementation. TCG supports the use of published, peer reviewed  standards and cryptographic algorithms.\n\n> TCGTCG\n>\n\n\n\nTCG only supports open standards that are developed through a  transparent development process, have undergone rigorous open review,  and are compatible with existing global standards. Closed standards  hamper both existing and emerging markets, and are detrimental to the  security of global ICT infrastructure, representing an obstacle to  technology innovation and industry growth.\n\n> TCGICT\n>\n\n\n\nTCG recognizes international standards in the field of IT security as  the most appropriate method to ensure efficacy, interoperability,  adoption and user acceptance. TCG takes into consideration international  market requirements through international membership and welcomes  participation from industry, academia, and governments in a unified,  worldwide Trusted Computing standards development process.\n\n> TCGITTCG\n>\n\n\n\n**The Trusted Computing Group Trusted Platform Module specification version 1.2 is published as ISO/IEC 11889 Parts 1-4.*\n\n> TCGTPM1.2ISO/IEC 118891-4\n>","slug":"TCG","published":1,"updated":"2019-03-06T09:24:50.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf736n000vt0t8amk4sw6a","content":"<h2 id=\"Trusted-Computing-Group-At-TCG-Organisation\"><a href=\"#Trusted-Computing-Group-At-TCG-Organisation\" class=\"headerlink\" title=\"Trusted Computing Group At | (TCG) | Organisation\"></a>Trusted Computing Group At | (TCG) | Organisation</h2><p>Trusted Computing based on hardware root of trust has been developed  by industry to protect computing infrastructure and billions of end  points.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<a id=\"more\"></a>\n<p>TCG created the Trusted Platform Module cryptographic capability,  which enforces specific behaviors and protects the system against  unauthorized changes and attacks such as malware and root kits. As  computing has expanded to different devices and infrastructure has  evolved, so too has TCG extended the concept of trusted systems well  beyond the computer-with-a-TPM to other devices, ranging from hard disk  drives and mobile phones.</p>\n<blockquote>\n<p>TCG(TPM)TCGTPM</p>\n</blockquote>\n<p>Standards-based Trusted Computing technologies developed by TCG  members now are deployed in enterprise systems, storage systems,  networks, embedded systems, and mobile devices and can secure cloud  computing and virtualized systems. Thousands of vendors offer a variety  of Trusted Computing-based products, including hardware, applications,  and services.</p>\n<blockquote>\n<p>TCG()()</p>\n</blockquote>\n<p>The result is that systems, networks, and applications are safer,  less prone to viruses and malware and thus not only more reliable but  also simpler to deploy and easier to manage.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"Benefits\"><a href=\"#Benefits\" class=\"headerlink\" title=\"Benefits\"></a>Benefits</h2><h3 id=\"Systems-based-on-Trusted-Computing\"><a href=\"#Systems-based-on-Trusted-Computing\" class=\"headerlink\" title=\"Systems based on Trusted Computing:\"></a>Systems based on Trusted Computing:</h3><ul>\n<li>Protect critical data and systems agains a variety of attacks</li>\n<li>Enable secure authentication and strong protection of unlimited certificates, keys, and passwords that otherwise are accessible</li>\n<li>Establish strong machine identity and integrity</li>\n<li>Help satisfy regulatory compliance with hardware-based security</li>\n<li>Cost less to manage, removing need for expensive tokens and peripherals</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li>()</li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<h3 id=\"Trusted-Computing-Technologies\"><a href=\"#Trusted-Computing-Technologies\" class=\"headerlink\" title=\"Trusted Computing Technologies:\"></a>Trusted Computing Technologies:</h3><ul>\n<li>Provide more secure remote access through a combination of machine and user authentication</li>\n<li>Protect against data leakage by confirmation of platform integrity prior to decryption</li>\n<li>Provide hardware-based protection for encryption and authentication  keys used by stored data files and communications (email, network  access, etc)</li>\n<li>Protect in hardware Personally Identifiable Information, such as user IDs and passwords</li>\n<li>Protect passwords and credentials stored on drives</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>ID</li>\n<li></li>\n</ul>\n</blockquote>\n<h2 id=\"Standards-Development\"><a href=\"#Standards-Development\" class=\"headerlink\" title=\"Standards Development\"></a>Standards Development</h2><p>Security is built into an increasing number of general purpose ICT  products, and security standards are fundamental to the integrity and  sustainability of the global ICT infrastructure. The Trusted Computing  Group (TCG) believes that open, interoperable, and internationally  vetted standards are critical for the success of trusted computing, and  that the multilateral approach to creating such standards is most  effective.</p>\n<blockquote>\n<p>ICTICTTCGTCG</p>\n</blockquote>\n<p>TCG works within the international standards community, and has  liaison and working group relationships with the Internet Engineering  Task Force (IETF) and the JTC1 joint committee of the International  Organization for Standardization (ISO) and the International  Electrotechnical Commission (IEC). The Trusted Platform Module is  defined by an <a href=\"http://standards.iso.org/ittf/PubliclyAvailableStandards/index.html\" target=\"_blank\" rel=\"noopener\">ISO/IEC international standard</a>*. The  TCG Certification Program leverages established and recognized security  evaluation standards. This program relies on certification by  laboratories operating under the supervision of National Schemes of <a href=\"https://www.commoncriteriaportal.org/\" target=\"_blank\" rel=\"noopener\">Common Criteria</a> members.</p>\n<blockquote>\n<p>TCGIETFISOJTC1IECTPMISO/IECTCG</p>\n</blockquote>\n<p>In support of open security standards, TCG encourages all nations to  adopt global best practices around standards development and adoption.  An open process fully supports worldwide participation from industry,  academia, and government with fair and transparent development and  decision processes. Specifications must be fully transparent and  available to all participants, both during development and for  implementation. TCG supports the use of published, peer reviewed  standards and cryptographic algorithms.</p>\n<blockquote>\n<p>TCGTCG</p>\n</blockquote>\n<p>TCG only supports open standards that are developed through a  transparent development process, have undergone rigorous open review,  and are compatible with existing global standards. Closed standards  hamper both existing and emerging markets, and are detrimental to the  security of global ICT infrastructure, representing an obstacle to  technology innovation and industry growth.</p>\n<blockquote>\n<p>TCGICT</p>\n</blockquote>\n<p>TCG recognizes international standards in the field of IT security as  the most appropriate method to ensure efficacy, interoperability,  adoption and user acceptance. TCG takes into consideration international  market requirements through international membership and welcomes  participation from industry, academia, and governments in a unified,  worldwide Trusted Computing standards development process.</p>\n<blockquote>\n<p>TCGITTCG</p>\n</blockquote>\n<p>*<em>The Trusted Computing Group Trusted Platform Module specification version 1.2 is published as ISO/IEC 11889 Parts 1-4.</em></p>\n<blockquote>\n<p>TCGTPM1.2ISO/IEC 118891-4</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"Trusted-Computing-Group-At-TCG-Organisation\"><a href=\"#Trusted-Computing-Group-At-TCG-Organisation\" class=\"headerlink\" title=\"Trusted Computing Group At | (TCG) | Organisation\"></a>Trusted Computing Group At | (TCG) | Organisation</h2><p>Trusted Computing based on hardware root of trust has been developed  by industry to protect computing infrastructure and billions of end  points.</p>\n<blockquote>\n<p></p>\n</blockquote>","more":"<p>TCG created the Trusted Platform Module cryptographic capability,  which enforces specific behaviors and protects the system against  unauthorized changes and attacks such as malware and root kits. As  computing has expanded to different devices and infrastructure has  evolved, so too has TCG extended the concept of trusted systems well  beyond the computer-with-a-TPM to other devices, ranging from hard disk  drives and mobile phones.</p>\n<blockquote>\n<p>TCG(TPM)TCGTPM</p>\n</blockquote>\n<p>Standards-based Trusted Computing technologies developed by TCG  members now are deployed in enterprise systems, storage systems,  networks, embedded systems, and mobile devices and can secure cloud  computing and virtualized systems. Thousands of vendors offer a variety  of Trusted Computing-based products, including hardware, applications,  and services.</p>\n<blockquote>\n<p>TCG()()</p>\n</blockquote>\n<p>The result is that systems, networks, and applications are safer,  less prone to viruses and malware and thus not only more reliable but  also simpler to deploy and easier to manage.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<h2 id=\"Benefits\"><a href=\"#Benefits\" class=\"headerlink\" title=\"Benefits\"></a>Benefits</h2><h3 id=\"Systems-based-on-Trusted-Computing\"><a href=\"#Systems-based-on-Trusted-Computing\" class=\"headerlink\" title=\"Systems based on Trusted Computing:\"></a>Systems based on Trusted Computing:</h3><ul>\n<li>Protect critical data and systems agains a variety of attacks</li>\n<li>Enable secure authentication and strong protection of unlimited certificates, keys, and passwords that otherwise are accessible</li>\n<li>Establish strong machine identity and integrity</li>\n<li>Help satisfy regulatory compliance with hardware-based security</li>\n<li>Cost less to manage, removing need for expensive tokens and peripherals</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li>()</li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<h3 id=\"Trusted-Computing-Technologies\"><a href=\"#Trusted-Computing-Technologies\" class=\"headerlink\" title=\"Trusted Computing Technologies:\"></a>Trusted Computing Technologies:</h3><ul>\n<li>Provide more secure remote access through a combination of machine and user authentication</li>\n<li>Protect against data leakage by confirmation of platform integrity prior to decryption</li>\n<li>Provide hardware-based protection for encryption and authentication  keys used by stored data files and communications (email, network  access, etc)</li>\n<li>Protect in hardware Personally Identifiable Information, such as user IDs and passwords</li>\n<li>Protect passwords and credentials stored on drives</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>ID</li>\n<li></li>\n</ul>\n</blockquote>\n<h2 id=\"Standards-Development\"><a href=\"#Standards-Development\" class=\"headerlink\" title=\"Standards Development\"></a>Standards Development</h2><p>Security is built into an increasing number of general purpose ICT  products, and security standards are fundamental to the integrity and  sustainability of the global ICT infrastructure. The Trusted Computing  Group (TCG) believes that open, interoperable, and internationally  vetted standards are critical for the success of trusted computing, and  that the multilateral approach to creating such standards is most  effective.</p>\n<blockquote>\n<p>ICTICTTCGTCG</p>\n</blockquote>\n<p>TCG works within the international standards community, and has  liaison and working group relationships with the Internet Engineering  Task Force (IETF) and the JTC1 joint committee of the International  Organization for Standardization (ISO) and the International  Electrotechnical Commission (IEC). The Trusted Platform Module is  defined by an <a href=\"http://standards.iso.org/ittf/PubliclyAvailableStandards/index.html\" target=\"_blank\" rel=\"noopener\">ISO/IEC international standard</a>*. The  TCG Certification Program leverages established and recognized security  evaluation standards. This program relies on certification by  laboratories operating under the supervision of National Schemes of <a href=\"https://www.commoncriteriaportal.org/\" target=\"_blank\" rel=\"noopener\">Common Criteria</a> members.</p>\n<blockquote>\n<p>TCGIETFISOJTC1IECTPMISO/IECTCG</p>\n</blockquote>\n<p>In support of open security standards, TCG encourages all nations to  adopt global best practices around standards development and adoption.  An open process fully supports worldwide participation from industry,  academia, and government with fair and transparent development and  decision processes. Specifications must be fully transparent and  available to all participants, both during development and for  implementation. TCG supports the use of published, peer reviewed  standards and cryptographic algorithms.</p>\n<blockquote>\n<p>TCGTCG</p>\n</blockquote>\n<p>TCG only supports open standards that are developed through a  transparent development process, have undergone rigorous open review,  and are compatible with existing global standards. Closed standards  hamper both existing and emerging markets, and are detrimental to the  security of global ICT infrastructure, representing an obstacle to  technology innovation and industry growth.</p>\n<blockquote>\n<p>TCGICT</p>\n</blockquote>\n<p>TCG recognizes international standards in the field of IT security as  the most appropriate method to ensure efficacy, interoperability,  adoption and user acceptance. TCG takes into consideration international  market requirements through international membership and welcomes  participation from industry, academia, and governments in a unified,  worldwide Trusted Computing standards development process.</p>\n<blockquote>\n<p>TCGITTCG</p>\n</blockquote>\n<p>*<em>The Trusted Computing Group Trusted Platform Module specification version 1.2 is published as ISO/IEC 11889 Parts 1-4.</em></p>\n<blockquote>\n<p>TCGTPM1.2ISO/IEC 118891-4</p>\n</blockquote>"},{"title":"Illustrate ProtoBuf","date":"2016-03-15T19:33:18.000Z","toc":true,"_content":"\n## Protobufgoogle protocol buffer\n\n#### \n\nGoogle Protocol Buffer(  Protobuf)  Google  48,162  12,183  .proto  RPC \nProtocol Buffers  RPC ` C++``Java``Python``go``c #`  API[](https://github.com/google/protobuf/releases)\n\n<!--more-->\n\n#### \n\nUbuntu 15.04 \n\n[1](https://github.com/google/protobuf/releases)[2](https://developers.google.com/protocol-buffers/docs/downloads)\n`tar xzvf protobuf-3.0.0-beta-3.tar.gz`\n`sudo apt-get install autoconf automake libtool curl make g++ unzip`\n[4]\n`./autogen.sh`\n`./configure`\n`make check`\n`sudo make install`\n`sudo ldconfig # refresh shared library cache.`\n\n#### \n\n##### 3.1 Google[1]\n\n1 . `addressbook.proto`\n\n```protobuf\n//syntax = \"proto2\";\n\npackage tutorial;\n\nmessage Person {\n\trequired string name = 1;\n\trequired int32 id = 2;\n\toptional string email = 3;\n\n\tenum PhoneType {\n\t\tMOBILE = 0;\n\t\tHOME = 1;\n\t\tWORK = 2;\n\t}\n\n\tmessage PhoneNumber {\n\t\trequired string number = 1;\n\t\toptional PhoneType phone_type = 2 [default = HOME];\n\t}\n\n\trepeated PhoneNumber phone = 4;\n}\n\nmessage AddressBook {\n\trepeated Person person = 1;\t\n}\n\n```\n\n2 . \n`protoc I=./ --cpp_out=./ ./addressbook.proto`\n\n3 . `writer.cc`\n\n```c++\n /**\n  * @file    writer.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-12 19:52:22\n  */\n\n#include <iostream>\n#include <fstream>\n#include <string>\n\n#include \"addressbook.pb.h\"\n\nusing namespace std;\n\nvoid PromptForAddress(tutorial::Person * person) {\n\tcout << \"Enter person ID name :\";\n\tint id;\n\tcin >> id;\n\tperson->set_id(id);\n\tcin.ignore(256, '\\n');\n\n\tcout << \"Enter name:\";\n\tgetline(cin , *person->mutable_name());\n\n\tcout << \"Enter email address (blank for none):\";\n\tstring email;\n\tgetline(cin, email);\n\tif (!email.empty()) {\n\t\tperson->set_email(email);\n\t}\n\n\twhile (true) {\n\t\tcout << \"Enter a phone number (or leave a blank to finish):\";\n\t\tstring number;\n\t\tgetline(cin, number);\n\t\tif (number.empty()) {\n\t\t\tbreak;\n\t\t}\n\n\t\ttutorial::Person::PhoneNumber * phone_number = person->add_phone();\n\t\tphone_number->set_number(number);\n\n\t\tcout << \"Is this a mobile, home or work phone?\";\n\t\tstring type;\n\t\tgetline(cin, type);\n\t\tif (\"mobile\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::MOBILE);\n\t\t} else if (\"home\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::HOME);\n\t\t} else if (\"work\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::WORK);\n\t\t} else {\n\t\t\tcout << \"Unknow phone type.\" << endl;\n\t\t}// end else\n\n\t}// end while\n}\n\nint main(int argc, char *argv[])\n{\n\t//\n\tGOOGLE_PROTOBUF_VERIFY_VERSION;\n\n\tif (argc != 2) {\n\t\tcerr << \"Usage :\" << argv[0] << \"ADDRESS_BOOK_FILE\" << endl;\n\t\treturn -1;\n\t}\n\t\n\ttutorial::AddressBook address_book;\n\t{\n\t\tfstream input(argv[1], ios::in | ios::binary);\n\t\tif (!input) {\n\t\t\tcout << argv[1] << \":File not found. Creating a new file.\" << endl;\n\t\t} else if (!address_book.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\t// Add an address.\n\tPromptForAddress(address_book.add_person()); \n\n\t{\n\t\t// Write the new address book back to disk.\n\t\tfstream output(argv[1], ios::out | ios::trunc | ios::binary);\n\t\tif (!address_book.SerializeToOstream(&output)) {\n\t\t\tcerr << \"Failed to write address book.\" << endl;\n\t\t\treturn -1;\n\t\t}//end if\n\t}\n\n\t// Delete all global objects allocated by libprotobuf.\n\tgoogle::protobuf::ShutdownProtobufLibrary();\n\n\treturn 0;\n}\n\n```\n\n4 . `reader.cc`\n\n```c++\n /**\n  * @file    reader.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-13 00:26:43\n  */\n\n#include <iostream>\n#include <fstream>\n#include <string>\n\n#include \"addressbook.pb.h\"\n\nusing namespace std;\n\nvoid ListPeople(const tutorial::AddressBook & address_book) {\n\tfor (int i = 0; i < address_book.person_size(); i++) {\n\t\tconst tutorial::Person & person = address_book.person(i);\n\n\t\tcout << \" Person ID: \" << person.id() << endl;\n\t\tcout << \" Name : \" << person.name() << endl;\n\t\tif (person.has_email()) {\n\t\t\tcout << \" Email : \" << person.email() << endl;\n\t\t}\n\t\t\n\t\tfor (int j = 0; j < person.phone_size(); j++) {\n\t\t\tconst tutorial::Person::PhoneNumber & phone_number = person.phone(j);\n\t\t\t\n\t\t\tswitch (phone_number.phone_type()) {\n\t\t\t\tcase tutorial::Person::MOBILE:\n\t\t\t\t\tcout << \" MOBILE : \";\n\t\t\t\t\tbreak;\n\t\t\t\tcase tutorial::Person::HOME:\n\t\t\t\t\tcout << \" HOME : \";\n\t\t\t\t\tbreak;\n\t\t\t\tcase tutorial::Person::WORK:\n\t\t\t\t\tcout << \" WORK : \";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tcout << phone_number.number() << endl;\n\t\t}\n\n\t}// end for\n}\n\n\n\nint main(int argc, char *argv[])\n{\n\t//::GOOGLE::PROTOBUF_VERIFY_VERSION;\n\n\tif (argc != 2) {\n\t\tcerr << \"Usage: \" << argv[0] << \" ADDRESS_BOOK_FILE\" << endl;\n\t\treturn -1;\n\t}\t\n\ttutorial::AddressBook address_book;\n\n\t{\n\t\tfstream input(argv[1], ios::in | ios::binary);\n\t\tif (!address_book.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n\t\n\tListPeople(address_book);\n\n\tgoogle::protobuf::ShutdownProtobufLibrary();\n\n\treturn 0;\n}\n\n```\n\n5 . \n`g++ -o writer writer.cc addressbook.pb.cc lprotobuf`\n`g++ -o reader reader.cc addressbook.pb.cc lprotobuf`\n6 . \n`./writer mid_file`\n`$Enter person ID name :1001`\n`$Enter name :Yun Ma`\n`$Enter email address (blank for none):ali@ali.com`\n`$Enter a phone number (or leave a blank to finish):17088888888`\n`$Is this a mobile , home or work phone?work`\n\n`./reader mid_file`\n```bash\nPerson ID :1001\nName : Yun MA\nEmail : ali@ali.com\nWORK : work\n```\n\n##### 3.2 DIYhelloworld[3]\n\n1`lm.helloworld.proto`\n\n```protobuf\nsyntax = \"proto2\";\n\npackage lm;\n\nmessage helloworld {\n\trequired int32\t\tid = 1;\n\trequired string\t\tstr = 2;\n\toptional int32\t\topt = 3;\n}\n\n```\n2\n```bash\nprotoc -I=./ --cpp_out=./ ./lm.helloword.proto\n```\n3writer.cc\n```c++\n /**\n  * @file    writer.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-13 16:04:02\n  */\n\n#include <iostream>\n#include <fstream>\n\n#include \"lm.helloworld.pb.h\"\n\nusing std::cout;\nusing std::cerr;\nusing std::endl;\nusing std::fstream;\nusing std::ios;\n\nint main()\n{\n\tlm::helloworld msg1;\n\tmsg1.set_id(1001);\n\tmsg1.set_str(\"google\");\n\n\tfstream output(\"./log\", ios::out | ios::trunc | ios::binary);\n\n\tif (!msg1.SerializeToOstream(&output)) {\n\t\tcerr << \"Failed to write msg.\" << endl;\n\t\treturn -1;\n\t}\n\t\n\treturn 0;\n}\n\n```\n4reader.cc\n```c++\n /**\n  * @file    reader.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-12 18:08:34\n  */\n\n#include \"lm.helloworld.pb.h\"\n\n#include <iostream>\n#include <fstream>\n\nusing std::cout;\nusing std::endl;\nusing std::fstream;\nusing std::ios;\nusing std::cerr;\n\nvoid listMsg(const lm::helloworld & msg) {\n\tcout << \"id = \" << msg.id() << endl;\n\tcout << \"str = \" << msg.str() << endl;\n}\n\n\nint main()\n{\n\tlm::helloworld msg1;\n#if 1\n\t{\n\t\tfstream input(\"./log\", ios::in | ios::binary);\n\t\tif (!msg1.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\t\n\tlistMsg(msg1);\n\n\treturn 0;\n}\n\n```\n5 .  \n`./writer`\n`$cat log`\n`$google`\n\n`./reader`\n`$ id = 1001`\n`$ str = google`\n\n#### \n\n[1]https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format\n[2]https://github.com/google/protobuf/blob/master/src/README.md\n[3]http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/\n\n\n","source":"_posts/IllustrateOfProtoBuf.md","raw":"---\ntitle: Illustrate ProtoBuf\ndate: 2016-03-16 03:33:18\ntags: protobuf\ncategories: opensource\ntoc: true\n---\n\n## Protobufgoogle protocol buffer\n\n#### \n\nGoogle Protocol Buffer(  Protobuf)  Google  48,162  12,183  .proto  RPC \nProtocol Buffers  RPC ` C++``Java``Python``go``c #`  API[](https://github.com/google/protobuf/releases)\n\n<!--more-->\n\n#### \n\nUbuntu 15.04 \n\n[1](https://github.com/google/protobuf/releases)[2](https://developers.google.com/protocol-buffers/docs/downloads)\n`tar xzvf protobuf-3.0.0-beta-3.tar.gz`\n`sudo apt-get install autoconf automake libtool curl make g++ unzip`\n[4]\n`./autogen.sh`\n`./configure`\n`make check`\n`sudo make install`\n`sudo ldconfig # refresh shared library cache.`\n\n#### \n\n##### 3.1 Google[1]\n\n1 . `addressbook.proto`\n\n```protobuf\n//syntax = \"proto2\";\n\npackage tutorial;\n\nmessage Person {\n\trequired string name = 1;\n\trequired int32 id = 2;\n\toptional string email = 3;\n\n\tenum PhoneType {\n\t\tMOBILE = 0;\n\t\tHOME = 1;\n\t\tWORK = 2;\n\t}\n\n\tmessage PhoneNumber {\n\t\trequired string number = 1;\n\t\toptional PhoneType phone_type = 2 [default = HOME];\n\t}\n\n\trepeated PhoneNumber phone = 4;\n}\n\nmessage AddressBook {\n\trepeated Person person = 1;\t\n}\n\n```\n\n2 . \n`protoc I=./ --cpp_out=./ ./addressbook.proto`\n\n3 . `writer.cc`\n\n```c++\n /**\n  * @file    writer.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-12 19:52:22\n  */\n\n#include <iostream>\n#include <fstream>\n#include <string>\n\n#include \"addressbook.pb.h\"\n\nusing namespace std;\n\nvoid PromptForAddress(tutorial::Person * person) {\n\tcout << \"Enter person ID name :\";\n\tint id;\n\tcin >> id;\n\tperson->set_id(id);\n\tcin.ignore(256, '\\n');\n\n\tcout << \"Enter name:\";\n\tgetline(cin , *person->mutable_name());\n\n\tcout << \"Enter email address (blank for none):\";\n\tstring email;\n\tgetline(cin, email);\n\tif (!email.empty()) {\n\t\tperson->set_email(email);\n\t}\n\n\twhile (true) {\n\t\tcout << \"Enter a phone number (or leave a blank to finish):\";\n\t\tstring number;\n\t\tgetline(cin, number);\n\t\tif (number.empty()) {\n\t\t\tbreak;\n\t\t}\n\n\t\ttutorial::Person::PhoneNumber * phone_number = person->add_phone();\n\t\tphone_number->set_number(number);\n\n\t\tcout << \"Is this a mobile, home or work phone?\";\n\t\tstring type;\n\t\tgetline(cin, type);\n\t\tif (\"mobile\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::MOBILE);\n\t\t} else if (\"home\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::HOME);\n\t\t} else if (\"work\" == type) {\n\t\t\tphone_number->set_phone_type(tutorial::Person::WORK);\n\t\t} else {\n\t\t\tcout << \"Unknow phone type.\" << endl;\n\t\t}// end else\n\n\t}// end while\n}\n\nint main(int argc, char *argv[])\n{\n\t//\n\tGOOGLE_PROTOBUF_VERIFY_VERSION;\n\n\tif (argc != 2) {\n\t\tcerr << \"Usage :\" << argv[0] << \"ADDRESS_BOOK_FILE\" << endl;\n\t\treturn -1;\n\t}\n\t\n\ttutorial::AddressBook address_book;\n\t{\n\t\tfstream input(argv[1], ios::in | ios::binary);\n\t\tif (!input) {\n\t\t\tcout << argv[1] << \":File not found. Creating a new file.\" << endl;\n\t\t} else if (!address_book.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n\n\t// Add an address.\n\tPromptForAddress(address_book.add_person()); \n\n\t{\n\t\t// Write the new address book back to disk.\n\t\tfstream output(argv[1], ios::out | ios::trunc | ios::binary);\n\t\tif (!address_book.SerializeToOstream(&output)) {\n\t\t\tcerr << \"Failed to write address book.\" << endl;\n\t\t\treturn -1;\n\t\t}//end if\n\t}\n\n\t// Delete all global objects allocated by libprotobuf.\n\tgoogle::protobuf::ShutdownProtobufLibrary();\n\n\treturn 0;\n}\n\n```\n\n4 . `reader.cc`\n\n```c++\n /**\n  * @file    reader.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-13 00:26:43\n  */\n\n#include <iostream>\n#include <fstream>\n#include <string>\n\n#include \"addressbook.pb.h\"\n\nusing namespace std;\n\nvoid ListPeople(const tutorial::AddressBook & address_book) {\n\tfor (int i = 0; i < address_book.person_size(); i++) {\n\t\tconst tutorial::Person & person = address_book.person(i);\n\n\t\tcout << \" Person ID: \" << person.id() << endl;\n\t\tcout << \" Name : \" << person.name() << endl;\n\t\tif (person.has_email()) {\n\t\t\tcout << \" Email : \" << person.email() << endl;\n\t\t}\n\t\t\n\t\tfor (int j = 0; j < person.phone_size(); j++) {\n\t\t\tconst tutorial::Person::PhoneNumber & phone_number = person.phone(j);\n\t\t\t\n\t\t\tswitch (phone_number.phone_type()) {\n\t\t\t\tcase tutorial::Person::MOBILE:\n\t\t\t\t\tcout << \" MOBILE : \";\n\t\t\t\t\tbreak;\n\t\t\t\tcase tutorial::Person::HOME:\n\t\t\t\t\tcout << \" HOME : \";\n\t\t\t\t\tbreak;\n\t\t\t\tcase tutorial::Person::WORK:\n\t\t\t\t\tcout << \" WORK : \";\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tcout << phone_number.number() << endl;\n\t\t}\n\n\t}// end for\n}\n\n\n\nint main(int argc, char *argv[])\n{\n\t//::GOOGLE::PROTOBUF_VERIFY_VERSION;\n\n\tif (argc != 2) {\n\t\tcerr << \"Usage: \" << argv[0] << \" ADDRESS_BOOK_FILE\" << endl;\n\t\treturn -1;\n\t}\t\n\ttutorial::AddressBook address_book;\n\n\t{\n\t\tfstream input(argv[1], ios::in | ios::binary);\n\t\tif (!address_book.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n\t\n\tListPeople(address_book);\n\n\tgoogle::protobuf::ShutdownProtobufLibrary();\n\n\treturn 0;\n}\n\n```\n\n5 . \n`g++ -o writer writer.cc addressbook.pb.cc lprotobuf`\n`g++ -o reader reader.cc addressbook.pb.cc lprotobuf`\n6 . \n`./writer mid_file`\n`$Enter person ID name :1001`\n`$Enter name :Yun Ma`\n`$Enter email address (blank for none):ali@ali.com`\n`$Enter a phone number (or leave a blank to finish):17088888888`\n`$Is this a mobile , home or work phone?work`\n\n`./reader mid_file`\n```bash\nPerson ID :1001\nName : Yun MA\nEmail : ali@ali.com\nWORK : work\n```\n\n##### 3.2 DIYhelloworld[3]\n\n1`lm.helloworld.proto`\n\n```protobuf\nsyntax = \"proto2\";\n\npackage lm;\n\nmessage helloworld {\n\trequired int32\t\tid = 1;\n\trequired string\t\tstr = 2;\n\toptional int32\t\topt = 3;\n}\n\n```\n2\n```bash\nprotoc -I=./ --cpp_out=./ ./lm.helloword.proto\n```\n3writer.cc\n```c++\n /**\n  * @file    writer.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-13 16:04:02\n  */\n\n#include <iostream>\n#include <fstream>\n\n#include \"lm.helloworld.pb.h\"\n\nusing std::cout;\nusing std::cerr;\nusing std::endl;\nusing std::fstream;\nusing std::ios;\n\nint main()\n{\n\tlm::helloworld msg1;\n\tmsg1.set_id(1001);\n\tmsg1.set_str(\"google\");\n\n\tfstream output(\"./log\", ios::out | ios::trunc | ios::binary);\n\n\tif (!msg1.SerializeToOstream(&output)) {\n\t\tcerr << \"Failed to write msg.\" << endl;\n\t\treturn -1;\n\t}\n\t\n\treturn 0;\n}\n\n```\n4reader.cc\n```c++\n /**\n  * @file    reader.cc\n  * @author  Home Jang(generalibm@gmail.com)\n  * @date    2016-06-12 18:08:34\n  */\n\n#include \"lm.helloworld.pb.h\"\n\n#include <iostream>\n#include <fstream>\n\nusing std::cout;\nusing std::endl;\nusing std::fstream;\nusing std::ios;\nusing std::cerr;\n\nvoid listMsg(const lm::helloworld & msg) {\n\tcout << \"id = \" << msg.id() << endl;\n\tcout << \"str = \" << msg.str() << endl;\n}\n\n\nint main()\n{\n\tlm::helloworld msg1;\n#if 1\n\t{\n\t\tfstream input(\"./log\", ios::in | ios::binary);\n\t\tif (!msg1.ParseFromIstream(&input)) {\n\t\t\tcerr << \"Failed to parse address book.\" << endl;\n\t\t\treturn -1;\n\t\t}\n\t}\n#endif\t\n\tlistMsg(msg1);\n\n\treturn 0;\n}\n\n```\n5 .  \n`./writer`\n`$cat log`\n`$google`\n\n`./reader`\n`$ id = 1001`\n`$ str = google`\n\n#### \n\n[1]https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format\n[2]https://github.com/google/protobuf/blob/master/src/README.md\n[3]http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/\n\n\n","slug":"IllustrateOfProtoBuf","published":1,"updated":"2019-03-06T09:07:16.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf736p000wt0t8j2tfe185","content":"<h2 id=\"Protobufgoogle-protocol-buffer\"><a href=\"#Protobufgoogle-protocol-buffer\" class=\"headerlink\" title=\"Protobufgoogle protocol buffer\"></a>Protobufgoogle protocol buffer</h2><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Google Protocol Buffer(  Protobuf)  Google  48,162  12,183  .proto  RPC <br>Protocol Buffers  RPC <code>C++</code><code>Java</code><code>Python</code><code>go</code><code>c #</code>  API<a href=\"https://github.com/google/protobuf/releases\" target=\"_blank\" rel=\"noopener\"></a></p>\n<a id=\"more\"></a>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Ubuntu 15.04<br><br><a href=\"https://github.com/google/protobuf/releases\" target=\"_blank\" rel=\"noopener\">1</a><a href=\"https://developers.google.com/protocol-buffers/docs/downloads\" target=\"_blank\" rel=\"noopener\">2</a><br><code>tar xzvf protobuf-3.0.0-beta-3.tar.gz</code><br><code>sudo apt-get install autoconf automake libtool curl make g++ unzip</code><br>[4]<br><code>./autogen.sh</code><br><code>./configure</code><br><code>make check</code><br><code>sudo make install</code><br><code>sudo ldconfig # refresh shared library cache.</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"3-1-Google-1\"><a href=\"#3-1-Google-1\" class=\"headerlink\" title=\"3.1 Google[1]\"></a>3.1 Google[1]</h5><p>1 . <code>addressbook.proto</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//syntax = &quot;proto2&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">package tutorial;</span><br><span class=\"line\"></span><br><span class=\"line\">message Person &#123;</span><br><span class=\"line\">\trequired string name = 1;</span><br><span class=\"line\">\trequired int32 id = 2;</span><br><span class=\"line\">\toptional string email = 3;</span><br><span class=\"line\"></span><br><span class=\"line\">\tenum PhoneType &#123;</span><br><span class=\"line\">\t\tMOBILE = 0;</span><br><span class=\"line\">\t\tHOME = 1;</span><br><span class=\"line\">\t\tWORK = 2;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessage PhoneNumber &#123;</span><br><span class=\"line\">\t\trequired string number = 1;</span><br><span class=\"line\">\t\toptional PhoneType phone_type = 2 [default = HOME];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\trepeated PhoneNumber phone = 4;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">message AddressBook &#123;</span><br><span class=\"line\">\trepeated Person person = 1;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2 . <br><code>protoc I=./ --cpp_out=./ ./addressbook.proto</code></p>\n<p>3 . <code>writer.cc</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    writer.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-12 19:52:22</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"addressbook.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">PromptForAddress</span><span class=\"params\">(tutorial::Person * person)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter person ID name :\"</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> id;</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span> &gt;&gt; id;</span><br><span class=\"line\">\tperson-&gt;set_id(id);</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span>.ignore(<span class=\"number\">256</span>, <span class=\"string\">'\\n'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter name:\"</span>;</span><br><span class=\"line\">\tgetline(<span class=\"built_in\">cin</span> , *person-&gt;mutable_name());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter email address (blank for none):\"</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">string</span> email;</span><br><span class=\"line\">\tgetline(<span class=\"built_in\">cin</span>, email);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!email.empty()) &#123;</span><br><span class=\"line\">\t\tperson-&gt;set_email(email);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter a phone number (or leave a blank to finish):\"</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">string</span> number;</span><br><span class=\"line\">\t\tgetline(<span class=\"built_in\">cin</span>, number);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (number.empty()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\ttutorial::Person::PhoneNumber * phone_number = person-&gt;add_phone();</span><br><span class=\"line\">\t\tphone_number-&gt;set_number(number);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Is this a mobile, home or work phone?\"</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">string</span> type;</span><br><span class=\"line\">\t\tgetline(<span class=\"built_in\">cin</span>, type);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"string\">\"mobile\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::MOBILE);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"home\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::HOME);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"work\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::WORK);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Unknow phone type.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"comment\">// end else</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;<span class=\"comment\">// end while</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tGOOGLE_PROTOBUF_VERIFY_VERSION;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (argc != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Usage :\"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\"ADDRESS_BOOK_FILE\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\ttutorial::AddressBook address_book;</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!input) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; argv[<span class=\"number\">1</span>] &lt;&lt; <span class=\"string\">\":File not found. Creating a new file.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!address_book.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Add an address.</span></span><br><span class=\"line\">\tPromptForAddress(address_book.add_person()); </span><br><span class=\"line\"></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Write the new address book back to disk.</span></span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">output</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::out | ios::trunc | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!address_book.SerializeToOstream(&amp;output)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to write address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"comment\">//end if</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Delete all global objects allocated by libprotobuf.</span></span><br><span class=\"line\">\tgoogle::protobuf::ShutdownProtobufLibrary();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4 . <code>reader.cc</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    reader.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-13 00:26:43</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"addressbook.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">ListPeople</span><span class=\"params\">(<span class=\"keyword\">const</span> tutorial::AddressBook &amp; address_book)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; address_book.person_size(); i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> tutorial::Person &amp; person = address_book.person(i);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Person ID: \"</span> &lt;&lt; person.id() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Name : \"</span> &lt;&lt; person.name() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (person.has_email()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Email : \"</span> &lt;&lt; person.email() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; person.phone_size(); j++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> tutorial::Person::PhoneNumber &amp; phone_number = person.phone(j);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">switch</span> (phone_number.phone_type()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::MOBILE:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" MOBILE : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::HOME:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" HOME : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::WORK:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" WORK : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; phone_number.number() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;<span class=\"comment\">// end for</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//::GOOGLE::PROTOBUF_VERIFY_VERSION;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (argc != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Usage: \"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\" ADDRESS_BOOK_FILE\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;\t</span><br><span class=\"line\">\ttutorial::AddressBook address_book;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!address_book.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tListPeople(address_book);</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle::protobuf::ShutdownProtobufLibrary();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5 . <br><code>g++ -o writer writer.cc addressbook.pb.cc lprotobuf</code><br><code>g++ -o reader reader.cc addressbook.pb.cc lprotobuf</code><br>6 . <br><code>./writer mid_file</code><br><code>$Enter person ID name :1001</code><br><code>$Enter name :Yun Ma</code><br><code>$Enter email address (blank for none):ali@ali.com</code><br><code>$Enter a phone number (or leave a blank to finish):17088888888</code><br><code>$Is this a mobile , home or work phone?work</code></p>\n<p><code>./reader mid_file</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Person ID :1001</span><br><span class=\"line\">Name : Yun MA</span><br><span class=\"line\">Email : ali@ali.com</span><br><span class=\"line\">WORK : work</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"3-2-DIYhelloworld-3\"><a href=\"#3-2-DIYhelloworld-3\" class=\"headerlink\" title=\"3.2 DIYhelloworld[3]\"></a>3.2 DIYhelloworld[3]</h5><p>1<code>lm.helloworld.proto</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = &quot;proto2&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">package lm;</span><br><span class=\"line\"></span><br><span class=\"line\">message helloworld &#123;</span><br><span class=\"line\">\trequired int32\t\tid = 1;</span><br><span class=\"line\">\trequired string\t\tstr = 2;</span><br><span class=\"line\">\toptional int32\t\topt = 3;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc -I=./ --cpp_out=./ ./lm.helloword.proto</span><br></pre></td></tr></table></figure></p>\n<p>3writer.cc<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    writer.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-13 16:04:02</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"lm.helloworld.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cerr</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::fstream;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::ios;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tlm::helloworld msg1;</span><br><span class=\"line\">\tmsg1.set_id(<span class=\"number\">1001</span>);</span><br><span class=\"line\">\tmsg1.set_str(<span class=\"string\">\"google\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">fstream <span class=\"title\">output</span><span class=\"params\">(<span class=\"string\">\"./log\"</span>, ios::out | ios::trunc | ios::binary)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!msg1.SerializeToOstream(&amp;output)) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to write msg.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>4reader.cc<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    reader.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-12 18:08:34</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"lm.helloworld.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::fstream;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::ios;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cerr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">listMsg</span><span class=\"params\">(<span class=\"keyword\">const</span> lm::helloworld &amp; msg)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"id = \"</span> &lt;&lt; msg.id() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"str = \"</span> &lt;&lt; msg.str() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tlm::helloworld msg1;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> 1</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(<span class=\"string\">\"./log\"</span>, ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!msg1.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span>\t</span></span><br><span class=\"line\">\tlistMsg(msg1);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>5 .  <br><code>./writer</code><br><code>$cat log</code><br><code>$google</code></p>\n<p><code>./reader</code><br><code>$ id = 1001</code><br><code>$ str = google</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>[1]<a href=\"https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format</a><br>[2]<a href=\"https://github.com/google/protobuf/blob/master/src/README.md\" target=\"_blank\" rel=\"noopener\">https://github.com/google/protobuf/blob/master/src/README.md</a><br>[3]<a href=\"http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/\" target=\"_blank\" rel=\"noopener\">http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/</a></p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Protobufgoogle-protocol-buffer\"><a href=\"#Protobufgoogle-protocol-buffer\" class=\"headerlink\" title=\"Protobufgoogle protocol buffer\"></a>Protobufgoogle protocol buffer</h2><h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Google Protocol Buffer(  Protobuf)  Google  48,162  12,183  .proto  RPC <br>Protocol Buffers  RPC <code>C++</code><code>Java</code><code>Python</code><code>go</code><code>c #</code>  API<a href=\"https://github.com/google/protobuf/releases\" target=\"_blank\" rel=\"noopener\"></a></p>","more":"<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>Ubuntu 15.04<br><br><a href=\"https://github.com/google/protobuf/releases\" target=\"_blank\" rel=\"noopener\">1</a><a href=\"https://developers.google.com/protocol-buffers/docs/downloads\" target=\"_blank\" rel=\"noopener\">2</a><br><code>tar xzvf protobuf-3.0.0-beta-3.tar.gz</code><br><code>sudo apt-get install autoconf automake libtool curl make g++ unzip</code><br>[4]<br><code>./autogen.sh</code><br><code>./configure</code><br><code>make check</code><br><code>sudo make install</code><br><code>sudo ldconfig # refresh shared library cache.</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"3-1-Google-1\"><a href=\"#3-1-Google-1\" class=\"headerlink\" title=\"3.1 Google[1]\"></a>3.1 Google[1]</h5><p>1 . <code>addressbook.proto</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//syntax = &quot;proto2&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">package tutorial;</span><br><span class=\"line\"></span><br><span class=\"line\">message Person &#123;</span><br><span class=\"line\">\trequired string name = 1;</span><br><span class=\"line\">\trequired int32 id = 2;</span><br><span class=\"line\">\toptional string email = 3;</span><br><span class=\"line\"></span><br><span class=\"line\">\tenum PhoneType &#123;</span><br><span class=\"line\">\t\tMOBILE = 0;</span><br><span class=\"line\">\t\tHOME = 1;</span><br><span class=\"line\">\t\tWORK = 2;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tmessage PhoneNumber &#123;</span><br><span class=\"line\">\t\trequired string number = 1;</span><br><span class=\"line\">\t\toptional PhoneType phone_type = 2 [default = HOME];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\trepeated PhoneNumber phone = 4;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">message AddressBook &#123;</span><br><span class=\"line\">\trepeated Person person = 1;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2 . <br><code>protoc I=./ --cpp_out=./ ./addressbook.proto</code></p>\n<p>3 . <code>writer.cc</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    writer.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-12 19:52:22</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"addressbook.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">PromptForAddress</span><span class=\"params\">(tutorial::Person * person)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter person ID name :\"</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> id;</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span> &gt;&gt; id;</span><br><span class=\"line\">\tperson-&gt;set_id(id);</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span>.ignore(<span class=\"number\">256</span>, <span class=\"string\">'\\n'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter name:\"</span>;</span><br><span class=\"line\">\tgetline(<span class=\"built_in\">cin</span> , *person-&gt;mutable_name());</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter email address (blank for none):\"</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">string</span> email;</span><br><span class=\"line\">\tgetline(<span class=\"built_in\">cin</span>, email);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!email.empty()) &#123;</span><br><span class=\"line\">\t\tperson-&gt;set_email(email);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Enter a phone number (or leave a blank to finish):\"</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">string</span> number;</span><br><span class=\"line\">\t\tgetline(<span class=\"built_in\">cin</span>, number);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (number.empty()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\ttutorial::Person::PhoneNumber * phone_number = person-&gt;add_phone();</span><br><span class=\"line\">\t\tphone_number-&gt;set_number(number);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Is this a mobile, home or work phone?\"</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">string</span> type;</span><br><span class=\"line\">\t\tgetline(<span class=\"built_in\">cin</span>, type);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"string\">\"mobile\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::MOBILE);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"home\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::HOME);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"string\">\"work\"</span> == type) &#123;</span><br><span class=\"line\">\t\t\tphone_number-&gt;set_phone_type(tutorial::Person::WORK);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"Unknow phone type.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"comment\">// end else</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;<span class=\"comment\">// end while</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//</span></span><br><span class=\"line\">\tGOOGLE_PROTOBUF_VERIFY_VERSION;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (argc != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Usage :\"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\"ADDRESS_BOOK_FILE\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\ttutorial::AddressBook address_book;</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!input) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; argv[<span class=\"number\">1</span>] &lt;&lt; <span class=\"string\">\":File not found. Creating a new file.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (!address_book.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Add an address.</span></span><br><span class=\"line\">\tPromptForAddress(address_book.add_person()); </span><br><span class=\"line\"></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Write the new address book back to disk.</span></span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">output</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::out | ios::trunc | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!address_book.SerializeToOstream(&amp;output)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to write address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;<span class=\"comment\">//end if</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// Delete all global objects allocated by libprotobuf.</span></span><br><span class=\"line\">\tgoogle::protobuf::ShutdownProtobufLibrary();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4 . <code>reader.cc</code></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    reader.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-13 00:26:43</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;string&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"addressbook.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">ListPeople</span><span class=\"params\">(<span class=\"keyword\">const</span> tutorial::AddressBook &amp; address_book)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; address_book.person_size(); i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> tutorial::Person &amp; person = address_book.person(i);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Person ID: \"</span> &lt;&lt; person.id() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Name : \"</span> &lt;&lt; person.name() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (person.has_email()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" Email : \"</span> &lt;&lt; person.email() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> j = <span class=\"number\">0</span>; j &lt; person.phone_size(); j++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">const</span> tutorial::Person::PhoneNumber &amp; phone_number = person.phone(j);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">switch</span> (phone_number.phone_type()) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::MOBILE:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" MOBILE : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::HOME:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" HOME : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">case</span> tutorial::Person::WORK:</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\" WORK : \"</span>;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; phone_number.number() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;<span class=\"comment\">// end for</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//::GOOGLE::PROTOBUF_VERIFY_VERSION;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (argc != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Usage: \"</span> &lt;&lt; argv[<span class=\"number\">0</span>] &lt;&lt; <span class=\"string\">\" ADDRESS_BOOK_FILE\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;\t</span><br><span class=\"line\">\ttutorial::AddressBook address_book;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(argv[<span class=\"number\">1</span>], ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!address_book.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tListPeople(address_book);</span><br><span class=\"line\"></span><br><span class=\"line\">\tgoogle::protobuf::ShutdownProtobufLibrary();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>5 . <br><code>g++ -o writer writer.cc addressbook.pb.cc lprotobuf</code><br><code>g++ -o reader reader.cc addressbook.pb.cc lprotobuf</code><br>6 . <br><code>./writer mid_file</code><br><code>$Enter person ID name :1001</code><br><code>$Enter name :Yun Ma</code><br><code>$Enter email address (blank for none):ali@ali.com</code><br><code>$Enter a phone number (or leave a blank to finish):17088888888</code><br><code>$Is this a mobile , home or work phone?work</code></p>\n<p><code>./reader mid_file</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Person ID :1001</span><br><span class=\"line\">Name : Yun MA</span><br><span class=\"line\">Email : ali@ali.com</span><br><span class=\"line\">WORK : work</span><br></pre></td></tr></table></figure></p>\n<h5 id=\"3-2-DIYhelloworld-3\"><a href=\"#3-2-DIYhelloworld-3\" class=\"headerlink\" title=\"3.2 DIYhelloworld[3]\"></a>3.2 DIYhelloworld[3]</h5><p>1<code>lm.helloworld.proto</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = &quot;proto2&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">package lm;</span><br><span class=\"line\"></span><br><span class=\"line\">message helloworld &#123;</span><br><span class=\"line\">\trequired int32\t\tid = 1;</span><br><span class=\"line\">\trequired string\t\tstr = 2;</span><br><span class=\"line\">\toptional int32\t\topt = 3;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">protoc -I=./ --cpp_out=./ ./lm.helloword.proto</span><br></pre></td></tr></table></figure></p>\n<p>3writer.cc<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    writer.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-13 16:04:02</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"lm.helloworld.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cerr</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::fstream;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::ios;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tlm::helloworld msg1;</span><br><span class=\"line\">\tmsg1.set_id(<span class=\"number\">1001</span>);</span><br><span class=\"line\">\tmsg1.set_str(<span class=\"string\">\"google\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\">fstream <span class=\"title\">output</span><span class=\"params\">(<span class=\"string\">\"./log\"</span>, ios::out | ios::trunc | ios::binary)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!msg1.SerializeToOstream(&amp;output)) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to write msg.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>4reader.cc<br><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * @file    reader.cc</span></span><br><span class=\"line\"><span class=\"comment\">  * @author  Home Jang(generalibm@gmail.com)</span></span><br><span class=\"line\"><span class=\"comment\">  * @date    2016-06-12 18:08:34</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">\"lm.helloworld.pb.h\"</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;fstream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::fstream;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::ios;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"built_in\">std</span>::<span class=\"built_in\">cerr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">listMsg</span><span class=\"params\">(<span class=\"keyword\">const</span> lm::helloworld &amp; msg)</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"id = \"</span> &lt;&lt; msg.id() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"str = \"</span> &lt;&lt; msg.str() &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tlm::helloworld msg1;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">if</span> 1</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"function\">fstream <span class=\"title\">input</span><span class=\"params\">(<span class=\"string\">\"./log\"</span>, ios::in | ios::binary)</span></span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!msg1.ParseFromIstream(&amp;input)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cerr</span> &lt;&lt; <span class=\"string\">\"Failed to parse address book.\"</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">endif</span>\t</span></span><br><span class=\"line\">\tlistMsg(msg1);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>5 .  <br><code>./writer</code><br><code>$cat log</code><br><code>$google</code></p>\n<p><code>./reader</code><br><code>$ id = 1001</code><br><code>$ str = google</code></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>[1]<a href=\"https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format\" target=\"_blank\" rel=\"noopener\">https://developers.google.com/protocol-buffers/docs/cpptutorial#defining-your-protocol-format</a><br>[2]<a href=\"https://github.com/google/protobuf/blob/master/src/README.md\" target=\"_blank\" rel=\"noopener\">https://github.com/google/protobuf/blob/master/src/README.md</a><br>[3]<a href=\"http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/\" target=\"_blank\" rel=\"noopener\">http://www.ibm.com/developerworks/cn/linux/l-cn-gpb/</a></p>"},{"title":"unsigned integers in cpp","date":"2019-05-07T02:23:38.000Z","keyword":["unsigned integers","wraps around","modulo wrapping","overflow"],"description":"A brief illustration of c++ unsigned integers.","toc":true,"_content":"\nIn [computer programming](https://en.wikipedia.org/wiki/Computer_programming), an **integer overflow** occurs when an [arithmetic](https://en.wikipedia.org/wiki/Arithmetic)  operation attempts to create a numeric value that is outside of the  range that can be represented with a given number of digits  either  larger than the maximum or lower than the minimum representable value. \n\nThe most common result of an overflow is that the least  significant representable digits of the result are stored; the result is  said to *wrap* around the maximum (i.e. [modulo](https://en.wikipedia.org/wiki/Modular_arithmetic) a power of the [radix](https://en.wikipedia.org/wiki/Radix), usually two in modern computers, but sometimes ten or another radix). \n\nAn overflow condition may give results leading to unintended  behavior. In particular, if the possibility has not been anticipated,  overflow can compromise a program's reliability and [security](https://en.wikipedia.org/wiki/Software_security). \n\n<!--more-->\n\n### Unsigned integer range\n\nWe all know that `c++` supports both **signed integer** and **unsigned integer**, the most regular example would be:\n\n```c++\n/// the usage of signed integer with 4-bytes.\nfor (int i = 0; i < container.size(); i++)\n{\n\t// do something    \n}\n\n/// the usage of unsigned integer with 4-bytes.\n/// why do developer do in this way for that `size()` returns a unsigned type\n/// and size_t is actually a typedef of unsigned type in cpp\nfor (size_t i = 0; i < container.size(); i++)\n{\n    // do something\n}\n```\n\nBoth of them would be behaving well. If we need a bigger number, we would use more bytes to present it \n\n| size/type       | range                          |\n| --------------- | ------------------------------ |\n| 1 byte unsigned | 0 to 255                       |\n| 2 byte unsigned | 0 to 65,535                    |\n| 4 byte unsigned | 0 to 4,294,967,295             |\n| 8 byte unsigned | 0 to18,446,744,073,709,551,615 |\n\nAn n-bit unsigned variable has a range of 0 to (2^n)-1.\n\n### Unsigned integer overflow\n\nBut when we traverse a container in reversed direction, would it properly behave as we expected?\n\n```c++\n/// signed integer example\nfor (int i = container.size()-1; i >= 0; i--)\n{\n    // do something\n}\n\n// unsigned integer example\n// dead loop here\nfor (size_t i = container.size()-1; i >= 0; i--)\n{\n    // do somthing\n}\n```\n\nNo, when we traverse a container in reversed direction with **unsigned integer**, it would cause **dead loop**.\n\n#### Overflow reasons\n\nWhy would it cause dead loop, but **signed integer** would not? Actually dead loop usually can not be caught easily, because the program does not raise any intuitive marks. But, we could check the log or debug it step by step or set break points just in your new codes([TDD](https://en.wikipedia.org/wiki/Test-driven_development) suggests you do like this, and it usually works). \n\nHere, we simplify it like:\n\n```c++\nfor (int i = 5; i >=0; i--)\n{\n    std::cout << \"i = \" << i << std::endl;\n}\nfor (size_t j = 5; j >=0; j--)\n{\n     std::cout << \"j = \" << j << std::endl;\n}\n```\nwe might get(run on x64):\n\n```bash\ni = 5\ni = 4\ni = 3\ni = 2\ni = 1\ni = 0 \nj = 5\nj = 4\nj = 3\nj = 2\nj = 1\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\nj = 18446744073709551613\nj = 18446744073709551612\nj = 18446744073709551611\nj = 18446744073709551610\nj = 18446744073709551609\nj = 18446744073709551608\nj = 18446744073709551607\nj = 18446744073709551606\n...\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\n...\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\n...\n```\n\nthe first loop stopped because `i` reached `-1`, while`j` is always positive number as a **unsigned type**. It will not be less than `0`, so the program did not stopped. \n\n`size_t` is a typedef of `long unsigned int`and we found that it would reach to the biggest 8-bytes unsigned integer(run on x64) and then decrease to 0 then repeat it again and again. The reason is that a unsigned integer will be represented by the type simply \"wraps around\"(sometimes called \"modulo wrapping\") when it is \"overflow\"(not real overflow, since the ISO standard states that for unsigned integers modulo wrapping is the defined behavior and the term overflow never applies:\"a computation involving unsigned operands can never overflow.\"). \n\nThat is when we try to store the number `-1`(which requires 9 bytes to represent) in a 8-byte unsigned integer, it would not overflow. Instead, if a value is out of range, it is divided by one greater than the largest number of the type, and only the remainder kept. The number `-1` it too less to fit in our 8-byte range of `0` to `18,446,744,073,709,551,615`. `1 `greater than the largest number of type is `18,446,744,073,709,551,616`, therefore, we divide `-1` by `18,446,744,073,709,551,616`, getting `1` remainder `18,446,744,073,709,551,615`, the remainder of `18,446,744,073,709,551,615` is what is stored.\n\nWhen we store the number `280`(which requires 9 bits to represent) in a 8-bits unsigned integer, it would also not overflow. `280` is greater than `255`(the largest number of 8-bits unsigned type). `1` greater than `255` is `256`, so we divide `280` by `256`, getting `1` remainder `24` which would be stored. \n\nWhen we figure out the quiz, the solution may be simple, DO NOT use unsigned type when traverse a container with reverse direction.\n\n```c++\n/// always use signed type when traverse with reverse direction\nfor (int i = container.size()-1; i >= 0; i++)\n{\n    // ...\n}\n\n/// or use iterator\nfor (auto it = container.end()-1; it != container.begin(); it--)\n{\n    // ...\n}\n```\n\nIn common language, **unsigned integer wrap around** is sometimes incorrectly called \"overflow\" since the cause is identical to signed integer overflow which is undefine behavior in ISO standard. \n\n### Other overflow examples\n\nMany notable bugs in video game history happened due to wrap around behavior with unsigned integers. \nIn the arcade game Donkey Kong, its not possible to go past level 22 due to an bug that leaves the user with not enough bonus time to complete the level. \nIn the PC game Civilization, Gandhi was known for being the first one to use nuclear weapons, which seems contrary to his normally passive nature. Gandhis aggression setting was normally set at 1, but if he went democratic, hed get a -2 modifier. This wrapped around his aggression setting to 255, making him maximally aggressive!\n\n### The controversy over unsigned numbers\n\nMany developers (and some large development houses, such as Google)  believe that developers should generally avoid unsigned integers.\n\nThis is largely because of two behaviors that can cause problems.\n\nFirst, consider the subtraction of two unsigned numbers, such as 3  and 5.  3 minus 5 is -2, but -2 isnt representable as an unsigned  number.\n\n```c++\nunsigned int x = 3;\nunsigned int y = 5;\n\nstd::cout << x-y << std::endl; // 4294967294\n```\n\nThe occurs due to `-2` wrapping around to a number close to the top of the range of a 4-byte integer.\n\nSecond, unexpected behavior can result when you mix signed and  unsigned integers.  In the above example, even if one of the operands (x  or y) is signed, the same behavior will result!\n\nConsider the following snippet:\n\n```c++\nvoid fun(unsigned int x)\n{\n    // ...\n}\n\nint bar()\n{\n    fun(-1);\n}\n```\n\n\nThe author of fun() was expecting someone to call this  function with only positive numbers.  But the caller is passing in *-1*.  What happens in this case?\n\nThe signed argument of *-1* gets implicitly converted to an  unsigned parameter.  *-1* isnt in the range of an unsigned number, so it  wraps around to some large number (probably `4294967295`).  Then the program goes ballistic.  Worse, theres no good way to guard against  this condition from happening.  C++ will freely convert between signed  and unsigned numbers, but it wont do any range checking to make sure  you dont overflow your type.\n\nMany modern programming languages (such as Java and C#) either dont include unsigned types, or limit their use. Python would raise a exception.\n\n**Bjarne Stroustrup**,  the designer of C++, said, Using an `unsigned` instead of an `int` to gain one more bit to represent positive integers is almost never a good idea.\n\nUnfortunately, due to some poor design choices in the C++ standard  library, completely avoiding unsigned numbers in C++ isnt possible at  this point in time.\n\nWarning\n\n>   Avoid unsigned numbers whenever possible.  Dont avoid negative  numbers by using unsigned types.  If you need a larger range, use a  larger signed type.If you do use unsigned numbers, take care not to mix signed and unsigned numbers.","source":"_posts/unsigned-intergers-in-cpp.md","raw":"---\ntitle: unsigned integers in cpp\ndate: 2019-05-07 10:23:38\ntags: cpp\ncategories: cpp\nkeyword: [unsigned integers, wraps around, modulo wrapping, overflow]\ndescription: A brief illustration of c++ unsigned integers.\ntoc: true\n---\n\nIn [computer programming](https://en.wikipedia.org/wiki/Computer_programming), an **integer overflow** occurs when an [arithmetic](https://en.wikipedia.org/wiki/Arithmetic)  operation attempts to create a numeric value that is outside of the  range that can be represented with a given number of digits  either  larger than the maximum or lower than the minimum representable value. \n\nThe most common result of an overflow is that the least  significant representable digits of the result are stored; the result is  said to *wrap* around the maximum (i.e. [modulo](https://en.wikipedia.org/wiki/Modular_arithmetic) a power of the [radix](https://en.wikipedia.org/wiki/Radix), usually two in modern computers, but sometimes ten or another radix). \n\nAn overflow condition may give results leading to unintended  behavior. In particular, if the possibility has not been anticipated,  overflow can compromise a program's reliability and [security](https://en.wikipedia.org/wiki/Software_security). \n\n<!--more-->\n\n### Unsigned integer range\n\nWe all know that `c++` supports both **signed integer** and **unsigned integer**, the most regular example would be:\n\n```c++\n/// the usage of signed integer with 4-bytes.\nfor (int i = 0; i < container.size(); i++)\n{\n\t// do something    \n}\n\n/// the usage of unsigned integer with 4-bytes.\n/// why do developer do in this way for that `size()` returns a unsigned type\n/// and size_t is actually a typedef of unsigned type in cpp\nfor (size_t i = 0; i < container.size(); i++)\n{\n    // do something\n}\n```\n\nBoth of them would be behaving well. If we need a bigger number, we would use more bytes to present it \n\n| size/type       | range                          |\n| --------------- | ------------------------------ |\n| 1 byte unsigned | 0 to 255                       |\n| 2 byte unsigned | 0 to 65,535                    |\n| 4 byte unsigned | 0 to 4,294,967,295             |\n| 8 byte unsigned | 0 to18,446,744,073,709,551,615 |\n\nAn n-bit unsigned variable has a range of 0 to (2^n)-1.\n\n### Unsigned integer overflow\n\nBut when we traverse a container in reversed direction, would it properly behave as we expected?\n\n```c++\n/// signed integer example\nfor (int i = container.size()-1; i >= 0; i--)\n{\n    // do something\n}\n\n// unsigned integer example\n// dead loop here\nfor (size_t i = container.size()-1; i >= 0; i--)\n{\n    // do somthing\n}\n```\n\nNo, when we traverse a container in reversed direction with **unsigned integer**, it would cause **dead loop**.\n\n#### Overflow reasons\n\nWhy would it cause dead loop, but **signed integer** would not? Actually dead loop usually can not be caught easily, because the program does not raise any intuitive marks. But, we could check the log or debug it step by step or set break points just in your new codes([TDD](https://en.wikipedia.org/wiki/Test-driven_development) suggests you do like this, and it usually works). \n\nHere, we simplify it like:\n\n```c++\nfor (int i = 5; i >=0; i--)\n{\n    std::cout << \"i = \" << i << std::endl;\n}\nfor (size_t j = 5; j >=0; j--)\n{\n     std::cout << \"j = \" << j << std::endl;\n}\n```\nwe might get(run on x64):\n\n```bash\ni = 5\ni = 4\ni = 3\ni = 2\ni = 1\ni = 0 \nj = 5\nj = 4\nj = 3\nj = 2\nj = 1\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\nj = 18446744073709551613\nj = 18446744073709551612\nj = 18446744073709551611\nj = 18446744073709551610\nj = 18446744073709551609\nj = 18446744073709551608\nj = 18446744073709551607\nj = 18446744073709551606\n...\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\n...\nj = 0\nj = 18446744073709551615\nj = 18446744073709551614\n...\n```\n\nthe first loop stopped because `i` reached `-1`, while`j` is always positive number as a **unsigned type**. It will not be less than `0`, so the program did not stopped. \n\n`size_t` is a typedef of `long unsigned int`and we found that it would reach to the biggest 8-bytes unsigned integer(run on x64) and then decrease to 0 then repeat it again and again. The reason is that a unsigned integer will be represented by the type simply \"wraps around\"(sometimes called \"modulo wrapping\") when it is \"overflow\"(not real overflow, since the ISO standard states that for unsigned integers modulo wrapping is the defined behavior and the term overflow never applies:\"a computation involving unsigned operands can never overflow.\"). \n\nThat is when we try to store the number `-1`(which requires 9 bytes to represent) in a 8-byte unsigned integer, it would not overflow. Instead, if a value is out of range, it is divided by one greater than the largest number of the type, and only the remainder kept. The number `-1` it too less to fit in our 8-byte range of `0` to `18,446,744,073,709,551,615`. `1 `greater than the largest number of type is `18,446,744,073,709,551,616`, therefore, we divide `-1` by `18,446,744,073,709,551,616`, getting `1` remainder `18,446,744,073,709,551,615`, the remainder of `18,446,744,073,709,551,615` is what is stored.\n\nWhen we store the number `280`(which requires 9 bits to represent) in a 8-bits unsigned integer, it would also not overflow. `280` is greater than `255`(the largest number of 8-bits unsigned type). `1` greater than `255` is `256`, so we divide `280` by `256`, getting `1` remainder `24` which would be stored. \n\nWhen we figure out the quiz, the solution may be simple, DO NOT use unsigned type when traverse a container with reverse direction.\n\n```c++\n/// always use signed type when traverse with reverse direction\nfor (int i = container.size()-1; i >= 0; i++)\n{\n    // ...\n}\n\n/// or use iterator\nfor (auto it = container.end()-1; it != container.begin(); it--)\n{\n    // ...\n}\n```\n\nIn common language, **unsigned integer wrap around** is sometimes incorrectly called \"overflow\" since the cause is identical to signed integer overflow which is undefine behavior in ISO standard. \n\n### Other overflow examples\n\nMany notable bugs in video game history happened due to wrap around behavior with unsigned integers. \nIn the arcade game Donkey Kong, its not possible to go past level 22 due to an bug that leaves the user with not enough bonus time to complete the level. \nIn the PC game Civilization, Gandhi was known for being the first one to use nuclear weapons, which seems contrary to his normally passive nature. Gandhis aggression setting was normally set at 1, but if he went democratic, hed get a -2 modifier. This wrapped around his aggression setting to 255, making him maximally aggressive!\n\n### The controversy over unsigned numbers\n\nMany developers (and some large development houses, such as Google)  believe that developers should generally avoid unsigned integers.\n\nThis is largely because of two behaviors that can cause problems.\n\nFirst, consider the subtraction of two unsigned numbers, such as 3  and 5.  3 minus 5 is -2, but -2 isnt representable as an unsigned  number.\n\n```c++\nunsigned int x = 3;\nunsigned int y = 5;\n\nstd::cout << x-y << std::endl; // 4294967294\n```\n\nThe occurs due to `-2` wrapping around to a number close to the top of the range of a 4-byte integer.\n\nSecond, unexpected behavior can result when you mix signed and  unsigned integers.  In the above example, even if one of the operands (x  or y) is signed, the same behavior will result!\n\nConsider the following snippet:\n\n```c++\nvoid fun(unsigned int x)\n{\n    // ...\n}\n\nint bar()\n{\n    fun(-1);\n}\n```\n\n\nThe author of fun() was expecting someone to call this  function with only positive numbers.  But the caller is passing in *-1*.  What happens in this case?\n\nThe signed argument of *-1* gets implicitly converted to an  unsigned parameter.  *-1* isnt in the range of an unsigned number, so it  wraps around to some large number (probably `4294967295`).  Then the program goes ballistic.  Worse, theres no good way to guard against  this condition from happening.  C++ will freely convert between signed  and unsigned numbers, but it wont do any range checking to make sure  you dont overflow your type.\n\nMany modern programming languages (such as Java and C#) either dont include unsigned types, or limit their use. Python would raise a exception.\n\n**Bjarne Stroustrup**,  the designer of C++, said, Using an `unsigned` instead of an `int` to gain one more bit to represent positive integers is almost never a good idea.\n\nUnfortunately, due to some poor design choices in the C++ standard  library, completely avoiding unsigned numbers in C++ isnt possible at  this point in time.\n\nWarning\n\n>   Avoid unsigned numbers whenever possible.  Dont avoid negative  numbers by using unsigned types.  If you need a larger range, use a  larger signed type.If you do use unsigned numbers, take care not to mix signed and unsigned numbers.","slug":"unsigned-intergers-in-cpp","published":1,"updated":"2019-05-07T06:23:44.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf736q000yt0t8191p0ch5","content":"<p>In <a href=\"https://en.wikipedia.org/wiki/Computer_programming\" target=\"_blank\" rel=\"noopener\">computer programming</a>, an <strong>integer overflow</strong> occurs when an <a href=\"https://en.wikipedia.org/wiki/Arithmetic\" target=\"_blank\" rel=\"noopener\">arithmetic</a>  operation attempts to create a numeric value that is outside of the  range that can be represented with a given number of digits  either  larger than the maximum or lower than the minimum representable value. </p>\n<p>The most common result of an overflow is that the least  significant representable digits of the result are stored; the result is  said to <em>wrap</em> around the maximum (i.e. <a href=\"https://en.wikipedia.org/wiki/Modular_arithmetic\" target=\"_blank\" rel=\"noopener\">modulo</a> a power of the <a href=\"https://en.wikipedia.org/wiki/Radix\" target=\"_blank\" rel=\"noopener\">radix</a>, usually two in modern computers, but sometimes ten or another radix). </p>\n<p>An overflow condition may give results leading to unintended  behavior. In particular, if the possibility has not been anticipated,  overflow can compromise a programs reliability and <a href=\"https://en.wikipedia.org/wiki/Software_security\" target=\"_blank\" rel=\"noopener\">security</a>. </p>\n<a id=\"more\"></a>\n<h3 id=\"Unsigned-integer-range\"><a href=\"#Unsigned-integer-range\" class=\"headerlink\" title=\"Unsigned integer range\"></a>Unsigned integer range</h3><p>We all know that <code>c++</code> supports both <strong>signed integer</strong> and <strong>unsigned integer</strong>, the most regular example would be:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// the usage of signed integer with 4-bytes.</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; container.size(); i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something    </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// the usage of unsigned integer with 4-bytes.</span></span><br><span class=\"line\"><span class=\"comment\">/// why do developer do in this way for that `size()` returns a unsigned type</span></span><br><span class=\"line\"><span class=\"comment\">/// and size_t is actually a typedef of unsigned type in cpp</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> i = <span class=\"number\">0</span>; i &lt; container.size(); i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Both of them would be behaving well. If we need a bigger number, we would use more bytes to present it </p>\n<table>\n<thead>\n<tr>\n<th>size/type</th>\n<th>range</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1 byte unsigned</td>\n<td>0 to 255</td>\n</tr>\n<tr>\n<td>2 byte unsigned</td>\n<td>0 to 65,535</td>\n</tr>\n<tr>\n<td>4 byte unsigned</td>\n<td>0 to 4,294,967,295</td>\n</tr>\n<tr>\n<td>8 byte unsigned</td>\n<td>0 to18,446,744,073,709,551,615</td>\n</tr>\n</tbody>\n</table>\n<p>An n-bit unsigned variable has a range of 0 to (2^n)-1.</p>\n<h3 id=\"Unsigned-integer-overflow\"><a href=\"#Unsigned-integer-overflow\" class=\"headerlink\" title=\"Unsigned integer overflow\"></a>Unsigned integer overflow</h3><p>But when we traverse a container in reversed direction, would it properly behave as we expected?</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// signed integer example</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// unsigned integer example</span></span><br><span class=\"line\"><span class=\"comment\">// dead loop here</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somthing</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>No, when we traverse a container in reversed direction with <strong>unsigned integer</strong>, it would cause <strong>dead loop</strong>.</p>\n<h4 id=\"Overflow-reasons\"><a href=\"#Overflow-reasons\" class=\"headerlink\" title=\"Overflow reasons\"></a>Overflow reasons</h4><p>Why would it cause dead loop, but <strong>signed integer</strong> would not? Actually dead loop usually can not be caught easily, because the program does not raise any intuitive marks. But, we could check the log or debug it step by step or set break points just in your new codes(<a href=\"https://en.wikipedia.org/wiki/Test-driven_development\" target=\"_blank\" rel=\"noopener\">TDD</a> suggests you do like this, and it usually works). </p>\n<p>Here, we simplify it like:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">5</span>; i &gt;=<span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"i = \"</span> &lt;&lt; i &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> j = <span class=\"number\">5</span>; j &gt;=<span class=\"number\">0</span>; j--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">     <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"j = \"</span> &lt;&lt; j &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>we might get(run on x64):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = 5</span><br><span class=\"line\">i = 4</span><br><span class=\"line\">i = 3</span><br><span class=\"line\">i = 2</span><br><span class=\"line\">i = 1</span><br><span class=\"line\">i = 0 </span><br><span class=\"line\">j = 5</span><br><span class=\"line\">j = 4</span><br><span class=\"line\">j = 3</span><br><span class=\"line\">j = 2</span><br><span class=\"line\">j = 1</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">j = 18446744073709551613</span><br><span class=\"line\">j = 18446744073709551612</span><br><span class=\"line\">j = 18446744073709551611</span><br><span class=\"line\">j = 18446744073709551610</span><br><span class=\"line\">j = 18446744073709551609</span><br><span class=\"line\">j = 18446744073709551608</span><br><span class=\"line\">j = 18446744073709551607</span><br><span class=\"line\">j = 18446744073709551606</span><br><span class=\"line\">...</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">...</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>the first loop stopped because <code>i</code> reached <code>-1</code>, while<code>j</code> is always positive number as a <strong>unsigned type</strong>. It will not be less than <code>0</code>, so the program did not stopped. </p>\n<p><code>size_t</code> is a typedef of <code>long unsigned int</code>and we found that it would reach to the biggest 8-bytes unsigned integer(run on x64) and then decrease to 0 then repeat it again and again. The reason is that a unsigned integer will be represented by the type simply wraps around(sometimes called modulo wrapping) when it is overflow(not real overflow, since the ISO standard states that for unsigned integers modulo wrapping is the defined behavior and the term overflow never applies:a computation involving unsigned operands can never overflow.). </p>\n<p>That is when we try to store the number <code>-1</code>(which requires 9 bytes to represent) in a 8-byte unsigned integer, it would not overflow. Instead, if a value is out of range, it is divided by one greater than the largest number of the type, and only the remainder kept. The number <code>-1</code> it too less to fit in our 8-byte range of <code>0</code> to <code>18,446,744,073,709,551,615</code>. <code>1</code>greater than the largest number of type is <code>18,446,744,073,709,551,616</code>, therefore, we divide <code>-1</code> by <code>18,446,744,073,709,551,616</code>, getting <code>1</code> remainder <code>18,446,744,073,709,551,615</code>, the remainder of <code>18,446,744,073,709,551,615</code> is what is stored.</p>\n<p>When we store the number <code>280</code>(which requires 9 bits to represent) in a 8-bits unsigned integer, it would also not overflow. <code>280</code> is greater than <code>255</code>(the largest number of 8-bits unsigned type). <code>1</code> greater than <code>255</code> is <code>256</code>, so we divide <code>280</code> by <code>256</code>, getting <code>1</code> remainder <code>24</code> which would be stored. </p>\n<p>When we figure out the quiz, the solution may be simple, DO NOT use unsigned type when traverse a container with reverse direction.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// always use signed type when traverse with reverse direction</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// or use iterator</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> it = container.end()<span class=\"number\">-1</span>; it != container.begin(); it--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>In common language, <strong>unsigned integer wrap around</strong> is sometimes incorrectly called overflow since the cause is identical to signed integer overflow which is undefine behavior in ISO standard. </p>\n<h3 id=\"Other-overflow-examples\"><a href=\"#Other-overflow-examples\" class=\"headerlink\" title=\"Other overflow examples\"></a>Other overflow examples</h3><p>Many notable bugs in video game history happened due to wrap around behavior with unsigned integers.<br>In the arcade game Donkey Kong, its not possible to go past level 22 due to an bug that leaves the user with not enough bonus time to complete the level.<br>In the PC game Civilization, Gandhi was known for being the first one to use nuclear weapons, which seems contrary to his normally passive nature. Gandhis aggression setting was normally set at 1, but if he went democratic, hed get a -2 modifier. This wrapped around his aggression setting to 255, making him maximally aggressive!</p>\n<h3 id=\"The-controversy-over-unsigned-numbers\"><a href=\"#The-controversy-over-unsigned-numbers\" class=\"headerlink\" title=\"The controversy over unsigned numbers\"></a>The controversy over unsigned numbers</h3><p>Many developers (and some large development houses, such as Google)  believe that developers should generally avoid unsigned integers.</p>\n<p>This is largely because of two behaviors that can cause problems.</p>\n<p>First, consider the subtraction of two unsigned numbers, such as 3  and 5.  3 minus 5 is -2, but -2 isnt representable as an unsigned  number.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> x = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> y = <span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; x-y &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>; <span class=\"comment\">// 4294967294</span></span><br></pre></td></tr></table></figure>\n<p>The occurs due to <code>-2</code> wrapping around to a number close to the top of the range of a 4-byte integer.</p>\n<p>Second, unexpected behavior can result when you mix signed and  unsigned integers.  In the above example, even if one of the operands (x  or y) is signed, the same behavior will result!</p>\n<p>Consider the following snippet:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">fun</span><span class=\"params\">(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">bar</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    fun(<span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The author of fun() was expecting someone to call this  function with only positive numbers.  But the caller is passing in <em>-1</em>.  What happens in this case?</p>\n<p>The signed argument of <em>-1</em> gets implicitly converted to an  unsigned parameter.  <em>-1</em> isnt in the range of an unsigned number, so it  wraps around to some large number (probably <code>4294967295</code>).  Then the program goes ballistic.  Worse, theres no good way to guard against  this condition from happening.  C++ will freely convert between signed  and unsigned numbers, but it wont do any range checking to make sure  you dont overflow your type.</p>\n<p>Many modern programming languages (such as Java and C#) either dont include unsigned types, or limit their use. Python would raise a exception.</p>\n<p><strong>Bjarne Stroustrup</strong>,  the designer of C++, said, Using an <code>unsigned</code> instead of an <code>int</code> to gain one more bit to represent positive integers is almost never a good idea.</p>\n<p>Unfortunately, due to some poor design choices in the C++ standard  library, completely avoiding unsigned numbers in C++ isnt possible at  this point in time.</p>\n<p>Warning</p>\n<blockquote>\n<p>  Avoid unsigned numbers whenever possible.  Dont avoid negative  numbers by using unsigned types.  If you need a larger range, use a  larger signed type.If you do use unsigned numbers, take care not to mix signed and unsigned numbers.</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>In <a href=\"https://en.wikipedia.org/wiki/Computer_programming\" target=\"_blank\" rel=\"noopener\">computer programming</a>, an <strong>integer overflow</strong> occurs when an <a href=\"https://en.wikipedia.org/wiki/Arithmetic\" target=\"_blank\" rel=\"noopener\">arithmetic</a>  operation attempts to create a numeric value that is outside of the  range that can be represented with a given number of digits  either  larger than the maximum or lower than the minimum representable value. </p>\n<p>The most common result of an overflow is that the least  significant representable digits of the result are stored; the result is  said to <em>wrap</em> around the maximum (i.e. <a href=\"https://en.wikipedia.org/wiki/Modular_arithmetic\" target=\"_blank\" rel=\"noopener\">modulo</a> a power of the <a href=\"https://en.wikipedia.org/wiki/Radix\" target=\"_blank\" rel=\"noopener\">radix</a>, usually two in modern computers, but sometimes ten or another radix). </p>\n<p>An overflow condition may give results leading to unintended  behavior. In particular, if the possibility has not been anticipated,  overflow can compromise a programs reliability and <a href=\"https://en.wikipedia.org/wiki/Software_security\" target=\"_blank\" rel=\"noopener\">security</a>. </p>","more":"<h3 id=\"Unsigned-integer-range\"><a href=\"#Unsigned-integer-range\" class=\"headerlink\" title=\"Unsigned integer range\"></a>Unsigned integer range</h3><p>We all know that <code>c++</code> supports both <strong>signed integer</strong> and <strong>unsigned integer</strong>, the most regular example would be:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// the usage of signed integer with 4-bytes.</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; container.size(); i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something    </span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// the usage of unsigned integer with 4-bytes.</span></span><br><span class=\"line\"><span class=\"comment\">/// why do developer do in this way for that `size()` returns a unsigned type</span></span><br><span class=\"line\"><span class=\"comment\">/// and size_t is actually a typedef of unsigned type in cpp</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> i = <span class=\"number\">0</span>; i &lt; container.size(); i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Both of them would be behaving well. If we need a bigger number, we would use more bytes to present it </p>\n<table>\n<thead>\n<tr>\n<th>size/type</th>\n<th>range</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1 byte unsigned</td>\n<td>0 to 255</td>\n</tr>\n<tr>\n<td>2 byte unsigned</td>\n<td>0 to 65,535</td>\n</tr>\n<tr>\n<td>4 byte unsigned</td>\n<td>0 to 4,294,967,295</td>\n</tr>\n<tr>\n<td>8 byte unsigned</td>\n<td>0 to18,446,744,073,709,551,615</td>\n</tr>\n</tbody>\n</table>\n<p>An n-bit unsigned variable has a range of 0 to (2^n)-1.</p>\n<h3 id=\"Unsigned-integer-overflow\"><a href=\"#Unsigned-integer-overflow\" class=\"headerlink\" title=\"Unsigned integer overflow\"></a>Unsigned integer overflow</h3><p>But when we traverse a container in reversed direction, would it properly behave as we expected?</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// signed integer example</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do something</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// unsigned integer example</span></span><br><span class=\"line\"><span class=\"comment\">// dead loop here</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// do somthing</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>No, when we traverse a container in reversed direction with <strong>unsigned integer</strong>, it would cause <strong>dead loop</strong>.</p>\n<h4 id=\"Overflow-reasons\"><a href=\"#Overflow-reasons\" class=\"headerlink\" title=\"Overflow reasons\"></a>Overflow reasons</h4><p>Why would it cause dead loop, but <strong>signed integer</strong> would not? Actually dead loop usually can not be caught easily, because the program does not raise any intuitive marks. But, we could check the log or debug it step by step or set break points just in your new codes(<a href=\"https://en.wikipedia.org/wiki/Test-driven_development\" target=\"_blank\" rel=\"noopener\">TDD</a> suggests you do like this, and it usually works). </p>\n<p>Here, we simplify it like:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">5</span>; i &gt;=<span class=\"number\">0</span>; i--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"i = \"</span> &lt;&lt; i &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">size_t</span> j = <span class=\"number\">5</span>; j &gt;=<span class=\"number\">0</span>; j--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">     <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"j = \"</span> &lt;&lt; j &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>we might get(run on x64):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i = 5</span><br><span class=\"line\">i = 4</span><br><span class=\"line\">i = 3</span><br><span class=\"line\">i = 2</span><br><span class=\"line\">i = 1</span><br><span class=\"line\">i = 0 </span><br><span class=\"line\">j = 5</span><br><span class=\"line\">j = 4</span><br><span class=\"line\">j = 3</span><br><span class=\"line\">j = 2</span><br><span class=\"line\">j = 1</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">j = 18446744073709551613</span><br><span class=\"line\">j = 18446744073709551612</span><br><span class=\"line\">j = 18446744073709551611</span><br><span class=\"line\">j = 18446744073709551610</span><br><span class=\"line\">j = 18446744073709551609</span><br><span class=\"line\">j = 18446744073709551608</span><br><span class=\"line\">j = 18446744073709551607</span><br><span class=\"line\">j = 18446744073709551606</span><br><span class=\"line\">...</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">...</span><br><span class=\"line\">j = 0</span><br><span class=\"line\">j = 18446744073709551615</span><br><span class=\"line\">j = 18446744073709551614</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>the first loop stopped because <code>i</code> reached <code>-1</code>, while<code>j</code> is always positive number as a <strong>unsigned type</strong>. It will not be less than <code>0</code>, so the program did not stopped. </p>\n<p><code>size_t</code> is a typedef of <code>long unsigned int</code>and we found that it would reach to the biggest 8-bytes unsigned integer(run on x64) and then decrease to 0 then repeat it again and again. The reason is that a unsigned integer will be represented by the type simply wraps around(sometimes called modulo wrapping) when it is overflow(not real overflow, since the ISO standard states that for unsigned integers modulo wrapping is the defined behavior and the term overflow never applies:a computation involving unsigned operands can never overflow.). </p>\n<p>That is when we try to store the number <code>-1</code>(which requires 9 bytes to represent) in a 8-byte unsigned integer, it would not overflow. Instead, if a value is out of range, it is divided by one greater than the largest number of the type, and only the remainder kept. The number <code>-1</code> it too less to fit in our 8-byte range of <code>0</code> to <code>18,446,744,073,709,551,615</code>. <code>1</code>greater than the largest number of type is <code>18,446,744,073,709,551,616</code>, therefore, we divide <code>-1</code> by <code>18,446,744,073,709,551,616</code>, getting <code>1</code> remainder <code>18,446,744,073,709,551,615</code>, the remainder of <code>18,446,744,073,709,551,615</code> is what is stored.</p>\n<p>When we store the number <code>280</code>(which requires 9 bits to represent) in a 8-bits unsigned integer, it would also not overflow. <code>280</code> is greater than <code>255</code>(the largest number of 8-bits unsigned type). <code>1</code> greater than <code>255</code> is <code>256</code>, so we divide <code>280</code> by <code>256</code>, getting <code>1</code> remainder <code>24</code> which would be stored. </p>\n<p>When we figure out the quiz, the solution may be simple, DO NOT use unsigned type when traverse a container with reverse direction.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// always use signed type when traverse with reverse direction</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = container.size()<span class=\"number\">-1</span>; i &gt;= <span class=\"number\">0</span>; i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// or use iterator</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">auto</span> it = container.end()<span class=\"number\">-1</span>; it != container.begin(); it--)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>In common language, <strong>unsigned integer wrap around</strong> is sometimes incorrectly called overflow since the cause is identical to signed integer overflow which is undefine behavior in ISO standard. </p>\n<h3 id=\"Other-overflow-examples\"><a href=\"#Other-overflow-examples\" class=\"headerlink\" title=\"Other overflow examples\"></a>Other overflow examples</h3><p>Many notable bugs in video game history happened due to wrap around behavior with unsigned integers.<br>In the arcade game Donkey Kong, its not possible to go past level 22 due to an bug that leaves the user with not enough bonus time to complete the level.<br>In the PC game Civilization, Gandhi was known for being the first one to use nuclear weapons, which seems contrary to his normally passive nature. Gandhis aggression setting was normally set at 1, but if he went democratic, hed get a -2 modifier. This wrapped around his aggression setting to 255, making him maximally aggressive!</p>\n<h3 id=\"The-controversy-over-unsigned-numbers\"><a href=\"#The-controversy-over-unsigned-numbers\" class=\"headerlink\" title=\"The controversy over unsigned numbers\"></a>The controversy over unsigned numbers</h3><p>Many developers (and some large development houses, such as Google)  believe that developers should generally avoid unsigned integers.</p>\n<p>This is largely because of two behaviors that can cause problems.</p>\n<p>First, consider the subtraction of two unsigned numbers, such as 3  and 5.  3 minus 5 is -2, but -2 isnt representable as an unsigned  number.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> x = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> y = <span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; x-y &lt;&lt; <span class=\"built_in\">std</span>::<span class=\"built_in\">endl</span>; <span class=\"comment\">// 4294967294</span></span><br></pre></td></tr></table></figure>\n<p>The occurs due to <code>-2</code> wrapping around to a number close to the top of the range of a 4-byte integer.</p>\n<p>Second, unexpected behavior can result when you mix signed and  unsigned integers.  In the above example, even if one of the operands (x  or y) is signed, the same behavior will result!</p>\n<p>Consider the following snippet:</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">fun</span><span class=\"params\">(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">bar</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    fun(<span class=\"number\">-1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>The author of fun() was expecting someone to call this  function with only positive numbers.  But the caller is passing in <em>-1</em>.  What happens in this case?</p>\n<p>The signed argument of <em>-1</em> gets implicitly converted to an  unsigned parameter.  <em>-1</em> isnt in the range of an unsigned number, so it  wraps around to some large number (probably <code>4294967295</code>).  Then the program goes ballistic.  Worse, theres no good way to guard against  this condition from happening.  C++ will freely convert between signed  and unsigned numbers, but it wont do any range checking to make sure  you dont overflow your type.</p>\n<p>Many modern programming languages (such as Java and C#) either dont include unsigned types, or limit their use. Python would raise a exception.</p>\n<p><strong>Bjarne Stroustrup</strong>,  the designer of C++, said, Using an <code>unsigned</code> instead of an <code>int</code> to gain one more bit to represent positive integers is almost never a good idea.</p>\n<p>Unfortunately, due to some poor design choices in the C++ standard  library, completely avoiding unsigned numbers in C++ isnt possible at  this point in time.</p>\n<p>Warning</p>\n<blockquote>\n<p>  Avoid unsigned numbers whenever possible.  Dont avoid negative  numbers by using unsigned types.  If you need a larger range, use a  larger signed type.If you do use unsigned numbers, take care not to mix signed and unsigned numbers.</p>\n</blockquote>"},{"title":"[Translation]Design is refactoring-The Lifetime of Food","date":"2019-03-06T08:53:28.000Z","keyword":["rust","lifetime rule","borrowing rule"],"description":"It is my first translation about rust programming(unfinished).","toc":true,"_content":"\n## [Design is Refactoring-The Lifetime of Food](http://designisrefactoring.com/2016/08/10/the-lifetime-of-food/)\nA Rusty Analogy using Millennial Stereotypes\n\nImagine you are out to dinner with some friends. You  are all stereotypical Millennials so photographing your meal is  expected. For every dish you order each of your friends borrows it,  takes a photograph, and then returns it to you.\n\nWell, thats the plan anyway. Some of your friends are not the most  reliable. Will they always return the right dish to you? Will they try  to sneak a bite? Human friends are so unreliable. But if your friends  were Rust functions youd have nothing to worry about, thanks to Rusts  rules around borrowing and lifetimes.\n<!--more-->\n\n> [](https://baike.baidu.com/item/%E5%8D%83%E7%A6%A7%E4%B8%80%E4%BB%A3/2683826?fr=aladdin) \n>\n> ?`Rust functions`,  `Rust`********\n>\n\n\nLets model this dinner party in Rust and see if we can learn a thing or two about borrowing and lifetimes.\n\nWell start off with the basics, a Dish that can be photographed.\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nWe have a `Dish` struct which contains a name. Theres one function on `Dish`, `photograph`. You get your dishes from the hot new Italian/Ethiopian fusion restaurant and take their pictures.\n\nLets introduce one of your friends. Well start off with your most  honest and trustworthy companion. Being honest this friend wants to  borrow a dish photograph it and return it. They dont want you giving  them more than one dish  that could get confusing! When converted to a  Rust function, this friend looks like:\n\n```rust\nfn honest_friend(dish: &Dish) {\n  dish.photograph(\"Honest Friend\")\n}\n```\n\nOur dinner-party now looks like:\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn honest_friend(dish: &Dish) {\n    dish.photograph(\"Honest Friend\");\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    honest_friend(&doro);\n    honest_friend(&bruschetta);\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+honest_friend%28dish%3A+%26Dish%29+%7B%0A++++dish.photograph%28%22Honest+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++honest_friend%28%26doro%29%3B%0A++++honest_friend%28%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nNote that your friend is not explicitly returning the Dish at the end  of their function. Thanks to Rusts borrowing rules they dont have to.  When your friends scope ends, the borrow ends.\n\n```rust\nfn honest_friend(dish: &Dish) {      //-- Borrow of the dish begins here\n  dish.photograph(\"Honest Friend\")   // |\n}                                   //-- Borrow of the dish ends here\n```\n\nA new friend joins your table. This friend likes to play pranks, but  they dont always go as expected. Your Trickster Friend says, Loan me a  dish and Ill give you a dish back. Trust me, Im going to return to  you the same dish you loaned me. You have your doubts.\n\n```rust\nfn trickster_friend(dish: &Dish) -> &Dish {\n    dish.photograph(\"Incompenent Friend\");\n\n    // Tricks and Pranks ensue\n\n    // Is this really the same dish you loaned?\n    mystery_dish\n}\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend(dish: &Dish) -> &Dish {\n    dish.photograph(\"Trickster Friend\");\n\n    // Your friend is either returning the same dish or a different one.\n    // Try running both options by uncommenting the assignments of mystery_dish\n\n    // Option One: Returning a different one\n    // let mystery_dish = &Dish { name: String::from(\"Pad Thai\") };\n\n    // Option Two: Returning the same one\n    // let mystery_dish = dish;\n\n    mystery_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_dish = trickster_friend(&doro); \n\n    mystery_dish.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend%28dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2F+Your+friend+is+either+returning+the+same+dish+or+a+different+one.%0A++++%2F%2F+Try+running+both+options+by+uncommenting+the+assignments+of+mystery_dish%0A%0A++++%2F%2F+Option+One%3A+Returning+a+different+one%0A++++%2F%2F+let+mystery_dish+%3D+%26Dish+%7B+name%3A+String%3A%3Afrom%28%22Pad+Thai%22%29+%7D%3B%0A%0A++++%2F%2F+Option+Two%3A+Returning+the+same+one%0A++++%2F%2F+let+mystery_dish+%3D+dish%3B%0A%0A++++mystery_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_dish+%3D+trickster_friend%28%26doro%29%3B+%0A%0A++++mystery_dish.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nTry both options and youll see that your trickster friend can not  prank you by giving you Pad Thai. The Pad Thai value is owned inside `trickster_friend` and is destroyed when `trickster_friend` ends. This is a bit easier to see if you inline the `trickster_friend` function into your `main` function\n\n```rust\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n\n    let mystery_meal = {                                          //-- Mystery Meal is created here \n      let other_dish = &Dish { name: String::from(\"Pad Thai\") };  // |  //-- Pad Thai is created here\n      other_dish                                                  // |     |\n    }                                                             // |  //-- Pad Thai is destroyed here\n                                                                  // |\n    me(mystery_meal)                                              //-- Mystery meal lives for longer than Pad Thai,\n                                                                  //   so it can't contain a reference to Pad Thai. \n                                                                  //   Compiler Error\n}\n```\n\nOur trickster friend shows us that if a function is going to receive and return a single borrowed reference it *has* to return the same reference it received. Even though our friends tricky plan failed we learned something from it!\n\nA third, very impatient friend arrives to our party. They dont have  time for this one plate at a time nonsense; this friend wants you to  loan them two dishes at once:\n\n```rust\nfn impatient_friend(first_dish: &Dish, second_dish: &Dish) {\n    first_dish.photograph(\"Impatient Friend\");\n    second_dish.photograph(\"Impatient Friend\");\n}\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn impatient_friend(first_dish: &Dish, second_dish: &Dish) {\n    first_dish.photograph(\"Impatient Friend\");\n    second_dish.photograph(\"Impatient Friend\");\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    impatient_friend(&doro, &bruschetta);\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+impatient_friend%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+%7B%0A++++first_dish.photograph%28%22Impatient+Friend%22%29%3B%0A++++second_dish.photograph%28%22Impatient+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++impatient_friend%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nJust as with your honest friend, this works fine. We loan our two dishes to our impatient friend who takes their photos. When `impatient_friend` ends, so do the borrows.\n\nBut your trickster friend sees this exchange and gets an idea. They  now know that they cant return a plate of Pad Thai, but they figure  that if they borrow 2 plates and only return one, they can keep that  extra plate for themselves.\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend_again(first_dish: &Dish, second_dish: &Dish) -> &Dish {\n    first_dish.photograph(\"Trickster Friend\");\n    second_dish.photograph(\"Trickster Friend\");\n\n    first_dish\n    //ha hah hah, I get to keep the second dish!\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = trickster_friend_again(&doro, &bruschetta);\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_again%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++first_dish%0A++++%2F%2Fha+hah+hah%2C+I+get+to+keep+the+second+dish%21%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_again%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D)\n\nFoiled again! If you run that youll get `error: missing lifetime specifier`.\n\nRemember what we first learned from our Trickster Friend? If a  function receives and returns a single reference then it must be the  same reference, otherwise you could return something that does not live  long enough. Thats easy for the Rust compiler to check as theres only  one option. But this function receives two references and returns one.  How does the compiler ensure that the reference you return points to a  value that lives long enough?\n\nIn this particular code both our values  `doro` and `bruschetta`  live long enough. So it can be hard to see why the Rust compiler is confused. But what if we changed our code to:\n\n```rust\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_again(&herring, &bruschetta)                   // |\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nIf `trickster_friend_again` returns `bruschetta` then that code would be fine. But if it returns `herring` wed try to photograph a dish that no longer existed. This is unsafe, so Rust wont let us do it.\n\nIf the Rust compiler ever has any questions about what reference a  function will return then that function must explicitly declare a  lifetime. Our trickster friend could declare one of four lifetimes:\n\nOption One:\n\n```rust\nfn trickster_friend_option_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish\n```\n\nOption Two:\n\n```rust\nfn trickster_friend_option_two<'a>(first_dish: &Dish, second_dish: &'a Dish) -> &'a Dish\n```\n\nOption Three:\n\n```rust\nfn trickster_friend_option_three<'a>(first_dish: &'a Dish, second_dish: &'a Dish) -> &'a Dish\n```\n\nOption Four:\n\n```rust\nfn trickster_friend_option_four<'a, 'b>(first_dish: &'a Dish, second_dish: &'b Dish) -> &'a Dish\n```\n\nLets see the differences between those options:\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend_lifetime_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish {\n    first_dish.photograph(\"Trickster Friend\");\n    second_dish.photograph(\"Trickster Friend\");\n\n    //Uncomment below to try to return second_dish\n    //second_dish\n\n    //Comment this out when you try to return second_dish\n    first_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = trickster_friend_lifetime_one(&doro, &bruschetta);\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_lifetime_one%3C%27a%3E%28first_dish%3A+%26%27a+Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26%27a+Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2FUncomment+below+to+try+to+return+second_dish%0A++++%2F%2Fsecond_dish%0A%0A++++%2F%2FComment+this+out+when+you+try+to+return+second_dish%0A++++first_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_lifetime_one%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D)\n\nIn this example weve declared one lifetime, given it to the reference passed to `first_dish` and our return value. Trickster friend now *must* return first_dish.\n\nLets try the `herring` code again:\n\n```rust\nfn trickster_friend_lifetime_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish {\n    first_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_one(&doro, &herring)                  // |  this will always return doro\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nUsing our current Trickster Friend this code will compile, because there is no way that `mystery_meal` will ever be `herring`.\n\nOption Two is the inverse of Option One. The function must now return the `second_dish`. If we pass in `herring` as the first dish, our code still runs.\n\n```rust\nfn trickster_friend_option_two<'a>(first_dish: &Dish, second_dish: &'a Dish) -> &'a Dish {\n  second_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_two(&herring, &doro)                  // |   this will always return &doro\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nOption Three gives the same lifetime to both parameters so the  function could return either of them. Our herring code will fail to  compile regardless of parameter order because `mystery_meal` could be bound to a destroyed value.\n\n```rust\nfn trickster_friend_option_three<'a>(first_dish: &'a Dish, second_dish: &'a Dish) -> &'a Dish {\n  // logic to determine if first_dish or second_dish is returned\n  dish_to_return\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_three(&herring, &doro)                // |   this could return doro or herring\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nIn our dinner party Option Four is functionally the same as Option  One. Weve declared two lifetimes but were never using the second one  making it irrelevant. Im sure there are times when having two lifetimes  on a function is useful, but I havent come across them. [The book says you can have multiple lifetimes, but dont explain why](https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes). Id love to know more about this.\n\nIs there more to lifetimes than this? Almost certainly. But I hope  that this analogy helps you grasp the fundamentals of why Rust has  lifetimes. If you want to learn more about fundamentals of Rust, maybe  read one of my earlier posts, [Rust via its Core Values](http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/). I also suggest the [New Rustacean](http://www.newrustacean.com/) podcast, which has helped me understand quite a lot about Rust.","source":"_posts/The Lifetime of Food - Design is Refactoring.md","raw":"---\ntitle: '[Translation]Design is refactoring-The Lifetime of Food'\ndate: 2019-03-06 16:53:28\ntags: rust\nkeyword: [rust, lifetime rule, borrowing rule]\ncategories: cpp\ndescription: It is my first translation about rust programming(unfinished).\ntoc: true\n---\n\n## [Design is Refactoring-The Lifetime of Food](http://designisrefactoring.com/2016/08/10/the-lifetime-of-food/)\nA Rusty Analogy using Millennial Stereotypes\n\nImagine you are out to dinner with some friends. You  are all stereotypical Millennials so photographing your meal is  expected. For every dish you order each of your friends borrows it,  takes a photograph, and then returns it to you.\n\nWell, thats the plan anyway. Some of your friends are not the most  reliable. Will they always return the right dish to you? Will they try  to sneak a bite? Human friends are so unreliable. But if your friends  were Rust functions youd have nothing to worry about, thanks to Rusts  rules around borrowing and lifetimes.\n<!--more-->\n\n> [](https://baike.baidu.com/item/%E5%8D%83%E7%A6%A7%E4%B8%80%E4%BB%A3/2683826?fr=aladdin) \n>\n> ?`Rust functions`,  `Rust`********\n>\n\n\nLets model this dinner party in Rust and see if we can learn a thing or two about borrowing and lifetimes.\n\nWell start off with the basics, a Dish that can be photographed.\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nWe have a `Dish` struct which contains a name. Theres one function on `Dish`, `photograph`. You get your dishes from the hot new Italian/Ethiopian fusion restaurant and take their pictures.\n\nLets introduce one of your friends. Well start off with your most  honest and trustworthy companion. Being honest this friend wants to  borrow a dish photograph it and return it. They dont want you giving  them more than one dish  that could get confusing! When converted to a  Rust function, this friend looks like:\n\n```rust\nfn honest_friend(dish: &Dish) {\n  dish.photograph(\"Honest Friend\")\n}\n```\n\nOur dinner-party now looks like:\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn honest_friend(dish: &Dish) {\n    dish.photograph(\"Honest Friend\");\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    honest_friend(&doro);\n    honest_friend(&bruschetta);\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+honest_friend%28dish%3A+%26Dish%29+%7B%0A++++dish.photograph%28%22Honest+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++honest_friend%28%26doro%29%3B%0A++++honest_friend%28%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nNote that your friend is not explicitly returning the Dish at the end  of their function. Thanks to Rusts borrowing rules they dont have to.  When your friends scope ends, the borrow ends.\n\n```rust\nfn honest_friend(dish: &Dish) {      //-- Borrow of the dish begins here\n  dish.photograph(\"Honest Friend\")   // |\n}                                   //-- Borrow of the dish ends here\n```\n\nA new friend joins your table. This friend likes to play pranks, but  they dont always go as expected. Your Trickster Friend says, Loan me a  dish and Ill give you a dish back. Trust me, Im going to return to  you the same dish you loaned me. You have your doubts.\n\n```rust\nfn trickster_friend(dish: &Dish) -> &Dish {\n    dish.photograph(\"Incompenent Friend\");\n\n    // Tricks and Pranks ensue\n\n    // Is this really the same dish you loaned?\n    mystery_dish\n}\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend(dish: &Dish) -> &Dish {\n    dish.photograph(\"Trickster Friend\");\n\n    // Your friend is either returning the same dish or a different one.\n    // Try running both options by uncommenting the assignments of mystery_dish\n\n    // Option One: Returning a different one\n    // let mystery_dish = &Dish { name: String::from(\"Pad Thai\") };\n\n    // Option Two: Returning the same one\n    // let mystery_dish = dish;\n\n    mystery_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_dish = trickster_friend(&doro); \n\n    mystery_dish.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend%28dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2F+Your+friend+is+either+returning+the+same+dish+or+a+different+one.%0A++++%2F%2F+Try+running+both+options+by+uncommenting+the+assignments+of+mystery_dish%0A%0A++++%2F%2F+Option+One%3A+Returning+a+different+one%0A++++%2F%2F+let+mystery_dish+%3D+%26Dish+%7B+name%3A+String%3A%3Afrom%28%22Pad+Thai%22%29+%7D%3B%0A%0A++++%2F%2F+Option+Two%3A+Returning+the+same+one%0A++++%2F%2F+let+mystery_dish+%3D+dish%3B%0A%0A++++mystery_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_dish+%3D+trickster_friend%28%26doro%29%3B+%0A%0A++++mystery_dish.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nTry both options and youll see that your trickster friend can not  prank you by giving you Pad Thai. The Pad Thai value is owned inside `trickster_friend` and is destroyed when `trickster_friend` ends. This is a bit easier to see if you inline the `trickster_friend` function into your `main` function\n\n```rust\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n\n    let mystery_meal = {                                          //-- Mystery Meal is created here \n      let other_dish = &Dish { name: String::from(\"Pad Thai\") };  // |  //-- Pad Thai is created here\n      other_dish                                                  // |     |\n    }                                                             // |  //-- Pad Thai is destroyed here\n                                                                  // |\n    me(mystery_meal)                                              //-- Mystery meal lives for longer than Pad Thai,\n                                                                  //   so it can't contain a reference to Pad Thai. \n                                                                  //   Compiler Error\n}\n```\n\nOur trickster friend shows us that if a function is going to receive and return a single borrowed reference it *has* to return the same reference it received. Even though our friends tricky plan failed we learned something from it!\n\nA third, very impatient friend arrives to our party. They dont have  time for this one plate at a time nonsense; this friend wants you to  loan them two dishes at once:\n\n```rust\nfn impatient_friend(first_dish: &Dish, second_dish: &Dish) {\n    first_dish.photograph(\"Impatient Friend\");\n    second_dish.photograph(\"Impatient Friend\");\n}\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn impatient_friend(first_dish: &Dish, second_dish: &Dish) {\n    first_dish.photograph(\"Impatient Friend\");\n    second_dish.photograph(\"Impatient Friend\");\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    impatient_friend(&doro, &bruschetta);\n\n    doro.photograph(\"Me\");\n    bruschetta.photograph(\"Me\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+impatient_friend%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+%7B%0A++++first_dish.photograph%28%22Impatient+Friend%22%29%3B%0A++++second_dish.photograph%28%22Impatient+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++impatient_friend%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D)\n\nJust as with your honest friend, this works fine. We loan our two dishes to our impatient friend who takes their photos. When `impatient_friend` ends, so do the borrows.\n\nBut your trickster friend sees this exchange and gets an idea. They  now know that they cant return a plate of Pad Thai, but they figure  that if they borrow 2 plates and only return one, they can keep that  extra plate for themselves.\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend_again(first_dish: &Dish, second_dish: &Dish) -> &Dish {\n    first_dish.photograph(\"Trickster Friend\");\n    second_dish.photograph(\"Trickster Friend\");\n\n    first_dish\n    //ha hah hah, I get to keep the second dish!\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = trickster_friend_again(&doro, &bruschetta);\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_again%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++first_dish%0A++++%2F%2Fha+hah+hah%2C+I+get+to+keep+the+second+dish%21%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_again%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D)\n\nFoiled again! If you run that youll get `error: missing lifetime specifier`.\n\nRemember what we first learned from our Trickster Friend? If a  function receives and returns a single reference then it must be the  same reference, otherwise you could return something that does not live  long enough. Thats easy for the Rust compiler to check as theres only  one option. But this function receives two references and returns one.  How does the compiler ensure that the reference you return points to a  value that lives long enough?\n\nIn this particular code both our values  `doro` and `bruschetta`  live long enough. So it can be hard to see why the Rust compiler is confused. But what if we changed our code to:\n\n```rust\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_again(&herring, &bruschetta)                   // |\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nIf `trickster_friend_again` returns `bruschetta` then that code would be fine. But if it returns `herring` wed try to photograph a dish that no longer existed. This is unsafe, so Rust wont let us do it.\n\nIf the Rust compiler ever has any questions about what reference a  function will return then that function must explicitly declare a  lifetime. Our trickster friend could declare one of four lifetimes:\n\nOption One:\n\n```rust\nfn trickster_friend_option_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish\n```\n\nOption Two:\n\n```rust\nfn trickster_friend_option_two<'a>(first_dish: &Dish, second_dish: &'a Dish) -> &'a Dish\n```\n\nOption Three:\n\n```rust\nfn trickster_friend_option_three<'a>(first_dish: &'a Dish, second_dish: &'a Dish) -> &'a Dish\n```\n\nOption Four:\n\n```rust\nfn trickster_friend_option_four<'a, 'b>(first_dish: &'a Dish, second_dish: &'b Dish) -> &'a Dish\n```\n\nLets see the differences between those options:\n\n```rust\nstruct Dish {\n    name: String,\n}\n\nimpl Dish {\n    fn photograph(&self, photographer: &str) {\n        println!(\"Snap! {} photographed by {}\", self.name, photographer)\n    }\n}\n\nfn trickster_friend_lifetime_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish {\n    first_dish.photograph(\"Trickster Friend\");\n    second_dish.photograph(\"Trickster Friend\");\n\n    //Uncomment below to try to return second_dish\n    //second_dish\n\n    //Comment this out when you try to return second_dish\n    first_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = trickster_friend_lifetime_one(&doro, &bruschetta);\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\n[Run](https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_lifetime_one%3C%27a%3E%28first_dish%3A+%26%27a+Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26%27a+Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2FUncomment+below+to+try+to+return+second_dish%0A++++%2F%2Fsecond_dish%0A%0A++++%2F%2FComment+this+out+when+you+try+to+return+second_dish%0A++++first_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_lifetime_one%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D)\n\nIn this example weve declared one lifetime, given it to the reference passed to `first_dish` and our return value. Trickster friend now *must* return first_dish.\n\nLets try the `herring` code again:\n\n```rust\nfn trickster_friend_lifetime_one<'a>(first_dish: &'a Dish, second_dish: &Dish) -> &'a Dish {\n    first_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_one(&doro, &herring)                  // |  this will always return doro\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nUsing our current Trickster Friend this code will compile, because there is no way that `mystery_meal` will ever be `herring`.\n\nOption Two is the inverse of Option One. The function must now return the `second_dish`. If we pass in `herring` as the first dish, our code still runs.\n\n```rust\nfn trickster_friend_option_two<'a>(first_dish: &Dish, second_dish: &'a Dish) -> &'a Dish {\n  second_dish\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_two(&herring, &doro)                  // |   this will always return &doro\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nOption Three gives the same lifetime to both parameters so the  function could return either of them. Our herring code will fail to  compile regardless of parameter order because `mystery_meal` could be bound to a destroyed value.\n\n```rust\nfn trickster_friend_option_three<'a>(first_dish: &'a Dish, second_dish: &'a Dish) -> &'a Dish {\n  // logic to determine if first_dish or second_dish is returned\n  dish_to_return\n}\n\nfn main() {\n    let doro = Dish { name: String::from(\"Doro Wat\") };\n    let bruschetta = Dish { name: String::from(\"Bruschetta\") };\n\n    let mystery_meal = {\n      let herring = Dish { name: String::from(\"Pickled Herring\") };   //-- Herring created here\n      trickster_friend_lifetime_three(&herring, &doro)                // |   this could return doro or herring\n    }                                                                 //-- Herring destroyed here\n\n\n    mystery_meal.photograph(\"Me!\");\n}\n```\n\nIn our dinner party Option Four is functionally the same as Option  One. Weve declared two lifetimes but were never using the second one  making it irrelevant. Im sure there are times when having two lifetimes  on a function is useful, but I havent come across them. [The book says you can have multiple lifetimes, but dont explain why](https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes). Id love to know more about this.\n\nIs there more to lifetimes than this? Almost certainly. But I hope  that this analogy helps you grasp the fundamentals of why Rust has  lifetimes. If you want to learn more about fundamentals of Rust, maybe  read one of my earlier posts, [Rust via its Core Values](http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/). I also suggest the [New Rustacean](http://www.newrustacean.com/) podcast, which has helped me understand quite a lot about Rust.","slug":"The Lifetime of Food - Design is Refactoring","published":1,"updated":"2019-03-06T09:26:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf736x0018t0t8ycahkyvq","content":"<h2 id=\"Design-is-Refactoring-The-Lifetime-of-Food\"><a href=\"#Design-is-Refactoring-The-Lifetime-of-Food\" class=\"headerlink\" title=\"Design is Refactoring-The Lifetime of Food\"></a><a href=\"http://designisrefactoring.com/2016/08/10/the-lifetime-of-food/\" target=\"_blank\" rel=\"noopener\">Design is Refactoring-The Lifetime of Food</a></h2><p>A Rusty Analogy using Millennial Stereotypes</p>\n<p>Imagine you are out to dinner with some friends. You  are all stereotypical Millennials so photographing your meal is  expected. For every dish you order each of your friends borrows it,  takes a photograph, and then returns it to you.</p>\n<p>Well, thats the plan anyway. Some of your friends are not the most  reliable. Will they always return the right dish to you? Will they try  to sneak a bite? Human friends are so unreliable. But if your friends  were Rust functions youd have nothing to worry about, thanks to Rusts  rules around borrowing and lifetimes.<br><a id=\"more\"></a></p>\n<blockquote>\n<p><a href=\"https://baike.baidu.com/item/%E5%8D%83%E7%A6%A7%E4%B8%80%E4%BB%A3/2683826?fr=aladdin\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<p>?<code>Rust functions</code>,  <code>Rust</code><strong></strong><strong></strong></p>\n</blockquote>\n<p>Lets model this dinner party in Rust and see if we can learn a thing or two about borrowing and lifetimes.</p>\n<p>Well start off with the basics, a Dish that can be photographed.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>We have a <code>Dish</code> struct which contains a name. Theres one function on <code>Dish</code>, <code>photograph</code>. You get your dishes from the hot new Italian/Ethiopian fusion restaurant and take their pictures.</p>\n<p>Lets introduce one of your friends. Well start off with your most  honest and trustworthy companion. Being honest this friend wants to  borrow a dish photograph it and return it. They dont want you giving  them more than one dish  that could get confusing! When converted to a  Rust function, this friend looks like:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class=\"line\">  dish.photograph(<span class=\"string\">\"Honest Friend\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Our dinner-party now looks like:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Honest Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    honest_friend(&amp;doro);</span><br><span class=\"line\">    honest_friend(&amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+honest_friend%28dish%3A+%26Dish%29+%7B%0A++++dish.photograph%28%22Honest+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++honest_friend%28%26doro%29%3B%0A++++honest_friend%28%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Note that your friend is not explicitly returning the Dish at the end  of their function. Thanks to Rusts borrowing rules they dont have to.  When your friends scope ends, the borrow ends.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;      <span class=\"comment\">//-- Borrow of the dish begins here</span></span><br><span class=\"line\">  dish.photograph(<span class=\"string\">\"Honest Friend\"</span>)   <span class=\"comment\">// |</span></span><br><span class=\"line\">&#125;                                   <span class=\"comment\">//-- Borrow of the dish ends here</span></span><br></pre></td></tr></table></figure>\n<p>A new friend joins your table. This friend likes to play pranks, but  they dont always go as expected. Your Trickster Friend says, Loan me a  dish and Ill give you a dish back. Trust me, Im going to return to  you the same dish you loaned me. You have your doubts.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Incompenent Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Tricks and Pranks ensue</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is this really the same dish you loaned?</span></span><br><span class=\"line\">    mystery_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Your friend is either returning the same dish or a different one.</span></span><br><span class=\"line\">    <span class=\"comment\">// Try running both options by uncommenting the assignments of mystery_dish</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Option One: Returning a different one</span></span><br><span class=\"line\">    <span class=\"comment\">// let mystery_dish = &amp;Dish &#123; name: String::from(\"Pad Thai\") &#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Option Two: Returning the same one</span></span><br><span class=\"line\">    <span class=\"comment\">// let mystery_dish = dish;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_dish = trickster_friend(&amp;doro); </span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_dish.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend%28dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2F+Your+friend+is+either+returning+the+same+dish+or+a+different+one.%0A++++%2F%2F+Try+running+both+options+by+uncommenting+the+assignments+of+mystery_dish%0A%0A++++%2F%2F+Option+One%3A+Returning+a+different+one%0A++++%2F%2F+let+mystery_dish+%3D+%26Dish+%7B+name%3A+String%3A%3Afrom%28%22Pad+Thai%22%29+%7D%3B%0A%0A++++%2F%2F+Option+Two%3A+Returning+the+same+one%0A++++%2F%2F+let+mystery_dish+%3D+dish%3B%0A%0A++++mystery_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_dish+%3D+trickster_friend%28%26doro%29%3B+%0A%0A++++mystery_dish.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Try both options and youll see that your trickster friend can not  prank you by giving you Pad Thai. The Pad Thai value is owned inside <code>trickster_friend</code> and is destroyed when <code>trickster_friend</code> ends. This is a bit easier to see if you inline the <code>trickster_friend</code> function into your <code>main</code> function</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;                                          <span class=\"comment\">//-- Mystery Meal is created here </span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> other_dish = &amp;Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pad Thai\"</span>) &#125;;  <span class=\"comment\">// |  //-- Pad Thai is created here</span></span><br><span class=\"line\">      other_dish                                                  <span class=\"comment\">// |     |</span></span><br><span class=\"line\">    &#125;                                                             <span class=\"comment\">// |  //-- Pad Thai is destroyed here</span></span><br><span class=\"line\">                                                                  <span class=\"comment\">// |</span></span><br><span class=\"line\">    me(mystery_meal)                                              <span class=\"comment\">//-- Mystery meal lives for longer than Pad Thai,</span></span><br><span class=\"line\">                                                                  <span class=\"comment\">//   so it can't contain a reference to Pad Thai. </span></span><br><span class=\"line\">                                                                  <span class=\"comment\">//   Compiler Error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Our trickster friend shows us that if a function is going to receive and return a single borrowed reference it <em>has</em> to return the same reference it received. Even though our friends tricky plan failed we learned something from it!</p>\n<p>A third, very impatient friend arrives to our party. They dont have  time for this one plate at a time nonsense; this friend wants you to  loan them two dishes at once:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    impatient_friend(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+impatient_friend%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+%7B%0A++++first_dish.photograph%28%22Impatient+Friend%22%29%3B%0A++++second_dish.photograph%28%22Impatient+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++impatient_friend%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Just as with your honest friend, this works fine. We loan our two dishes to our impatient friend who takes their photos. When <code>impatient_friend</code> ends, so do the borrows.</p>\n<p>But your trickster friend sees this exchange and gets an idea. They  now know that they cant return a plate of Pad Thai, but they figure  that if they borrow 2 plates and only return one, they can keep that  extra plate for themselves.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_again</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">    <span class=\"comment\">//ha hah hah, I get to keep the second dish!</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = trickster_friend_again(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_again%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++first_dish%0A++++%2F%2Fha+hah+hah%2C+I+get+to+keep+the+second+dish%21%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_again%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Foiled again! If you run that youll get <code>error: missing lifetime specifier</code>.</p>\n<p>Remember what we first learned from our Trickster Friend? If a  function receives and returns a single reference then it must be the  same reference, otherwise you could return something that does not live  long enough. Thats easy for the Rust compiler to check as theres only  one option. But this function receives two references and returns one.  How does the compiler ensure that the reference you return points to a  value that lives long enough?</p>\n<p>In this particular code both our values  <code>doro</code> and <code>bruschetta</code>  live long enough. So it can be hard to see why the Rust compiler is confused. But what if we changed our code to:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_again(&amp;herring, &amp;bruschetta)                   <span class=\"comment\">// |</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>If <code>trickster_friend_again</code> returns <code>bruschetta</code> then that code would be fine. But if it returns <code>herring</code> wed try to photograph a dish that no longer existed. This is unsafe, so Rust wont let us do it.</p>\n<p>If the Rust compiler ever has any questions about what reference a  function will return then that function must explicitly declare a  lifetime. Our trickster friend could declare one of four lifetimes:</p>\n<p>Option One:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Two:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_two</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Three:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_three</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Four:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_four</span></span>&lt;<span class=\"symbol\">'a</span>, <span class=\"symbol\">'b</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'b</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Lets see the differences between those options:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_lifetime_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Uncomment below to try to return second_dish</span></span><br><span class=\"line\">    <span class=\"comment\">//second_dish</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Comment this out when you try to return second_dish</span></span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = trickster_friend_lifetime_one(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_lifetime_one%3C%27a%3E%28first_dish%3A+%26%27a+Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26%27a+Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2FUncomment+below+to+try+to+return+second_dish%0A++++%2F%2Fsecond_dish%0A%0A++++%2F%2FComment+this+out+when+you+try+to+return+second_dish%0A++++first_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_lifetime_one%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>In this example weve declared one lifetime, given it to the reference passed to <code>first_dish</code> and our return value. Trickster friend now <em>must</em> return first_dish.</p>\n<p>Lets try the <code>herring</code> code again:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_lifetime_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_one(&amp;doro, &amp;herring)                  <span class=\"comment\">// |  this will always return doro</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Using our current Trickster Friend this code will compile, because there is no way that <code>mystery_meal</code> will ever be <code>herring</code>.</p>\n<p>Option Two is the inverse of Option One. The function must now return the <code>second_dish</code>. If we pass in <code>herring</code> as the first dish, our code still runs.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_two</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">  second_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_two(&amp;herring, &amp;doro)                  <span class=\"comment\">// |   this will always return &amp;doro</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Option Three gives the same lifetime to both parameters so the  function could return either of them. Our herring code will fail to  compile regardless of parameter order because <code>mystery_meal</code> could be bound to a destroyed value.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_three</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">  <span class=\"comment\">// logic to determine if first_dish or second_dish is returned</span></span><br><span class=\"line\">  dish_to_return</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_three(&amp;herring, &amp;doro)                <span class=\"comment\">// |   this could return doro or herring</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>In our dinner party Option Four is functionally the same as Option  One. Weve declared two lifetimes but were never using the second one  making it irrelevant. Im sure there are times when having two lifetimes  on a function is useful, but I havent come across them. <a href=\"https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes\" target=\"_blank\" rel=\"noopener\">The book says you can have multiple lifetimes, but dont explain why</a>. Id love to know more about this.</p>\n<p>Is there more to lifetimes than this? Almost certainly. But I hope  that this analogy helps you grasp the fundamentals of why Rust has  lifetimes. If you want to learn more about fundamentals of Rust, maybe  read one of my earlier posts, <a href=\"http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/\" target=\"_blank\" rel=\"noopener\">Rust via its Core Values</a>. I also suggest the <a href=\"http://www.newrustacean.com/\" target=\"_blank\" rel=\"noopener\">New Rustacean</a> podcast, which has helped me understand quite a lot about Rust.</p>\n","site":{"data":{}},"excerpt":"<h2 id=\"Design-is-Refactoring-The-Lifetime-of-Food\"><a href=\"#Design-is-Refactoring-The-Lifetime-of-Food\" class=\"headerlink\" title=\"Design is Refactoring-The Lifetime of Food\"></a><a href=\"http://designisrefactoring.com/2016/08/10/the-lifetime-of-food/\" target=\"_blank\" rel=\"noopener\">Design is Refactoring-The Lifetime of Food</a></h2><p>A Rusty Analogy using Millennial Stereotypes</p>\n<p>Imagine you are out to dinner with some friends. You  are all stereotypical Millennials so photographing your meal is  expected. For every dish you order each of your friends borrows it,  takes a photograph, and then returns it to you.</p>\n<p>Well, thats the plan anyway. Some of your friends are not the most  reliable. Will they always return the right dish to you? Will they try  to sneak a bite? Human friends are so unreliable. But if your friends  were Rust functions youd have nothing to worry about, thanks to Rusts  rules around borrowing and lifetimes.<br>","more":"</p>\n<blockquote>\n<p><a href=\"https://baike.baidu.com/item/%E5%8D%83%E7%A6%A7%E4%B8%80%E4%BB%A3/2683826?fr=aladdin\" target=\"_blank\" rel=\"noopener\"></a> </p>\n<p>?<code>Rust functions</code>,  <code>Rust</code><strong></strong><strong></strong></p>\n</blockquote>\n<p>Lets model this dinner party in Rust and see if we can learn a thing or two about borrowing and lifetimes.</p>\n<p>Well start off with the basics, a Dish that can be photographed.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>We have a <code>Dish</code> struct which contains a name. Theres one function on <code>Dish</code>, <code>photograph</code>. You get your dishes from the hot new Italian/Ethiopian fusion restaurant and take their pictures.</p>\n<p>Lets introduce one of your friends. Well start off with your most  honest and trustworthy companion. Being honest this friend wants to  borrow a dish photograph it and return it. They dont want you giving  them more than one dish  that could get confusing! When converted to a  Rust function, this friend looks like:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class=\"line\">  dish.photograph(<span class=\"string\">\"Honest Friend\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Our dinner-party now looks like:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Honest Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    honest_friend(&amp;doro);</span><br><span class=\"line\">    honest_friend(&amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+honest_friend%28dish%3A+%26Dish%29+%7B%0A++++dish.photograph%28%22Honest+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++honest_friend%28%26doro%29%3B%0A++++honest_friend%28%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Note that your friend is not explicitly returning the Dish at the end  of their function. Thanks to Rusts borrowing rules they dont have to.  When your friends scope ends, the borrow ends.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">honest_friend</span></span>(dish: &amp;Dish) &#123;      <span class=\"comment\">//-- Borrow of the dish begins here</span></span><br><span class=\"line\">  dish.photograph(<span class=\"string\">\"Honest Friend\"</span>)   <span class=\"comment\">// |</span></span><br><span class=\"line\">&#125;                                   <span class=\"comment\">//-- Borrow of the dish ends here</span></span><br></pre></td></tr></table></figure>\n<p>A new friend joins your table. This friend likes to play pranks, but  they dont always go as expected. Your Trickster Friend says, Loan me a  dish and Ill give you a dish back. Trust me, Im going to return to  you the same dish you loaned me. You have your doubts.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Incompenent Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Tricks and Pranks ensue</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Is this really the same dish you loaned?</span></span><br><span class=\"line\">    mystery_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Your friend is either returning the same dish or a different one.</span></span><br><span class=\"line\">    <span class=\"comment\">// Try running both options by uncommenting the assignments of mystery_dish</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Option One: Returning a different one</span></span><br><span class=\"line\">    <span class=\"comment\">// let mystery_dish = &amp;Dish &#123; name: String::from(\"Pad Thai\") &#125;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Option Two: Returning the same one</span></span><br><span class=\"line\">    <span class=\"comment\">// let mystery_dish = dish;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_dish = trickster_friend(&amp;doro); </span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_dish.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend%28dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2F+Your+friend+is+either+returning+the+same+dish+or+a+different+one.%0A++++%2F%2F+Try+running+both+options+by+uncommenting+the+assignments+of+mystery_dish%0A%0A++++%2F%2F+Option+One%3A+Returning+a+different+one%0A++++%2F%2F+let+mystery_dish+%3D+%26Dish+%7B+name%3A+String%3A%3Afrom%28%22Pad+Thai%22%29+%7D%3B%0A%0A++++%2F%2F+Option+Two%3A+Returning+the+same+one%0A++++%2F%2F+let+mystery_dish+%3D+dish%3B%0A%0A++++mystery_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_dish+%3D+trickster_friend%28%26doro%29%3B+%0A%0A++++mystery_dish.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Try both options and youll see that your trickster friend can not  prank you by giving you Pad Thai. The Pad Thai value is owned inside <code>trickster_friend</code> and is destroyed when <code>trickster_friend</code> ends. This is a bit easier to see if you inline the <code>trickster_friend</code> function into your <code>main</code> function</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;                                          <span class=\"comment\">//-- Mystery Meal is created here </span></span><br><span class=\"line\">      <span class=\"keyword\">let</span> other_dish = &amp;Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pad Thai\"</span>) &#125;;  <span class=\"comment\">// |  //-- Pad Thai is created here</span></span><br><span class=\"line\">      other_dish                                                  <span class=\"comment\">// |     |</span></span><br><span class=\"line\">    &#125;                                                             <span class=\"comment\">// |  //-- Pad Thai is destroyed here</span></span><br><span class=\"line\">                                                                  <span class=\"comment\">// |</span></span><br><span class=\"line\">    me(mystery_meal)                                              <span class=\"comment\">//-- Mystery meal lives for longer than Pad Thai,</span></span><br><span class=\"line\">                                                                  <span class=\"comment\">//   so it can't contain a reference to Pad Thai. </span></span><br><span class=\"line\">                                                                  <span class=\"comment\">//   Compiler Error</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Our trickster friend shows us that if a function is going to receive and return a single borrowed reference it <em>has</em> to return the same reference it received. Even though our friends tricky plan failed we learned something from it!</p>\n<p>A third, very impatient friend arrives to our party. They dont have  time for this one plate at a time nonsense; this friend wants you to  loan them two dishes at once:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Impatient Friend\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    impatient_friend(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    doro.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">    bruschetta.photograph(<span class=\"string\">\"Me\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+impatient_friend%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+%7B%0A++++first_dish.photograph%28%22Impatient+Friend%22%29%3B%0A++++second_dish.photograph%28%22Impatient+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++impatient_friend%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Just as with your honest friend, this works fine. We loan our two dishes to our impatient friend who takes their photos. When <code>impatient_friend</code> ends, so do the borrows.</p>\n<p>But your trickster friend sees this exchange and gets an idea. They  now know that they cant return a plate of Pad Thai, but they figure  that if they borrow 2 plates and only return one, they can keep that  extra plate for themselves.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_again</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">    <span class=\"comment\">//ha hah hah, I get to keep the second dish!</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = trickster_friend_again(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_again%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++first_dish%0A++++%2F%2Fha+hah+hah%2C+I+get+to+keep+the+second+dish%21%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_again%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>Foiled again! If you run that youll get <code>error: missing lifetime specifier</code>.</p>\n<p>Remember what we first learned from our Trickster Friend? If a  function receives and returns a single reference then it must be the  same reference, otherwise you could return something that does not live  long enough. Thats easy for the Rust compiler to check as theres only  one option. But this function receives two references and returns one.  How does the compiler ensure that the reference you return points to a  value that lives long enough?</p>\n<p>In this particular code both our values  <code>doro</code> and <code>bruschetta</code>  live long enough. So it can be hard to see why the Rust compiler is confused. But what if we changed our code to:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_again(&amp;herring, &amp;bruschetta)                   <span class=\"comment\">// |</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>If <code>trickster_friend_again</code> returns <code>bruschetta</code> then that code would be fine. But if it returns <code>herring</code> wed try to photograph a dish that no longer existed. This is unsafe, so Rust wont let us do it.</p>\n<p>If the Rust compiler ever has any questions about what reference a  function will return then that function must explicitly declare a  lifetime. Our trickster friend could declare one of four lifetimes:</p>\n<p>Option One:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Two:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_two</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Three:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_three</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Option Four:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_four</span></span>&lt;<span class=\"symbol\">'a</span>, <span class=\"symbol\">'b</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'b</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish</span><br></pre></td></tr></table></figure>\n<p>Lets see the differences between those options:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Dish</span></span> &#123;</span><br><span class=\"line\">    name: <span class=\"built_in\">String</span>,</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">impl</span> Dish &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">photograph</span></span>(&amp;<span class=\"keyword\">self</span>, photographer: &amp;<span class=\"built_in\">str</span>) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">println!</span>(<span class=\"string\">\"Snap! &#123;&#125; photographed by &#123;&#125;\"</span>, <span class=\"keyword\">self</span>.name, photographer)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_lifetime_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">    first_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\">    second_dish.photograph(<span class=\"string\">\"Trickster Friend\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Uncomment below to try to return second_dish</span></span><br><span class=\"line\">    <span class=\"comment\">//second_dish</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//Comment this out when you try to return second_dish</span></span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = trickster_friend_lifetime_one(&amp;doro, &amp;bruschetta);</span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_lifetime_one%3C%27a%3E%28first_dish%3A+%26%27a+Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26%27a+Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2FUncomment+below+to+try+to+return+second_dish%0A++++%2F%2Fsecond_dish%0A%0A++++%2F%2FComment+this+out+when+you+try+to+return+second_dish%0A++++first_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_lifetime_one%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D\" target=\"_blank\" rel=\"noopener\">Run</a></p>\n<p>In this example weve declared one lifetime, given it to the reference passed to <code>first_dish</code> and our return value. Trickster friend now <em>must</em> return first_dish.</p>\n<p>Lets try the <code>herring</code> code again:</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_lifetime_one</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">    first_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_one(&amp;doro, &amp;herring)                  <span class=\"comment\">// |  this will always return doro</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Using our current Trickster Friend this code will compile, because there is no way that <code>mystery_meal</code> will ever be <code>herring</code>.</p>\n<p>Option Two is the inverse of Option One. The function must now return the <code>second_dish</code>. If we pass in <code>herring</code> as the first dish, our code still runs.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_two</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">  second_dish</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_two(&amp;herring, &amp;doro)                  <span class=\"comment\">// |   this will always return &amp;doro</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Option Three gives the same lifetime to both parameters so the  function could return either of them. Our herring code will fail to  compile regardless of parameter order because <code>mystery_meal</code> could be bound to a destroyed value.</p>\n<figure class=\"highlight rust\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">trickster_friend_option_three</span></span>&lt;<span class=\"symbol\">'a</span>&gt;(first_dish: &amp;<span class=\"symbol\">'a</span> Dish, second_dish: &amp;<span class=\"symbol\">'a</span> Dish) -&gt; &amp;<span class=\"symbol\">'a</span> Dish &#123;</span><br><span class=\"line\">  <span class=\"comment\">// logic to determine if first_dish or second_dish is returned</span></span><br><span class=\"line\">  dish_to_return</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> doro = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Doro Wat\"</span>) &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> bruschetta = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Bruschetta\"</span>) &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">let</span> mystery_meal = &#123;</span><br><span class=\"line\">      <span class=\"keyword\">let</span> herring = Dish &#123; name: <span class=\"built_in\">String</span>::from(<span class=\"string\">\"Pickled Herring\"</span>) &#125;;   <span class=\"comment\">//-- Herring created here</span></span><br><span class=\"line\">      trickster_friend_lifetime_three(&amp;herring, &amp;doro)                <span class=\"comment\">// |   this could return doro or herring</span></span><br><span class=\"line\">    &#125;                                                                 <span class=\"comment\">//-- Herring destroyed here</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    mystery_meal.photograph(<span class=\"string\">\"Me!\"</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>In our dinner party Option Four is functionally the same as Option  One. Weve declared two lifetimes but were never using the second one  making it irrelevant. Im sure there are times when having two lifetimes  on a function is useful, but I havent come across them. <a href=\"https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes\" target=\"_blank\" rel=\"noopener\">The book says you can have multiple lifetimes, but dont explain why</a>. Id love to know more about this.</p>\n<p>Is there more to lifetimes than this? Almost certainly. But I hope  that this analogy helps you grasp the fundamentals of why Rust has  lifetimes. If you want to learn more about fundamentals of Rust, maybe  read one of my earlier posts, <a href=\"http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/\" target=\"_blank\" rel=\"noopener\">Rust via its Core Values</a>. I also suggest the <a href=\"http://www.newrustacean.com/\" target=\"_blank\" rel=\"noopener\">New Rustacean</a> podcast, which has helped me understand quite a lot about Rust.</p>"},{"title":"How to specify a newer version gcc for cmake","date":"2019-04-10T01:46:49.000Z","keyword":["gcc","cmake","gdb"],"description":"A small piece of note for Linux toolkit.","toc":true,"_content":"\nAfter I upgraded `gcc` from *version of 4.4.7* to *version of 7.4.0* on **CentOS 6.5**, some ridiculous bugs happened when I linked my project to `gtest`. So I rebuilt `gtest` using the newer `gcc`, however, bugs remained. In the end, I found that `cmake` did not use the newer `gcc` when I was typing `cmake ..` command, I guessed that was the key. \n\n<!--more-->\n\n### How to upgrade `gcc` to a newer version\n\n#### install development tools\n\n```bash\nyum groupinstall \"Development Tools\"\nyum install glibc-static libstdc++-static\n```\n\n#### download `gcc` package\n\n`http://mirror.hust.edu.cn/gnu/gcc/` turned out to be the most fastest mirror in China. \n\n#### build `gcc`\n\n```bash\ntar -Jxvf gcc-7.4.0.tar.xz\ncd gcc-7.4.0\n./contrib/download_prerequisits\nmkdir BUILD\ncd BUILD\n../configure --enable-checking=release --enable-languages=c,c++ --disable-multilib\nmake -j4\nsudo make install\n```\nNote that `./contrib/download_prerequisits` will download 4 packages:\n- mpc-1.0.3.tar.gc\n\n- mpfr-3.1.4.tar.bz2\n\n- gmp-6.1.9.tar.bz2\n\n- isl-0.16.1.tar.bz2\n\n#### new feature support testing\n\nv7.4.0 support c++17, here is a sample from [cppreference](https://en.cppreference.com/w/cpp/utility/any).\n\n```c++\n/// cpp17_any.cc\n#include <any>\n#include <iostream>\n \nint main()\n{\n    std::cout << std::boolalpha;\n \n    // any type\n    std::any a = 1;\n    std::cout << a.type().name() << \": \" << std::any_cast<int>(a) << '\\n';\n    a = 3.14;\n    std::cout << a.type().name() << \": \" << std::any_cast<double>(a) << '\\n';\n    a = true;\n    std::cout << a.type().name() << \": \" << std::any_cast<bool>(a) << '\\n';\n \n    // bad cast\n    try\n    {\n        a = 1;\n        std::cout << std::any_cast<float>(a) << '\\n';\n    }\n    catch (const std::bad_any_cast& e)\n    {\n        std::cout << e.what() << '\\n';\n    }\n \n    // has value\n    a = 1;\n    if (a.has_value())\n    {\n        std::cout << a.type().name() << '\\n';\n    }\n \n    // reset\n    a.reset();\n    if (!a.has_value())\n    {\n        std::cout << \"no value\\n\";\n    }\n \n    // pointer to contained data\n    a = 1;\n    int* i = std::any_cast<int>(&a);\n    std::cout << *i << \"\\n\";\n}\n```\n\n```bash\ng++ cpp17_any.cc -std=c++17\n./a.out\n```\n\nIt would raise linking errors for libraries compatibility. \n\n#### update the  system newer`gcc` linker\n\n```bash\nfind . -name *libstdc++* # find the newer lib\nstrings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep 'CXXABI' \nstrings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep 'GLIBCXX'\nsudo cp  ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 /usr/lib64/\nstrings /usr/lib64/libstdc++.so.6.0.24 | grep 'GLIBCXX' # check lib\nstrings /usr/lib64/libstdc++.so.6.0.24 | grep 'CXXABI' \nsudo rm /usr/lib64/libstdc++.so.6\nsudo ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6\nstrings /usr/lib64/libstdc++.so.6 | grep 'CXXABI' # check lib\nstrings /usr/lib64/libstdc++.so.6 | grep 'GLIBCXX'\n```\n\ncompile and run  again the output would be:\n\n```bash\ni: 1\nd: 3.14\nb: true\nbad any_cast\ni\nno value\n1\n```\n\nNote that `gdb` would not be compatible for the newer `gcc`, you should upgrade it too.\n\n\n### How to specify the newer version `gcc `for `cmake`\n\n#### bad approach\n\nFor the sake of specify the newer version of `gcc`, I tried to modify the **CMakeList.txt** by adding some like the following:\n\n```bash\nset(CMAKE_C_COMPILER \"/usr/local/bin/gcc\")\nset(CMAKE_CXX_COMPILER \"/usr/local/bin/g++\")\n```\n\nwhich reminds me it is a bad idea, even though I had backed up a copy.\n\n#### ideal approach\n\nBUT, `export` is [a ideal approach](https://stackoverflow.com/questions/17275348/how-to-specify-new-gcc-path-for-cmake). that is exporting system variables of `CXX` and `CC` to CMake's cache before `cmake`:\n\n```bash\nexport CC=/usr/local/bin/gcc \nexport CXX=/usr/local/bin/g++\n```\n\nThe export only needs to be done once, the first time you configure  the project, then those values will be read from the CMake cache.\n\n#### reasonable explaination\n\nI recommend against overriding the `CMAKE_C(XX)_COMPILER`  value for two main reasons: because it won't play well with CMake's  cache and because it breaks compiler checks and tooling detection.\n\nWhen using the `set` command, you have three options: \n\n- without cache, to create a normal variable\n- with cache, to create a cached variable\n- force cache, to always force the cache value when configuring\n\nLet's see what happens for the three possible calls to `set`:\n\n**Without cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang)\nset(CMAKE_CXX_COMPILER /usr/bin/clang++)\n```\n\nWhen doing this, you create a \"normal\" variable `CMAKE_C(XX)_COMPILER`  that hides the cache variable of the same name. That means your  compiler is now hard-coded in your build script and you cannot give it a  custom value. This will be a problem if you have multiple build  environments with different compilers. You could just update your script  each time you want to use a different compiler, but that removes the  value of using CMake in the first place.\n\nOk, then, let's update the cache...\n\n**With cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH \"\")\nset(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH \"\")\n```\n\nThis version will just \"not work\". The `CMAKE_C(XX)_COMPILER` variable is already in the cache, so it won't get updated unless you force it.\n\nAh... let's use the force, then...\n\n**Force cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH \"\" FORCE)\nset(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH \"\" FORCE)\n```\n\nThis is almost the same as the \"normal\" variable version, the only  difference is your value will be set in the cache, so users can see it.  But any change will be overwritten by the `set` command.\n\n**Breaking compiler checks and tooling**\n\nEarly in the configuration process, CMake performs checks on the  compiler: Does it work? Is it able to produce executables? etc. It also  uses the compiler to detect related tools, like `ar` and `ranlib`. When you override the compiler value in a script, it's \"too late\", all checks and detections are already done.\n\nFor instance, on my machine with gcc as default compiler, when using the `set` command to `/usr/bin/clang`, `ar` is set to `/usr/bin/gcc-ar-7`. When using an export before running CMake it is set to `/usr/lib/llvm-3.8/bin/llvm-ar`.\n\n### How to upgrade `gdb`\n\n#### download the newest version of `gdb`\n\n`http://mirror.hust.edu.cn/gnu/gdb/`\n\n#### specify the newer `gcc` version to build\n\n```bash\nmkdir BUILD & cd BUILD/\nexport CC=/usr/local/bin/gcc\nexport CXX=/usr/local/bin/g++\n```\n\n#### make it support TUI\n\n```bash\n../configure --enable-tui --with-python=yes\nmake -j8\nsudo make install\n```\n\n#### make it support STL pretty print message\n\n**copy the following script to local with name like `.gdbinit`** \n\n```python\n#                                                                                                        \n#   STL GDB evaluators/views/utilities - 1.03\n#\n#   The new GDB commands:                                                         \n# \t    are entirely non instrumental                                             \n# \t    do not depend on any \"inline\"(s) - e.g. size(), [], etc\n#       are extremely tolerant to debugger settings\n#                                                                                 \n#   This file should be \"included\" in .gdbinit as following:\n#   source stl-views.gdb or just paste it into your .gdbinit file\n#\n#   The following STL containers are currently supported:\n#\n#       std::vector<T> -- via pvector command\n#       std::list<T> -- via plist or plist_member command\n#       std::map<T,T> -- via pmap or pmap_member command\n#       std::multimap<T,T> -- via pmap or pmap_member command\n#       std::set<T> -- via pset command\n#       std::multiset<T> -- via pset command\n#       std::deque<T> -- via pdequeue command\n#       std::stack<T> -- via pstack command\n#       std::queue<T> -- via pqueue command\n#       std::priority_queue<T> -- via ppqueue command\n#       std::bitset<n> -- via pbitset command\n#       std::string -- via pstring command\n#       std::widestring -- via pwstring command\n#\n#   The end of this file contains (optional) C++ beautifiers\n#   Make sure your debugger supports $argc\n#\n#   Simple GDB Macros writen by Dan Marinescu (H-PhD) - License GPL\n#   Inspired by intial work of Tom Malnar, \n#     Tony Novac (PhD) / Cornell / Stanford,\n#     Gilad Mishne (PhD) and Many Many Others.\n#   Contact: dan_c_marinescu@yahoo.com (Subject: STL)\n#\n#   Modified to work with g++ 4.3 by Anders Elton\n#   Also added _member functions, that instead of printing the entire class in map, prints a member.\n\n\n\n#\n# std::vector<>\n#\n\ndefine pvector\n\tif $argc == 0\n\t\thelp pvector\n\telse\n\t\tset $size = $arg0._M_impl._M_finish - $arg0._M_impl._M_start\n\t\tset $capacity = $arg0._M_impl._M_end_of_storage - $arg0._M_impl._M_start\n\t\tset $size_max = $size - 1\n\tend\n\tif $argc == 1\n\t\tset $i = 0\n\t\twhile $i < $size\n\t\t\tprintf \"elem[%u]: \", $i\n\t\t\tp *($arg0._M_impl._M_start + $i)\n\t\t\tset $i++\n\t\tend\n\tend\n\tif $argc == 2\n\t\tset $idx = $arg1\n\t\tif $idx < 0 || $idx > $size_max\n\t\t\tprintf \"idx1, idx2 are not in acceptable range: [0..%u].\\n\", $size_max\n\t\telse\n\t\t\tprintf \"elem[%u]: \", $idx\n\t\t\tp *($arg0._M_impl._M_start + $idx)\n\t\tend\n\tend\n\tif $argc == 3\n\t  set $start_idx = $arg1\n\t  set $stop_idx = $arg2\n\t  if $start_idx > $stop_idx\n\t    set $tmp_idx = $start_idx\n\t    set $start_idx = $stop_idx\n\t    set $stop_idx = $tmp_idx\n\t  end\n\t  if $start_idx < 0 || $stop_idx < 0 || $start_idx > $size_max || $stop_idx > $size_max\n\t    printf \"idx1, idx2 are not in acceptable range: [0..%u].\\n\", $size_max\n\t  else\n\t    set $i = $start_idx\n\t\twhile $i <= $stop_idx\n\t\t\tprintf \"elem[%u]: \", $i\n\t\t\tp *($arg0._M_impl._M_start + $i)\n\t\t\tset $i++\n\t\tend\n\t  end\n\tend\n\tif $argc > 0\n\t\tprintf \"Vector size = %u\\n\", $size\n\t\tprintf \"Vector capacity = %u\\n\", $capacity\n\t\tprintf \"Element \"\n\t\twhatis $arg0._M_impl._M_start\n\tend\nend\n\ndocument pvector\n\tPrints std::vector<T> information.\n\tSyntax: pvector <vector> <idx1> <idx2>\n\tNote: idx, idx1 and idx2 must be in acceptable range [0..<vector>.size()-1].\n\tExamples:\n\tpvector v - Prints vector content, size, capacity and T typedef\n\tpvector v 0 - Prints element[idx] from vector\n\tpvector v 1 2 - Prints elements in range [idx1..idx2] from vector\nend \n\n#\n# std::list<>\n#\n\ndefine plist\n\tif $argc == 0\n\t\thelp plist\n\telse\n\t\tset $head = &$arg0._M_impl._M_node\n\t\tset $current = $arg0._M_impl._M_node._M_next\n\t\tset $size = 0\n\t\twhile $current != $head\n\t\t\tif $argc == 2\n\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\tp *($arg1*)($current + 1)\n\t\t\tend\n\t\t\tif $argc == 3\n\t\t\t\tif $size == $arg2\n\t\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\t\tp *($arg1*)($current + 1)\n\t\t\t\tend\n\t\t\tend\n\t\t\tset $current = $current._M_next\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"List size = %u \\n\", $size\n\t\tif $argc == 1\n\t\t\tprintf \"List \"\n\t\t\twhatis $arg0\n\t\t\tprintf \"Use plist <variable_name> <element_type> to see the elements in the list.\\n\"\n\t\tend\n\tend\nend\n\ndocument plist\n\tPrints std::list<T> information.\n\tSyntax: plist <list> <T> <idx>: Prints list size, if T defined all elements or just element at idx\n\tExamples:\n\tplist l - prints list size and definition\n\tplist l int - prints all elements and list size\n\tplist l int 2 - prints the third element in the list (if exists) and list size\nend\n\ndefine plist_member\n\tif $argc == 0\n\t\thelp plist_member\n\telse\n\t\tset $head = &$arg0._M_impl._M_node\n\t\tset $current = $arg0._M_impl._M_node._M_next\n\t\tset $size = 0\n\t\twhile $current != $head\n\t\t\tif $argc == 3\n\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\tp (*($arg1*)($current + 1)).$arg2\n\t\t\tend\n\t\t\tif $argc == 4\n\t\t\t\tif $size == $arg3\n\t\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\t\tp (*($arg1*)($current + 1)).$arg2\n\t\t\t\tend\n\t\t\tend\n\t\t\tset $current = $current._M_next\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"List size = %u \\n\", $size\n\t\tif $argc == 1\n\t\t\tprintf \"List \"\n\t\t\twhatis $arg0\n\t\t\tprintf \"Use plist_member <variable_name> <element_type> <member> to see the elements in the list.\\n\"\n\t\tend\n\tend\nend\n\ndocument plist_member\n\tPrints std::list<T> information.\n\tSyntax: plist <list> <T> <idx>: Prints list size, if T defined all elements or just element at idx\n\tExamples:\n\tplist_member l int member - prints all elements and list size\n\tplist_member l int member 2 - prints the third element in the list (if exists) and list size\nend\n\n\n#\n# std::map and std::multimap\n#\n\ndefine pmap\n\tif $argc == 0\n\t\thelp pmap\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Map \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pmap <variable_name> <left_element_type> <right_element_type> to see the elements in the map.\\n\"\n\t\tend\n\t\tif $argc == 3\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\tp *($arg1*)$value\n\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\tp *($arg2*)$value\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 4\n\t\t\tset $idx = $arg3\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp *($arg1*)$value\n\t\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp *($arg2*)$value\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tif $argc == 5\n\t\t\tset $idx1 = $arg3\n\t\t\tset $idx2 = $arg4\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tset $valueLeft = *($arg1*)$value\n\t\t\t\tset $valueRight = *($arg2*)($value + sizeof($arg1))\n\t\t\t\tif $valueLeft == $idx1 && $valueRight == $idx2\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp $valueLeft\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp $valueRight\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Map size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pmap\n\tPrints std::map<TLeft and TRight> or std::multimap<TLeft and TRight> information. Works for std::multimap as well.\n\tSyntax: pmap <map> <TtypeLeft> <TypeRight> <valLeft> <valRight>: Prints map size, if T defined all elements or just element(s) with val(s)\n\tExamples:\n\tpmap m - prints map size and definition\n\tpmap m int int - prints all elements and map size\n\tpmap m int int 20 - prints the element(s) with left-value = 20 (if any) and map size\n\tpmap m int int 20 200 - prints the element(s) with left-value = 20 and right-value = 200 (if any) and map size\nend\n\n\ndefine pmap_member\n\tif $argc == 0\n\t\thelp pmap_member\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Map \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pmap <variable_name> <left_element_type> <right_element_type> to see the elements in the map.\\n\"\n\t\tend\n\t\tif $argc == 5\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\tp (*($arg1*)$value).$arg2\n\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\tp (*($arg3*)$value).$arg4\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 6\n\t\t\tset $idx = $arg5\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp (*($arg1*)$value).$arg2\n\t\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp (*($arg3*)$value).$arg4\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Map size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pmap_member\n\tPrints std::map<TLeft and TRight> or std::multimap<TLeft and TRight> information. Works for std::multimap as well.\n\tSyntax: pmap <map> <TtypeLeft> <TypeRight> <valLeft> <valRight>: Prints map size, if T defined all elements or just element(s) with val(s)\n\tExamples:\n\tpmap_member m class1 member1 class2 member2 - prints class1.member1 : class2.member2\n\tpmap_member m class1 member1 class2 member2 lvalue - prints class1.member1 : class2.member2 where class1 == lvalue\nend\n\n\n#\n# std::set and std::multiset\n#\n\ndefine pset\n\tif $argc == 0\n\t\thelp pset\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Set \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pset <variable_name> <element_type> to see the elements in the set.\\n\"\n\t\tend\n\t\tif $argc == 2\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u]: \", $i\n\t\t\t\tp *($arg1*)$value\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 3\n\t\t\tset $idx = $arg2\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u]: \", $i\n\t\t\t\t\tp *($arg1*)$value\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Set size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pset\n\tPrints std::set<T> or std::multiset<T> information. Works for std::multiset as well.\n\tSyntax: pset <set> <T> <val>: Prints set size, if T defined all elements or just element(s) having val\n\tExamples:\n\tpset s - prints set size and definition\n\tpset s int - prints all elements and the size of s\n\tpset s int 20 - prints the element(s) with value = 20 (if any) and the size of s\nend\n\n\n\n#\n# std::dequeue\n#\n\ndefine pdequeue\n\tif $argc == 0\n\t\thelp pdequeue\n\telse\n\t\tset $size = 0\n\t\tset $start_cur = $arg0._M_impl._M_start._M_cur\n\t\tset $start_last = $arg0._M_impl._M_start._M_last\n\t\tset $start_stop = $start_last\n\t\twhile $start_cur != $start_stop\n\t\t\tp *$start_cur\n\t\t\tset $start_cur++\n\t\t\tset $size++\n\t\tend\n\t\tset $finish_first = $arg0._M_impl._M_finish._M_first\n\t\tset $finish_cur = $arg0._M_impl._M_finish._M_cur\n\t\tset $finish_last = $arg0._M_impl._M_finish._M_last\n\t\tif $finish_cur < $finish_last\n\t\t\tset $finish_stop = $finish_cur\n\t\telse\n\t\t\tset $finish_stop = $finish_last\n\t\tend\n\t\twhile $finish_first != $finish_stop\n\t\t\tp *$finish_first\n\t\t\tset $finish_first++\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"Dequeue size = %u\\n\", $size\n\tend\nend\n\ndocument pdequeue\n\tPrints std::dequeue<T> information.\n\tSyntax: pdequeue <dequeue>: Prints dequeue size, if T defined all elements\n\tDeque elements are listed \"left to right\" (left-most stands for front and right-most stands for back)\n\tExample:\n\tpdequeue d - prints all elements and size of d\nend\n\n\n\n#\n# std::stack\n#\n\ndefine pstack\n\tif $argc == 0\n\t\thelp pstack\n\telse\n\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur\n\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur\n\t\tset $size = $finish_cur - $start_cur\n        set $i = $size - 1\n        while $i >= 0\n            p *($start_cur + $i)\n            set $i--\n        end\n\t\tprintf \"Stack size = %u\\n\", $size\n\tend\nend\n\ndocument pstack\n\tPrints std::stack<T> information.\n\tSyntax: pstack <stack>: Prints all elements and size of the stack\n\tStack elements are listed \"top to buttom\" (top-most element is the first to come on pop)\n\tExample:\n\tpstack s - prints all elements and the size of s\nend\n\n\n\n#\n# std::queue\n#\n\ndefine pqueue\n\tif $argc == 0\n\t\thelp pqueue\n\telse\n\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur\n\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur\n\t\tset $size = $finish_cur - $start_cur\n        set $i = 0\n        while $i < $size\n            p *($start_cur + $i)\n            set $i++\n        end\n\t\tprintf \"Queue size = %u\\n\", $size\n\tend\nend\n\ndocument pqueue\n\tPrints std::queue<T> information.\n\tSyntax: pqueue <queue>: Prints all elements and the size of the queue\n\tQueue elements are listed \"top to bottom\" (top-most element is the first to come on pop)\n\tExample:\n\tpqueue q - prints all elements and the size of q\nend\n\n\n\n#\n# std::priority_queue\n#\n\ndefine ppqueue\n\tif $argc == 0\n\t\thelp ppqueue\n\telse\n\t\tset $size = $arg0.c._M_impl._M_finish - $arg0.c._M_impl._M_start\n\t\tset $capacity = $arg0.c._M_impl._M_end_of_storage - $arg0.c._M_impl._M_start\n\t\tset $i = $size - 1\n\t\twhile $i >= 0\n\t\t\tp *($arg0.c._M_impl._M_start + $i)\n\t\t\tset $i--\n\t\tend\n\t\tprintf \"Priority queue size = %u\\n\", $size\n\t\tprintf \"Priority queue capacity = %u\\n\", $capacity\n\tend\nend\n\ndocument ppqueue\n\tPrints std::priority_queue<T> information.\n\tSyntax: ppqueue <priority_queue>: Prints all elements, size and capacity of the priority_queue\n\tPriority_queue elements are listed \"top to buttom\" (top-most element is the first to come on pop)\n\tExample:\n\tppqueue pq - prints all elements, size and capacity of pq\nend\n\n\n\n#\n# std::bitset\n#\n\ndefine pbitset\n\tif $argc == 0\n\t\thelp pbitset\n\telse\n        p /t $arg0._M_w\n\tend\nend\n\ndocument pbitset\n\tPrints std::bitset<n> information.\n\tSyntax: pbitset <bitset>: Prints all bits in bitset\n\tExample:\n\tpbitset b - prints all bits in b\nend\n\n\n\n#\n# std::string\n#\n\ndefine pstring\n\tif $argc == 0\n\t\thelp pstring\n\telse\n\t\tprintf \"String \\t\\t\\t= \\\"%s\\\"\\n\", $arg0._M_data()\n\t\tprintf \"String size/length \\t= %u\\n\", $arg0._M_rep()._M_length\n\t\tprintf \"String capacity \\t= %u\\n\", $arg0._M_rep()._M_capacity\n\t\tprintf \"String ref-count \\t= %d\\n\", $arg0._M_rep()._M_refcount\n\tend\nend\n\ndocument pstring\n\tPrints std::string information.\n\tSyntax: pstring <string>\n\tExample:\n\tpstring s - Prints content, size/length, capacity and ref-count of string s\nend \n\n#\n# std::wstring\n#\n\ndefine pwstring\n\tif $argc == 0\n\t\thelp pwstring\n\telse\n\t\tcall printf(\"WString \\t\\t= \\\"%ls\\\"\\n\", $arg0._M_data())\n\t\tprintf \"WString size/length \\t= %u\\n\", $arg0._M_rep()._M_length\n\t\tprintf \"WString capacity \\t= %u\\n\", $arg0._M_rep()._M_capacity\n\t\tprintf \"WString ref-count \\t= %d\\n\", $arg0._M_rep()._M_refcount\n\tend\nend\n\ndocument pwstring\n\tPrints std::wstring information.\n\tSyntax: pwstring <wstring>\n\tExample:\n\tpwstring s - Prints content, size/length, capacity and ref-count of wstring s\nend \n\n#\n# C++ related beautifiers (optional)\n#\n\nset print pretty on\nset print object on\nset print static-members on\nset print vtbl on\nset print demangle on\nset demangle-style gnu-v3\nset print sevenbit-strings off\n\n```\n\n#### `gdb` testing example\n\n**example code**\n\n   ```c++\n///  vector_test.cc\n\n#include <iostream>\n#include <vector>\n \nint main()\n{\n    // Create a vector containing integers\n    std::vector<int> v = {7, 5, 16, 8};\n \n    // Add two more integers to vector\n    v.push_back(25);\n    v.push_back(13);\n \n    // Iterate and print values of vector\n    for(int n : v) {\n        std::cout << n << '\\n';\n    }\n    return 0;\n}\n   ```\n\ncompile it and debug using \n\n```bash\ng++ vector_test.cc -std=c++11 -g\ngdb a.out\n```\n\n**`gdb` console**\n\n```bash\n(gdb) b 9\n(gdb) layout src\t\t# set source code layout(TUI mode)\n(gdb) r\n(gdb) pvector v\t\t\t# print all the vector elements\n(gdb) n\n(gdb) n\n(gdb) pvector v 4 5      # check v[4] v[5]\n```","source":"_posts/How-to-specify-a-newer-version-gcc-for-cmake.md","raw":"---\ntitle: How to specify a newer version gcc for cmake\ndate: 2019-04-10 09:46:49\ntags: Linux\ncategories: cpp\nkeyword: [gcc, cmake, gdb]\ndescription: A small piece of note for Linux toolkit.\ntoc: true\n---\n\nAfter I upgraded `gcc` from *version of 4.4.7* to *version of 7.4.0* on **CentOS 6.5**, some ridiculous bugs happened when I linked my project to `gtest`. So I rebuilt `gtest` using the newer `gcc`, however, bugs remained. In the end, I found that `cmake` did not use the newer `gcc` when I was typing `cmake ..` command, I guessed that was the key. \n\n<!--more-->\n\n### How to upgrade `gcc` to a newer version\n\n#### install development tools\n\n```bash\nyum groupinstall \"Development Tools\"\nyum install glibc-static libstdc++-static\n```\n\n#### download `gcc` package\n\n`http://mirror.hust.edu.cn/gnu/gcc/` turned out to be the most fastest mirror in China. \n\n#### build `gcc`\n\n```bash\ntar -Jxvf gcc-7.4.0.tar.xz\ncd gcc-7.4.0\n./contrib/download_prerequisits\nmkdir BUILD\ncd BUILD\n../configure --enable-checking=release --enable-languages=c,c++ --disable-multilib\nmake -j4\nsudo make install\n```\nNote that `./contrib/download_prerequisits` will download 4 packages:\n- mpc-1.0.3.tar.gc\n\n- mpfr-3.1.4.tar.bz2\n\n- gmp-6.1.9.tar.bz2\n\n- isl-0.16.1.tar.bz2\n\n#### new feature support testing\n\nv7.4.0 support c++17, here is a sample from [cppreference](https://en.cppreference.com/w/cpp/utility/any).\n\n```c++\n/// cpp17_any.cc\n#include <any>\n#include <iostream>\n \nint main()\n{\n    std::cout << std::boolalpha;\n \n    // any type\n    std::any a = 1;\n    std::cout << a.type().name() << \": \" << std::any_cast<int>(a) << '\\n';\n    a = 3.14;\n    std::cout << a.type().name() << \": \" << std::any_cast<double>(a) << '\\n';\n    a = true;\n    std::cout << a.type().name() << \": \" << std::any_cast<bool>(a) << '\\n';\n \n    // bad cast\n    try\n    {\n        a = 1;\n        std::cout << std::any_cast<float>(a) << '\\n';\n    }\n    catch (const std::bad_any_cast& e)\n    {\n        std::cout << e.what() << '\\n';\n    }\n \n    // has value\n    a = 1;\n    if (a.has_value())\n    {\n        std::cout << a.type().name() << '\\n';\n    }\n \n    // reset\n    a.reset();\n    if (!a.has_value())\n    {\n        std::cout << \"no value\\n\";\n    }\n \n    // pointer to contained data\n    a = 1;\n    int* i = std::any_cast<int>(&a);\n    std::cout << *i << \"\\n\";\n}\n```\n\n```bash\ng++ cpp17_any.cc -std=c++17\n./a.out\n```\n\nIt would raise linking errors for libraries compatibility. \n\n#### update the  system newer`gcc` linker\n\n```bash\nfind . -name *libstdc++* # find the newer lib\nstrings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep 'CXXABI' \nstrings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep 'GLIBCXX'\nsudo cp  ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 /usr/lib64/\nstrings /usr/lib64/libstdc++.so.6.0.24 | grep 'GLIBCXX' # check lib\nstrings /usr/lib64/libstdc++.so.6.0.24 | grep 'CXXABI' \nsudo rm /usr/lib64/libstdc++.so.6\nsudo ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6\nstrings /usr/lib64/libstdc++.so.6 | grep 'CXXABI' # check lib\nstrings /usr/lib64/libstdc++.so.6 | grep 'GLIBCXX'\n```\n\ncompile and run  again the output would be:\n\n```bash\ni: 1\nd: 3.14\nb: true\nbad any_cast\ni\nno value\n1\n```\n\nNote that `gdb` would not be compatible for the newer `gcc`, you should upgrade it too.\n\n\n### How to specify the newer version `gcc `for `cmake`\n\n#### bad approach\n\nFor the sake of specify the newer version of `gcc`, I tried to modify the **CMakeList.txt** by adding some like the following:\n\n```bash\nset(CMAKE_C_COMPILER \"/usr/local/bin/gcc\")\nset(CMAKE_CXX_COMPILER \"/usr/local/bin/g++\")\n```\n\nwhich reminds me it is a bad idea, even though I had backed up a copy.\n\n#### ideal approach\n\nBUT, `export` is [a ideal approach](https://stackoverflow.com/questions/17275348/how-to-specify-new-gcc-path-for-cmake). that is exporting system variables of `CXX` and `CC` to CMake's cache before `cmake`:\n\n```bash\nexport CC=/usr/local/bin/gcc \nexport CXX=/usr/local/bin/g++\n```\n\nThe export only needs to be done once, the first time you configure  the project, then those values will be read from the CMake cache.\n\n#### reasonable explaination\n\nI recommend against overriding the `CMAKE_C(XX)_COMPILER`  value for two main reasons: because it won't play well with CMake's  cache and because it breaks compiler checks and tooling detection.\n\nWhen using the `set` command, you have three options: \n\n- without cache, to create a normal variable\n- with cache, to create a cached variable\n- force cache, to always force the cache value when configuring\n\nLet's see what happens for the three possible calls to `set`:\n\n**Without cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang)\nset(CMAKE_CXX_COMPILER /usr/bin/clang++)\n```\n\nWhen doing this, you create a \"normal\" variable `CMAKE_C(XX)_COMPILER`  that hides the cache variable of the same name. That means your  compiler is now hard-coded in your build script and you cannot give it a  custom value. This will be a problem if you have multiple build  environments with different compilers. You could just update your script  each time you want to use a different compiler, but that removes the  value of using CMake in the first place.\n\nOk, then, let's update the cache...\n\n**With cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH \"\")\nset(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH \"\")\n```\n\nThis version will just \"not work\". The `CMAKE_C(XX)_COMPILER` variable is already in the cache, so it won't get updated unless you force it.\n\nAh... let's use the force, then...\n\n**Force cache**\n\n```bash\nset(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH \"\" FORCE)\nset(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH \"\" FORCE)\n```\n\nThis is almost the same as the \"normal\" variable version, the only  difference is your value will be set in the cache, so users can see it.  But any change will be overwritten by the `set` command.\n\n**Breaking compiler checks and tooling**\n\nEarly in the configuration process, CMake performs checks on the  compiler: Does it work? Is it able to produce executables? etc. It also  uses the compiler to detect related tools, like `ar` and `ranlib`. When you override the compiler value in a script, it's \"too late\", all checks and detections are already done.\n\nFor instance, on my machine with gcc as default compiler, when using the `set` command to `/usr/bin/clang`, `ar` is set to `/usr/bin/gcc-ar-7`. When using an export before running CMake it is set to `/usr/lib/llvm-3.8/bin/llvm-ar`.\n\n### How to upgrade `gdb`\n\n#### download the newest version of `gdb`\n\n`http://mirror.hust.edu.cn/gnu/gdb/`\n\n#### specify the newer `gcc` version to build\n\n```bash\nmkdir BUILD & cd BUILD/\nexport CC=/usr/local/bin/gcc\nexport CXX=/usr/local/bin/g++\n```\n\n#### make it support TUI\n\n```bash\n../configure --enable-tui --with-python=yes\nmake -j8\nsudo make install\n```\n\n#### make it support STL pretty print message\n\n**copy the following script to local with name like `.gdbinit`** \n\n```python\n#                                                                                                        \n#   STL GDB evaluators/views/utilities - 1.03\n#\n#   The new GDB commands:                                                         \n# \t    are entirely non instrumental                                             \n# \t    do not depend on any \"inline\"(s) - e.g. size(), [], etc\n#       are extremely tolerant to debugger settings\n#                                                                                 \n#   This file should be \"included\" in .gdbinit as following:\n#   source stl-views.gdb or just paste it into your .gdbinit file\n#\n#   The following STL containers are currently supported:\n#\n#       std::vector<T> -- via pvector command\n#       std::list<T> -- via plist or plist_member command\n#       std::map<T,T> -- via pmap or pmap_member command\n#       std::multimap<T,T> -- via pmap or pmap_member command\n#       std::set<T> -- via pset command\n#       std::multiset<T> -- via pset command\n#       std::deque<T> -- via pdequeue command\n#       std::stack<T> -- via pstack command\n#       std::queue<T> -- via pqueue command\n#       std::priority_queue<T> -- via ppqueue command\n#       std::bitset<n> -- via pbitset command\n#       std::string -- via pstring command\n#       std::widestring -- via pwstring command\n#\n#   The end of this file contains (optional) C++ beautifiers\n#   Make sure your debugger supports $argc\n#\n#   Simple GDB Macros writen by Dan Marinescu (H-PhD) - License GPL\n#   Inspired by intial work of Tom Malnar, \n#     Tony Novac (PhD) / Cornell / Stanford,\n#     Gilad Mishne (PhD) and Many Many Others.\n#   Contact: dan_c_marinescu@yahoo.com (Subject: STL)\n#\n#   Modified to work with g++ 4.3 by Anders Elton\n#   Also added _member functions, that instead of printing the entire class in map, prints a member.\n\n\n\n#\n# std::vector<>\n#\n\ndefine pvector\n\tif $argc == 0\n\t\thelp pvector\n\telse\n\t\tset $size = $arg0._M_impl._M_finish - $arg0._M_impl._M_start\n\t\tset $capacity = $arg0._M_impl._M_end_of_storage - $arg0._M_impl._M_start\n\t\tset $size_max = $size - 1\n\tend\n\tif $argc == 1\n\t\tset $i = 0\n\t\twhile $i < $size\n\t\t\tprintf \"elem[%u]: \", $i\n\t\t\tp *($arg0._M_impl._M_start + $i)\n\t\t\tset $i++\n\t\tend\n\tend\n\tif $argc == 2\n\t\tset $idx = $arg1\n\t\tif $idx < 0 || $idx > $size_max\n\t\t\tprintf \"idx1, idx2 are not in acceptable range: [0..%u].\\n\", $size_max\n\t\telse\n\t\t\tprintf \"elem[%u]: \", $idx\n\t\t\tp *($arg0._M_impl._M_start + $idx)\n\t\tend\n\tend\n\tif $argc == 3\n\t  set $start_idx = $arg1\n\t  set $stop_idx = $arg2\n\t  if $start_idx > $stop_idx\n\t    set $tmp_idx = $start_idx\n\t    set $start_idx = $stop_idx\n\t    set $stop_idx = $tmp_idx\n\t  end\n\t  if $start_idx < 0 || $stop_idx < 0 || $start_idx > $size_max || $stop_idx > $size_max\n\t    printf \"idx1, idx2 are not in acceptable range: [0..%u].\\n\", $size_max\n\t  else\n\t    set $i = $start_idx\n\t\twhile $i <= $stop_idx\n\t\t\tprintf \"elem[%u]: \", $i\n\t\t\tp *($arg0._M_impl._M_start + $i)\n\t\t\tset $i++\n\t\tend\n\t  end\n\tend\n\tif $argc > 0\n\t\tprintf \"Vector size = %u\\n\", $size\n\t\tprintf \"Vector capacity = %u\\n\", $capacity\n\t\tprintf \"Element \"\n\t\twhatis $arg0._M_impl._M_start\n\tend\nend\n\ndocument pvector\n\tPrints std::vector<T> information.\n\tSyntax: pvector <vector> <idx1> <idx2>\n\tNote: idx, idx1 and idx2 must be in acceptable range [0..<vector>.size()-1].\n\tExamples:\n\tpvector v - Prints vector content, size, capacity and T typedef\n\tpvector v 0 - Prints element[idx] from vector\n\tpvector v 1 2 - Prints elements in range [idx1..idx2] from vector\nend \n\n#\n# std::list<>\n#\n\ndefine plist\n\tif $argc == 0\n\t\thelp plist\n\telse\n\t\tset $head = &$arg0._M_impl._M_node\n\t\tset $current = $arg0._M_impl._M_node._M_next\n\t\tset $size = 0\n\t\twhile $current != $head\n\t\t\tif $argc == 2\n\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\tp *($arg1*)($current + 1)\n\t\t\tend\n\t\t\tif $argc == 3\n\t\t\t\tif $size == $arg2\n\t\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\t\tp *($arg1*)($current + 1)\n\t\t\t\tend\n\t\t\tend\n\t\t\tset $current = $current._M_next\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"List size = %u \\n\", $size\n\t\tif $argc == 1\n\t\t\tprintf \"List \"\n\t\t\twhatis $arg0\n\t\t\tprintf \"Use plist <variable_name> <element_type> to see the elements in the list.\\n\"\n\t\tend\n\tend\nend\n\ndocument plist\n\tPrints std::list<T> information.\n\tSyntax: plist <list> <T> <idx>: Prints list size, if T defined all elements or just element at idx\n\tExamples:\n\tplist l - prints list size and definition\n\tplist l int - prints all elements and list size\n\tplist l int 2 - prints the third element in the list (if exists) and list size\nend\n\ndefine plist_member\n\tif $argc == 0\n\t\thelp plist_member\n\telse\n\t\tset $head = &$arg0._M_impl._M_node\n\t\tset $current = $arg0._M_impl._M_node._M_next\n\t\tset $size = 0\n\t\twhile $current != $head\n\t\t\tif $argc == 3\n\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\tp (*($arg1*)($current + 1)).$arg2\n\t\t\tend\n\t\t\tif $argc == 4\n\t\t\t\tif $size == $arg3\n\t\t\t\t\tprintf \"elem[%u]: \", $size\n\t\t\t\t\tp (*($arg1*)($current + 1)).$arg2\n\t\t\t\tend\n\t\t\tend\n\t\t\tset $current = $current._M_next\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"List size = %u \\n\", $size\n\t\tif $argc == 1\n\t\t\tprintf \"List \"\n\t\t\twhatis $arg0\n\t\t\tprintf \"Use plist_member <variable_name> <element_type> <member> to see the elements in the list.\\n\"\n\t\tend\n\tend\nend\n\ndocument plist_member\n\tPrints std::list<T> information.\n\tSyntax: plist <list> <T> <idx>: Prints list size, if T defined all elements or just element at idx\n\tExamples:\n\tplist_member l int member - prints all elements and list size\n\tplist_member l int member 2 - prints the third element in the list (if exists) and list size\nend\n\n\n#\n# std::map and std::multimap\n#\n\ndefine pmap\n\tif $argc == 0\n\t\thelp pmap\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Map \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pmap <variable_name> <left_element_type> <right_element_type> to see the elements in the map.\\n\"\n\t\tend\n\t\tif $argc == 3\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\tp *($arg1*)$value\n\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\tp *($arg2*)$value\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 4\n\t\t\tset $idx = $arg3\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp *($arg1*)$value\n\t\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp *($arg2*)$value\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tif $argc == 5\n\t\t\tset $idx1 = $arg3\n\t\t\tset $idx2 = $arg4\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tset $valueLeft = *($arg1*)$value\n\t\t\t\tset $valueRight = *($arg2*)($value + sizeof($arg1))\n\t\t\t\tif $valueLeft == $idx1 && $valueRight == $idx2\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp $valueLeft\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp $valueRight\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Map size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pmap\n\tPrints std::map<TLeft and TRight> or std::multimap<TLeft and TRight> information. Works for std::multimap as well.\n\tSyntax: pmap <map> <TtypeLeft> <TypeRight> <valLeft> <valRight>: Prints map size, if T defined all elements or just element(s) with val(s)\n\tExamples:\n\tpmap m - prints map size and definition\n\tpmap m int int - prints all elements and map size\n\tpmap m int int 20 - prints the element(s) with left-value = 20 (if any) and map size\n\tpmap m int int 20 200 - prints the element(s) with left-value = 20 and right-value = 200 (if any) and map size\nend\n\n\ndefine pmap_member\n\tif $argc == 0\n\t\thelp pmap_member\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Map \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pmap <variable_name> <left_element_type> <right_element_type> to see the elements in the map.\\n\"\n\t\tend\n\t\tif $argc == 5\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\tp (*($arg1*)$value).$arg2\n\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\tp (*($arg3*)$value).$arg4\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 6\n\t\t\tset $idx = $arg5\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u].left: \", $i\n\t\t\t\t\tp (*($arg1*)$value).$arg2\n\t\t\t\t\tset $value = $value + sizeof($arg1)\n\t\t\t\t\tprintf \"elem[%u].right: \", $i\n\t\t\t\t\tp (*($arg3*)$value).$arg4\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Map size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pmap_member\n\tPrints std::map<TLeft and TRight> or std::multimap<TLeft and TRight> information. Works for std::multimap as well.\n\tSyntax: pmap <map> <TtypeLeft> <TypeRight> <valLeft> <valRight>: Prints map size, if T defined all elements or just element(s) with val(s)\n\tExamples:\n\tpmap_member m class1 member1 class2 member2 - prints class1.member1 : class2.member2\n\tpmap_member m class1 member1 class2 member2 lvalue - prints class1.member1 : class2.member2 where class1 == lvalue\nend\n\n\n#\n# std::set and std::multiset\n#\n\ndefine pset\n\tif $argc == 0\n\t\thelp pset\n\telse\n\t\tset $tree = $arg0\n\t\tset $i = 0\n\t\tset $node = $tree._M_t._M_impl._M_header._M_left\n\t\tset $end = $tree._M_t._M_impl._M_header\n\t\tset $tree_size = $tree._M_t._M_impl._M_node_count\n\t\tif $argc == 1\n\t\t\tprintf \"Set \"\n\t\t\twhatis $tree\n\t\t\tprintf \"Use pset <variable_name> <element_type> to see the elements in the set.\\n\"\n\t\tend\n\t\tif $argc == 2\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tprintf \"elem[%u]: \", $i\n\t\t\t\tp *($arg1*)$value\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\tend\n\t\tif $argc == 3\n\t\t\tset $idx = $arg2\n\t\t\tset $ElementsFound = 0\n\t\t\twhile $i < $tree_size\n\t\t\t\tset $value = (void *)($node + 1)\n\t\t\t\tif *($arg1*)$value == $idx\n\t\t\t\t\tprintf \"elem[%u]: \", $i\n\t\t\t\t\tp *($arg1*)$value\n\t\t\t\t\tset $ElementsFound++\n\t\t\t\tend\n\t\t\t\tif $node._M_right != 0\n\t\t\t\t\tset $node = $node._M_right\n\t\t\t\t\twhile $node._M_left != 0\n\t\t\t\t\t\tset $node = $node._M_left\n\t\t\t\t\tend\n\t\t\t\telse\n\t\t\t\t\tset $tmp_node = $node._M_parent\n\t\t\t\t\twhile $node == $tmp_node._M_right\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent\n\t\t\t\t\tend\n\t\t\t\t\tif $node._M_right != $tmp_node\n\t\t\t\t\t\tset $node = $tmp_node\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\t\tset $i++\n\t\t\tend\n\t\t\tprintf \"Number of elements found = %u\\n\", $ElementsFound\n\t\tend\n\t\tprintf \"Set size = %u\\n\", $tree_size\n\tend\nend\n\ndocument pset\n\tPrints std::set<T> or std::multiset<T> information. Works for std::multiset as well.\n\tSyntax: pset <set> <T> <val>: Prints set size, if T defined all elements or just element(s) having val\n\tExamples:\n\tpset s - prints set size and definition\n\tpset s int - prints all elements and the size of s\n\tpset s int 20 - prints the element(s) with value = 20 (if any) and the size of s\nend\n\n\n\n#\n# std::dequeue\n#\n\ndefine pdequeue\n\tif $argc == 0\n\t\thelp pdequeue\n\telse\n\t\tset $size = 0\n\t\tset $start_cur = $arg0._M_impl._M_start._M_cur\n\t\tset $start_last = $arg0._M_impl._M_start._M_last\n\t\tset $start_stop = $start_last\n\t\twhile $start_cur != $start_stop\n\t\t\tp *$start_cur\n\t\t\tset $start_cur++\n\t\t\tset $size++\n\t\tend\n\t\tset $finish_first = $arg0._M_impl._M_finish._M_first\n\t\tset $finish_cur = $arg0._M_impl._M_finish._M_cur\n\t\tset $finish_last = $arg0._M_impl._M_finish._M_last\n\t\tif $finish_cur < $finish_last\n\t\t\tset $finish_stop = $finish_cur\n\t\telse\n\t\t\tset $finish_stop = $finish_last\n\t\tend\n\t\twhile $finish_first != $finish_stop\n\t\t\tp *$finish_first\n\t\t\tset $finish_first++\n\t\t\tset $size++\n\t\tend\n\t\tprintf \"Dequeue size = %u\\n\", $size\n\tend\nend\n\ndocument pdequeue\n\tPrints std::dequeue<T> information.\n\tSyntax: pdequeue <dequeue>: Prints dequeue size, if T defined all elements\n\tDeque elements are listed \"left to right\" (left-most stands for front and right-most stands for back)\n\tExample:\n\tpdequeue d - prints all elements and size of d\nend\n\n\n\n#\n# std::stack\n#\n\ndefine pstack\n\tif $argc == 0\n\t\thelp pstack\n\telse\n\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur\n\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur\n\t\tset $size = $finish_cur - $start_cur\n        set $i = $size - 1\n        while $i >= 0\n            p *($start_cur + $i)\n            set $i--\n        end\n\t\tprintf \"Stack size = %u\\n\", $size\n\tend\nend\n\ndocument pstack\n\tPrints std::stack<T> information.\n\tSyntax: pstack <stack>: Prints all elements and size of the stack\n\tStack elements are listed \"top to buttom\" (top-most element is the first to come on pop)\n\tExample:\n\tpstack s - prints all elements and the size of s\nend\n\n\n\n#\n# std::queue\n#\n\ndefine pqueue\n\tif $argc == 0\n\t\thelp pqueue\n\telse\n\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur\n\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur\n\t\tset $size = $finish_cur - $start_cur\n        set $i = 0\n        while $i < $size\n            p *($start_cur + $i)\n            set $i++\n        end\n\t\tprintf \"Queue size = %u\\n\", $size\n\tend\nend\n\ndocument pqueue\n\tPrints std::queue<T> information.\n\tSyntax: pqueue <queue>: Prints all elements and the size of the queue\n\tQueue elements are listed \"top to bottom\" (top-most element is the first to come on pop)\n\tExample:\n\tpqueue q - prints all elements and the size of q\nend\n\n\n\n#\n# std::priority_queue\n#\n\ndefine ppqueue\n\tif $argc == 0\n\t\thelp ppqueue\n\telse\n\t\tset $size = $arg0.c._M_impl._M_finish - $arg0.c._M_impl._M_start\n\t\tset $capacity = $arg0.c._M_impl._M_end_of_storage - $arg0.c._M_impl._M_start\n\t\tset $i = $size - 1\n\t\twhile $i >= 0\n\t\t\tp *($arg0.c._M_impl._M_start + $i)\n\t\t\tset $i--\n\t\tend\n\t\tprintf \"Priority queue size = %u\\n\", $size\n\t\tprintf \"Priority queue capacity = %u\\n\", $capacity\n\tend\nend\n\ndocument ppqueue\n\tPrints std::priority_queue<T> information.\n\tSyntax: ppqueue <priority_queue>: Prints all elements, size and capacity of the priority_queue\n\tPriority_queue elements are listed \"top to buttom\" (top-most element is the first to come on pop)\n\tExample:\n\tppqueue pq - prints all elements, size and capacity of pq\nend\n\n\n\n#\n# std::bitset\n#\n\ndefine pbitset\n\tif $argc == 0\n\t\thelp pbitset\n\telse\n        p /t $arg0._M_w\n\tend\nend\n\ndocument pbitset\n\tPrints std::bitset<n> information.\n\tSyntax: pbitset <bitset>: Prints all bits in bitset\n\tExample:\n\tpbitset b - prints all bits in b\nend\n\n\n\n#\n# std::string\n#\n\ndefine pstring\n\tif $argc == 0\n\t\thelp pstring\n\telse\n\t\tprintf \"String \\t\\t\\t= \\\"%s\\\"\\n\", $arg0._M_data()\n\t\tprintf \"String size/length \\t= %u\\n\", $arg0._M_rep()._M_length\n\t\tprintf \"String capacity \\t= %u\\n\", $arg0._M_rep()._M_capacity\n\t\tprintf \"String ref-count \\t= %d\\n\", $arg0._M_rep()._M_refcount\n\tend\nend\n\ndocument pstring\n\tPrints std::string information.\n\tSyntax: pstring <string>\n\tExample:\n\tpstring s - Prints content, size/length, capacity and ref-count of string s\nend \n\n#\n# std::wstring\n#\n\ndefine pwstring\n\tif $argc == 0\n\t\thelp pwstring\n\telse\n\t\tcall printf(\"WString \\t\\t= \\\"%ls\\\"\\n\", $arg0._M_data())\n\t\tprintf \"WString size/length \\t= %u\\n\", $arg0._M_rep()._M_length\n\t\tprintf \"WString capacity \\t= %u\\n\", $arg0._M_rep()._M_capacity\n\t\tprintf \"WString ref-count \\t= %d\\n\", $arg0._M_rep()._M_refcount\n\tend\nend\n\ndocument pwstring\n\tPrints std::wstring information.\n\tSyntax: pwstring <wstring>\n\tExample:\n\tpwstring s - Prints content, size/length, capacity and ref-count of wstring s\nend \n\n#\n# C++ related beautifiers (optional)\n#\n\nset print pretty on\nset print object on\nset print static-members on\nset print vtbl on\nset print demangle on\nset demangle-style gnu-v3\nset print sevenbit-strings off\n\n```\n\n#### `gdb` testing example\n\n**example code**\n\n   ```c++\n///  vector_test.cc\n\n#include <iostream>\n#include <vector>\n \nint main()\n{\n    // Create a vector containing integers\n    std::vector<int> v = {7, 5, 16, 8};\n \n    // Add two more integers to vector\n    v.push_back(25);\n    v.push_back(13);\n \n    // Iterate and print values of vector\n    for(int n : v) {\n        std::cout << n << '\\n';\n    }\n    return 0;\n}\n   ```\n\ncompile it and debug using \n\n```bash\ng++ vector_test.cc -std=c++11 -g\ngdb a.out\n```\n\n**`gdb` console**\n\n```bash\n(gdb) b 9\n(gdb) layout src\t\t# set source code layout(TUI mode)\n(gdb) r\n(gdb) pvector v\t\t\t# print all the vector elements\n(gdb) n\n(gdb) n\n(gdb) pvector v 4 5      # check v[4] v[5]\n```","slug":"How-to-specify-a-newer-version-gcc-for-cmake","published":1,"updated":"2019-05-07T06:34:20.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf7377001ct0t8vd04s0hg","content":"<p>After I upgraded <code>gcc</code> from <em>version of 4.4.7</em> to <em>version of 7.4.0</em> on <strong>CentOS 6.5</strong>, some ridiculous bugs happened when I linked my project to <code>gtest</code>. So I rebuilt <code>gtest</code> using the newer <code>gcc</code>, however, bugs remained. In the end, I found that <code>cmake</code> did not use the newer <code>gcc</code> when I was typing <code>cmake ..</code> command, I guessed that was the key. </p>\n<a id=\"more\"></a>\n<h3 id=\"How-to-upgrade-gcc-to-a-newer-version\"><a href=\"#How-to-upgrade-gcc-to-a-newer-version\" class=\"headerlink\" title=\"How to upgrade gcc to a newer version\"></a>How to upgrade <code>gcc</code> to a newer version</h3><h4 id=\"install-development-tools\"><a href=\"#install-development-tools\" class=\"headerlink\" title=\"install development tools\"></a>install development tools</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum groupinstall <span class=\"string\">\"Development Tools\"</span></span><br><span class=\"line\">yum install glibc-static libstdc++-static</span><br></pre></td></tr></table></figure>\n<h4 id=\"download-gcc-package\"><a href=\"#download-gcc-package\" class=\"headerlink\" title=\"download gcc package\"></a>download <code>gcc</code> package</h4><p><code>http://mirror.hust.edu.cn/gnu/gcc/</code> turned out to be the most fastest mirror in China. </p>\n<h4 id=\"build-gcc\"><a href=\"#build-gcc\" class=\"headerlink\" title=\"build gcc\"></a>build <code>gcc</code></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -Jxvf gcc-7.4.0.tar.xz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> gcc-7.4.0</span><br><span class=\"line\">./contrib/download_prerequisits</span><br><span class=\"line\">mkdir BUILD</span><br><span class=\"line\"><span class=\"built_in\">cd</span> BUILD</span><br><span class=\"line\">../configure --<span class=\"built_in\">enable</span>-checking=release --<span class=\"built_in\">enable</span>-languages=c,c++ --<span class=\"built_in\">disable</span>-multilib</span><br><span class=\"line\">make -j4</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n<p>Note that <code>./contrib/download_prerequisits</code> will download 4 packages:</p>\n<ul>\n<li><p>mpc-1.0.3.tar.gc</p>\n</li>\n<li><p>mpfr-3.1.4.tar.bz2</p>\n</li>\n<li><p>gmp-6.1.9.tar.bz2</p>\n</li>\n<li><p>isl-0.16.1.tar.bz2</p>\n</li>\n</ul>\n<h4 id=\"new-feature-support-testing\"><a href=\"#new-feature-support-testing\" class=\"headerlink\" title=\"new feature support testing\"></a>new feature support testing</h4><p>v7.4.0 support c++17, here is a sample from <a href=\"https://en.cppreference.com/w/cpp/utility/any\" target=\"_blank\" rel=\"noopener\">cppreference</a>.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// cpp17_any.cc</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;any&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">std</span>::boolalpha;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// any type</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::any a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">int</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    a = <span class=\"number\">3.14</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">double</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    a = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">bool</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// bad cast</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        a = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">float</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (<span class=\"keyword\">const</span> <span class=\"built_in\">std</span>::bad_any_cast&amp; e)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; e.what() &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// has value</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (a.has_value())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// reset</span></span><br><span class=\"line\">    a.reset();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!a.has_value())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"no value\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// pointer to contained data</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* i = <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">int</span>&gt;(&amp;a);</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; *i &lt;&lt; <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">g++ cpp17_any.cc -std=c++17</span><br><span class=\"line\">./a.out</span><br></pre></td></tr></table></figure>\n<p>It would raise linking errors for libraries compatibility. </p>\n<h4 id=\"update-the-system-newergcc-linker\"><a href=\"#update-the-system-newergcc-linker\" class=\"headerlink\" title=\"update the  system newergcc linker\"></a>update the  system newer<code>gcc</code> linker</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -name *libstdc++* <span class=\"comment\"># find the newer lib</span></span><br><span class=\"line\">strings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep <span class=\"string\">'CXXABI'</span> </span><br><span class=\"line\">strings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep <span class=\"string\">'GLIBCXX'</span></span><br><span class=\"line\">sudo cp  ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 /usr/lib64/</span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6.0.24 | grep <span class=\"string\">'GLIBCXX'</span> <span class=\"comment\"># check lib</span></span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6.0.24 | grep <span class=\"string\">'CXXABI'</span> </span><br><span class=\"line\">sudo rm /usr/lib64/libstdc++.so.6</span><br><span class=\"line\">sudo ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6</span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6 | grep <span class=\"string\">'CXXABI'</span> <span class=\"comment\"># check lib</span></span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6 | grep <span class=\"string\">'GLIBCXX'</span></span><br></pre></td></tr></table></figure>\n<p>compile and run  again the output would be:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i: 1</span><br><span class=\"line\">d: 3.14</span><br><span class=\"line\">b: <span class=\"literal\">true</span></span><br><span class=\"line\">bad any_cast</span><br><span class=\"line\">i</span><br><span class=\"line\">no value</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n<p>Note that <code>gdb</code> would not be compatible for the newer <code>gcc</code>, you should upgrade it too.</p>\n<h3 id=\"How-to-specify-the-newer-version-gccfor-cmake\"><a href=\"#How-to-specify-the-newer-version-gccfor-cmake\" class=\"headerlink\" title=\"How to specify the newer version gccfor cmake\"></a>How to specify the newer version <code>gcc</code>for <code>cmake</code></h3><h4 id=\"bad-approach\"><a href=\"#bad-approach\" class=\"headerlink\" title=\"bad approach\"></a>bad approach</h4><p>For the sake of specify the newer version of <code>gcc</code>, I tried to modify the <strong>CMakeList.txt</strong> by adding some like the following:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER <span class=\"string\">\"/usr/local/bin/gcc\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER <span class=\"string\">\"/usr/local/bin/g++\"</span>)</span><br></pre></td></tr></table></figure>\n<p>which reminds me it is a bad idea, even though I had backed up a copy.</p>\n<h4 id=\"ideal-approach\"><a href=\"#ideal-approach\" class=\"headerlink\" title=\"ideal approach\"></a>ideal approach</h4><p>BUT, <code>export</code> is <a href=\"https://stackoverflow.com/questions/17275348/how-to-specify-new-gcc-path-for-cmake\" target=\"_blank\" rel=\"noopener\">a ideal approach</a>. that is exporting system variables of <code>CXX</code> and <code>CC</code> to CMakes cache before <code>cmake</code>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> CC=/usr/<span class=\"built_in\">local</span>/bin/gcc </span><br><span class=\"line\"><span class=\"built_in\">export</span> CXX=/usr/<span class=\"built_in\">local</span>/bin/g++</span><br></pre></td></tr></table></figure>\n<p>The export only needs to be done once, the first time you configure  the project, then those values will be read from the CMake cache.</p>\n<h4 id=\"reasonable-explaination\"><a href=\"#reasonable-explaination\" class=\"headerlink\" title=\"reasonable explaination\"></a>reasonable explaination</h4><p>I recommend against overriding the <code>CMAKE_C(XX)_COMPILER</code>  value for two main reasons: because it wont play well with CMakes  cache and because it breaks compiler checks and tooling detection.</p>\n<p>When using the <code>set</code> command, you have three options: </p>\n<ul>\n<li>without cache, to create a normal variable</li>\n<li>with cache, to create a cached variable</li>\n<li>force cache, to always force the cache value when configuring</li>\n</ul>\n<p>Lets see what happens for the three possible calls to <code>set</code>:</p>\n<p><strong>Without cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++)</span><br></pre></td></tr></table></figure>\n<p>When doing this, you create a normal variable <code>CMAKE_C(XX)_COMPILER</code>  that hides the cache variable of the same name. That means your  compiler is now hard-coded in your build script and you cannot give it a  custom value. This will be a problem if you have multiple build  environments with different compilers. You could just update your script  each time you want to use a different compiler, but that removes the  value of using CMake in the first place.</p>\n<p>Ok, then, lets update the cache</p>\n<p><strong>With cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH <span class=\"string\">\"\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH <span class=\"string\">\"\"</span>)</span><br></pre></td></tr></table></figure>\n<p>This version will just not work. The <code>CMAKE_C(XX)_COMPILER</code> variable is already in the cache, so it wont get updated unless you force it.</p>\n<p>Ah lets use the force, then</p>\n<p><strong>Force cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH <span class=\"string\">\"\"</span> FORCE)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH <span class=\"string\">\"\"</span> FORCE)</span><br></pre></td></tr></table></figure>\n<p>This is almost the same as the normal variable version, the only  difference is your value will be set in the cache, so users can see it.  But any change will be overwritten by the <code>set</code> command.</p>\n<p><strong>Breaking compiler checks and tooling</strong></p>\n<p>Early in the configuration process, CMake performs checks on the  compiler: Does it work? Is it able to produce executables? etc. It also  uses the compiler to detect related tools, like <code>ar</code> and <code>ranlib</code>. When you override the compiler value in a script, its too late, all checks and detections are already done.</p>\n<p>For instance, on my machine with gcc as default compiler, when using the <code>set</code> command to <code>/usr/bin/clang</code>, <code>ar</code> is set to <code>/usr/bin/gcc-ar-7</code>. When using an export before running CMake it is set to <code>/usr/lib/llvm-3.8/bin/llvm-ar</code>.</p>\n<h3 id=\"How-to-upgrade-gdb\"><a href=\"#How-to-upgrade-gdb\" class=\"headerlink\" title=\"How to upgrade gdb\"></a>How to upgrade <code>gdb</code></h3><h4 id=\"download-the-newest-version-of-gdb\"><a href=\"#download-the-newest-version-of-gdb\" class=\"headerlink\" title=\"download the newest version of gdb\"></a>download the newest version of <code>gdb</code></h4><p><code>http://mirror.hust.edu.cn/gnu/gdb/</code></p>\n<h4 id=\"specify-the-newer-gcc-version-to-build\"><a href=\"#specify-the-newer-gcc-version-to-build\" class=\"headerlink\" title=\"specify the newer gcc version to build\"></a>specify the newer <code>gcc</code> version to build</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir BUILD &amp; <span class=\"built_in\">cd</span> BUILD/</span><br><span class=\"line\"><span class=\"built_in\">export</span> CC=/usr/<span class=\"built_in\">local</span>/bin/gcc</span><br><span class=\"line\"><span class=\"built_in\">export</span> CXX=/usr/<span class=\"built_in\">local</span>/bin/g++</span><br></pre></td></tr></table></figure>\n<h4 id=\"make-it-support-TUI\"><a href=\"#make-it-support-TUI\" class=\"headerlink\" title=\"make it support TUI\"></a>make it support TUI</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../configure --<span class=\"built_in\">enable</span>-tui --with-python=yes</span><br><span class=\"line\">make -j8</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n<h4 id=\"make-it-support-STL-pretty-print-message\"><a href=\"#make-it-support-STL-pretty-print-message\" class=\"headerlink\" title=\"make it support STL pretty print message\"></a>make it support STL pretty print message</h4><p><strong>copy the following script to local with name like <code>.gdbinit</code></strong> </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#                                                                                                        </span></span><br><span class=\"line\"><span class=\"comment\">#   STL GDB evaluators/views/utilities - 1.03</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The new GDB commands:                                                         </span></span><br><span class=\"line\"><span class=\"comment\"># \t    are entirely non instrumental                                             </span></span><br><span class=\"line\"><span class=\"comment\"># \t    do not depend on any \"inline\"(s) - e.g. size(), [], etc</span></span><br><span class=\"line\"><span class=\"comment\">#       are extremely tolerant to debugger settings</span></span><br><span class=\"line\"><span class=\"comment\">#                                                                                 </span></span><br><span class=\"line\"><span class=\"comment\">#   This file should be \"included\" in .gdbinit as following:</span></span><br><span class=\"line\"><span class=\"comment\">#   source stl-views.gdb or just paste it into your .gdbinit file</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The following STL containers are currently supported:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#       std::vector&lt;T&gt; -- via pvector command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::list&lt;T&gt; -- via plist or plist_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::map&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::multimap&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::set&lt;T&gt; -- via pset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::multiset&lt;T&gt; -- via pset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::deque&lt;T&gt; -- via pdequeue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::stack&lt;T&gt; -- via pstack command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::queue&lt;T&gt; -- via pqueue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::priority_queue&lt;T&gt; -- via ppqueue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::bitset&lt;n&gt; -- via pbitset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::string -- via pstring command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::widestring -- via pwstring command</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The end of this file contains (optional) C++ beautifiers</span></span><br><span class=\"line\"><span class=\"comment\">#   Make sure your debugger supports $argc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   Simple GDB Macros writen by Dan Marinescu (H-PhD) - License GPL</span></span><br><span class=\"line\"><span class=\"comment\">#   Inspired by intial work of Tom Malnar, </span></span><br><span class=\"line\"><span class=\"comment\">#     Tony Novac (PhD) / Cornell / Stanford,</span></span><br><span class=\"line\"><span class=\"comment\">#     Gilad Mishne (PhD) and Many Many Others.</span></span><br><span class=\"line\"><span class=\"comment\">#   Contact: dan_c_marinescu@yahoo.com (Subject: STL)</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   Modified to work with g++ 4.3 by Anders Elton</span></span><br><span class=\"line\"><span class=\"comment\">#   Also added _member functions, that instead of printing the entire class in map, prints a member.</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::vector&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pvector</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pvector</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = $arg0._M_impl._M_finish - $arg0._M_impl._M_start</span><br><span class=\"line\">\t\tset $capacity = $arg0._M_impl._M_end_of_storage - $arg0._M_impl._M_start</span><br><span class=\"line\">\t\tset $size_max = $size - <span class=\"number\">1</span></span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &lt; $size</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\tset $idx = $arg1</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $idx &lt; <span class=\"number\">0</span> || $idx &gt; $size_max</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"idx1, idx2 are not in acceptable range: [0..%u].\\n\"</span>, $size_max</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $idx</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $idx)</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t  set $start_idx = $arg1</span><br><span class=\"line\">\t  set $stop_idx = $arg2</span><br><span class=\"line\">\t  <span class=\"keyword\">if</span> $start_idx &gt; $stop_idx</span><br><span class=\"line\">\t    set $tmp_idx = $start_idx</span><br><span class=\"line\">\t    set $start_idx = $stop_idx</span><br><span class=\"line\">\t    set $stop_idx = $tmp_idx</span><br><span class=\"line\">\t  end</span><br><span class=\"line\">\t  <span class=\"keyword\">if</span> $start_idx &lt; <span class=\"number\">0</span> || $stop_idx &lt; <span class=\"number\">0</span> || $start_idx &gt; $size_max || $stop_idx &gt; $size_max</span><br><span class=\"line\">\t    printf <span class=\"string\">\"idx1, idx2 are not in acceptable range: [0..%u].\\n\"</span>, $size_max</span><br><span class=\"line\">\t  <span class=\"keyword\">else</span></span><br><span class=\"line\">\t    set $i = $start_idx</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &lt;= $stop_idx</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t  end</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc &gt; <span class=\"number\">0</span></span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Vector size = %u\\n\"</span>, $size</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Vector capacity = %u\\n\"</span>, $capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Element \"</span></span><br><span class=\"line\">\t\twhatis $arg0._M_impl._M_start</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pvector</span><br><span class=\"line\">\tPrints std::vector&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pvector &lt;vector&gt; &lt;idx1&gt; &lt;idx2&gt;</span><br><span class=\"line\">\tNote: idx, idx1 <span class=\"keyword\">and</span> idx2 must be <span class=\"keyword\">in</span> acceptable range [<span class=\"number\">0.</span>.&lt;vector&gt;.size()<span class=\"number\">-1</span>].</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpvector v - Prints vector content, size, capacity <span class=\"keyword\">and</span> T typedef</span><br><span class=\"line\">\tpvector v <span class=\"number\">0</span> - Prints element[idx] <span class=\"keyword\">from</span> vector</span><br><span class=\"line\">\tpvector v <span class=\"number\">1</span> <span class=\"number\">2</span> - Prints elements <span class=\"keyword\">in</span> range [idx1..idx2] <span class=\"keyword\">from</span> vector</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::list&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define plist</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp plist</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $head = &amp;$arg0._M_impl._M_node</span><br><span class=\"line\">\t\tset $current = $arg0._M_impl._M_node._M_next</span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $current != $head</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\tp *($arg1*)($current + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $size == $arg2</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)($current + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tset $current = $current._M_next</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"List size = %u \\n\"</span>, $size</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"List \"</span></span><br><span class=\"line\">\t\t\twhatis $arg0</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use plist &lt;variable_name&gt; &lt;element_type&gt; to see the elements in the list.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document plist</span><br><span class=\"line\">\tPrints std::list&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: plist &lt;list&gt; &lt;T&gt; &lt;idx&gt;: Prints list size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element at idx</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tplist l - prints list size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tplist l int - prints all elements <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">\tplist l int <span class=\"number\">2</span> - prints the third element <span class=\"keyword\">in</span> the list (<span class=\"keyword\">if</span> exists) <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">define plist_member</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp plist_member</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $head = &amp;$arg0._M_impl._M_node</span><br><span class=\"line\">\t\tset $current = $arg0._M_impl._M_node._M_next</span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $current != $head</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\tp (*($arg1*)($current + <span class=\"number\">1</span>)).$arg2</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">4</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $size == $arg3</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\t\tp (*($arg1*)($current + <span class=\"number\">1</span>)).$arg2</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tset $current = $current._M_next</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"List size = %u \\n\"</span>, $size</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"List \"</span></span><br><span class=\"line\">\t\t\twhatis $arg0</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use plist_member &lt;variable_name&gt; &lt;element_type&gt; &lt;member&gt; to see the elements in the list.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document plist_member</span><br><span class=\"line\">\tPrints std::list&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: plist &lt;list&gt; &lt;T&gt; &lt;idx&gt;: Prints list size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element at idx</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tplist_member l int member - prints all elements <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">\tplist_member l int member <span class=\"number\">2</span> - prints the third element <span class=\"keyword\">in</span> the list (<span class=\"keyword\">if</span> exists) <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::map and std::multimap</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pmap</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pmap</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Map \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pmap &lt;variable_name&gt; &lt;left_element_type&gt; &lt;right_element_type&gt; to see the elements in the map.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg2*)$value</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">4</span></span><br><span class=\"line\">\t\t\tset $idx = $arg3</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg2*)$value</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">5</span></span><br><span class=\"line\">\t\t\tset $idx1 = $arg3</span><br><span class=\"line\">\t\t\tset $idx2 = $arg4</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tset $valueLeft = *($arg1*)$value</span><br><span class=\"line\">\t\t\t\tset $valueRight = *($arg2*)($value + sizeof($arg1))</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $valueLeft == $idx1 &amp;&amp; $valueRight == $idx2</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp $valueLeft</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp $valueRight</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Map size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pmap</span><br><span class=\"line\">\tPrints std::map&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; <span class=\"keyword\">or</span> std::multimap&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; information. Works <span class=\"keyword\">for</span> std::multimap <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pmap &lt;map&gt; &lt;TtypeLeft&gt; &lt;TypeRight&gt; &lt;valLeft&gt; &lt;valRight&gt;: Prints map size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) <span class=\"keyword\">with</span> val(s)</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpmap m - prints map size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tpmap m int int - prints all elements <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">\tpmap m int int <span class=\"number\">20</span> - prints the element(s) <span class=\"keyword\">with</span> left-value = <span class=\"number\">20</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">\tpmap m int int <span class=\"number\">20</span> <span class=\"number\">200</span> - prints the element(s) <span class=\"keyword\">with</span> left-value = <span class=\"number\">20</span> <span class=\"keyword\">and</span> right-value = <span class=\"number\">200</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">define pmap_member</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pmap_member</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Map \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pmap &lt;variable_name&gt; &lt;left_element_type&gt; &lt;right_element_type&gt; to see the elements in the map.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">5</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp (*($arg1*)$value).$arg2</span><br><span class=\"line\">\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp (*($arg3*)$value).$arg4</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">6</span></span><br><span class=\"line\">\t\t\tset $idx = $arg5</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp (*($arg1*)$value).$arg2</span><br><span class=\"line\">\t\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp (*($arg3*)$value).$arg4</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Map size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pmap_member</span><br><span class=\"line\">\tPrints std::map&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; <span class=\"keyword\">or</span> std::multimap&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; information. Works <span class=\"keyword\">for</span> std::multimap <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pmap &lt;map&gt; &lt;TtypeLeft&gt; &lt;TypeRight&gt; &lt;valLeft&gt; &lt;valRight&gt;: Prints map size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) <span class=\"keyword\">with</span> val(s)</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpmap_member m class1 member1 class2 member2 - prints class1.member1 : class2.member2</span><br><span class=\"line\">\tpmap_member m class1 member1 class2 member2 lvalue - prints class1.member1 : class2.member2 where class1 == lvalue</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::set and std::multiset</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pset</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pset</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Set \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pset &lt;variable_name&gt; &lt;element_type&gt; to see the elements in the set.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\tset $idx = $arg2</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Set size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pset</span><br><span class=\"line\">\tPrints std::set&lt;T&gt; <span class=\"keyword\">or</span> std::multiset&lt;T&gt; information. Works <span class=\"keyword\">for</span> std::multiset <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pset &lt;set&gt; &lt;T&gt; &lt;val&gt;: Prints set size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) having val</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpset s - prints set size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tpset s int - prints all elements <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">\tpset s int <span class=\"number\">20</span> - prints the element(s) <span class=\"keyword\">with</span> value = <span class=\"number\">20</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::dequeue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pdequeue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pdequeue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $start_last = $arg0._M_impl._M_start._M_last</span><br><span class=\"line\">\t\tset $start_stop = $start_last</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $start_cur != $start_stop</span><br><span class=\"line\">\t\t\tp *$start_cur</span><br><span class=\"line\">\t\t\tset $start_cur++</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tset $finish_first = $arg0._M_impl._M_finish._M_first</span><br><span class=\"line\">\t\tset $finish_cur = $arg0._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $finish_last = $arg0._M_impl._M_finish._M_last</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $finish_cur &lt; $finish_last</span><br><span class=\"line\">\t\t\tset $finish_stop = $finish_cur</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tset $finish_stop = $finish_last</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $finish_first != $finish_stop</span><br><span class=\"line\">\t\t\tp *$finish_first</span><br><span class=\"line\">\t\t\tset $finish_first++</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Dequeue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pdequeue</span><br><span class=\"line\">\tPrints std::dequeue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pdequeue &lt;dequeue&gt;: Prints dequeue size, <span class=\"keyword\">if</span> T defined all elements</span><br><span class=\"line\">\tDeque elements are listed <span class=\"string\">\"left to right\"</span> (left-most stands <span class=\"keyword\">for</span> front <span class=\"keyword\">and</span> right-most stands <span class=\"keyword\">for</span> back)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpdequeue d - prints all elements <span class=\"keyword\">and</span> size of d</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::stack</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pstack</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pstack</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $size = $finish_cur - $start_cur</span><br><span class=\"line\">        set $i = $size - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> $i &gt;= <span class=\"number\">0</span></span><br><span class=\"line\">            p *($start_cur + $i)</span><br><span class=\"line\">            set $i--</span><br><span class=\"line\">        end</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Stack size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pstack</span><br><span class=\"line\">\tPrints std::stack&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pstack &lt;stack&gt;: Prints all elements <span class=\"keyword\">and</span> size of the stack</span><br><span class=\"line\">\tStack elements are listed <span class=\"string\">\"top to buttom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpstack s - prints all elements <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::queue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pqueue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pqueue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $size = $finish_cur - $start_cur</span><br><span class=\"line\">        set $i = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> $i &lt; $size</span><br><span class=\"line\">            p *($start_cur + $i)</span><br><span class=\"line\">            set $i++</span><br><span class=\"line\">        end</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Queue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pqueue</span><br><span class=\"line\">\tPrints std::queue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pqueue &lt;queue&gt;: Prints all elements <span class=\"keyword\">and</span> the size of the queue</span><br><span class=\"line\">\tQueue elements are listed <span class=\"string\">\"top to bottom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpqueue q - prints all elements <span class=\"keyword\">and</span> the size of q</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::priority_queue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define ppqueue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp ppqueue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = $arg0.c._M_impl._M_finish - $arg0.c._M_impl._M_start</span><br><span class=\"line\">\t\tset $capacity = $arg0.c._M_impl._M_end_of_storage - $arg0.c._M_impl._M_start</span><br><span class=\"line\">\t\tset $i = $size - <span class=\"number\">1</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &gt;= <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\tp *($arg0.c._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i--</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Priority queue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Priority queue capacity = %u\\n\"</span>, $capacity</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document ppqueue</span><br><span class=\"line\">\tPrints std::priority_queue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: ppqueue &lt;priority_queue&gt;: Prints all elements, size <span class=\"keyword\">and</span> capacity of the priority_queue</span><br><span class=\"line\">\tPriority_queue elements are listed <span class=\"string\">\"top to buttom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tppqueue pq - prints all elements, size <span class=\"keyword\">and</span> capacity of pq</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::bitset</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pbitset</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pbitset</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">        p /t $arg0._M_w</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pbitset</span><br><span class=\"line\">\tPrints std::bitset&lt;n&gt; information.</span><br><span class=\"line\">\tSyntax: pbitset &lt;bitset&gt;: Prints all bits <span class=\"keyword\">in</span> bitset</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpbitset b - prints all bits <span class=\"keyword\">in</span> b</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::string</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pstring</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pstring</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String \\t\\t\\t= \\\"%s\\\"\\n\"</span>, $arg0._M_data()</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String size/length \\t= %u\\n\"</span>, $arg0._M_rep()._M_length</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String capacity \\t= %u\\n\"</span>, $arg0._M_rep()._M_capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String ref-count \\t= %d\\n\"</span>, $arg0._M_rep()._M_refcount</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pstring</span><br><span class=\"line\">\tPrints std::string information.</span><br><span class=\"line\">\tSyntax: pstring &lt;string&gt;</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpstring s - Prints content, size/length, capacity <span class=\"keyword\">and</span> ref-count of string s</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::wstring</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pwstring</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pwstring</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tcall printf(<span class=\"string\">\"WString \\t\\t= \\\"%ls\\\"\\n\"</span>, $arg0._M_data())</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString size/length \\t= %u\\n\"</span>, $arg0._M_rep()._M_length</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString capacity \\t= %u\\n\"</span>, $arg0._M_rep()._M_capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString ref-count \\t= %d\\n\"</span>, $arg0._M_rep()._M_refcount</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pwstring</span><br><span class=\"line\">\tPrints std::wstring information.</span><br><span class=\"line\">\tSyntax: pwstring &lt;wstring&gt;</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpwstring s - Prints content, size/length, capacity <span class=\"keyword\">and</span> ref-count of wstring s</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># C++ related beautifiers (optional)</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">set <span class=\"keyword\">print</span> pretty on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> object on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> static-members on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> vtbl on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> demangle on</span><br><span class=\"line\">set demangle-style gnu-v3</span><br><span class=\"line\">set <span class=\"keyword\">print</span> sevenbit-strings off</span><br></pre></td></tr></table></figure>\n<h4 id=\"gdb-testing-example\"><a href=\"#gdb-testing-example\" class=\"headerlink\" title=\"gdb testing example\"></a><code>gdb</code> testing example</h4><p><strong>example code</strong></p>\n   <figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  vector_test.cc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Create a vector containing integers</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; v = &#123;<span class=\"number\">7</span>, <span class=\"number\">5</span>, <span class=\"number\">16</span>, <span class=\"number\">8</span>&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// Add two more integers to vector</span></span><br><span class=\"line\">    v.push_back(<span class=\"number\">25</span>);</span><br><span class=\"line\">    v.push_back(<span class=\"number\">13</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// Iterate and print values of vector</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> n : v) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; n &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>compile it and debug using </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">g++ vector_test.cc -std=c++11 -g</span><br><span class=\"line\">gdb a.out</span><br></pre></td></tr></table></figure>\n<p><strong><code>gdb</code> console</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(gdb) b 9</span><br><span class=\"line\">(gdb) layout src\t\t<span class=\"comment\"># set source code layout(TUI mode)</span></span><br><span class=\"line\">(gdb) r</span><br><span class=\"line\">(gdb) pvector v\t\t\t<span class=\"comment\"># print all the vector elements</span></span><br><span class=\"line\">(gdb) n</span><br><span class=\"line\">(gdb) n</span><br><span class=\"line\">(gdb) pvector v 4 5      <span class=\"comment\"># check v[4] v[5]</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>After I upgraded <code>gcc</code> from <em>version of 4.4.7</em> to <em>version of 7.4.0</em> on <strong>CentOS 6.5</strong>, some ridiculous bugs happened when I linked my project to <code>gtest</code>. So I rebuilt <code>gtest</code> using the newer <code>gcc</code>, however, bugs remained. In the end, I found that <code>cmake</code> did not use the newer <code>gcc</code> when I was typing <code>cmake ..</code> command, I guessed that was the key. </p>","more":"<h3 id=\"How-to-upgrade-gcc-to-a-newer-version\"><a href=\"#How-to-upgrade-gcc-to-a-newer-version\" class=\"headerlink\" title=\"How to upgrade gcc to a newer version\"></a>How to upgrade <code>gcc</code> to a newer version</h3><h4 id=\"install-development-tools\"><a href=\"#install-development-tools\" class=\"headerlink\" title=\"install development tools\"></a>install development tools</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum groupinstall <span class=\"string\">\"Development Tools\"</span></span><br><span class=\"line\">yum install glibc-static libstdc++-static</span><br></pre></td></tr></table></figure>\n<h4 id=\"download-gcc-package\"><a href=\"#download-gcc-package\" class=\"headerlink\" title=\"download gcc package\"></a>download <code>gcc</code> package</h4><p><code>http://mirror.hust.edu.cn/gnu/gcc/</code> turned out to be the most fastest mirror in China. </p>\n<h4 id=\"build-gcc\"><a href=\"#build-gcc\" class=\"headerlink\" title=\"build gcc\"></a>build <code>gcc</code></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -Jxvf gcc-7.4.0.tar.xz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> gcc-7.4.0</span><br><span class=\"line\">./contrib/download_prerequisits</span><br><span class=\"line\">mkdir BUILD</span><br><span class=\"line\"><span class=\"built_in\">cd</span> BUILD</span><br><span class=\"line\">../configure --<span class=\"built_in\">enable</span>-checking=release --<span class=\"built_in\">enable</span>-languages=c,c++ --<span class=\"built_in\">disable</span>-multilib</span><br><span class=\"line\">make -j4</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n<p>Note that <code>./contrib/download_prerequisits</code> will download 4 packages:</p>\n<ul>\n<li><p>mpc-1.0.3.tar.gc</p>\n</li>\n<li><p>mpfr-3.1.4.tar.bz2</p>\n</li>\n<li><p>gmp-6.1.9.tar.bz2</p>\n</li>\n<li><p>isl-0.16.1.tar.bz2</p>\n</li>\n</ul>\n<h4 id=\"new-feature-support-testing\"><a href=\"#new-feature-support-testing\" class=\"headerlink\" title=\"new feature support testing\"></a>new feature support testing</h4><p>v7.4.0 support c++17, here is a sample from <a href=\"https://en.cppreference.com/w/cpp/utility/any\" target=\"_blank\" rel=\"noopener\">cppreference</a>.</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// cpp17_any.cc</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;any&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">std</span>::boolalpha;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// any type</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::any a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">int</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    a = <span class=\"number\">3.14</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">double</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    a = <span class=\"literal\">true</span>;</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">\": \"</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">bool</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// bad cast</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        a = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">float</span>&gt;(a) &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">catch</span> (<span class=\"keyword\">const</span> <span class=\"built_in\">std</span>::bad_any_cast&amp; e)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; e.what() &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// has value</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (a.has_value())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; a.type().name() &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// reset</span></span><br><span class=\"line\">    a.reset();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!a.has_value())</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">\"no value\\n\"</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// pointer to contained data</span></span><br><span class=\"line\">    a = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span>* i = <span class=\"built_in\">std</span>::any_cast&lt;<span class=\"keyword\">int</span>&gt;(&amp;a);</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; *i &lt;&lt; <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">g++ cpp17_any.cc -std=c++17</span><br><span class=\"line\">./a.out</span><br></pre></td></tr></table></figure>\n<p>It would raise linking errors for libraries compatibility. </p>\n<h4 id=\"update-the-system-newergcc-linker\"><a href=\"#update-the-system-newergcc-linker\" class=\"headerlink\" title=\"update the  system newergcc linker\"></a>update the  system newer<code>gcc</code> linker</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">find . -name *libstdc++* <span class=\"comment\"># find the newer lib</span></span><br><span class=\"line\">strings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep <span class=\"string\">'CXXABI'</span> </span><br><span class=\"line\">strings ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 | grep <span class=\"string\">'GLIBCXX'</span></span><br><span class=\"line\">sudo cp  ./prev-x86_64-pc-linux-gnu/libstdc++-v3/src/.libs/libstdc++.so.6.0.24 /usr/lib64/</span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6.0.24 | grep <span class=\"string\">'GLIBCXX'</span> <span class=\"comment\"># check lib</span></span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6.0.24 | grep <span class=\"string\">'CXXABI'</span> </span><br><span class=\"line\">sudo rm /usr/lib64/libstdc++.so.6</span><br><span class=\"line\">sudo ln -s /usr/lib64/libstdc++.so.6.0.24 /usr/lib64/libstdc++.so.6</span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6 | grep <span class=\"string\">'CXXABI'</span> <span class=\"comment\"># check lib</span></span><br><span class=\"line\">strings /usr/lib64/libstdc++.so.6 | grep <span class=\"string\">'GLIBCXX'</span></span><br></pre></td></tr></table></figure>\n<p>compile and run  again the output would be:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i: 1</span><br><span class=\"line\">d: 3.14</span><br><span class=\"line\">b: <span class=\"literal\">true</span></span><br><span class=\"line\">bad any_cast</span><br><span class=\"line\">i</span><br><span class=\"line\">no value</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n<p>Note that <code>gdb</code> would not be compatible for the newer <code>gcc</code>, you should upgrade it too.</p>\n<h3 id=\"How-to-specify-the-newer-version-gccfor-cmake\"><a href=\"#How-to-specify-the-newer-version-gccfor-cmake\" class=\"headerlink\" title=\"How to specify the newer version gccfor cmake\"></a>How to specify the newer version <code>gcc</code>for <code>cmake</code></h3><h4 id=\"bad-approach\"><a href=\"#bad-approach\" class=\"headerlink\" title=\"bad approach\"></a>bad approach</h4><p>For the sake of specify the newer version of <code>gcc</code>, I tried to modify the <strong>CMakeList.txt</strong> by adding some like the following:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER <span class=\"string\">\"/usr/local/bin/gcc\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER <span class=\"string\">\"/usr/local/bin/g++\"</span>)</span><br></pre></td></tr></table></figure>\n<p>which reminds me it is a bad idea, even though I had backed up a copy.</p>\n<h4 id=\"ideal-approach\"><a href=\"#ideal-approach\" class=\"headerlink\" title=\"ideal approach\"></a>ideal approach</h4><p>BUT, <code>export</code> is <a href=\"https://stackoverflow.com/questions/17275348/how-to-specify-new-gcc-path-for-cmake\" target=\"_blank\" rel=\"noopener\">a ideal approach</a>. that is exporting system variables of <code>CXX</code> and <code>CC</code> to CMakes cache before <code>cmake</code>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> CC=/usr/<span class=\"built_in\">local</span>/bin/gcc </span><br><span class=\"line\"><span class=\"built_in\">export</span> CXX=/usr/<span class=\"built_in\">local</span>/bin/g++</span><br></pre></td></tr></table></figure>\n<p>The export only needs to be done once, the first time you configure  the project, then those values will be read from the CMake cache.</p>\n<h4 id=\"reasonable-explaination\"><a href=\"#reasonable-explaination\" class=\"headerlink\" title=\"reasonable explaination\"></a>reasonable explaination</h4><p>I recommend against overriding the <code>CMAKE_C(XX)_COMPILER</code>  value for two main reasons: because it wont play well with CMakes  cache and because it breaks compiler checks and tooling detection.</p>\n<p>When using the <code>set</code> command, you have three options: </p>\n<ul>\n<li>without cache, to create a normal variable</li>\n<li>with cache, to create a cached variable</li>\n<li>force cache, to always force the cache value when configuring</li>\n</ul>\n<p>Lets see what happens for the three possible calls to <code>set</code>:</p>\n<p><strong>Without cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++)</span><br></pre></td></tr></table></figure>\n<p>When doing this, you create a normal variable <code>CMAKE_C(XX)_COMPILER</code>  that hides the cache variable of the same name. That means your  compiler is now hard-coded in your build script and you cannot give it a  custom value. This will be a problem if you have multiple build  environments with different compilers. You could just update your script  each time you want to use a different compiler, but that removes the  value of using CMake in the first place.</p>\n<p>Ok, then, lets update the cache</p>\n<p><strong>With cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH <span class=\"string\">\"\"</span>)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH <span class=\"string\">\"\"</span>)</span><br></pre></td></tr></table></figure>\n<p>This version will just not work. The <code>CMAKE_C(XX)_COMPILER</code> variable is already in the cache, so it wont get updated unless you force it.</p>\n<p>Ah lets use the force, then</p>\n<p><strong>Force cache</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_C_COMPILER /usr/bin/clang CACHE PATH <span class=\"string\">\"\"</span> FORCE)</span><br><span class=\"line\"><span class=\"built_in\">set</span>(CMAKE_CXX_COMPILER /usr/bin/clang++ CACHE PATH <span class=\"string\">\"\"</span> FORCE)</span><br></pre></td></tr></table></figure>\n<p>This is almost the same as the normal variable version, the only  difference is your value will be set in the cache, so users can see it.  But any change will be overwritten by the <code>set</code> command.</p>\n<p><strong>Breaking compiler checks and tooling</strong></p>\n<p>Early in the configuration process, CMake performs checks on the  compiler: Does it work? Is it able to produce executables? etc. It also  uses the compiler to detect related tools, like <code>ar</code> and <code>ranlib</code>. When you override the compiler value in a script, its too late, all checks and detections are already done.</p>\n<p>For instance, on my machine with gcc as default compiler, when using the <code>set</code> command to <code>/usr/bin/clang</code>, <code>ar</code> is set to <code>/usr/bin/gcc-ar-7</code>. When using an export before running CMake it is set to <code>/usr/lib/llvm-3.8/bin/llvm-ar</code>.</p>\n<h3 id=\"How-to-upgrade-gdb\"><a href=\"#How-to-upgrade-gdb\" class=\"headerlink\" title=\"How to upgrade gdb\"></a>How to upgrade <code>gdb</code></h3><h4 id=\"download-the-newest-version-of-gdb\"><a href=\"#download-the-newest-version-of-gdb\" class=\"headerlink\" title=\"download the newest version of gdb\"></a>download the newest version of <code>gdb</code></h4><p><code>http://mirror.hust.edu.cn/gnu/gdb/</code></p>\n<h4 id=\"specify-the-newer-gcc-version-to-build\"><a href=\"#specify-the-newer-gcc-version-to-build\" class=\"headerlink\" title=\"specify the newer gcc version to build\"></a>specify the newer <code>gcc</code> version to build</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir BUILD &amp; <span class=\"built_in\">cd</span> BUILD/</span><br><span class=\"line\"><span class=\"built_in\">export</span> CC=/usr/<span class=\"built_in\">local</span>/bin/gcc</span><br><span class=\"line\"><span class=\"built_in\">export</span> CXX=/usr/<span class=\"built_in\">local</span>/bin/g++</span><br></pre></td></tr></table></figure>\n<h4 id=\"make-it-support-TUI\"><a href=\"#make-it-support-TUI\" class=\"headerlink\" title=\"make it support TUI\"></a>make it support TUI</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">../configure --<span class=\"built_in\">enable</span>-tui --with-python=yes</span><br><span class=\"line\">make -j8</span><br><span class=\"line\">sudo make install</span><br></pre></td></tr></table></figure>\n<h4 id=\"make-it-support-STL-pretty-print-message\"><a href=\"#make-it-support-STL-pretty-print-message\" class=\"headerlink\" title=\"make it support STL pretty print message\"></a>make it support STL pretty print message</h4><p><strong>copy the following script to local with name like <code>.gdbinit</code></strong> </p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#                                                                                                        </span></span><br><span class=\"line\"><span class=\"comment\">#   STL GDB evaluators/views/utilities - 1.03</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The new GDB commands:                                                         </span></span><br><span class=\"line\"><span class=\"comment\"># \t    are entirely non instrumental                                             </span></span><br><span class=\"line\"><span class=\"comment\"># \t    do not depend on any \"inline\"(s) - e.g. size(), [], etc</span></span><br><span class=\"line\"><span class=\"comment\">#       are extremely tolerant to debugger settings</span></span><br><span class=\"line\"><span class=\"comment\">#                                                                                 </span></span><br><span class=\"line\"><span class=\"comment\">#   This file should be \"included\" in .gdbinit as following:</span></span><br><span class=\"line\"><span class=\"comment\">#   source stl-views.gdb or just paste it into your .gdbinit file</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The following STL containers are currently supported:</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#       std::vector&lt;T&gt; -- via pvector command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::list&lt;T&gt; -- via plist or plist_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::map&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::multimap&lt;T,T&gt; -- via pmap or pmap_member command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::set&lt;T&gt; -- via pset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::multiset&lt;T&gt; -- via pset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::deque&lt;T&gt; -- via pdequeue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::stack&lt;T&gt; -- via pstack command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::queue&lt;T&gt; -- via pqueue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::priority_queue&lt;T&gt; -- via ppqueue command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::bitset&lt;n&gt; -- via pbitset command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::string -- via pstring command</span></span><br><span class=\"line\"><span class=\"comment\">#       std::widestring -- via pwstring command</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   The end of this file contains (optional) C++ beautifiers</span></span><br><span class=\"line\"><span class=\"comment\">#   Make sure your debugger supports $argc</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   Simple GDB Macros writen by Dan Marinescu (H-PhD) - License GPL</span></span><br><span class=\"line\"><span class=\"comment\">#   Inspired by intial work of Tom Malnar, </span></span><br><span class=\"line\"><span class=\"comment\">#     Tony Novac (PhD) / Cornell / Stanford,</span></span><br><span class=\"line\"><span class=\"comment\">#     Gilad Mishne (PhD) and Many Many Others.</span></span><br><span class=\"line\"><span class=\"comment\">#   Contact: dan_c_marinescu@yahoo.com (Subject: STL)</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#   Modified to work with g++ 4.3 by Anders Elton</span></span><br><span class=\"line\"><span class=\"comment\">#   Also added _member functions, that instead of printing the entire class in map, prints a member.</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::vector&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pvector</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pvector</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = $arg0._M_impl._M_finish - $arg0._M_impl._M_start</span><br><span class=\"line\">\t\tset $capacity = $arg0._M_impl._M_end_of_storage - $arg0._M_impl._M_start</span><br><span class=\"line\">\t\tset $size_max = $size - <span class=\"number\">1</span></span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &lt; $size</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\tset $idx = $arg1</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $idx &lt; <span class=\"number\">0</span> || $idx &gt; $size_max</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"idx1, idx2 are not in acceptable range: [0..%u].\\n\"</span>, $size_max</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $idx</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $idx)</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t  set $start_idx = $arg1</span><br><span class=\"line\">\t  set $stop_idx = $arg2</span><br><span class=\"line\">\t  <span class=\"keyword\">if</span> $start_idx &gt; $stop_idx</span><br><span class=\"line\">\t    set $tmp_idx = $start_idx</span><br><span class=\"line\">\t    set $start_idx = $stop_idx</span><br><span class=\"line\">\t    set $stop_idx = $tmp_idx</span><br><span class=\"line\">\t  end</span><br><span class=\"line\">\t  <span class=\"keyword\">if</span> $start_idx &lt; <span class=\"number\">0</span> || $stop_idx &lt; <span class=\"number\">0</span> || $start_idx &gt; $size_max || $stop_idx &gt; $size_max</span><br><span class=\"line\">\t    printf <span class=\"string\">\"idx1, idx2 are not in acceptable range: [0..%u].\\n\"</span>, $size_max</span><br><span class=\"line\">\t  <span class=\"keyword\">else</span></span><br><span class=\"line\">\t    set $i = $start_idx</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &lt;= $stop_idx</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\tp *($arg0._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t  end</span><br><span class=\"line\">\tend</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc &gt; <span class=\"number\">0</span></span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Vector size = %u\\n\"</span>, $size</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Vector capacity = %u\\n\"</span>, $capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Element \"</span></span><br><span class=\"line\">\t\twhatis $arg0._M_impl._M_start</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pvector</span><br><span class=\"line\">\tPrints std::vector&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pvector &lt;vector&gt; &lt;idx1&gt; &lt;idx2&gt;</span><br><span class=\"line\">\tNote: idx, idx1 <span class=\"keyword\">and</span> idx2 must be <span class=\"keyword\">in</span> acceptable range [<span class=\"number\">0.</span>.&lt;vector&gt;.size()<span class=\"number\">-1</span>].</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpvector v - Prints vector content, size, capacity <span class=\"keyword\">and</span> T typedef</span><br><span class=\"line\">\tpvector v <span class=\"number\">0</span> - Prints element[idx] <span class=\"keyword\">from</span> vector</span><br><span class=\"line\">\tpvector v <span class=\"number\">1</span> <span class=\"number\">2</span> - Prints elements <span class=\"keyword\">in</span> range [idx1..idx2] <span class=\"keyword\">from</span> vector</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::list&lt;&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define plist</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp plist</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $head = &amp;$arg0._M_impl._M_node</span><br><span class=\"line\">\t\tset $current = $arg0._M_impl._M_node._M_next</span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $current != $head</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\tp *($arg1*)($current + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $size == $arg2</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)($current + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tset $current = $current._M_next</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"List size = %u \\n\"</span>, $size</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"List \"</span></span><br><span class=\"line\">\t\t\twhatis $arg0</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use plist &lt;variable_name&gt; &lt;element_type&gt; to see the elements in the list.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document plist</span><br><span class=\"line\">\tPrints std::list&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: plist &lt;list&gt; &lt;T&gt; &lt;idx&gt;: Prints list size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element at idx</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tplist l - prints list size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tplist l int - prints all elements <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">\tplist l int <span class=\"number\">2</span> - prints the third element <span class=\"keyword\">in</span> the list (<span class=\"keyword\">if</span> exists) <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">define plist_member</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp plist_member</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $head = &amp;$arg0._M_impl._M_node</span><br><span class=\"line\">\t\tset $current = $arg0._M_impl._M_node._M_next</span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $current != $head</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\tp (*($arg1*)($current + <span class=\"number\">1</span>)).$arg2</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">4</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $size == $arg3</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $size</span><br><span class=\"line\">\t\t\t\t\tp (*($arg1*)($current + <span class=\"number\">1</span>)).$arg2</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tset $current = $current._M_next</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"List size = %u \\n\"</span>, $size</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"List \"</span></span><br><span class=\"line\">\t\t\twhatis $arg0</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use plist_member &lt;variable_name&gt; &lt;element_type&gt; &lt;member&gt; to see the elements in the list.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document plist_member</span><br><span class=\"line\">\tPrints std::list&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: plist &lt;list&gt; &lt;T&gt; &lt;idx&gt;: Prints list size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element at idx</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tplist_member l int member - prints all elements <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">\tplist_member l int member <span class=\"number\">2</span> - prints the third element <span class=\"keyword\">in</span> the list (<span class=\"keyword\">if</span> exists) <span class=\"keyword\">and</span> list size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::map and std::multimap</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pmap</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pmap</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Map \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pmap &lt;variable_name&gt; &lt;left_element_type&gt; &lt;right_element_type&gt; to see the elements in the map.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg2*)$value</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">4</span></span><br><span class=\"line\">\t\t\tset $idx = $arg3</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg2*)$value</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">5</span></span><br><span class=\"line\">\t\t\tset $idx1 = $arg3</span><br><span class=\"line\">\t\t\tset $idx2 = $arg4</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tset $valueLeft = *($arg1*)$value</span><br><span class=\"line\">\t\t\t\tset $valueRight = *($arg2*)($value + sizeof($arg1))</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $valueLeft == $idx1 &amp;&amp; $valueRight == $idx2</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp $valueLeft</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp $valueRight</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Map size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pmap</span><br><span class=\"line\">\tPrints std::map&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; <span class=\"keyword\">or</span> std::multimap&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; information. Works <span class=\"keyword\">for</span> std::multimap <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pmap &lt;map&gt; &lt;TtypeLeft&gt; &lt;TypeRight&gt; &lt;valLeft&gt; &lt;valRight&gt;: Prints map size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) <span class=\"keyword\">with</span> val(s)</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpmap m - prints map size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tpmap m int int - prints all elements <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">\tpmap m int int <span class=\"number\">20</span> - prints the element(s) <span class=\"keyword\">with</span> left-value = <span class=\"number\">20</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">\tpmap m int int <span class=\"number\">20</span> <span class=\"number\">200</span> - prints the element(s) <span class=\"keyword\">with</span> left-value = <span class=\"number\">20</span> <span class=\"keyword\">and</span> right-value = <span class=\"number\">200</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> map size</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">define pmap_member</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pmap_member</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Map \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pmap &lt;variable_name&gt; &lt;left_element_type&gt; &lt;right_element_type&gt; to see the elements in the map.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">5</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp (*($arg1*)$value).$arg2</span><br><span class=\"line\">\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp (*($arg3*)$value).$arg4</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">6</span></span><br><span class=\"line\">\t\t\tset $idx = $arg5</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].left: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp (*($arg1*)$value).$arg2</span><br><span class=\"line\">\t\t\t\t\tset $value = $value + sizeof($arg1)</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u].right: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp (*($arg3*)$value).$arg4</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Map size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pmap_member</span><br><span class=\"line\">\tPrints std::map&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; <span class=\"keyword\">or</span> std::multimap&lt;TLeft <span class=\"keyword\">and</span> TRight&gt; information. Works <span class=\"keyword\">for</span> std::multimap <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pmap &lt;map&gt; &lt;TtypeLeft&gt; &lt;TypeRight&gt; &lt;valLeft&gt; &lt;valRight&gt;: Prints map size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) <span class=\"keyword\">with</span> val(s)</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpmap_member m class1 member1 class2 member2 - prints class1.member1 : class2.member2</span><br><span class=\"line\">\tpmap_member m class1 member1 class2 member2 lvalue - prints class1.member1 : class2.member2 where class1 == lvalue</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::set and std::multiset</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pset</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pset</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $tree = $arg0</span><br><span class=\"line\">\t\tset $i = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $node = $tree._M_t._M_impl._M_header._M_left</span><br><span class=\"line\">\t\tset $end = $tree._M_t._M_impl._M_header</span><br><span class=\"line\">\t\tset $tree_size = $tree._M_t._M_impl._M_node_count</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">1</span></span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Set \"</span></span><br><span class=\"line\">\t\t\twhatis $tree</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Use pset &lt;variable_name&gt; &lt;element_type&gt; to see the elements in the set.\\n\"</span></span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">2</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">3</span></span><br><span class=\"line\">\t\t\tset $idx = $arg2</span><br><span class=\"line\">\t\t\tset $ElementsFound = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> $i &lt; $tree_size</span><br><span class=\"line\">\t\t\t\tset $value = (void *)($node + <span class=\"number\">1</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> *($arg1*)$value == $idx</span><br><span class=\"line\">\t\t\t\t\tprintf <span class=\"string\">\"elem[%u]: \"</span>, $i</span><br><span class=\"line\">\t\t\t\t\tp *($arg1*)$value</span><br><span class=\"line\">\t\t\t\t\tset $ElementsFound++</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\tset $node = $node._M_right</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node._M_left != <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\t\t\t\tset $node = $node._M_left</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\tset $tmp_node = $node._M_parent</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">while</span> $node == $tmp_node._M_right</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $tmp_node = $tmp_node._M_parent</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> $node._M_right != $tmp_node</span><br><span class=\"line\">\t\t\t\t\t\tset $node = $tmp_node</span><br><span class=\"line\">\t\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tend</span><br><span class=\"line\">\t\t\t\tset $i++</span><br><span class=\"line\">\t\t\tend</span><br><span class=\"line\">\t\t\tprintf <span class=\"string\">\"Number of elements found = %u\\n\"</span>, $ElementsFound</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Set size = %u\\n\"</span>, $tree_size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pset</span><br><span class=\"line\">\tPrints std::set&lt;T&gt; <span class=\"keyword\">or</span> std::multiset&lt;T&gt; information. Works <span class=\"keyword\">for</span> std::multiset <span class=\"keyword\">as</span> well.</span><br><span class=\"line\">\tSyntax: pset &lt;set&gt; &lt;T&gt; &lt;val&gt;: Prints set size, <span class=\"keyword\">if</span> T defined all elements <span class=\"keyword\">or</span> just element(s) having val</span><br><span class=\"line\">\tExamples:</span><br><span class=\"line\">\tpset s - prints set size <span class=\"keyword\">and</span> definition</span><br><span class=\"line\">\tpset s int - prints all elements <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">\tpset s int <span class=\"number\">20</span> - prints the element(s) <span class=\"keyword\">with</span> value = <span class=\"number\">20</span> (<span class=\"keyword\">if</span> any) <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::dequeue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pdequeue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pdequeue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = <span class=\"number\">0</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $start_last = $arg0._M_impl._M_start._M_last</span><br><span class=\"line\">\t\tset $start_stop = $start_last</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $start_cur != $start_stop</span><br><span class=\"line\">\t\t\tp *$start_cur</span><br><span class=\"line\">\t\t\tset $start_cur++</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tset $finish_first = $arg0._M_impl._M_finish._M_first</span><br><span class=\"line\">\t\tset $finish_cur = $arg0._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $finish_last = $arg0._M_impl._M_finish._M_last</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> $finish_cur &lt; $finish_last</span><br><span class=\"line\">\t\t\tset $finish_stop = $finish_cur</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tset $finish_stop = $finish_last</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $finish_first != $finish_stop</span><br><span class=\"line\">\t\t\tp *$finish_first</span><br><span class=\"line\">\t\t\tset $finish_first++</span><br><span class=\"line\">\t\t\tset $size++</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Dequeue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pdequeue</span><br><span class=\"line\">\tPrints std::dequeue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pdequeue &lt;dequeue&gt;: Prints dequeue size, <span class=\"keyword\">if</span> T defined all elements</span><br><span class=\"line\">\tDeque elements are listed <span class=\"string\">\"left to right\"</span> (left-most stands <span class=\"keyword\">for</span> front <span class=\"keyword\">and</span> right-most stands <span class=\"keyword\">for</span> back)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpdequeue d - prints all elements <span class=\"keyword\">and</span> size of d</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::stack</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pstack</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pstack</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $size = $finish_cur - $start_cur</span><br><span class=\"line\">        set $i = $size - <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> $i &gt;= <span class=\"number\">0</span></span><br><span class=\"line\">            p *($start_cur + $i)</span><br><span class=\"line\">            set $i--</span><br><span class=\"line\">        end</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Stack size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pstack</span><br><span class=\"line\">\tPrints std::stack&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pstack &lt;stack&gt;: Prints all elements <span class=\"keyword\">and</span> size of the stack</span><br><span class=\"line\">\tStack elements are listed <span class=\"string\">\"top to buttom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpstack s - prints all elements <span class=\"keyword\">and</span> the size of s</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::queue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pqueue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pqueue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $start_cur = $arg0.c._M_impl._M_start._M_cur</span><br><span class=\"line\">\t\tset $finish_cur = $arg0.c._M_impl._M_finish._M_cur</span><br><span class=\"line\">\t\tset $size = $finish_cur - $start_cur</span><br><span class=\"line\">        set $i = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> $i &lt; $size</span><br><span class=\"line\">            p *($start_cur + $i)</span><br><span class=\"line\">            set $i++</span><br><span class=\"line\">        end</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Queue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pqueue</span><br><span class=\"line\">\tPrints std::queue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: pqueue &lt;queue&gt;: Prints all elements <span class=\"keyword\">and</span> the size of the queue</span><br><span class=\"line\">\tQueue elements are listed <span class=\"string\">\"top to bottom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpqueue q - prints all elements <span class=\"keyword\">and</span> the size of q</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::priority_queue</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define ppqueue</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp ppqueue</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tset $size = $arg0.c._M_impl._M_finish - $arg0.c._M_impl._M_start</span><br><span class=\"line\">\t\tset $capacity = $arg0.c._M_impl._M_end_of_storage - $arg0.c._M_impl._M_start</span><br><span class=\"line\">\t\tset $i = $size - <span class=\"number\">1</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> $i &gt;= <span class=\"number\">0</span></span><br><span class=\"line\">\t\t\tp *($arg0.c._M_impl._M_start + $i)</span><br><span class=\"line\">\t\t\tset $i--</span><br><span class=\"line\">\t\tend</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Priority queue size = %u\\n\"</span>, $size</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"Priority queue capacity = %u\\n\"</span>, $capacity</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document ppqueue</span><br><span class=\"line\">\tPrints std::priority_queue&lt;T&gt; information.</span><br><span class=\"line\">\tSyntax: ppqueue &lt;priority_queue&gt;: Prints all elements, size <span class=\"keyword\">and</span> capacity of the priority_queue</span><br><span class=\"line\">\tPriority_queue elements are listed <span class=\"string\">\"top to buttom\"</span> (top-most element <span class=\"keyword\">is</span> the first to come on pop)</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tppqueue pq - prints all elements, size <span class=\"keyword\">and</span> capacity of pq</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::bitset</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pbitset</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pbitset</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">        p /t $arg0._M_w</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pbitset</span><br><span class=\"line\">\tPrints std::bitset&lt;n&gt; information.</span><br><span class=\"line\">\tSyntax: pbitset &lt;bitset&gt;: Prints all bits <span class=\"keyword\">in</span> bitset</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpbitset b - prints all bits <span class=\"keyword\">in</span> b</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::string</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pstring</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pstring</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String \\t\\t\\t= \\\"%s\\\"\\n\"</span>, $arg0._M_data()</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String size/length \\t= %u\\n\"</span>, $arg0._M_rep()._M_length</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String capacity \\t= %u\\n\"</span>, $arg0._M_rep()._M_capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"String ref-count \\t= %d\\n\"</span>, $arg0._M_rep()._M_refcount</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pstring</span><br><span class=\"line\">\tPrints std::string information.</span><br><span class=\"line\">\tSyntax: pstring &lt;string&gt;</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpstring s - Prints content, size/length, capacity <span class=\"keyword\">and</span> ref-count of string s</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># std::wstring</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">define pwstring</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> $argc == <span class=\"number\">0</span></span><br><span class=\"line\">\t\thelp pwstring</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\tcall printf(<span class=\"string\">\"WString \\t\\t= \\\"%ls\\\"\\n\"</span>, $arg0._M_data())</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString size/length \\t= %u\\n\"</span>, $arg0._M_rep()._M_length</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString capacity \\t= %u\\n\"</span>, $arg0._M_rep()._M_capacity</span><br><span class=\"line\">\t\tprintf <span class=\"string\">\"WString ref-count \\t= %d\\n\"</span>, $arg0._M_rep()._M_refcount</span><br><span class=\"line\">\tend</span><br><span class=\"line\">end</span><br><span class=\"line\"></span><br><span class=\"line\">document pwstring</span><br><span class=\"line\">\tPrints std::wstring information.</span><br><span class=\"line\">\tSyntax: pwstring &lt;wstring&gt;</span><br><span class=\"line\">\tExample:</span><br><span class=\"line\">\tpwstring s - Prints content, size/length, capacity <span class=\"keyword\">and</span> ref-count of wstring s</span><br><span class=\"line\">end </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># C++ related beautifiers (optional)</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\">set <span class=\"keyword\">print</span> pretty on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> object on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> static-members on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> vtbl on</span><br><span class=\"line\">set <span class=\"keyword\">print</span> demangle on</span><br><span class=\"line\">set demangle-style gnu-v3</span><br><span class=\"line\">set <span class=\"keyword\">print</span> sevenbit-strings off</span><br></pre></td></tr></table></figure>\n<h4 id=\"gdb-testing-example\"><a href=\"#gdb-testing-example\" class=\"headerlink\" title=\"gdb testing example\"></a><code>gdb</code> testing example</h4><p><strong>example code</strong></p>\n   <figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">///  vector_test.cc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Create a vector containing integers</span></span><br><span class=\"line\">    <span class=\"built_in\">std</span>::<span class=\"built_in\">vector</span>&lt;<span class=\"keyword\">int</span>&gt; v = &#123;<span class=\"number\">7</span>, <span class=\"number\">5</span>, <span class=\"number\">16</span>, <span class=\"number\">8</span>&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// Add two more integers to vector</span></span><br><span class=\"line\">    v.push_back(<span class=\"number\">25</span>);</span><br><span class=\"line\">    v.push_back(<span class=\"number\">13</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// Iterate and print values of vector</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> n : v) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">std</span>::<span class=\"built_in\">cout</span> &lt;&lt; n &lt;&lt; <span class=\"string\">'\\n'</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>compile it and debug using </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">g++ vector_test.cc -std=c++11 -g</span><br><span class=\"line\">gdb a.out</span><br></pre></td></tr></table></figure>\n<p><strong><code>gdb</code> console</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(gdb) b 9</span><br><span class=\"line\">(gdb) layout src\t\t<span class=\"comment\"># set source code layout(TUI mode)</span></span><br><span class=\"line\">(gdb) r</span><br><span class=\"line\">(gdb) pvector v\t\t\t<span class=\"comment\"># print all the vector elements</span></span><br><span class=\"line\">(gdb) n</span><br><span class=\"line\">(gdb) n</span><br><span class=\"line\">(gdb) pvector v 4 5      <span class=\"comment\"># check v[4] v[5]</span></span><br></pre></td></tr></table></figure>"},{"title":"[translation] High-Performance Server Architecture","date":"2019-01-28T15:31:59.000Z","description":"A translation access to techs article(unfinished).","keywords":["High-Performance","Server Architecture"],"toc":true,"_content":"\n## High-Performance Server Architecture-Jeff Darcy\n\nThe purpose of this document is to share some ideas that I've  developed over the years about how to develop a certain kind of  application for which the term \"server\" is only a weak approximation.   More accurately, I'll be writing about a broad class of programs that  are designed to handle very large numbers of discrete messages or  requests per second. Network servers most commonly fit this definition,  but not all programs that do are really servers in any sense of the  word.  For the sake of simplicity, though, and because \"High-Performance  Request-Handling Programs\" is a really lousy title, we'll just say  \"server\" and be done with it.\n\n> \n>\n\n<!--more-->\n\nI will not be writing about \"mildly parallel\" applications, even  though multitasking within a single program is now commonplace.  The  browser you're using to read this probably does some things in parallel,  but such low levels of parallelism really don't introduce many  interesting challenges.  The interesting challenges occur when the  request-handling infrastructure itself is the limiting factor on overall  performance, so that improving the infrastructure actually improves  performance.  That's not often the case for a browser running on a  gigahertz processor with a gigabyte of memory doing six simultaneous  downloads over a DSL line.  The focus here is not on applications that  sip through a straw but on those that drink from a firehose, <u>on the very  edge of hardware capabilities where how you do it really does matter</u>.\n\n\n\n> (mildly parallel)GBGHzDSL6yunxi \n>\n\n\n\nSome people will inevitably take issue with some of my comments and  suggestions, or think they have an even better way.  Fine.  I'm not  trying to be the Voice of God here; these are just methods that I've  found to work for me, not only in terms of their effects on performance  but also in terms of their effects on the difficulty of debugging or  extending code later.  Your mileage may vary.  If something else works  better for you that's great, but be warned that almost everything I  suggest here exists as an alternative to something else that I tried  once only to be disgusted or horrified by the results.  <u>Your pet idea  might very well feature prominently in one of these stories</u>, and  innocent readers might be bored to death if you encourage me to start  telling them.  You wouldn't want to hurt them, would you?\n\n\n\n> (),,, \n>\n\n\n\nThe rest of this article is going to be centered around what I'll call the Four Horsemen of Poor Performance:\n\n1. Data copies\n2. Context switches\n3. Memory allocation\n4. Lock contention\n\n\n\n> \n>\n> 1. \n> 2. \n> 3. \n> 4. \n>\n\n\n\nThere will also be a catch-all section at the end, but these are the  biggest performance-killers.  If you can handle most requests without  copying data, without a context switch, without going through the memory  allocator and without contending for locks, you'll have a server that  performs well even if it gets some of the minor parts wrong.\n\n> ()\n>\n\n\n\nThis could be a very short section, for one very simple reason: most  people have learned this lesson already.  Everybody knows data copies  are bad; it's obvious, right?  Well, actually, it probably only seems  obvious because you learned it very early in your computing career, and  that only happened because somebody started putting out the word decades  ago.  I know that's true for me, but I digress.  Nowadays it's covered  in every school curriculum and in every informal how-to.  <u>Even the  marketing types have figured out that \"zero copy\" is a good buzzword.</u>\n\n> (how-to)\n>\n\n\n\nDespite the after-the-fact obviousness of copies being bad, though,  there still seem to be nuances that people miss.  The most important of  these is that data copies are often hidden and disguised.  Do you really  know whether any code you call in drivers or libraries does data  copies?  It's probably more than you think.  Guess what \"Programmed I/O\"  on a PC refers to.  An example of a copy that's disguised rather than  hidden is a hash function, which has all the memory-access cost of a  copy and also involves more computation.  <u>Once it's pointed out that  hashing is effectively \"copying plus\" it seems obvious that it should be  avoided</u>, but I know at least one group of brilliant people who had to  figure it out the hard way.  If you really want to get rid of data  copies, either because they really are hurting performance or because  you want to put \"zero-copy operation\" on your hacker-conference slides,  you'll need to track down a lot of things that really are data copies  but don't advertise themselves as such.\n\n> PCIOhashhashCPUhash\n>\n\n\n\nThe tried and true method for avoiding data copies is to use  indirection, and pass buffer descriptors (or chains of buffer  descriptors) around instead of mere buffer pointers.  Each descriptor  typically consists of the following:\n\n- A pointer and length for the whole buffer.\n- A pointer and length, or offset and length, for the part of the buffer that's actually filled.\n- Forward and back pointers to other buffer descriptors in a list.\n- A reference count.\n\n> \n>\n> - \n> - \n> - \n> - \n>\n\n\n\nNow, instead of copying a piece of data to make sure it stays in  memory, code can simply increment a reference count on the appropriate  buffer descriptor.  This can work extremely well under some conditions,  including the way that a typical network protocol stack operates, but it  can also become a really big headache.  Generally speaking, it's easy  to add buffers at the beginning or end of a chain, to add references to  whole buffers, and to deallocate a whole chain at once.  Adding in the  middle, deallocating piece by piece, or referring to partial buffers  will each make life increasingly difficult.  Trying to split or combine  buffers will simply drive you insane.\n\n> ()\n>\n\n\n\nI don't actually recommend using this approach for everything, though.  Why not?  Because it gets to be a *huge*  pain when you have to walk through descriptor chains every time you  want to look at a header field.  There really are worse things than data  copies.  I find that the best thing to do is to identify the large  objects in a program, such as data blocks, make sure *those* get allocated separately as described above so that they don't need to be copied, and not sweat too much about the other stuff.\n\n> ()()()\n>\n\n\n\nThis brings me to my last point about data copies: don't go overboard  avoiding them.  I've seen way too much code that avoids data copies by  doing something even worse, like forcing a context switch or breaking up  a large I/O request.  Data copies are expensive, and when you're  looking for places to avoid redundant operations they're one of the  first things you should look at, <u>but there is a point of diminishing  returns.  Combing through code and then making it twice as complicated  just to get rid of that last few data copies is usually a waste of time  that could be better spent in other ways.</u>\n\n> IO\n>\n\n\n\nWhereas everyone thinks it's obvious that data copies are bad, I'm  often surprised by how many people totally ignore the effect of context  switches on performance.  In my experience, context switches are  actually behind more total \"meltdowns\" at high load than data copies;  the system starts spending more time going from one thread to another  than it actually spends within any thread doing useful work.  The  amazing thing is that, at one level, it's totally obvious what causes  excessive context switching.  The #1 cause of context switches is having  more active threads than you have processors.  As the ratio of active  threads to processors increases, the number of context switches also  increases - linearly if you're lucky, but often exponentially.  This  very simple fact explains why multi-threaded designs that have one  thread per connection scale very poorly.  The only realistic alternative  for a scalable system is to limit the number of active threads so it's  (usually) less than or equal to the number of processors.  One popular  variant of this approach is to use only one thread, ever; while such an  approach does avoid context thrashing, and avoids the need for locking  as well, <u>it is also incapable of achieving more than one processor's  worth of total throughput and thus remains beneath contempt unless the  program will be non-CPU-bound (usually network-I/O-bound) anyway.</u>\n\n> (active)(processor)... \n>\n\n\n\nThe first thing that a \"thread-frugal\" program has to do is figure  out how it's going to make one thread handle multiple connections at  once.  This usually implies a front end that uses select/poll,  asynchronous I/O, signals or completion ports, with an event-driven  structure behind that.  Many \"religious wars\" have been fought, and  continue to be fought, over which of the various front-end APIs is best.   Dan Kegel's [C10K paper](http://www.kegel.com/c10k.html) is  a good resource is this area.  Personally, I think all flavors of  select/poll and signals are ugly hacks, and therefore favor either AIO  or completion ports, but it actually doesn't matter that much.  They all  - except maybe select() - work reasonably well, and don't really do  much to address the matter of what happens past the very outermost layer  of your program's front end.\n\n> select/pollIO[IOCP](https://en.wikipedia.org/wiki/Input/output_completion_port)(:)API [C10K paper](http://www.kegel.com/c10k.html) Dan Kegelselect/pollIOIOCP`select()`\n>\n\n\n\nThe simplest conceptual model of a multi-threaded event-driven server  has a queue at its center; requests are read by one or more \"listener\"  threads and put on queues, from which one or more \"worker\" threads will  remove and process them.  Conceptually, this is a good model, but all  too often people actually implement their code this way.  Why is this  wrong?  Because the #2 cause of context switches is transferring work  from one thread to another.  <u>Some people even compound the error by  requiring that the response to a request be sent by the original thread -  guaranteeing not one but two context switches per request</u>.  It's very  important to use a \"symmetric\" approach in which a given thread can go  from being a listener to a worker to a listener again without ever  changing context.  Whether this involves partitioning connections  between threads or having all threads take turns being listener for the  entire set of connections seems to matter a lot less.\n\n> <u></u> \n>\n\n\n\nUsually, it's not possible to know how many threads will be active  even one instant into the future.  After all, requests can come in on  any connection at any moment, or \"background\" threads dedicated to  various maintenance tasks could pick that moment to wake up.  If you  don't *know* how many threads are active, how can you *limit*  how many are active?  In my experience, one of the most effective  approaches is also one of the simplest: use an old-fashioned counting  semaphore which each thread must hold whenever it's doing \"real work\".   If the thread limit has already been reached then each listen-mode  thread might incur one extra context switch as it wakes up and then  blocks on the semaphore, but once all listen-mode threads have blocked  in this way they won't continue contending for resources until one of  the existing threads \"retires\" so the system effect is negligible.  More  importantly, this method handles maintenance threads - which sleep most  of the time and therefore dont' count against the active thread count -  more gracefully than most alternatives.\n\n> instance()gracefully\n>\n\n\n\nOnce the processing of requests has been broken up into two stages  (listener and worker) with multiple threads to service the stages, it's  natural to break up the processing even further into more than two  stages.  In its simplest form, processing a request thus becomes a  matter of invoking stages successively in one direction, and then in the  other (for replies).  However, things can get more complicated; a stage  might represent a \"fork\" between two processing paths which involve  different stages, or it might generate a reply (e.g. a cached value)  itself without invoking further stages.  Therefore, each stage needs to  be able to specify \"what should happen next\" for a request.  There are  three possibilities, represented by return values from the stage's  dispatch function:\n\n- <u>The request needs to be passed on to another stage (an ID or pointer in the return value).</u>\n- The request has been completed (a special \"request done\" return value)\n- The request was blocked (a special \"request blocked\" return value).   This is equivalent to the previous case, except that the request is not  freed and will be continued later from another thread.\n\n> ()()(dispatch)\n>\n> - (ID)\n> - ()\n> - ()\n>\n\n\n\nNote that, in this model, queuing of requests is done *within*  stages, not between stages.  This avoids the common silliness of  constantly putting a request on a successor stage's queue, then  immediately invoking that successor stage and dequeuing the request  again; I call that lots of queue activity - and locking - for nothing.\n\n> \n>\n\n\n\nIf this idea of separating a complex task into multiple smaller  communicating parts seems familiar, that's because it's actually very  old.  <u>My approach has its roots in the [Communicating Sequential Processes](http://www.afm.sbu.ac.uk/csp/)  concept elucidated by C.A.R. Hoare in 1978, based in turn on ideas from  Per Brinch Hansen and Matthew Conway going back to 1963 - before I was  born!</u>  However, when Hoare coined the term CSP he meant \"process\" in the  abstract mathematical sense, and a CSP process need bear no relation to  the operating-system entities of the same name.  In my opinion, the  common approach of implementing CSP via thread-like coroutines within a  single OS thread gives the user all of the headaches of concurrency with  none of the scalability.\n\n> \n>\n\n\n\nA contemporary example of the staged-execution idea <u>evolved in a saner direction is Matt Welsh's [SEDA](http://www.cs.berkeley.edu/~mdw/proj/seda/)</u>.   In fact, SEDA is such a good example of \"server architecture done  right\" that it's worth commenting on some of its specific  characteristics (especially where those differ from what I've outlined  above). \n\n1. SEDA's \"batching\" tends to emphasize processing multiple requests  through a stage at once, while my approach tends to emphasize processing  a single request through multiple stages at once.\n2. SEDA's one significant flaw, in my opinion, is that it allocates a  separate thread pool to each stage with only \"background\" reallocation  of threads between stages in response to load.  As a result, the #1 and  #2 causes of context switches noted above are still very much present.\n3. In the context of an academic research project, implementing SEDA in  Java might make sense.  In the real world, though, I think the choice  can be characterized as unfortunate.\n\n> ...\n>\n\n\n\nAllocating and freeing memory is one of the most common operations in  many applications.  Accordingly, many clever tricks have been developed  to make general-purpose memory allocators more efficient.  However, <u>no  amount of cleverness can make up for the fact that the very generality  of such allocators inevitably makes them far less efficient than the  alternatives in many cases</u>.  I therefore have three suggestions for how  to avoid the system memory allocator altogether.\n\n> ()\n>\n\nSuggestion #1 is simple preallocation.  We all know that static  allocation is bad when it imposes artificial limits on program  functionality, but there are many other forms of preallocation that can  be quite beneficial.  Usually the reason comes down to the fact that one  trip through the system memory allocator is better than several, even  when some memory is \"wasted\" in the process.  Thus, if it's possible to  assert that no more than N items could ever be in use at once,  preallocation at program startup might be a valid choice.  Even when  that's not the case, preallocating everything that a request handler  might need right at the beginning might be preferable to allocating each  piece as it's needed; aside from the possibility of allocating multiple  items contiguously in one trip through the system allocator, this often  greatly simplifies error-recovery code.  If memory is very tight then  preallocation might not be an option, but in all but the most extreme  circumstances it generally turns out to be a net win.\n\n> ()N()()\n>\n\n\n\nSuggestion #2 is to use lookaside lists for objects that are  allocated and freed frequently.  The basic idea is to put recently-freed  objects onto a list instead of actually freeing them, in the hope that  if they're needed again soon they need merely be taken off the list  instead of being allocated from system memory.  As an additional  benefit, transitions to/from a lookaside list can often be implemented  to skip complex object initialization/finalization.\n\n> (:oftenalways)(:)\n>\n\n\n\nIt's generally undesirable to have lookaside lists grow without  bound, never actually freeing anything even when your program is idle.   Therefore, it's usually necessary to have some sort of periodic  \"sweeper\" task to free inactive objects, but it would also be  undesirable if the sweeper introduced undue locking complexity or  contention.  A good compromise is therefore a system in which a  lookaside list actually consists of separately locked \"old\" and \"new\"  lists.  Allocation is done preferentially from the new list, then from  the old list, and from the system only as a last resort; objects are  always freed onto the new list.  The sweeper thread operates as follows:\n\n1. Lock both lists.\n2. Save the head for the old list.\n3. Make the (previously) new list into the old list by assigning list heads.\n4. Unlock.\n5. Free everything on the saved old list at leisure.\n\n> ()()\n>\n> 1. \n> 2. \n> 3. ()\n> 4. \n> 5. \n>\n\n\n\nObjects in this sort of system are only actually freed when they have  not been needed for at least one full sweeper interval, but always less  than two.  Most importantly, the sweeper does most of its work without  holding any locks to contend with regular threads.  In theory, the same  approach can be generalized to more than two stages, but I have yet to  find that useful.\n\n> \n>\n\n\n\nOne concern with using lookaside lists is that the list pointers  might increase object size.  In my experience, most of the objects that  I'd use lookaside lists for already contain list pointers anyway, so  it's kind of a moot point.  Even if the pointers were only needed for  the lookaside lists, though, the savings in terms of avoided trips  through the system memory allocator (and object initialization) would  more than make up for the extra memory.\n\n> ()\n>\n\n\n\nSuggestion #3 actually has to do with locking, which we haven't  discussed yet, but I'll toss it in anyway.  Lock contention is often the  biggest cost in allocating memory, even when lookaside lists are in  use.  One solution is to maintain multiple private lookaside lists, such  that there's absolutely no possibility of contention for any one list.   For example, you could have a separate lookaside list for each thread.   One list per processor can be even better, due to cache-warmth  considerations, but only works if threads cannot be preempted.  The  private lookaside lists can even be combined with a shared list if  necessary, to create a system with extremely low allocation overhead.\n\n> \n>\n\n\n\nEfficient locking schemes are notoriously hard to design, because of  what I call Scylla and Charybdis after the monsters in the Odyssey.   Scylla is locking that's too simplistic and/or coarse-grained,  serializing activities that can or should proceed in parallel and thus  sacrificing performance and scalability; Charybdis is overly complex or  fine-grained locking, with space for locks and time for lock operations  again sapping performance.  Near Scylla are shoals representing deadlock  and livelock conditions; near Charybdis are shoals representing race  conditions.  In between, there's a narrow channel that represents  locking which is both efficient and correct...or is there?  Since  locking tends to be deeply tied to program logic, it's often impossible  to design a good locking scheme without fundamentally changing how the  program works.  This is why people hate locking, and try to rationalize  their use of non-scalable single-threaded approaches.\n\n>  ... \n>\n\n\n\nAlmost every locking scheme starts off as \"one big lock around  everything\" and a vague hope that performance won't suck.  When that  hope is dashed, and it almost always is, the big lock is broken up into  smaller ones and the prayer is repeated, and then the whole process is  repeated, presumably until performance is adequate.  Often, though, each  iteration increases complexity and locking overhead by 20-50% in return  for a 5-10% decrease in lock contention.  With luck, the net result is  still a modest increase in performance, but actual decreases are not  uncommon.  The designer is left scratching his head (I use \"his\" because  I'm a guy myself; get over it).  \"I made the locks finer grained like  all the textbooks said I should,\" he thinks, \"so why did performance get  worse?\"\n\n> \n>\n\n\n\nIn my opinion, things got worse because the  aforementioned approach is fundamentally misguided.  Imagine the  \"solution space\" as a mountain range, with high points representing good  solutions and low points representing bad ones.  The problem is that  the \"one big lock\" starting point is almost always separated from the  higher peaks by all manner of valleys, saddles, lesser peaks and dead  ends.  It's a classic hill-climbing problem; trying to get from such a  starting point to the higher peaks only by taking small steps and never  going downhill almost never works.  What's needed is a *fundamentally* different way of approaching the peaks.\n\n> \n>\n\n\n\nThe first thing you have to do is form a mental map of your program's locking.  This map has two axes:\n\n- The vertical axis represents code.  If you're using a staged  architecture with non-branching stages, you probably already have a  diagram showing these divisions, like the ones everybody uses for  OSI-model network protocol stacks.\n- The horizontal axis represents data.  In every stage, each request  should be assigned to a data set with its own resources separate from  any other set.\n\n> \n>\n> - OSI\n> - \n>\n\n\n\nYou now have a grid, where each cell represents a particular data set  in a particular processing stage.  What's most important is the  following rule: two requests should not be in contention unless they are  in the same data set *and* the same processing stage.  If you can manage that, you've already won half the battle.\n\n> \n>\n\n\n\nOnce you've defined the grid, every type of locking your program does  can be plotted, and your next goal is to ensure that the resulting dots  are as evenly distributed along both axes as possible.  Unfortunately,  this part is very application-specific.  You have to think like a  diamond-cutter, using your knowledge of what the program does to find  the natural \"cleavage lines\" between stages and data sets.  Sometimes  they're obvious to start with.  Sometimes they're harder to find, but  seem more obvious in retrospect.  Dividing code into stages is a  complicated matter of program design, so there's not much I can offer  there, but here are some suggestions for how to define data sets:\n\n- If you have some sort of a block number or hash or transaction ID  associated with requests, you can rarely do better than to divide that  value by the number of data sets.\n- Sometimes, it's better to assign requests to data sets dynamically,  based on which data set has the most resources available rather than  some intrinsic property of the request.  Think of it like multiple  integer units in a modern CPU; those guys know a thing or two about  making discrete requests flow through a system.\n- It's often helpful to make sure that the data-set assignment is  different for each stage, so that requests which would contend at one  stage are guaranteed not to do so at another stage.\n\n> (:code)(:offer)\n>\n> - hashID\n> - CPU\n> - \n>\n\n\n\nIf you've divided your \"locking space\" both vertically and  horizontally, and made sure that lock activity is spread evenly across  the resulting cells, you can be pretty sure that your locking is in  pretty good shape.  There's one more step, though.  Do you remember the  \"small steps\" approach I derided a few paragraphs ago?  It still has its  place, because now you're at a good starting point instead of a  terrible one.  In metaphorical terms you're probably well up the slope  on one of the mountain range's highest peaks, but you're probably not at  the top of one.  Now is the time to collect contention statistics and  see what you need to do to improve, splitting stages and data sets in  different ways and then collecting more statistics until you're  satisfied.  If you do all that, you're sure to have a fine view from the  mountaintop.\n\n> \n>\n\n\n\nAs promised, I've covered the four biggest performance problems in  server design.  There are still some important issues that any  particular server will need to address, though.  Mostly, these come down  to knowing your platform/environment:\n\n- How does your storage subsystem perform with larger vs. smaller  requests?  With sequential vs. random?  How well do read-ahead and  write-behind work?\n- How efficient is the network protocol you're using?  Are there  parameters or flags you can set to make it perform better?  Are there  facilities like TCP_CORK, MSG_PUSH, or the Nagle-toggling trick that you  can use to avoid tiny messages?\n- Does your system support scatter/gather I/O (e.g. readv/writev)?   Using these can improve performance and also take much of the pain out  of using buffer chains.\n- What's your page size?  What's your cache-line size?  Is it worth it  to align stuff on these boundaries?  How expensive are system calls or  context switches, relative to other things?\n- Are your reader/writer lock primitives subject to starvation?  Of  whom?  Do your events have \"thundering herd\" problems?  Does your  sleep/wakeup have the nasty (but very common) behavior that when X wakes  Y a context switch to Y happens immediately even if X still has things  to do?\n\n> 4()\n>\n> - \n> - TCP_CORKMSG_PUSHNagle\n> - readv/writev/IO\n> - cache\n> - /[](https://en.wikipedia.org/wiki/Thundering_herd_problem)(:)XYYX/\n>\n\n\n\nI'm sure I could think of many more questions in this vein.  I'm sure  you could too.  In any particular situation it might not be worthwhile  to do anything about any one of these issues, but it's usually worth at  least thinking about them.  If you don't know the answers - many of  which you will not find in the system documentation - *find out*.   Write a test program or micro-benchmark to find the answers  empirically; writing such code is a useful skill in and of itself  anyway.  If you're writing code to run on multiple platforms, many of  these questions correlate with points where you should probably be  abstracting functionality into per-platform libraries so you can realize  a performance gain on that one platform that supports a particular  feature.\n\n>  \n>\n\n\n\nThe \"know the answers\" theory applies to your own code, too.  Figure  out what the important high-level operations in your code are, and time  them under different conditions.  This is not quite the same as  traditional profiling; it's about measuring *design* elements,  not actual implementations.  Low-level optimization is generally the  last resort of someone who screwed up the design.\n\n> \n>","source":"_posts/HighPerformanceServer.md","raw":"---\ntitle: '[translation] High-Performance Server Architecture'\ndate: 2019-01-28 23:31:59\ntags: [High-Performance]\ncategories: translation\ndescription: A translation access to techs article(unfinished).\nkeywords: [High-Performance,Server Architecture]\ntoc: true\n---\n\n## High-Performance Server Architecture-Jeff Darcy\n\nThe purpose of this document is to share some ideas that I've  developed over the years about how to develop a certain kind of  application for which the term \"server\" is only a weak approximation.   More accurately, I'll be writing about a broad class of programs that  are designed to handle very large numbers of discrete messages or  requests per second. Network servers most commonly fit this definition,  but not all programs that do are really servers in any sense of the  word.  For the sake of simplicity, though, and because \"High-Performance  Request-Handling Programs\" is a really lousy title, we'll just say  \"server\" and be done with it.\n\n> \n>\n\n<!--more-->\n\nI will not be writing about \"mildly parallel\" applications, even  though multitasking within a single program is now commonplace.  The  browser you're using to read this probably does some things in parallel,  but such low levels of parallelism really don't introduce many  interesting challenges.  The interesting challenges occur when the  request-handling infrastructure itself is the limiting factor on overall  performance, so that improving the infrastructure actually improves  performance.  That's not often the case for a browser running on a  gigahertz processor with a gigabyte of memory doing six simultaneous  downloads over a DSL line.  The focus here is not on applications that  sip through a straw but on those that drink from a firehose, <u>on the very  edge of hardware capabilities where how you do it really does matter</u>.\n\n\n\n> (mildly parallel)GBGHzDSL6yunxi \n>\n\n\n\nSome people will inevitably take issue with some of my comments and  suggestions, or think they have an even better way.  Fine.  I'm not  trying to be the Voice of God here; these are just methods that I've  found to work for me, not only in terms of their effects on performance  but also in terms of their effects on the difficulty of debugging or  extending code later.  Your mileage may vary.  If something else works  better for you that's great, but be warned that almost everything I  suggest here exists as an alternative to something else that I tried  once only to be disgusted or horrified by the results.  <u>Your pet idea  might very well feature prominently in one of these stories</u>, and  innocent readers might be bored to death if you encourage me to start  telling them.  You wouldn't want to hurt them, would you?\n\n\n\n> (),,, \n>\n\n\n\nThe rest of this article is going to be centered around what I'll call the Four Horsemen of Poor Performance:\n\n1. Data copies\n2. Context switches\n3. Memory allocation\n4. Lock contention\n\n\n\n> \n>\n> 1. \n> 2. \n> 3. \n> 4. \n>\n\n\n\nThere will also be a catch-all section at the end, but these are the  biggest performance-killers.  If you can handle most requests without  copying data, without a context switch, without going through the memory  allocator and without contending for locks, you'll have a server that  performs well even if it gets some of the minor parts wrong.\n\n> ()\n>\n\n\n\nThis could be a very short section, for one very simple reason: most  people have learned this lesson already.  Everybody knows data copies  are bad; it's obvious, right?  Well, actually, it probably only seems  obvious because you learned it very early in your computing career, and  that only happened because somebody started putting out the word decades  ago.  I know that's true for me, but I digress.  Nowadays it's covered  in every school curriculum and in every informal how-to.  <u>Even the  marketing types have figured out that \"zero copy\" is a good buzzword.</u>\n\n> (how-to)\n>\n\n\n\nDespite the after-the-fact obviousness of copies being bad, though,  there still seem to be nuances that people miss.  The most important of  these is that data copies are often hidden and disguised.  Do you really  know whether any code you call in drivers or libraries does data  copies?  It's probably more than you think.  Guess what \"Programmed I/O\"  on a PC refers to.  An example of a copy that's disguised rather than  hidden is a hash function, which has all the memory-access cost of a  copy and also involves more computation.  <u>Once it's pointed out that  hashing is effectively \"copying plus\" it seems obvious that it should be  avoided</u>, but I know at least one group of brilliant people who had to  figure it out the hard way.  If you really want to get rid of data  copies, either because they really are hurting performance or because  you want to put \"zero-copy operation\" on your hacker-conference slides,  you'll need to track down a lot of things that really are data copies  but don't advertise themselves as such.\n\n> PCIOhashhashCPUhash\n>\n\n\n\nThe tried and true method for avoiding data copies is to use  indirection, and pass buffer descriptors (or chains of buffer  descriptors) around instead of mere buffer pointers.  Each descriptor  typically consists of the following:\n\n- A pointer and length for the whole buffer.\n- A pointer and length, or offset and length, for the part of the buffer that's actually filled.\n- Forward and back pointers to other buffer descriptors in a list.\n- A reference count.\n\n> \n>\n> - \n> - \n> - \n> - \n>\n\n\n\nNow, instead of copying a piece of data to make sure it stays in  memory, code can simply increment a reference count on the appropriate  buffer descriptor.  This can work extremely well under some conditions,  including the way that a typical network protocol stack operates, but it  can also become a really big headache.  Generally speaking, it's easy  to add buffers at the beginning or end of a chain, to add references to  whole buffers, and to deallocate a whole chain at once.  Adding in the  middle, deallocating piece by piece, or referring to partial buffers  will each make life increasingly difficult.  Trying to split or combine  buffers will simply drive you insane.\n\n> ()\n>\n\n\n\nI don't actually recommend using this approach for everything, though.  Why not?  Because it gets to be a *huge*  pain when you have to walk through descriptor chains every time you  want to look at a header field.  There really are worse things than data  copies.  I find that the best thing to do is to identify the large  objects in a program, such as data blocks, make sure *those* get allocated separately as described above so that they don't need to be copied, and not sweat too much about the other stuff.\n\n> ()()()\n>\n\n\n\nThis brings me to my last point about data copies: don't go overboard  avoiding them.  I've seen way too much code that avoids data copies by  doing something even worse, like forcing a context switch or breaking up  a large I/O request.  Data copies are expensive, and when you're  looking for places to avoid redundant operations they're one of the  first things you should look at, <u>but there is a point of diminishing  returns.  Combing through code and then making it twice as complicated  just to get rid of that last few data copies is usually a waste of time  that could be better spent in other ways.</u>\n\n> IO\n>\n\n\n\nWhereas everyone thinks it's obvious that data copies are bad, I'm  often surprised by how many people totally ignore the effect of context  switches on performance.  In my experience, context switches are  actually behind more total \"meltdowns\" at high load than data copies;  the system starts spending more time going from one thread to another  than it actually spends within any thread doing useful work.  The  amazing thing is that, at one level, it's totally obvious what causes  excessive context switching.  The #1 cause of context switches is having  more active threads than you have processors.  As the ratio of active  threads to processors increases, the number of context switches also  increases - linearly if you're lucky, but often exponentially.  This  very simple fact explains why multi-threaded designs that have one  thread per connection scale very poorly.  The only realistic alternative  for a scalable system is to limit the number of active threads so it's  (usually) less than or equal to the number of processors.  One popular  variant of this approach is to use only one thread, ever; while such an  approach does avoid context thrashing, and avoids the need for locking  as well, <u>it is also incapable of achieving more than one processor's  worth of total throughput and thus remains beneath contempt unless the  program will be non-CPU-bound (usually network-I/O-bound) anyway.</u>\n\n> (active)(processor)... \n>\n\n\n\nThe first thing that a \"thread-frugal\" program has to do is figure  out how it's going to make one thread handle multiple connections at  once.  This usually implies a front end that uses select/poll,  asynchronous I/O, signals or completion ports, with an event-driven  structure behind that.  Many \"religious wars\" have been fought, and  continue to be fought, over which of the various front-end APIs is best.   Dan Kegel's [C10K paper](http://www.kegel.com/c10k.html) is  a good resource is this area.  Personally, I think all flavors of  select/poll and signals are ugly hacks, and therefore favor either AIO  or completion ports, but it actually doesn't matter that much.  They all  - except maybe select() - work reasonably well, and don't really do  much to address the matter of what happens past the very outermost layer  of your program's front end.\n\n> select/pollIO[IOCP](https://en.wikipedia.org/wiki/Input/output_completion_port)(:)API [C10K paper](http://www.kegel.com/c10k.html) Dan Kegelselect/pollIOIOCP`select()`\n>\n\n\n\nThe simplest conceptual model of a multi-threaded event-driven server  has a queue at its center; requests are read by one or more \"listener\"  threads and put on queues, from which one or more \"worker\" threads will  remove and process them.  Conceptually, this is a good model, but all  too often people actually implement their code this way.  Why is this  wrong?  Because the #2 cause of context switches is transferring work  from one thread to another.  <u>Some people even compound the error by  requiring that the response to a request be sent by the original thread -  guaranteeing not one but two context switches per request</u>.  It's very  important to use a \"symmetric\" approach in which a given thread can go  from being a listener to a worker to a listener again without ever  changing context.  Whether this involves partitioning connections  between threads or having all threads take turns being listener for the  entire set of connections seems to matter a lot less.\n\n> <u></u> \n>\n\n\n\nUsually, it's not possible to know how many threads will be active  even one instant into the future.  After all, requests can come in on  any connection at any moment, or \"background\" threads dedicated to  various maintenance tasks could pick that moment to wake up.  If you  don't *know* how many threads are active, how can you *limit*  how many are active?  In my experience, one of the most effective  approaches is also one of the simplest: use an old-fashioned counting  semaphore which each thread must hold whenever it's doing \"real work\".   If the thread limit has already been reached then each listen-mode  thread might incur one extra context switch as it wakes up and then  blocks on the semaphore, but once all listen-mode threads have blocked  in this way they won't continue contending for resources until one of  the existing threads \"retires\" so the system effect is negligible.  More  importantly, this method handles maintenance threads - which sleep most  of the time and therefore dont' count against the active thread count -  more gracefully than most alternatives.\n\n> instance()gracefully\n>\n\n\n\nOnce the processing of requests has been broken up into two stages  (listener and worker) with multiple threads to service the stages, it's  natural to break up the processing even further into more than two  stages.  In its simplest form, processing a request thus becomes a  matter of invoking stages successively in one direction, and then in the  other (for replies).  However, things can get more complicated; a stage  might represent a \"fork\" between two processing paths which involve  different stages, or it might generate a reply (e.g. a cached value)  itself without invoking further stages.  Therefore, each stage needs to  be able to specify \"what should happen next\" for a request.  There are  three possibilities, represented by return values from the stage's  dispatch function:\n\n- <u>The request needs to be passed on to another stage (an ID or pointer in the return value).</u>\n- The request has been completed (a special \"request done\" return value)\n- The request was blocked (a special \"request blocked\" return value).   This is equivalent to the previous case, except that the request is not  freed and will be continued later from another thread.\n\n> ()()(dispatch)\n>\n> - (ID)\n> - ()\n> - ()\n>\n\n\n\nNote that, in this model, queuing of requests is done *within*  stages, not between stages.  This avoids the common silliness of  constantly putting a request on a successor stage's queue, then  immediately invoking that successor stage and dequeuing the request  again; I call that lots of queue activity - and locking - for nothing.\n\n> \n>\n\n\n\nIf this idea of separating a complex task into multiple smaller  communicating parts seems familiar, that's because it's actually very  old.  <u>My approach has its roots in the [Communicating Sequential Processes](http://www.afm.sbu.ac.uk/csp/)  concept elucidated by C.A.R. Hoare in 1978, based in turn on ideas from  Per Brinch Hansen and Matthew Conway going back to 1963 - before I was  born!</u>  However, when Hoare coined the term CSP he meant \"process\" in the  abstract mathematical sense, and a CSP process need bear no relation to  the operating-system entities of the same name.  In my opinion, the  common approach of implementing CSP via thread-like coroutines within a  single OS thread gives the user all of the headaches of concurrency with  none of the scalability.\n\n> \n>\n\n\n\nA contemporary example of the staged-execution idea <u>evolved in a saner direction is Matt Welsh's [SEDA](http://www.cs.berkeley.edu/~mdw/proj/seda/)</u>.   In fact, SEDA is such a good example of \"server architecture done  right\" that it's worth commenting on some of its specific  characteristics (especially where those differ from what I've outlined  above). \n\n1. SEDA's \"batching\" tends to emphasize processing multiple requests  through a stage at once, while my approach tends to emphasize processing  a single request through multiple stages at once.\n2. SEDA's one significant flaw, in my opinion, is that it allocates a  separate thread pool to each stage with only \"background\" reallocation  of threads between stages in response to load.  As a result, the #1 and  #2 causes of context switches noted above are still very much present.\n3. In the context of an academic research project, implementing SEDA in  Java might make sense.  In the real world, though, I think the choice  can be characterized as unfortunate.\n\n> ...\n>\n\n\n\nAllocating and freeing memory is one of the most common operations in  many applications.  Accordingly, many clever tricks have been developed  to make general-purpose memory allocators more efficient.  However, <u>no  amount of cleverness can make up for the fact that the very generality  of such allocators inevitably makes them far less efficient than the  alternatives in many cases</u>.  I therefore have three suggestions for how  to avoid the system memory allocator altogether.\n\n> ()\n>\n\nSuggestion #1 is simple preallocation.  We all know that static  allocation is bad when it imposes artificial limits on program  functionality, but there are many other forms of preallocation that can  be quite beneficial.  Usually the reason comes down to the fact that one  trip through the system memory allocator is better than several, even  when some memory is \"wasted\" in the process.  Thus, if it's possible to  assert that no more than N items could ever be in use at once,  preallocation at program startup might be a valid choice.  Even when  that's not the case, preallocating everything that a request handler  might need right at the beginning might be preferable to allocating each  piece as it's needed; aside from the possibility of allocating multiple  items contiguously in one trip through the system allocator, this often  greatly simplifies error-recovery code.  If memory is very tight then  preallocation might not be an option, but in all but the most extreme  circumstances it generally turns out to be a net win.\n\n> ()N()()\n>\n\n\n\nSuggestion #2 is to use lookaside lists for objects that are  allocated and freed frequently.  The basic idea is to put recently-freed  objects onto a list instead of actually freeing them, in the hope that  if they're needed again soon they need merely be taken off the list  instead of being allocated from system memory.  As an additional  benefit, transitions to/from a lookaside list can often be implemented  to skip complex object initialization/finalization.\n\n> (:oftenalways)(:)\n>\n\n\n\nIt's generally undesirable to have lookaside lists grow without  bound, never actually freeing anything even when your program is idle.   Therefore, it's usually necessary to have some sort of periodic  \"sweeper\" task to free inactive objects, but it would also be  undesirable if the sweeper introduced undue locking complexity or  contention.  A good compromise is therefore a system in which a  lookaside list actually consists of separately locked \"old\" and \"new\"  lists.  Allocation is done preferentially from the new list, then from  the old list, and from the system only as a last resort; objects are  always freed onto the new list.  The sweeper thread operates as follows:\n\n1. Lock both lists.\n2. Save the head for the old list.\n3. Make the (previously) new list into the old list by assigning list heads.\n4. Unlock.\n5. Free everything on the saved old list at leisure.\n\n> ()()\n>\n> 1. \n> 2. \n> 3. ()\n> 4. \n> 5. \n>\n\n\n\nObjects in this sort of system are only actually freed when they have  not been needed for at least one full sweeper interval, but always less  than two.  Most importantly, the sweeper does most of its work without  holding any locks to contend with regular threads.  In theory, the same  approach can be generalized to more than two stages, but I have yet to  find that useful.\n\n> \n>\n\n\n\nOne concern with using lookaside lists is that the list pointers  might increase object size.  In my experience, most of the objects that  I'd use lookaside lists for already contain list pointers anyway, so  it's kind of a moot point.  Even if the pointers were only needed for  the lookaside lists, though, the savings in terms of avoided trips  through the system memory allocator (and object initialization) would  more than make up for the extra memory.\n\n> ()\n>\n\n\n\nSuggestion #3 actually has to do with locking, which we haven't  discussed yet, but I'll toss it in anyway.  Lock contention is often the  biggest cost in allocating memory, even when lookaside lists are in  use.  One solution is to maintain multiple private lookaside lists, such  that there's absolutely no possibility of contention for any one list.   For example, you could have a separate lookaside list for each thread.   One list per processor can be even better, due to cache-warmth  considerations, but only works if threads cannot be preempted.  The  private lookaside lists can even be combined with a shared list if  necessary, to create a system with extremely low allocation overhead.\n\n> \n>\n\n\n\nEfficient locking schemes are notoriously hard to design, because of  what I call Scylla and Charybdis after the monsters in the Odyssey.   Scylla is locking that's too simplistic and/or coarse-grained,  serializing activities that can or should proceed in parallel and thus  sacrificing performance and scalability; Charybdis is overly complex or  fine-grained locking, with space for locks and time for lock operations  again sapping performance.  Near Scylla are shoals representing deadlock  and livelock conditions; near Charybdis are shoals representing race  conditions.  In between, there's a narrow channel that represents  locking which is both efficient and correct...or is there?  Since  locking tends to be deeply tied to program logic, it's often impossible  to design a good locking scheme without fundamentally changing how the  program works.  This is why people hate locking, and try to rationalize  their use of non-scalable single-threaded approaches.\n\n>  ... \n>\n\n\n\nAlmost every locking scheme starts off as \"one big lock around  everything\" and a vague hope that performance won't suck.  When that  hope is dashed, and it almost always is, the big lock is broken up into  smaller ones and the prayer is repeated, and then the whole process is  repeated, presumably until performance is adequate.  Often, though, each  iteration increases complexity and locking overhead by 20-50% in return  for a 5-10% decrease in lock contention.  With luck, the net result is  still a modest increase in performance, but actual decreases are not  uncommon.  The designer is left scratching his head (I use \"his\" because  I'm a guy myself; get over it).  \"I made the locks finer grained like  all the textbooks said I should,\" he thinks, \"so why did performance get  worse?\"\n\n> \n>\n\n\n\nIn my opinion, things got worse because the  aforementioned approach is fundamentally misguided.  Imagine the  \"solution space\" as a mountain range, with high points representing good  solutions and low points representing bad ones.  The problem is that  the \"one big lock\" starting point is almost always separated from the  higher peaks by all manner of valleys, saddles, lesser peaks and dead  ends.  It's a classic hill-climbing problem; trying to get from such a  starting point to the higher peaks only by taking small steps and never  going downhill almost never works.  What's needed is a *fundamentally* different way of approaching the peaks.\n\n> \n>\n\n\n\nThe first thing you have to do is form a mental map of your program's locking.  This map has two axes:\n\n- The vertical axis represents code.  If you're using a staged  architecture with non-branching stages, you probably already have a  diagram showing these divisions, like the ones everybody uses for  OSI-model network protocol stacks.\n- The horizontal axis represents data.  In every stage, each request  should be assigned to a data set with its own resources separate from  any other set.\n\n> \n>\n> - OSI\n> - \n>\n\n\n\nYou now have a grid, where each cell represents a particular data set  in a particular processing stage.  What's most important is the  following rule: two requests should not be in contention unless they are  in the same data set *and* the same processing stage.  If you can manage that, you've already won half the battle.\n\n> \n>\n\n\n\nOnce you've defined the grid, every type of locking your program does  can be plotted, and your next goal is to ensure that the resulting dots  are as evenly distributed along both axes as possible.  Unfortunately,  this part is very application-specific.  You have to think like a  diamond-cutter, using your knowledge of what the program does to find  the natural \"cleavage lines\" between stages and data sets.  Sometimes  they're obvious to start with.  Sometimes they're harder to find, but  seem more obvious in retrospect.  Dividing code into stages is a  complicated matter of program design, so there's not much I can offer  there, but here are some suggestions for how to define data sets:\n\n- If you have some sort of a block number or hash or transaction ID  associated with requests, you can rarely do better than to divide that  value by the number of data sets.\n- Sometimes, it's better to assign requests to data sets dynamically,  based on which data set has the most resources available rather than  some intrinsic property of the request.  Think of it like multiple  integer units in a modern CPU; those guys know a thing or two about  making discrete requests flow through a system.\n- It's often helpful to make sure that the data-set assignment is  different for each stage, so that requests which would contend at one  stage are guaranteed not to do so at another stage.\n\n> (:code)(:offer)\n>\n> - hashID\n> - CPU\n> - \n>\n\n\n\nIf you've divided your \"locking space\" both vertically and  horizontally, and made sure that lock activity is spread evenly across  the resulting cells, you can be pretty sure that your locking is in  pretty good shape.  There's one more step, though.  Do you remember the  \"small steps\" approach I derided a few paragraphs ago?  It still has its  place, because now you're at a good starting point instead of a  terrible one.  In metaphorical terms you're probably well up the slope  on one of the mountain range's highest peaks, but you're probably not at  the top of one.  Now is the time to collect contention statistics and  see what you need to do to improve, splitting stages and data sets in  different ways and then collecting more statistics until you're  satisfied.  If you do all that, you're sure to have a fine view from the  mountaintop.\n\n> \n>\n\n\n\nAs promised, I've covered the four biggest performance problems in  server design.  There are still some important issues that any  particular server will need to address, though.  Mostly, these come down  to knowing your platform/environment:\n\n- How does your storage subsystem perform with larger vs. smaller  requests?  With sequential vs. random?  How well do read-ahead and  write-behind work?\n- How efficient is the network protocol you're using?  Are there  parameters or flags you can set to make it perform better?  Are there  facilities like TCP_CORK, MSG_PUSH, or the Nagle-toggling trick that you  can use to avoid tiny messages?\n- Does your system support scatter/gather I/O (e.g. readv/writev)?   Using these can improve performance and also take much of the pain out  of using buffer chains.\n- What's your page size?  What's your cache-line size?  Is it worth it  to align stuff on these boundaries?  How expensive are system calls or  context switches, relative to other things?\n- Are your reader/writer lock primitives subject to starvation?  Of  whom?  Do your events have \"thundering herd\" problems?  Does your  sleep/wakeup have the nasty (but very common) behavior that when X wakes  Y a context switch to Y happens immediately even if X still has things  to do?\n\n> 4()\n>\n> - \n> - TCP_CORKMSG_PUSHNagle\n> - readv/writev/IO\n> - cache\n> - /[](https://en.wikipedia.org/wiki/Thundering_herd_problem)(:)XYYX/\n>\n\n\n\nI'm sure I could think of many more questions in this vein.  I'm sure  you could too.  In any particular situation it might not be worthwhile  to do anything about any one of these issues, but it's usually worth at  least thinking about them.  If you don't know the answers - many of  which you will not find in the system documentation - *find out*.   Write a test program or micro-benchmark to find the answers  empirically; writing such code is a useful skill in and of itself  anyway.  If you're writing code to run on multiple platforms, many of  these questions correlate with points where you should probably be  abstracting functionality into per-platform libraries so you can realize  a performance gain on that one platform that supports a particular  feature.\n\n>  \n>\n\n\n\nThe \"know the answers\" theory applies to your own code, too.  Figure  out what the important high-level operations in your code are, and time  them under different conditions.  This is not quite the same as  traditional profiling; it's about measuring *design* elements,  not actual implementations.  Low-level optimization is generally the  last resort of someone who screwed up the design.\n\n> \n>","slug":"HighPerformanceServer","published":1,"updated":"2019-03-06T09:23:18.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjvdf737b001gt0t8jg7ypbkm","content":"<h2 id=\"High-Performance-Server-Architecture-Jeff-Darcy\"><a href=\"#High-Performance-Server-Architecture-Jeff-Darcy\" class=\"headerlink\" title=\"High-Performance Server Architecture-Jeff Darcy\"></a>High-Performance Server Architecture-Jeff Darcy</h2><p>The purpose of this document is to share some ideas that Ive  developed over the years about how to develop a certain kind of  application for which the term server is only a weak approximation.   More accurately, Ill be writing about a broad class of programs that  are designed to handle very large numbers of discrete messages or  requests per second. Network servers most commonly fit this definition,  but not all programs that do are really servers in any sense of the  word.  For the sake of simplicity, though, and because High-Performance  Request-Handling Programs is a really lousy title, well just say  server and be done with it.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<a id=\"more\"></a>\n<p>I will not be writing about mildly parallel applications, even  though multitasking within a single program is now commonplace.  The  browser youre using to read this probably does some things in parallel,  but such low levels of parallelism really dont introduce many  interesting challenges.  The interesting challenges occur when the  request-handling infrastructure itself is the limiting factor on overall  performance, so that improving the infrastructure actually improves  performance.  Thats not often the case for a browser running on a  gigahertz processor with a gigabyte of memory doing six simultaneous  downloads over a DSL line.  The focus here is not on applications that  sip through a straw but on those that drink from a firehose, <u>on the very  edge of hardware capabilities where how you do it really does matter</u>.</p>\n<blockquote>\n<p>(mildly parallel)GBGHzDSL6yunxi </p>\n</blockquote>\n<p>Some people will inevitably take issue with some of my comments and  suggestions, or think they have an even better way.  Fine.  Im not  trying to be the Voice of God here; these are just methods that Ive  found to work for me, not only in terms of their effects on performance  but also in terms of their effects on the difficulty of debugging or  extending code later.  Your mileage may vary.  If something else works  better for you thats great, but be warned that almost everything I  suggest here exists as an alternative to something else that I tried  once only to be disgusted or horrified by the results.  <u>Your pet idea  might very well feature prominently in one of these stories</u>, and  innocent readers might be bored to death if you encourage me to start  telling them.  You wouldnt want to hurt them, would you?</p>\n<blockquote>\n<p>(),,, </p>\n</blockquote>\n<p>The rest of this article is going to be centered around what Ill call the Four Horsemen of Poor Performance:</p>\n<ol>\n<li>Data copies</li>\n<li>Context switches</li>\n<li>Memory allocation</li>\n<li>Lock contention</li>\n</ol>\n<blockquote>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</blockquote>\n<p>There will also be a catch-all section at the end, but these are the  biggest performance-killers.  If you can handle most requests without  copying data, without a context switch, without going through the memory  allocator and without contending for locks, youll have a server that  performs well even if it gets some of the minor parts wrong.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>This could be a very short section, for one very simple reason: most  people have learned this lesson already.  Everybody knows data copies  are bad; its obvious, right?  Well, actually, it probably only seems  obvious because you learned it very early in your computing career, and  that only happened because somebody started putting out the word decades  ago.  I know thats true for me, but I digress.  Nowadays its covered  in every school curriculum and in every informal how-to.  <u>Even the  marketing types have figured out that zero copy is a good buzzword.</u></p>\n<blockquote>\n<p>(how-to)</p>\n</blockquote>\n<p>Despite the after-the-fact obviousness of copies being bad, though,  there still seem to be nuances that people miss.  The most important of  these is that data copies are often hidden and disguised.  Do you really  know whether any code you call in drivers or libraries does data  copies?  Its probably more than you think.  Guess what Programmed I/O  on a PC refers to.  An example of a copy thats disguised rather than  hidden is a hash function, which has all the memory-access cost of a  copy and also involves more computation.  <u>Once its pointed out that  hashing is effectively copying plus it seems obvious that it should be  avoided</u>, but I know at least one group of brilliant people who had to  figure it out the hard way.  If you really want to get rid of data  copies, either because they really are hurting performance or because  you want to put zero-copy operation on your hacker-conference slides,  youll need to track down a lot of things that really are data copies  but dont advertise themselves as such.</p>\n<blockquote>\n<p>PCIOhashhashCPUhash</p>\n</blockquote>\n<p>The tried and true method for avoiding data copies is to use  indirection, and pass buffer descriptors (or chains of buffer  descriptors) around instead of mere buffer pointers.  Each descriptor  typically consists of the following:</p>\n<ul>\n<li>A pointer and length for the whole buffer.</li>\n<li>A pointer and length, or offset and length, for the part of the buffer thats actually filled.</li>\n<li>Forward and back pointers to other buffer descriptors in a list.</li>\n<li>A reference count.</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p>Now, instead of copying a piece of data to make sure it stays in  memory, code can simply increment a reference count on the appropriate  buffer descriptor.  This can work extremely well under some conditions,  including the way that a typical network protocol stack operates, but it  can also become a really big headache.  Generally speaking, its easy  to add buffers at the beginning or end of a chain, to add references to  whole buffers, and to deallocate a whole chain at once.  Adding in the  middle, deallocating piece by piece, or referring to partial buffers  will each make life increasingly difficult.  Trying to split or combine  buffers will simply drive you insane.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>I dont actually recommend using this approach for everything, though.  Why not?  Because it gets to be a <em>huge</em>  pain when you have to walk through descriptor chains every time you  want to look at a header field.  There really are worse things than data  copies.  I find that the best thing to do is to identify the large  objects in a program, such as data blocks, make sure <em>those</em> get allocated separately as described above so that they dont need to be copied, and not sweat too much about the other stuff.</p>\n<blockquote>\n<p>()()()</p>\n</blockquote>\n<p>This brings me to my last point about data copies: dont go overboard  avoiding them.  Ive seen way too much code that avoids data copies by  doing something even worse, like forcing a context switch or breaking up  a large I/O request.  Data copies are expensive, and when youre  looking for places to avoid redundant operations theyre one of the  first things you should look at, <u>but there is a point of diminishing  returns.  Combing through code and then making it twice as complicated  just to get rid of that last few data copies is usually a waste of time  that could be better spent in other ways.</u></p>\n<blockquote>\n<p>IO</p>\n</blockquote>\n<p>Whereas everyone thinks its obvious that data copies are bad, Im  often surprised by how many people totally ignore the effect of context  switches on performance.  In my experience, context switches are  actually behind more total meltdowns at high load than data copies;  the system starts spending more time going from one thread to another  than it actually spends within any thread doing useful work.  The  amazing thing is that, at one level, its totally obvious what causes  excessive context switching.  The #1 cause of context switches is having  more active threads than you have processors.  As the ratio of active  threads to processors increases, the number of context switches also  increases - linearly if youre lucky, but often exponentially.  This  very simple fact explains why multi-threaded designs that have one  thread per connection scale very poorly.  The only realistic alternative  for a scalable system is to limit the number of active threads so its  (usually) less than or equal to the number of processors.  One popular  variant of this approach is to use only one thread, ever; while such an  approach does avoid context thrashing, and avoids the need for locking  as well, <u>it is also incapable of achieving more than one processors  worth of total throughput and thus remains beneath contempt unless the  program will be non-CPU-bound (usually network-I/O-bound) anyway.</u></p>\n<blockquote>\n<p>(active)(processor) </p>\n</blockquote>\n<p>The first thing that a thread-frugal program has to do is figure  out how its going to make one thread handle multiple connections at  once.  This usually implies a front end that uses select/poll,  asynchronous I/O, signals or completion ports, with an event-driven  structure behind that.  Many religious wars have been fought, and  continue to be fought, over which of the various front-end APIs is best.   Dan Kegels <a href=\"http://www.kegel.com/c10k.html\" target=\"_blank\" rel=\"noopener\">C10K paper</a> is  a good resource is this area.  Personally, I think all flavors of  select/poll and signals are ugly hacks, and therefore favor either AIO  or completion ports, but it actually doesnt matter that much.  They all  - except maybe select() - work reasonably well, and dont really do  much to address the matter of what happens past the very outermost layer  of your programs front end.</p>\n<blockquote>\n<p>select/pollIO<a href=\"https://en.wikipedia.org/wiki/Input/output_completion_port\" target=\"_blank\" rel=\"noopener\">IOCP</a>(:)API <a href=\"http://www.kegel.com/c10k.html\" target=\"_blank\" rel=\"noopener\">C10K paper</a> Dan Kegelselect/pollIOIOCP<code>select()</code></p>\n</blockquote>\n<p>The simplest conceptual model of a multi-threaded event-driven server  has a queue at its center; requests are read by one or more listener  threads and put on queues, from which one or more worker threads will  remove and process them.  Conceptually, this is a good model, but all  too often people actually implement their code this way.  Why is this  wrong?  Because the #2 cause of context switches is transferring work  from one thread to another.  <u>Some people even compound the error by  requiring that the response to a request be sent by the original thread -  guaranteeing not one but two context switches per request</u>.  Its very  important to use a symmetric approach in which a given thread can go  from being a listener to a worker to a listener again without ever  changing context.  Whether this involves partitioning connections  between threads or having all threads take turns being listener for the  entire set of connections seems to matter a lot less.</p>\n<blockquote>\n<p><u></u> </p>\n</blockquote>\n<p>Usually, its not possible to know how many threads will be active  even one instant into the future.  After all, requests can come in on  any connection at any moment, or background threads dedicated to  various maintenance tasks could pick that moment to wake up.  If you  dont <em>know</em> how many threads are active, how can you <em>limit</em>  how many are active?  In my experience, one of the most effective  approaches is also one of the simplest: use an old-fashioned counting  semaphore which each thread must hold whenever its doing real work.   If the thread limit has already been reached then each listen-mode  thread might incur one extra context switch as it wakes up and then  blocks on the semaphore, but once all listen-mode threads have blocked  in this way they wont continue contending for resources until one of  the existing threads retires so the system effect is negligible.  More  importantly, this method handles maintenance threads - which sleep most  of the time and therefore dont count against the active thread count -  more gracefully than most alternatives.</p>\n<blockquote>\n<p>instance()gracefully</p>\n</blockquote>\n<p>Once the processing of requests has been broken up into two stages  (listener and worker) with multiple threads to service the stages, its  natural to break up the processing even further into more than two  stages.  In its simplest form, processing a request thus becomes a  matter of invoking stages successively in one direction, and then in the  other (for replies).  However, things can get more complicated; a stage  might represent a fork between two processing paths which involve  different stages, or it might generate a reply (e.g. a cached value)  itself without invoking further stages.  Therefore, each stage needs to  be able to specify what should happen next for a request.  There are  three possibilities, represented by return values from the stages  dispatch function:</p>\n<ul>\n<li><u>The request needs to be passed on to another stage (an ID or pointer in the return value).</u></li>\n<li>The request has been completed (a special request done return value)</li>\n<li>The request was blocked (a special request blocked return value).   This is equivalent to the previous case, except that the request is not  freed and will be continued later from another thread.</li>\n</ul>\n<blockquote>\n<p>()()(dispatch)</p>\n<ul>\n<li>(ID)</li>\n<li>()</li>\n<li>()</li>\n</ul>\n</blockquote>\n<p>Note that, in this model, queuing of requests is done <em>within</em>  stages, not between stages.  This avoids the common silliness of  constantly putting a request on a successor stages queue, then  immediately invoking that successor stage and dequeuing the request  again; I call that lots of queue activity - and locking - for nothing.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>If this idea of separating a complex task into multiple smaller  communicating parts seems familiar, thats because its actually very  old.  <u>My approach has its roots in the <a href=\"http://www.afm.sbu.ac.uk/csp/\" target=\"_blank\" rel=\"noopener\">Communicating Sequential Processes</a>  concept elucidated by C.A.R. Hoare in 1978, based in turn on ideas from  Per Brinch Hansen and Matthew Conway going back to 1963 - before I was  born!</u>  However, when Hoare coined the term CSP he meant process in the  abstract mathematical sense, and a CSP process need bear no relation to  the operating-system entities of the same name.  In my opinion, the  common approach of implementing CSP via thread-like coroutines within a  single OS thread gives the user all of the headaches of concurrency with  none of the scalability.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>A contemporary example of the staged-execution idea <u>evolved in a saner direction is Matt Welshs <a href=\"http://www.cs.berkeley.edu/~mdw/proj/seda/\" target=\"_blank\" rel=\"noopener\">SEDA</a></u>.   In fact, SEDA is such a good example of server architecture done  right that its worth commenting on some of its specific  characteristics (especially where those differ from what Ive outlined  above). </p>\n<ol>\n<li>SEDAs batching tends to emphasize processing multiple requests  through a stage at once, while my approach tends to emphasize processing  a single request through multiple stages at once.</li>\n<li>SEDAs one significant flaw, in my opinion, is that it allocates a  separate thread pool to each stage with only background reallocation  of threads between stages in response to load.  As a result, the #1 and  #2 causes of context switches noted above are still very much present.</li>\n<li>In the context of an academic research project, implementing SEDA in  Java might make sense.  In the real world, though, I think the choice  can be characterized as unfortunate.</li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Allocating and freeing memory is one of the most common operations in  many applications.  Accordingly, many clever tricks have been developed  to make general-purpose memory allocators more efficient.  However, <u>no  amount of cleverness can make up for the fact that the very generality  of such allocators inevitably makes them far less efficient than the  alternatives in many cases</u>.  I therefore have three suggestions for how  to avoid the system memory allocator altogether.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>Suggestion #1 is simple preallocation.  We all know that static  allocation is bad when it imposes artificial limits on program  functionality, but there are many other forms of preallocation that can  be quite beneficial.  Usually the reason comes down to the fact that one  trip through the system memory allocator is better than several, even  when some memory is wasted in the process.  Thus, if its possible to  assert that no more than N items could ever be in use at once,  preallocation at program startup might be a valid choice.  Even when  thats not the case, preallocating everything that a request handler  might need right at the beginning might be preferable to allocating each  piece as its needed; aside from the possibility of allocating multiple  items contiguously in one trip through the system allocator, this often  greatly simplifies error-recovery code.  If memory is very tight then  preallocation might not be an option, but in all but the most extreme  circumstances it generally turns out to be a net win.</p>\n<blockquote>\n<p>()N()()</p>\n</blockquote>\n<p>Suggestion #2 is to use lookaside lists for objects that are  allocated and freed frequently.  The basic idea is to put recently-freed  objects onto a list instead of actually freeing them, in the hope that  if theyre needed again soon they need merely be taken off the list  instead of being allocated from system memory.  As an additional  benefit, transitions to/from a lookaside list can often be implemented  to skip complex object initialization/finalization.</p>\n<blockquote>\n<p>(:oftenalways)(:)</p>\n</blockquote>\n<p>Its generally undesirable to have lookaside lists grow without  bound, never actually freeing anything even when your program is idle.   Therefore, its usually necessary to have some sort of periodic  sweeper task to free inactive objects, but it would also be  undesirable if the sweeper introduced undue locking complexity or  contention.  A good compromise is therefore a system in which a  lookaside list actually consists of separately locked old and new  lists.  Allocation is done preferentially from the new list, then from  the old list, and from the system only as a last resort; objects are  always freed onto the new list.  The sweeper thread operates as follows:</p>\n<ol>\n<li>Lock both lists.</li>\n<li>Save the head for the old list.</li>\n<li>Make the (previously) new list into the old list by assigning list heads.</li>\n<li>Unlock.</li>\n<li>Free everything on the saved old list at leisure.</li>\n</ol>\n<blockquote>\n<p>()()</p>\n<ol>\n<li></li>\n<li></li>\n<li>()</li>\n<li></li>\n<li></li>\n</ol>\n</blockquote>\n<p>Objects in this sort of system are only actually freed when they have  not been needed for at least one full sweeper interval, but always less  than two.  Most importantly, the sweeper does most of its work without  holding any locks to contend with regular threads.  In theory, the same  approach can be generalized to more than two stages, but I have yet to  find that useful.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>One concern with using lookaside lists is that the list pointers  might increase object size.  In my experience, most of the objects that  Id use lookaside lists for already contain list pointers anyway, so  its kind of a moot point.  Even if the pointers were only needed for  the lookaside lists, though, the savings in terms of avoided trips  through the system memory allocator (and object initialization) would  more than make up for the extra memory.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>Suggestion #3 actually has to do with locking, which we havent  discussed yet, but Ill toss it in anyway.  Lock contention is often the  biggest cost in allocating memory, even when lookaside lists are in  use.  One solution is to maintain multiple private lookaside lists, such  that theres absolutely no possibility of contention for any one list.   For example, you could have a separate lookaside list for each thread.   One list per processor can be even better, due to cache-warmth  considerations, but only works if threads cannot be preempted.  The  private lookaside lists can even be combined with a shared list if  necessary, to create a system with extremely low allocation overhead.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Efficient locking schemes are notoriously hard to design, because of  what I call Scylla and Charybdis after the monsters in the Odyssey.   Scylla is locking thats too simplistic and/or coarse-grained,  serializing activities that can or should proceed in parallel and thus  sacrificing performance and scalability; Charybdis is overly complex or  fine-grained locking, with space for locks and time for lock operations  again sapping performance.  Near Scylla are shoals representing deadlock  and livelock conditions; near Charybdis are shoals representing race  conditions.  In between, theres a narrow channel that represents  locking which is both efficient and corrector is there?  Since  locking tends to be deeply tied to program logic, its often impossible  to design a good locking scheme without fundamentally changing how the  program works.  This is why people hate locking, and try to rationalize  their use of non-scalable single-threaded approaches.</p>\n<blockquote>\n<p>  </p>\n</blockquote>\n<p>Almost every locking scheme starts off as one big lock around  everything and a vague hope that performance wont suck.  When that  hope is dashed, and it almost always is, the big lock is broken up into  smaller ones and the prayer is repeated, and then the whole process is  repeated, presumably until performance is adequate.  Often, though, each  iteration increases complexity and locking overhead by 20-50% in return  for a 5-10% decrease in lock contention.  With luck, the net result is  still a modest increase in performance, but actual decreases are not  uncommon.  The designer is left scratching his head (I use his because  Im a guy myself; get over it).  I made the locks finer grained like  all the textbooks said I should, he thinks, so why did performance get  worse?</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>In my opinion, things got worse because the  aforementioned approach is fundamentally misguided.  Imagine the  solution space as a mountain range, with high points representing good  solutions and low points representing bad ones.  The problem is that  the one big lock starting point is almost always separated from the  higher peaks by all manner of valleys, saddles, lesser peaks and dead  ends.  Its a classic hill-climbing problem; trying to get from such a  starting point to the higher peaks only by taking small steps and never  going downhill almost never works.  Whats needed is a <em>fundamentally</em> different way of approaching the peaks.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>The first thing you have to do is form a mental map of your programs locking.  This map has two axes:</p>\n<ul>\n<li>The vertical axis represents code.  If youre using a staged  architecture with non-branching stages, you probably already have a  diagram showing these divisions, like the ones everybody uses for  OSI-model network protocol stacks.</li>\n<li>The horizontal axis represents data.  In every stage, each request  should be assigned to a data set with its own resources separate from  any other set.</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li>OSI</li>\n<li></li>\n</ul>\n</blockquote>\n<p>You now have a grid, where each cell represents a particular data set  in a particular processing stage.  Whats most important is the  following rule: two requests should not be in contention unless they are  in the same data set <em>and</em> the same processing stage.  If you can manage that, youve already won half the battle.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Once youve defined the grid, every type of locking your program does  can be plotted, and your next goal is to ensure that the resulting dots  are as evenly distributed along both axes as possible.  Unfortunately,  this part is very application-specific.  You have to think like a  diamond-cutter, using your knowledge of what the program does to find  the natural cleavage lines between stages and data sets.  Sometimes  theyre obvious to start with.  Sometimes theyre harder to find, but  seem more obvious in retrospect.  Dividing code into stages is a  complicated matter of program design, so theres not much I can offer  there, but here are some suggestions for how to define data sets:</p>\n<ul>\n<li>If you have some sort of a block number or hash or transaction ID  associated with requests, you can rarely do better than to divide that  value by the number of data sets.</li>\n<li>Sometimes, its better to assign requests to data sets dynamically,  based on which data set has the most resources available rather than  some intrinsic property of the request.  Think of it like multiple  integer units in a modern CPU; those guys know a thing or two about  making discrete requests flow through a system.</li>\n<li>Its often helpful to make sure that the data-set assignment is  different for each stage, so that requests which would contend at one  stage are guaranteed not to do so at another stage.</li>\n</ul>\n<blockquote>\n<p>(:code)(:offer)</p>\n<ul>\n<li>hashID</li>\n<li>CPU</li>\n<li></li>\n</ul>\n</blockquote>\n<p>If youve divided your locking space both vertically and  horizontally, and made sure that lock activity is spread evenly across  the resulting cells, you can be pretty sure that your locking is in  pretty good shape.  Theres one more step, though.  Do you remember the  small steps approach I derided a few paragraphs ago?  It still has its  place, because now youre at a good starting point instead of a  terrible one.  In metaphorical terms youre probably well up the slope  on one of the mountain ranges highest peaks, but youre probably not at  the top of one.  Now is the time to collect contention statistics and  see what you need to do to improve, splitting stages and data sets in  different ways and then collecting more statistics until youre  satisfied.  If you do all that, youre sure to have a fine view from the  mountaintop.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>As promised, Ive covered the four biggest performance problems in  server design.  There are still some important issues that any  particular server will need to address, though.  Mostly, these come down  to knowing your platform/environment:</p>\n<ul>\n<li>How does your storage subsystem perform with larger vs. smaller  requests?  With sequential vs. random?  How well do read-ahead and  write-behind work?</li>\n<li>How efficient is the network protocol youre using?  Are there  parameters or flags you can set to make it perform better?  Are there  facilities like TCP_CORK, MSG_PUSH, or the Nagle-toggling trick that you  can use to avoid tiny messages?</li>\n<li>Does your system support scatter/gather I/O (e.g. readv/writev)?   Using these can improve performance and also take much of the pain out  of using buffer chains.</li>\n<li>Whats your page size?  Whats your cache-line size?  Is it worth it  to align stuff on these boundaries?  How expensive are system calls or  context switches, relative to other things?</li>\n<li>Are your reader/writer lock primitives subject to starvation?  Of  whom?  Do your events have thundering herd problems?  Does your  sleep/wakeup have the nasty (but very common) behavior that when X wakes  Y a context switch to Y happens immediately even if X still has things  to do?</li>\n</ul>\n<blockquote>\n<p>4()</p>\n<ul>\n<li></li>\n<li>TCP_CORKMSG_PUSHNagle</li>\n<li>readv/writev/IO</li>\n<li>cache</li>\n<li>/<a href=\"https://en.wikipedia.org/wiki/Thundering_herd_problem\" target=\"_blank\" rel=\"noopener\"></a>(:)XYYX/</li>\n</ul>\n</blockquote>\n<p>Im sure I could think of many more questions in this vein.  Im sure  you could too.  In any particular situation it might not be worthwhile  to do anything about any one of these issues, but its usually worth at  least thinking about them.  If you dont know the answers - many of  which you will not find in the system documentation - <em>find out</em>.   Write a test program or micro-benchmark to find the answers  empirically; writing such code is a useful skill in and of itself  anyway.  If youre writing code to run on multiple platforms, many of  these questions correlate with points where you should probably be  abstracting functionality into per-platform libraries so you can realize  a performance gain on that one platform that supports a particular  feature.</p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>The know the answers theory applies to your own code, too.  Figure  out what the important high-level operations in your code are, and time  them under different conditions.  This is not quite the same as  traditional profiling; its about measuring <em>design</em> elements,  not actual implementations.  Low-level optimization is generally the  last resort of someone who screwed up the design.</p>\n<blockquote>\n<p></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<h2 id=\"High-Performance-Server-Architecture-Jeff-Darcy\"><a href=\"#High-Performance-Server-Architecture-Jeff-Darcy\" class=\"headerlink\" title=\"High-Performance Server Architecture-Jeff Darcy\"></a>High-Performance Server Architecture-Jeff Darcy</h2><p>The purpose of this document is to share some ideas that Ive  developed over the years about how to develop a certain kind of  application for which the term server is only a weak approximation.   More accurately, Ill be writing about a broad class of programs that  are designed to handle very large numbers of discrete messages or  requests per second. Network servers most commonly fit this definition,  but not all programs that do are really servers in any sense of the  word.  For the sake of simplicity, though, and because High-Performance  Request-Handling Programs is a really lousy title, well just say  server and be done with it.</p>\n<blockquote>\n<p></p>\n</blockquote>","more":"<p>I will not be writing about mildly parallel applications, even  though multitasking within a single program is now commonplace.  The  browser youre using to read this probably does some things in parallel,  but such low levels of parallelism really dont introduce many  interesting challenges.  The interesting challenges occur when the  request-handling infrastructure itself is the limiting factor on overall  performance, so that improving the infrastructure actually improves  performance.  Thats not often the case for a browser running on a  gigahertz processor with a gigabyte of memory doing six simultaneous  downloads over a DSL line.  The focus here is not on applications that  sip through a straw but on those that drink from a firehose, <u>on the very  edge of hardware capabilities where how you do it really does matter</u>.</p>\n<blockquote>\n<p>(mildly parallel)GBGHzDSL6yunxi </p>\n</blockquote>\n<p>Some people will inevitably take issue with some of my comments and  suggestions, or think they have an even better way.  Fine.  Im not  trying to be the Voice of God here; these are just methods that Ive  found to work for me, not only in terms of their effects on performance  but also in terms of their effects on the difficulty of debugging or  extending code later.  Your mileage may vary.  If something else works  better for you thats great, but be warned that almost everything I  suggest here exists as an alternative to something else that I tried  once only to be disgusted or horrified by the results.  <u>Your pet idea  might very well feature prominently in one of these stories</u>, and  innocent readers might be bored to death if you encourage me to start  telling them.  You wouldnt want to hurt them, would you?</p>\n<blockquote>\n<p>(),,, </p>\n</blockquote>\n<p>The rest of this article is going to be centered around what Ill call the Four Horsemen of Poor Performance:</p>\n<ol>\n<li>Data copies</li>\n<li>Context switches</li>\n<li>Memory allocation</li>\n<li>Lock contention</li>\n</ol>\n<blockquote>\n<p></p>\n<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n</blockquote>\n<p>There will also be a catch-all section at the end, but these are the  biggest performance-killers.  If you can handle most requests without  copying data, without a context switch, without going through the memory  allocator and without contending for locks, youll have a server that  performs well even if it gets some of the minor parts wrong.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>This could be a very short section, for one very simple reason: most  people have learned this lesson already.  Everybody knows data copies  are bad; its obvious, right?  Well, actually, it probably only seems  obvious because you learned it very early in your computing career, and  that only happened because somebody started putting out the word decades  ago.  I know thats true for me, but I digress.  Nowadays its covered  in every school curriculum and in every informal how-to.  <u>Even the  marketing types have figured out that zero copy is a good buzzword.</u></p>\n<blockquote>\n<p>(how-to)</p>\n</blockquote>\n<p>Despite the after-the-fact obviousness of copies being bad, though,  there still seem to be nuances that people miss.  The most important of  these is that data copies are often hidden and disguised.  Do you really  know whether any code you call in drivers or libraries does data  copies?  Its probably more than you think.  Guess what Programmed I/O  on a PC refers to.  An example of a copy thats disguised rather than  hidden is a hash function, which has all the memory-access cost of a  copy and also involves more computation.  <u>Once its pointed out that  hashing is effectively copying plus it seems obvious that it should be  avoided</u>, but I know at least one group of brilliant people who had to  figure it out the hard way.  If you really want to get rid of data  copies, either because they really are hurting performance or because  you want to put zero-copy operation on your hacker-conference slides,  youll need to track down a lot of things that really are data copies  but dont advertise themselves as such.</p>\n<blockquote>\n<p>PCIOhashhashCPUhash</p>\n</blockquote>\n<p>The tried and true method for avoiding data copies is to use  indirection, and pass buffer descriptors (or chains of buffer  descriptors) around instead of mere buffer pointers.  Each descriptor  typically consists of the following:</p>\n<ul>\n<li>A pointer and length for the whole buffer.</li>\n<li>A pointer and length, or offset and length, for the part of the buffer thats actually filled.</li>\n<li>Forward and back pointers to other buffer descriptors in a list.</li>\n<li>A reference count.</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</blockquote>\n<p>Now, instead of copying a piece of data to make sure it stays in  memory, code can simply increment a reference count on the appropriate  buffer descriptor.  This can work extremely well under some conditions,  including the way that a typical network protocol stack operates, but it  can also become a really big headache.  Generally speaking, its easy  to add buffers at the beginning or end of a chain, to add references to  whole buffers, and to deallocate a whole chain at once.  Adding in the  middle, deallocating piece by piece, or referring to partial buffers  will each make life increasingly difficult.  Trying to split or combine  buffers will simply drive you insane.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>I dont actually recommend using this approach for everything, though.  Why not?  Because it gets to be a <em>huge</em>  pain when you have to walk through descriptor chains every time you  want to look at a header field.  There really are worse things than data  copies.  I find that the best thing to do is to identify the large  objects in a program, such as data blocks, make sure <em>those</em> get allocated separately as described above so that they dont need to be copied, and not sweat too much about the other stuff.</p>\n<blockquote>\n<p>()()()</p>\n</blockquote>\n<p>This brings me to my last point about data copies: dont go overboard  avoiding them.  Ive seen way too much code that avoids data copies by  doing something even worse, like forcing a context switch or breaking up  a large I/O request.  Data copies are expensive, and when youre  looking for places to avoid redundant operations theyre one of the  first things you should look at, <u>but there is a point of diminishing  returns.  Combing through code and then making it twice as complicated  just to get rid of that last few data copies is usually a waste of time  that could be better spent in other ways.</u></p>\n<blockquote>\n<p>IO</p>\n</blockquote>\n<p>Whereas everyone thinks its obvious that data copies are bad, Im  often surprised by how many people totally ignore the effect of context  switches on performance.  In my experience, context switches are  actually behind more total meltdowns at high load than data copies;  the system starts spending more time going from one thread to another  than it actually spends within any thread doing useful work.  The  amazing thing is that, at one level, its totally obvious what causes  excessive context switching.  The #1 cause of context switches is having  more active threads than you have processors.  As the ratio of active  threads to processors increases, the number of context switches also  increases - linearly if youre lucky, but often exponentially.  This  very simple fact explains why multi-threaded designs that have one  thread per connection scale very poorly.  The only realistic alternative  for a scalable system is to limit the number of active threads so its  (usually) less than or equal to the number of processors.  One popular  variant of this approach is to use only one thread, ever; while such an  approach does avoid context thrashing, and avoids the need for locking  as well, <u>it is also incapable of achieving more than one processors  worth of total throughput and thus remains beneath contempt unless the  program will be non-CPU-bound (usually network-I/O-bound) anyway.</u></p>\n<blockquote>\n<p>(active)(processor) </p>\n</blockquote>\n<p>The first thing that a thread-frugal program has to do is figure  out how its going to make one thread handle multiple connections at  once.  This usually implies a front end that uses select/poll,  asynchronous I/O, signals or completion ports, with an event-driven  structure behind that.  Many religious wars have been fought, and  continue to be fought, over which of the various front-end APIs is best.   Dan Kegels <a href=\"http://www.kegel.com/c10k.html\" target=\"_blank\" rel=\"noopener\">C10K paper</a> is  a good resource is this area.  Personally, I think all flavors of  select/poll and signals are ugly hacks, and therefore favor either AIO  or completion ports, but it actually doesnt matter that much.  They all  - except maybe select() - work reasonably well, and dont really do  much to address the matter of what happens past the very outermost layer  of your programs front end.</p>\n<blockquote>\n<p>select/pollIO<a href=\"https://en.wikipedia.org/wiki/Input/output_completion_port\" target=\"_blank\" rel=\"noopener\">IOCP</a>(:)API <a href=\"http://www.kegel.com/c10k.html\" target=\"_blank\" rel=\"noopener\">C10K paper</a> Dan Kegelselect/pollIOIOCP<code>select()</code></p>\n</blockquote>\n<p>The simplest conceptual model of a multi-threaded event-driven server  has a queue at its center; requests are read by one or more listener  threads and put on queues, from which one or more worker threads will  remove and process them.  Conceptually, this is a good model, but all  too often people actually implement their code this way.  Why is this  wrong?  Because the #2 cause of context switches is transferring work  from one thread to another.  <u>Some people even compound the error by  requiring that the response to a request be sent by the original thread -  guaranteeing not one but two context switches per request</u>.  Its very  important to use a symmetric approach in which a given thread can go  from being a listener to a worker to a listener again without ever  changing context.  Whether this involves partitioning connections  between threads or having all threads take turns being listener for the  entire set of connections seems to matter a lot less.</p>\n<blockquote>\n<p><u></u> </p>\n</blockquote>\n<p>Usually, its not possible to know how many threads will be active  even one instant into the future.  After all, requests can come in on  any connection at any moment, or background threads dedicated to  various maintenance tasks could pick that moment to wake up.  If you  dont <em>know</em> how many threads are active, how can you <em>limit</em>  how many are active?  In my experience, one of the most effective  approaches is also one of the simplest: use an old-fashioned counting  semaphore which each thread must hold whenever its doing real work.   If the thread limit has already been reached then each listen-mode  thread might incur one extra context switch as it wakes up and then  blocks on the semaphore, but once all listen-mode threads have blocked  in this way they wont continue contending for resources until one of  the existing threads retires so the system effect is negligible.  More  importantly, this method handles maintenance threads - which sleep most  of the time and therefore dont count against the active thread count -  more gracefully than most alternatives.</p>\n<blockquote>\n<p>instance()gracefully</p>\n</blockquote>\n<p>Once the processing of requests has been broken up into two stages  (listener and worker) with multiple threads to service the stages, its  natural to break up the processing even further into more than two  stages.  In its simplest form, processing a request thus becomes a  matter of invoking stages successively in one direction, and then in the  other (for replies).  However, things can get more complicated; a stage  might represent a fork between two processing paths which involve  different stages, or it might generate a reply (e.g. a cached value)  itself without invoking further stages.  Therefore, each stage needs to  be able to specify what should happen next for a request.  There are  three possibilities, represented by return values from the stages  dispatch function:</p>\n<ul>\n<li><u>The request needs to be passed on to another stage (an ID or pointer in the return value).</u></li>\n<li>The request has been completed (a special request done return value)</li>\n<li>The request was blocked (a special request blocked return value).   This is equivalent to the previous case, except that the request is not  freed and will be continued later from another thread.</li>\n</ul>\n<blockquote>\n<p>()()(dispatch)</p>\n<ul>\n<li>(ID)</li>\n<li>()</li>\n<li>()</li>\n</ul>\n</blockquote>\n<p>Note that, in this model, queuing of requests is done <em>within</em>  stages, not between stages.  This avoids the common silliness of  constantly putting a request on a successor stages queue, then  immediately invoking that successor stage and dequeuing the request  again; I call that lots of queue activity - and locking - for nothing.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>If this idea of separating a complex task into multiple smaller  communicating parts seems familiar, thats because its actually very  old.  <u>My approach has its roots in the <a href=\"http://www.afm.sbu.ac.uk/csp/\" target=\"_blank\" rel=\"noopener\">Communicating Sequential Processes</a>  concept elucidated by C.A.R. Hoare in 1978, based in turn on ideas from  Per Brinch Hansen and Matthew Conway going back to 1963 - before I was  born!</u>  However, when Hoare coined the term CSP he meant process in the  abstract mathematical sense, and a CSP process need bear no relation to  the operating-system entities of the same name.  In my opinion, the  common approach of implementing CSP via thread-like coroutines within a  single OS thread gives the user all of the headaches of concurrency with  none of the scalability.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>A contemporary example of the staged-execution idea <u>evolved in a saner direction is Matt Welshs <a href=\"http://www.cs.berkeley.edu/~mdw/proj/seda/\" target=\"_blank\" rel=\"noopener\">SEDA</a></u>.   In fact, SEDA is such a good example of server architecture done  right that its worth commenting on some of its specific  characteristics (especially where those differ from what Ive outlined  above). </p>\n<ol>\n<li>SEDAs batching tends to emphasize processing multiple requests  through a stage at once, while my approach tends to emphasize processing  a single request through multiple stages at once.</li>\n<li>SEDAs one significant flaw, in my opinion, is that it allocates a  separate thread pool to each stage with only background reallocation  of threads between stages in response to load.  As a result, the #1 and  #2 causes of context switches noted above are still very much present.</li>\n<li>In the context of an academic research project, implementing SEDA in  Java might make sense.  In the real world, though, I think the choice  can be characterized as unfortunate.</li>\n</ol>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Allocating and freeing memory is one of the most common operations in  many applications.  Accordingly, many clever tricks have been developed  to make general-purpose memory allocators more efficient.  However, <u>no  amount of cleverness can make up for the fact that the very generality  of such allocators inevitably makes them far less efficient than the  alternatives in many cases</u>.  I therefore have three suggestions for how  to avoid the system memory allocator altogether.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>Suggestion #1 is simple preallocation.  We all know that static  allocation is bad when it imposes artificial limits on program  functionality, but there are many other forms of preallocation that can  be quite beneficial.  Usually the reason comes down to the fact that one  trip through the system memory allocator is better than several, even  when some memory is wasted in the process.  Thus, if its possible to  assert that no more than N items could ever be in use at once,  preallocation at program startup might be a valid choice.  Even when  thats not the case, preallocating everything that a request handler  might need right at the beginning might be preferable to allocating each  piece as its needed; aside from the possibility of allocating multiple  items contiguously in one trip through the system allocator, this often  greatly simplifies error-recovery code.  If memory is very tight then  preallocation might not be an option, but in all but the most extreme  circumstances it generally turns out to be a net win.</p>\n<blockquote>\n<p>()N()()</p>\n</blockquote>\n<p>Suggestion #2 is to use lookaside lists for objects that are  allocated and freed frequently.  The basic idea is to put recently-freed  objects onto a list instead of actually freeing them, in the hope that  if theyre needed again soon they need merely be taken off the list  instead of being allocated from system memory.  As an additional  benefit, transitions to/from a lookaside list can often be implemented  to skip complex object initialization/finalization.</p>\n<blockquote>\n<p>(:oftenalways)(:)</p>\n</blockquote>\n<p>Its generally undesirable to have lookaside lists grow without  bound, never actually freeing anything even when your program is idle.   Therefore, its usually necessary to have some sort of periodic  sweeper task to free inactive objects, but it would also be  undesirable if the sweeper introduced undue locking complexity or  contention.  A good compromise is therefore a system in which a  lookaside list actually consists of separately locked old and new  lists.  Allocation is done preferentially from the new list, then from  the old list, and from the system only as a last resort; objects are  always freed onto the new list.  The sweeper thread operates as follows:</p>\n<ol>\n<li>Lock both lists.</li>\n<li>Save the head for the old list.</li>\n<li>Make the (previously) new list into the old list by assigning list heads.</li>\n<li>Unlock.</li>\n<li>Free everything on the saved old list at leisure.</li>\n</ol>\n<blockquote>\n<p>()()</p>\n<ol>\n<li></li>\n<li></li>\n<li>()</li>\n<li></li>\n<li></li>\n</ol>\n</blockquote>\n<p>Objects in this sort of system are only actually freed when they have  not been needed for at least one full sweeper interval, but always less  than two.  Most importantly, the sweeper does most of its work without  holding any locks to contend with regular threads.  In theory, the same  approach can be generalized to more than two stages, but I have yet to  find that useful.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>One concern with using lookaside lists is that the list pointers  might increase object size.  In my experience, most of the objects that  Id use lookaside lists for already contain list pointers anyway, so  its kind of a moot point.  Even if the pointers were only needed for  the lookaside lists, though, the savings in terms of avoided trips  through the system memory allocator (and object initialization) would  more than make up for the extra memory.</p>\n<blockquote>\n<p>()</p>\n</blockquote>\n<p>Suggestion #3 actually has to do with locking, which we havent  discussed yet, but Ill toss it in anyway.  Lock contention is often the  biggest cost in allocating memory, even when lookaside lists are in  use.  One solution is to maintain multiple private lookaside lists, such  that theres absolutely no possibility of contention for any one list.   For example, you could have a separate lookaside list for each thread.   One list per processor can be even better, due to cache-warmth  considerations, but only works if threads cannot be preempted.  The  private lookaside lists can even be combined with a shared list if  necessary, to create a system with extremely low allocation overhead.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Efficient locking schemes are notoriously hard to design, because of  what I call Scylla and Charybdis after the monsters in the Odyssey.   Scylla is locking thats too simplistic and/or coarse-grained,  serializing activities that can or should proceed in parallel and thus  sacrificing performance and scalability; Charybdis is overly complex or  fine-grained locking, with space for locks and time for lock operations  again sapping performance.  Near Scylla are shoals representing deadlock  and livelock conditions; near Charybdis are shoals representing race  conditions.  In between, theres a narrow channel that represents  locking which is both efficient and corrector is there?  Since  locking tends to be deeply tied to program logic, its often impossible  to design a good locking scheme without fundamentally changing how the  program works.  This is why people hate locking, and try to rationalize  their use of non-scalable single-threaded approaches.</p>\n<blockquote>\n<p>  </p>\n</blockquote>\n<p>Almost every locking scheme starts off as one big lock around  everything and a vague hope that performance wont suck.  When that  hope is dashed, and it almost always is, the big lock is broken up into  smaller ones and the prayer is repeated, and then the whole process is  repeated, presumably until performance is adequate.  Often, though, each  iteration increases complexity and locking overhead by 20-50% in return  for a 5-10% decrease in lock contention.  With luck, the net result is  still a modest increase in performance, but actual decreases are not  uncommon.  The designer is left scratching his head (I use his because  Im a guy myself; get over it).  I made the locks finer grained like  all the textbooks said I should, he thinks, so why did performance get  worse?</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>In my opinion, things got worse because the  aforementioned approach is fundamentally misguided.  Imagine the  solution space as a mountain range, with high points representing good  solutions and low points representing bad ones.  The problem is that  the one big lock starting point is almost always separated from the  higher peaks by all manner of valleys, saddles, lesser peaks and dead  ends.  Its a classic hill-climbing problem; trying to get from such a  starting point to the higher peaks only by taking small steps and never  going downhill almost never works.  Whats needed is a <em>fundamentally</em> different way of approaching the peaks.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>The first thing you have to do is form a mental map of your programs locking.  This map has two axes:</p>\n<ul>\n<li>The vertical axis represents code.  If youre using a staged  architecture with non-branching stages, you probably already have a  diagram showing these divisions, like the ones everybody uses for  OSI-model network protocol stacks.</li>\n<li>The horizontal axis represents data.  In every stage, each request  should be assigned to a data set with its own resources separate from  any other set.</li>\n</ul>\n<blockquote>\n<p></p>\n<ul>\n<li>OSI</li>\n<li></li>\n</ul>\n</blockquote>\n<p>You now have a grid, where each cell represents a particular data set  in a particular processing stage.  Whats most important is the  following rule: two requests should not be in contention unless they are  in the same data set <em>and</em> the same processing stage.  If you can manage that, youve already won half the battle.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>Once youve defined the grid, every type of locking your program does  can be plotted, and your next goal is to ensure that the resulting dots  are as evenly distributed along both axes as possible.  Unfortunately,  this part is very application-specific.  You have to think like a  diamond-cutter, using your knowledge of what the program does to find  the natural cleavage lines between stages and data sets.  Sometimes  theyre obvious to start with.  Sometimes theyre harder to find, but  seem more obvious in retrospect.  Dividing code into stages is a  complicated matter of program design, so theres not much I can offer  there, but here are some suggestions for how to define data sets:</p>\n<ul>\n<li>If you have some sort of a block number or hash or transaction ID  associated with requests, you can rarely do better than to divide that  value by the number of data sets.</li>\n<li>Sometimes, its better to assign requests to data sets dynamically,  based on which data set has the most resources available rather than  some intrinsic property of the request.  Think of it like multiple  integer units in a modern CPU; those guys know a thing or two about  making discrete requests flow through a system.</li>\n<li>Its often helpful to make sure that the data-set assignment is  different for each stage, so that requests which would contend at one  stage are guaranteed not to do so at another stage.</li>\n</ul>\n<blockquote>\n<p>(:code)(:offer)</p>\n<ul>\n<li>hashID</li>\n<li>CPU</li>\n<li></li>\n</ul>\n</blockquote>\n<p>If youve divided your locking space both vertically and  horizontally, and made sure that lock activity is spread evenly across  the resulting cells, you can be pretty sure that your locking is in  pretty good shape.  Theres one more step, though.  Do you remember the  small steps approach I derided a few paragraphs ago?  It still has its  place, because now youre at a good starting point instead of a  terrible one.  In metaphorical terms youre probably well up the slope  on one of the mountain ranges highest peaks, but youre probably not at  the top of one.  Now is the time to collect contention statistics and  see what you need to do to improve, splitting stages and data sets in  different ways and then collecting more statistics until youre  satisfied.  If you do all that, youre sure to have a fine view from the  mountaintop.</p>\n<blockquote>\n<p></p>\n</blockquote>\n<p>As promised, Ive covered the four biggest performance problems in  server design.  There are still some important issues that any  particular server will need to address, though.  Mostly, these come down  to knowing your platform/environment:</p>\n<ul>\n<li>How does your storage subsystem perform with larger vs. smaller  requests?  With sequential vs. random?  How well do read-ahead and  write-behind work?</li>\n<li>How efficient is the network protocol youre using?  Are there  parameters or flags you can set to make it perform better?  Are there  facilities like TCP_CORK, MSG_PUSH, or the Nagle-toggling trick that you  can use to avoid tiny messages?</li>\n<li>Does your system support scatter/gather I/O (e.g. readv/writev)?   Using these can improve performance and also take much of the pain out  of using buffer chains.</li>\n<li>Whats your page size?  Whats your cache-line size?  Is it worth it  to align stuff on these boundaries?  How expensive are system calls or  context switches, relative to other things?</li>\n<li>Are your reader/writer lock primitives subject to starvation?  Of  whom?  Do your events have thundering herd problems?  Does your  sleep/wakeup have the nasty (but very common) behavior that when X wakes  Y a context switch to Y happens immediately even if X still has things  to do?</li>\n</ul>\n<blockquote>\n<p>4()</p>\n<ul>\n<li></li>\n<li>TCP_CORKMSG_PUSHNagle</li>\n<li>readv/writev/IO</li>\n<li>cache</li>\n<li>/<a href=\"https://en.wikipedia.org/wiki/Thundering_herd_problem\" target=\"_blank\" rel=\"noopener\"></a>(:)XYYX/</li>\n</ul>\n</blockquote>\n<p>Im sure I could think of many more questions in this vein.  Im sure  you could too.  In any particular situation it might not be worthwhile  to do anything about any one of these issues, but its usually worth at  least thinking about them.  If you dont know the answers - many of  which you will not find in the system documentation - <em>find out</em>.   Write a test program or micro-benchmark to find the answers  empirically; writing such code is a useful skill in and of itself  anyway.  If youre writing code to run on multiple platforms, many of  these questions correlate with points where you should probably be  abstracting functionality into per-platform libraries so you can realize  a performance gain on that one platform that supports a particular  feature.</p>\n<blockquote>\n<p> </p>\n</blockquote>\n<p>The know the answers theory applies to your own code, too.  Figure  out what the important high-level operations in your code are, and time  them under different conditions.  This is not quite the same as  traditional profiling; its about measuring <em>design</em> elements,  not actual implementations.  Low-level optimization is generally the  last resort of someone who screwed up the design.</p>\n<blockquote>\n<p></p>\n</blockquote>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjvdf73530000t0t895rrtlf8","category_id":"cjvdf735c0004t0t85z0mjr0u","_id":"cjvdf735n000et0t8k2zsny3h"},{"post_id":"cjvdf73590002t0t8z123js4m","category_id":"cjvdf735j000at0t8z3q48xc2","_id":"cjvdf735p000ht0t8vfv9ahtd"},{"post_id":"cjvdf735e0005t0t8odzc0p7f","category_id":"cjvdf735o000ft0t8gujyfivd","_id":"cjvdf735r000lt0t8b046nt6s"},{"post_id":"cjvdf735g0008t0t8i1gb3gw3","category_id":"cjvdf735q000it0t815p2u6lx","_id":"cjvdf735t000rt0t8to687u53"},{"post_id":"cjvdf735i0009t0t80fi9aouz","category_id":"cjvdf735j000at0t8z3q48xc2","_id":"cjvdf735u000tt0t887cnpbes"},{"post_id":"cjvdf735k000bt0t8p96q7v91","category_id":"cjvdf735t000qt0t8bsvw8wo8","_id":"cjvdf735u000ut0t8o1fz7tu6"},{"post_id":"cjvdf736n000vt0t8amk4sw6a","category_id":"cjvdf735q000it0t815p2u6lx","_id":"cjvdf736s0010t0t8xt2rp2yd"},{"post_id":"cjvdf736q000yt0t8191p0ch5","category_id":"cjvdf735t000qt0t8bsvw8wo8","_id":"cjvdf736t0013t0t8ly022ca6"},{"post_id":"cjvdf736p000wt0t8j2tfe185","category_id":"cjvdf736r000zt0t82cwv7sdl","_id":"cjvdf736u0015t0t8cqtl3610"},{"post_id":"cjvdf736x0018t0t8ycahkyvq","category_id":"cjvdf735t000qt0t8bsvw8wo8","_id":"cjvdf736z001at0t8qdx84snw"},{"post_id":"cjvdf7377001ct0t8vd04s0hg","category_id":"cjvdf735t000qt0t8bsvw8wo8","_id":"cjvdf7379001et0t8sqju2tpf"},{"post_id":"cjvdf737b001gt0t8jg7ypbkm","category_id":"cjvdf735q000it0t815p2u6lx","_id":"cjvdf737d001it0t8bdxqwufo"}],"PostTag":[{"post_id":"cjvdf73590002t0t8z123js4m","tag_id":"cjvdf735f0007t0t89q16vs37","_id":"cjvdf735n000dt0t8pe53d47h"},{"post_id":"cjvdf735e0005t0t8odzc0p7f","tag_id":"cjvdf735m000ct0t8bgg43g3j","_id":"cjvdf735r000kt0t8brihjomx"},{"post_id":"cjvdf735e0005t0t8odzc0p7f","tag_id":"cjvdf735p000gt0t820ig7imp","_id":"cjvdf735s000nt0t84nirpl1d"},{"post_id":"cjvdf735i0009t0t80fi9aouz","tag_id":"cjvdf735q000jt0t8cpiur4b4","_id":"cjvdf735t000pt0t8xnlhmejj"},{"post_id":"cjvdf735k000bt0t8p96q7v91","tag_id":"cjvdf735s000ot0t8182e8i3z","_id":"cjvdf735u000st0t837n7zw8v"},{"post_id":"cjvdf736n000vt0t8amk4sw6a","tag_id":"cjvdf736q000xt0t87npujfiu","_id":"cjvdf736t0012t0t8rms6e7s4"},{"post_id":"cjvdf736p000wt0t8j2tfe185","tag_id":"cjvdf736s0011t0t8jd36xkp6","_id":"cjvdf736u0016t0t82ne48841"},{"post_id":"cjvdf736q000yt0t8191p0ch5","tag_id":"cjvdf736u0014t0t8c2pja49s","_id":"cjvdf736v0017t0t82mhryj96"},{"post_id":"cjvdf736x0018t0t8ycahkyvq","tag_id":"cjvdf736y0019t0t8g4xboozr","_id":"cjvdf7370001bt0t8jz58j8lp"},{"post_id":"cjvdf7377001ct0t8vd04s0hg","tag_id":"cjvdf7378001dt0t82cd250ck","_id":"cjvdf7379001ft0t8njdxr3ep"},{"post_id":"cjvdf737b001gt0t8jg7ypbkm","tag_id":"cjvdf737c001ht0t8s3sioxs8","_id":"cjvdf737d001jt0t8qb3j2x6q"}],"Tag":[{"name":"grandpa","_id":"cjvdf735f0007t0t89q16vs37"},{"name":"blog","_id":"cjvdf735m000ct0t8bgg43g3j"},{"name":"hexo","_id":"cjvdf735p000gt0t820ig7imp"},{"name":"dissertation","_id":"cjvdf735q000jt0t8cpiur4b4"},{"name":"c++2.0","_id":"cjvdf735s000ot0t8182e8i3z"},{"name":"TCG","_id":"cjvdf736q000xt0t87npujfiu"},{"name":"protobuf","_id":"cjvdf736s0011t0t8jd36xkp6"},{"name":"cpp","_id":"cjvdf736u0014t0t8c2pja49s"},{"name":"rust","_id":"cjvdf736y0019t0t8g4xboozr"},{"name":"Linux","_id":"cjvdf7378001dt0t82cd250ck"},{"name":"High-Performance","_id":"cjvdf737c001ht0t8s3sioxs8"}]}}