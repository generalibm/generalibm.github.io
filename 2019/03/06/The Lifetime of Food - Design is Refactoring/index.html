<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>[Translation] Design is refactoring | A creative expression</title>
  <meta name="author" content="generalibm">
  
  <meta name="description" content="A Rusty Analogy using Millennial Stereotypes.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="[Translation] Design is refactoring">
  <meta property="og:site_name" content="A creative expression">

  
    <meta property="og:image" content="">
  

  
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
    <script src="/js/marked.js"></script>
    <script src="/js/comment.js"></script>
    <script src="/js/timeago.min.js"></script>
    <script src="/js/highlight.min.js"></script>
	<script src="/js/spin.min.js"></script>
  
  <!-- analytics -->
  



</head>
</html>
 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">A creative expression</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> [Translation] Design is refactoring</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> <p>A Rusty Analogy using Millennial Stereotypes.</p>
			
		 </div> <!-- alert -->
	  		

	  <h2 id="Design-is-Refactoring-The-Lifetime-of-Food"><a href="#Design-is-Refactoring-The-Lifetime-of-Food" class="headerlink" title="Design is Refactoring-The Lifetime of Food"></a><a href="http://designisrefactoring.com/2016/08/10/the-lifetime-of-food/" target="_blank" rel="noopener">Design is Refactoring-The Lifetime of Food</a></h2><p>设计即重构 —— 食物的生命周期<br>A Rusty Analogy using Millennial Stereotypes<br>一个采用千禧年固化形象的 rust 式类比</p>
<p>Imagine you are out to dinner with some friends. You  are all stereotypical Millennials so photographing your meal is  expected. For every dish you order each of your friends borrows it,  takes a photograph, and then returns it to you.</p>
<blockquote>
<p>想象一下，你准备和几个朋友一起去外面吃饭，你们都是典型的<a href="https://baike.baidu.com/item/%E5%8D%83%E7%A6%A7%E4%B8%80%E4%BB%A3/2683826?fr=aladdin" target="_blank" rel="noopener">千禧年一代</a>，所以拍照是意料之中的事情。对于你点的每一道菜，他们都会拿过去拍一张， 然后再还给你。<br><a id="more"></a></p>
</blockquote>
<p>Well, that’s the plan anyway. Some of your friends are not the most  reliable. Will they always return the right dish to you? Will they try  to sneak a bite? Human friends are so unreliable. But if your friends  were Rust functions you’d have nothing to worry about, thanks to Rust’s  rules around borrowing and lifetimes.</p>
<blockquote>
<p>好了，这就是所谓的计划。他们之中有几个不是非常的靠得住。他们一定要把你点的还回来么？他们会吃掉几口么？人类朋友是非常不可靠的。但是如果你的朋友是 <code>Rust functions</code> ，  那你就不用担心啦，这要感谢 <code>Rust</code> 围绕 <strong>借</strong> 规则和 <strong>生命周期</strong> 规则。</p>
</blockquote>
<p>Let’s model this dinner party in Rust and see if we can learn a thing or two about borrowing and lifetimes.</p>
<blockquote>
<p>那就让我们使用 <code>Rust</code> 为这次晚餐聚会建模，然后看看我们能否学习一两点关于 <strong>借用</strong> 和 <strong>生命周期</strong> 的知识。</p>
</blockquote>
<p>We’ll start off with the basics, a Dish that can be photographed.</p>
<blockquote>
<p>我们将从基础开始，一盘用来拍照的菜。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    doro.photograph(<span class="string">"Me"</span>);</span><br><span class="line">    bruschetta.photograph(<span class="string">"Me"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>We have a <code>Dish</code> struct which contains a name. There’s one function on <code>Dish</code>, <code>photograph</code>. You get your dishes from the hot new Italian/Ethiopian fusion restaurant and take their pictures.</p>
<blockquote>
<p>我们有一个 <code>Dish</code> 结构体，里面包含一个 <code>name</code> 字段。<code>Dish</code> 还实现了一个函数 <code>photogragh</code>。 你在新开的火爆的意大利 / 埃塞俄比亚融合餐厅点了一些菜并拍下了它们的照片。</p>
</blockquote>
<p>Let’s introduce one of your friends. We’ll start off with your most  honest and trustworthy companion. Being honest this friend wants to  borrow a dish photograph it and return it. They don’t want you giving  them more than one dish – that could get confusing! When converted to a  Rust function, this friend looks like:</p>
<blockquote>
<p>让我们介绍一位你的朋友。我们将从最诚实最值得信任的伙伴开始。这位最信任的朋友想借一盘菜，拍照后再还给你。他们不让你给他们多于一盘菜，因为那将会很困扰。当将其写成 <code>Rust fucntion</code> ，这位朋友将会像这样：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class="line">  dish.photograph(<span class="string">"Honest Friend"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Our dinner-party now looks like:</p>
<blockquote>
<p>现在，我们的晚餐聚会是这样：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">honest_friend</span></span>(dish: &amp;Dish) &#123;</span><br><span class="line">    dish.photograph(<span class="string">"Honest Friend"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    honest_friend(&amp;doro);</span><br><span class="line">    honest_friend(&amp;bruschetta);</span><br><span class="line"></span><br><span class="line">    doro.photograph(<span class="string">"Me"</span>);</span><br><span class="line">    bruschetta.photograph(<span class="string">"Me"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+honest_friend%28dish%3A+%26Dish%29+%7B%0A++++dish.photograph%28%22Honest+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++honest_friend%28%26doro%29%3B%0A++++honest_friend%28%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>Note that your friend is not explicitly returning the Dish at the end  of their function. Thanks to Rust’s borrowing rules they don’t have to.  When your friend’s scope ends, the borrow ends.</p>
<blockquote>
<p>要知道你的朋友并不是显式地在函数最后归还了那盘菜。由于 <code>Rust</code> 的 <strong>借用</strong> 规则，他们无需如此。一旦你朋友的 <code>scope</code> 结束，<strong>借用</strong> 也就结束了。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">honest_friend</span></span>(dish: &amp;Dish) &#123;      <span class="comment">//-- Borrow of the dish begins here</span></span><br><span class="line">  dish.photograph(<span class="string">"Honest Friend"</span>)   <span class="comment">// |</span></span><br><span class="line">&#125;                                   <span class="comment">//-- Borrow of the dish ends here</span></span><br></pre></td></tr></table></figure>
<p>A new friend joins your table. This friend likes to play pranks, but  they don’t always go as expected. Your Trickster Friend says, “Loan me a  dish and I’ll give you a dish back. Trust me, I’m going to return to  you the same dish you loaned me.” You have your doubts.</p>
<blockquote>
<p>一个新朋友加入你们。这位朋友喜欢搞恶作剧，但也不是总是恶搞。你的骗子朋友说，“借我一盘菜，我会原样还给你的”。你有你的（如下）疑虑。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class="line">    dish.photograph(<span class="string">"Incompenent Friend"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Tricks and Pranks ensue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is this really the same dish you loaned?</span></span><br><span class="line">    mystery_dish</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend</span></span>(dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class="line">    dish.photograph(<span class="string">"Trickster Friend"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Your friend is either returning the same dish or a different one.</span></span><br><span class="line">    <span class="comment">// Try running both options by uncommenting the assignments of mystery_dish</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Option One: Returning a different one</span></span><br><span class="line">    <span class="comment">// let mystery_dish = &amp;Dish &#123; name: String::from("Pad Thai") &#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Option Two: Returning the same one</span></span><br><span class="line">    <span class="comment">// let mystery_dish = dish;</span></span><br><span class="line"></span><br><span class="line">    mystery_dish</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_dish = trickster_friend(&amp;doro); </span><br><span class="line"></span><br><span class="line">    mystery_dish.photograph(<span class="string">"Me"</span>);</span><br><span class="line">    bruschetta.photograph(<span class="string">"Me"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend%28dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2F+Your+friend+is+either+returning+the+same+dish+or+a+different+one.%0A++++%2F%2F+Try+running+both+options+by+uncommenting+the+assignments+of+mystery_dish%0A%0A++++%2F%2F+Option+One%3A+Returning+a+different+one%0A++++%2F%2F+let+mystery_dish+%3D+%26Dish+%7B+name%3A+String%3A%3Afrom%28%22Pad+Thai%22%29+%7D%3B%0A%0A++++%2F%2F+Option+Two%3A+Returning+the+same+one%0A++++%2F%2F+let+mystery_dish+%3D+dish%3B%0A%0A++++mystery_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_dish+%3D+trickster_friend%28%26doro%29%3B+%0A%0A++++mystery_dish.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>Try both options and you’ll see that your trickster friend can not  prank you by giving you Pad Thai. The Pad Thai value is owned inside <code>trickster_friend</code> and is destroyed when <code>trickster_friend</code> ends. This is a bit easier to see if you inline the <code>trickster_friend</code> function into your <code>main</code> function.</p>
<blockquote>
<p>两种方案都试一下，你就会发现你的骗子朋友是不能给你一盘泰式（Pad Thai）来蒙骗过关。这个 Pad Thai 值由你的骗子朋友内部所有，并且在骗子朋友结束之后也随之销毁。如果将其内联到你的 <code>main</code> 函数中，就更加清晰了。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = &#123;                                          <span class="comment">//-- Mystery Meal is created here </span></span><br><span class="line">      <span class="keyword">let</span> other_dish = &amp;Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Pad Thai"</span>) &#125;;  <span class="comment">// |  //-- Pad Thai is created here</span></span><br><span class="line">      other_dish                                                  <span class="comment">// |     |</span></span><br><span class="line">    &#125;                                                             <span class="comment">// |  //-- Pad Thai is destroyed here</span></span><br><span class="line">                                                                  <span class="comment">// |</span></span><br><span class="line">    me(mystery_meal)                                              <span class="comment">//-- Mystery meal lives for longer than Pad Thai,</span></span><br><span class="line">                                                                  <span class="comment">//   so it can't contain a reference to Pad Thai. </span></span><br><span class="line">                                                                  <span class="comment">//   Compiler Error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Our trickster friend shows us that if a function is going to receive and return a single borrowed reference it <em>has</em> to return the same reference it received. Even though our friend’s tricky plan failed we learned something from it!</p>
<blockquote>
<p>我们这位骗子朋友向我们展示了：如果一个函数想要 <strong>接收</strong> 然后 <strong>返回</strong> 一个它自己拥有的 <strong>借用引用</strong> ，那就必须原样返回收到的 <strong>引用</strong>。尽管我们的骗子朋友没有得逞，我们也学到了一些新的东西。</p>
</blockquote>
<p>A third, very impatient friend arrives to our party. They don’t have  time for this “one plate at a time” nonsense; this friend wants you to  loan them two dishes at once:</p>
<blockquote>
<p>第三位加入到聚会的是一个尤为不耐心的朋友。他没有时间参与这种无意义的“一盘接着一盘”游戏；他想让你一次借给他两盘：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class="line">    first_dish.photograph(<span class="string">"Impatient Friend"</span>);</span><br><span class="line">    second_dish.photograph(<span class="string">"Impatient Friend"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">impatient_friend</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) &#123;</span><br><span class="line">    first_dish.photograph(<span class="string">"Impatient Friend"</span>);</span><br><span class="line">    second_dish.photograph(<span class="string">"Impatient Friend"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    impatient_friend(&amp;doro, &amp;bruschetta);</span><br><span class="line"></span><br><span class="line">    doro.photograph(<span class="string">"Me"</span>);</span><br><span class="line">    bruschetta.photograph(<span class="string">"Me"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+impatient_friend%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+%7B%0A++++first_dish.photograph%28%22Impatient+Friend%22%29%3B%0A++++second_dish.photograph%28%22Impatient+Friend%22%29%3B%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++impatient_friend%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++doro.photograph%28%22Me%22%29%3B%0A++++bruschetta.photograph%28%22Me%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>Just as with your honest friend, this works fine. We loan our two dishes to our impatient friend who takes their photos. When <code>impatient_friend</code> ends, so do the borrows.</p>
<blockquote>
<p>就像你的那位值得信任的朋友那样，一切正常。我们借给不耐心朋友两盘菜，他拿去拍照。当这位朋友结束，借用也就结束了。</p>
</blockquote>
<p>But your trickster friend sees this exchange and gets an idea. They  now know that they can’t return a plate of Pad Thai, but they figure  that if they borrow 2 plates and only return one, they can keep that  extra plate for themselves.</p>
<blockquote>
<p>但是，你的捣蛋鬼朋友看到这种变化之后立马有了一个主意。他知道现在不能还一盘泰式，但是他想着如果借两盘，还一盘如何呢？</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_again</span></span>(first_dish: &amp;Dish, second_dish: &amp;Dish) -&gt; &amp;Dish &#123;</span><br><span class="line">    first_dish.photograph(<span class="string">"Trickster Friend"</span>);</span><br><span class="line">    second_dish.photograph(<span class="string">"Trickster Friend"</span>);</span><br><span class="line"></span><br><span class="line">    first_dish</span><br><span class="line">    <span class="comment">//ha hah hah, I get to keep the second dish!</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = trickster_friend_again(&amp;doro, &amp;bruschetta);</span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_again%28first_dish%3A+%26Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++first_dish%0A++++%2F%2Fha+hah+hah%2C+I+get+to+keep+the+second+dish%21%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_again%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>Foiled again! If you run that you’ll get <code>error: missing lifetime specifier</code>.</p>
<blockquote>
<p>再次受挫！如果你运行上述程序，你会得到 “error: missing lifetime specifier”。</p>
</blockquote>
<p>Remember what we first learned from our Trickster Friend? If a  function receives and returns a single reference then it must be the  same reference, otherwise you could return something that does not live  long enough. That’s easy for the Rust compiler to check as there’s only  one option. But this function receives two references and returns one.  How does the compiler ensure that the reference you return points to a  value that lives long enough?</p>
<blockquote>
<p>还记得第一次从这位捣蛋鬼朋友身上学习到什么了不？如果一个函数 <strong>接收</strong> 然后 <strong>返回</strong> 一个 <strong>引用</strong>，那他就必须是 <strong>同样的引用</strong>，否则你就会返回 <strong>生命周期不够长</strong> 的东西。由于只有这样唯一的一种选择，因此这对 Rust 编译器检查来说就很容易。但是对于这种接收了两个引用并且只返回其中一个的情况，编译器如何确保你返回的引用生命周期足够长呢？</p>
</blockquote>
<p>In this particular code both our values – <code>doro</code> and <code>bruschetta</code> – live long enough. So it can be hard to see why the Rust compiler is confused. But what if we changed our code to:</p>
<blockquote>
<p>在这种特定的代码中，两个值 —— <code>doro</code> 和 <code>bruschetta</code> —— 的生命周期都足够长。因此，对于 Rust 编译器而言，不会混淆。但是，如果我们如下修改我们的代码呢：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = &#123;</span><br><span class="line">      <span class="keyword">let</span> herring = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Pickled Herring"</span>) &#125;;   <span class="comment">//-- Herring created here</span></span><br><span class="line">      trickster_friend_again(&amp;herring, &amp;bruschetta)                   <span class="comment">// |</span></span><br><span class="line">    &#125;                                                                 <span class="comment">//-- Herring destroyed here</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If <code>trickster_friend_again</code> returns <code>bruschetta</code> then that code would be fine. But if it returns <code>herring</code> we’d try to photograph a dish that no longer existed. This is unsafe, so Rust won’t let us do it.</p>
<blockquote>
<p>如果捣蛋鬼朋友返回 <code>bruschetta</code> ，那么代码会良好运行。但是如果返回 <code>herring</code> ，我们会对一盘不再存在的菜进行拍照。这是不安全的，所以 Rust 不允许我们如此操作。</p>
</blockquote>
<p>If the Rust compiler ever has any questions about what reference a  function will return then that function must explicitly declare a  lifetime. Our trickster friend could declare one of four lifetimes:</p>
<blockquote>
<p>如何 Rust 编译器对于函数将会返回什么引用有疑问，那么该函数就必须显式指明一个生命周期。我们的捣蛋鬼朋友可以（显式）指定一个生命周期，他有四种选择：</p>
</blockquote>
<p>Option One:</p>
<blockquote>
<p>选择一：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_one</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class="symbol">'a</span> Dish</span><br></pre></td></tr></table></figure>
<p>Option Two:</p>
<blockquote>
<p>选择二：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_two</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class="symbol">'a</span> Dish) -&gt; &amp;<span class="symbol">'a</span> Dish</span><br></pre></td></tr></table></figure>
<p>Option Three:</p>
<blockquote>
<p>选择三：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_three</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;<span class="symbol">'a</span> Dish) -&gt; &amp;<span class="symbol">'a</span> Dish</span><br></pre></td></tr></table></figure>
<p>Option Four:</p>
<blockquote>
<p>选择四：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_four</span></span>&lt;<span class="symbol">'a</span>, <span class="symbol">'b</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;<span class="symbol">'b</span> Dish) -&gt; &amp;<span class="symbol">'a</span> Dish</span><br></pre></td></tr></table></figure>
<p>Let’s see the differences between those options:</p>
<blockquote>
<p>让我们看下这些不同选择的差异：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Dish</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Dish &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">photograph</span></span>(&amp;<span class="keyword">self</span>, photographer: &amp;<span class="built_in">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"Snap! &#123;&#125; photographed by &#123;&#125;"</span>, <span class="keyword">self</span>.name, photographer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_lifetime_one</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class="symbol">'a</span> Dish &#123;</span><br><span class="line">    first_dish.photograph(<span class="string">"Trickster Friend"</span>);</span><br><span class="line">    second_dish.photograph(<span class="string">"Trickster Friend"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Uncomment below to try to return second_dish</span></span><br><span class="line">    <span class="comment">//second_dish</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Comment this out when you try to return second_dish</span></span><br><span class="line">    first_dish</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = trickster_friend_lifetime_one(&amp;doro, &amp;bruschetta);</span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://play.rust-lang.org/?code=struct+Dish+%7B%0A++++name%3A+String%2C%0A%7D%0A%0Aimpl+Dish+%7B%0A++++fn+photograph%28%26self%2C+photographer%3A+%26str%29+%7B%0A++++++++println%21%28%22Snap%21+%7B%7D+photographed+by+%7B%7D%22%2C+self.name%2C+photographer%29%0A++++%7D%0A%7D%0A%0Afn+trickster_friend_lifetime_one%3C%27a%3E%28first_dish%3A+%26%27a+Dish%2C+second_dish%3A+%26Dish%29+-%3E+%26%27a+Dish+%7B%0A++++first_dish.photograph%28%22Trickster+Friend%22%29%3B%0A++++second_dish.photograph%28%22Trickster+Friend%22%29%3B%0A%0A++++%2F%2FUncomment+below+to+try+to+return+second_dish%0A++++%2F%2Fsecond_dish%0A%0A++++%2F%2FComment+this+out+when+you+try+to+return+second_dish%0A++++first_dish%0A%7D%0A%0Afn+main%28%29+%7B%0A++++let+doro+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Doro+Wat%22%29+%7D%3B%0A++++let+bruschetta+%3D+Dish+%7B+name%3A+String%3A%3Afrom%28%22Bruschetta%22%29+%7D%3B%0A%0A++++let+mystery_meal+%3D+trickster_friend_lifetime_one%28%26doro%2C+%26bruschetta%29%3B%0A%0A++++mystery_meal.photograph%28%22Me%21%22%29%3B%0A%7D" target="_blank" rel="noopener">Run</a></p>
<p>In this example we’ve declared one lifetime, given it to the reference passed to <code>first_dish</code> and our return value. Trickster friend now <em>must</em> return first_dish.</p>
<blockquote>
<p>在这个例子中，我们指定了一个生命周期，将其给到传给 <code>first_dish</code> 的引用，还指定了一个返回值。现在，捣蛋鬼朋友必须返回 <code>first_dish</code> 。</p>
</blockquote>
<p>Let’s try the <code>herring</code> code again:</p>
<blockquote>
<p>让我们再试一下 <code>herring</code> 的代码：</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_lifetime_one</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;Dish) -&gt; &amp;<span class="symbol">'a</span> Dish &#123;</span><br><span class="line">    first_dish</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = &#123;</span><br><span class="line">      <span class="keyword">let</span> herring = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Pickled Herring"</span>) &#125;;   <span class="comment">//-- Herring created here</span></span><br><span class="line">      trickster_friend_lifetime_one(&amp;doro, &amp;herring)                  <span class="comment">// |  this will always return doro</span></span><br><span class="line">    &#125;                                                                 <span class="comment">//-- Herring destroyed here</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using our current Trickster Friend this code will compile, because there is no way that <code>mystery_meal</code> will ever be <code>herring</code>.</p>
<blockquote>
<p>现在，我们的捣蛋鬼朋友代码可以编译通过了，因为 <code>mystery_meal</code> 不可能会是 <code>herring</code>。</p>
</blockquote>
<p>Option Two is the inverse of Option One. The function must now return the <code>second_dish</code>. If we pass in <code>herring</code> as the first dish, our code still runs.</p>
<blockquote>
<p>选择一反过来就是选择二。该函数现在必须返回 <code>second_dish</code> 。如果我们传入  <code>herring</code> 作为第一参数，我们的代码仍然会运作。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_two</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;Dish, second_dish: &amp;<span class="symbol">'a</span> Dish) -&gt; &amp;<span class="symbol">'a</span> Dish &#123;</span><br><span class="line">  second_dish</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = &#123;</span><br><span class="line">      <span class="keyword">let</span> herring = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Pickled Herring"</span>) &#125;;   <span class="comment">//-- Herring created here</span></span><br><span class="line">      trickster_friend_lifetime_two(&amp;herring, &amp;doro)                  <span class="comment">// |   this will always return &amp;doro</span></span><br><span class="line">    &#125;                                                                 <span class="comment">//-- Herring destroyed here</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Option Three gives the same lifetime to both parameters so the  function could return either of them. Our herring code will fail to  compile regardless of parameter order because <code>mystery_meal</code> could be bound to a destroyed value.</p>
<blockquote>
<p>选择三给予两个参数同样的生命周期，因此函数可以返回其中的任意一个。如论是什么传参顺序，我们的 <code>herring</code> 代码会编译失败。因为 <code>mystery_meal</code> 会绑定到一个已经销毁了的值。</p>
</blockquote>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">trickster_friend_option_three</span></span>&lt;<span class="symbol">'a</span>&gt;(first_dish: &amp;<span class="symbol">'a</span> Dish, second_dish: &amp;<span class="symbol">'a</span> Dish) -&gt; &amp;<span class="symbol">'a</span> Dish &#123;</span><br><span class="line">  <span class="comment">// logic to determine if first_dish or second_dish is returned</span></span><br><span class="line">  dish_to_return</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> doro = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Doro Wat"</span>) &#125;;</span><br><span class="line">    <span class="keyword">let</span> bruschetta = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Bruschetta"</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> mystery_meal = &#123;</span><br><span class="line">      <span class="keyword">let</span> herring = Dish &#123; name: <span class="built_in">String</span>::from(<span class="string">"Pickled Herring"</span>) &#125;;   <span class="comment">//-- Herring created here</span></span><br><span class="line">      trickster_friend_lifetime_three(&amp;herring, &amp;doro)                <span class="comment">// |   this could return doro or herring</span></span><br><span class="line">    &#125;                                                                 <span class="comment">//-- Herring destroyed here</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mystery_meal.photograph(<span class="string">"Me!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In our dinner party Option Four is functionally the same as Option  One. We’ve declared two lifetimes but we’re never using the second one  making it irrelevant. I’m sure there are times when having two lifetimes  on a function is useful, but I haven’t come across them. <a href="https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes" target="_blank" rel="noopener">The book says you can have multiple lifetimes, but don’t explain why</a>. I’d love to know more about this.</p>
<blockquote>
<p>在我们的晚餐聚会中，选择四功能上和选择一相同。我们指定了两个生命周期，但是并没有使用第二个，而是使其不相关。我能确定的是，指定两个生命周期的场景是有用的，但我自己并没有遇到过。<a href="https://doc.rust-lang.org/book/lifetimes.html#multiple-lifetimes" target="_blank" rel="noopener">这本书介绍了可以指定多个生命周期的，但并没有解释原因</a>，关于这点我想知道更多一些。</p>
</blockquote>
<p>Is there more to lifetimes than this? Almost certainly. But I hope  that this analogy helps you grasp the fundamentals of why Rust has  lifetimes. If you want to learn more about fundamentals of Rust, maybe  read one of my earlier posts, <a href="http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/" target="_blank" rel="noopener">Rust via its Core Values</a>. I also suggest the <a href="http://www.newrustacean.com/" target="_blank" rel="noopener">New Rustacean</a> podcast, which has helped me understand quite a lot about Rust.</p>
<blockquote>
<p>关于生命周期，有比这更多的资料么？几乎可以肯定。但是我希望这个类比可以帮助你抓住为何 Rust 有生命周期这个核心基础。如果你想学习更多关于 Rust 基础知识，或许可以阅读我的早期博文 —— <a href="http://designisrefactoring.com/2016/04/01/rust-via-its-core-values/" target="_blank" rel="noopener">Rust via its Core Values</a>。 我也同样建议<a href="http://www.newrustacean.com/" target="_blank" rel="noopener">播客 New Rustacean</a>，该播客帮助我理解了很多 Rust 知识。</p>
</blockquote>
	  
	</div>

	<!-- recommended posts -->
	

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2019/04/10/How-to-specify-a-newer-version-gcc-for-cmake/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2019/03/03/What I have learnt from the Dissertation of Danqi/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_more" data-cmd="more"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
        <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
        <a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
        <a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a>
        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
        <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};
        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>


        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>
    	 
	 <div id="comment-thread"></div>
	 <div id="loading-spin"></div>
	 <script type="text/javascript">
	   getComments({
           type: "github" ? "github" : "github",       
	       user: "generalibm",
	       repo: "generalibm.github.io",
		   client_id: "bf7d4ba11877db88543e",
           client_secret: "bff8a6b06b745c0bfcdccbe225623ea8e2a057bb",
		   no_comment: "No comments yet. Press the button and go to comment now!",
		   go_to_comment: "Go to comment",
		   no_issue: "no_issue",
		   issue_title: "[Translation] Design is refactoring",
		   issue_id: "",
		   btn_class: "btn btn-primary",
		   comments_target: "#comment-thread",
		   loading_target: "#loading_spin"
		   });
	 </script>
  
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2019-03-06 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    </li><li><a href="/categories/translation/">translation<span>4</span></a></li>
  

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/rust/">rust<span>1</span></a></li> <li><a href="/tags/lifetime-rule/">lifetime rule<span>1</span></a></li> <li><a href="/tags/borrowing-rule/">borrowing rule<span>1</span></a></li>
    </ul>
	</div>
	

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Design-is-Refactoring-The-Lifetime-of-Food"><span class="toc-article-text">Design is Refactoring-The Lifetime of Food</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 generalibm
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 




   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>


<!-- syntax highlighting -->

  <script>
  marked.setOptions({
    highlight: function (code, lang) {
        return hljs.highlightAuto(code).value;
    }
  });
  function Highlighting(){
    var markdowns = document.getElementsByClassName('markdown');
    for(var i=0;i<markdowns.length;i++){
        if(markdowns[i].innerHTML) markdowns[i].innerHTML =marked(markdowns[i].innerHTML);
    }
  }
  window.addEventListener('DOMContentLoaded', Highlighting, false);
  window.addEventListener('load', Highlighting, false);
  </script>


</body>
   </html>
